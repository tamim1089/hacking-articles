<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Beginner Guide to IPtables</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/beginner-guide-iptables/" rel="bookmark"><time class="entry-date published updated" datetime="2018-02-09T16:48:07+00:00">February 9, 2018</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Hello friends!! In this article, we are going to discuss on Iptables and its uses. <strong>Iptables</strong> is a command-line firewall, installed by default on all official Ubuntu distributions. Using Iptables, you can label a set of rules, that will be gone after by the Linux kernel to verify all incoming and outgoing network traffic.</span></p>
<p><span style="color: #000000;">Today we will look at some basic concept of Ipatble using various Iptables options to generate a <strong>Filter Table </strong>which will filter the incoming and outgoing traffic</span></p>
<p><span style="color: #000000;"><strong>Basic Iptables Options </strong></span></p>
<p><span style="color: #000000;"><strong>-A</strong>: Add this rule to a rule chain.</span></p>
<p><span style="color: #000000;"><strong>-L:</strong>  List the current filter rules.</span></p>
<p><span style="color: #000000;"><strong>-m conntrack :</strong> Allow filter rules to match based on connection state. Permits the use of the –ctstate option.</span></p>
<p><span style="color: #000000;"><strong>–ctstate:</strong> Define the list of states for the rule to match on. Valid states are:</span></p>
<ul>
<li><span style="color: #000000;"><strong>NEW</strong> – The connection has not yet been seen.</span></li>
<li><span style="color: #000000;"><strong>RELATED</strong> – The connection is new, but is related to another connection already permitted.</span></li>
<li><span style="color: #000000;"><strong>ESTABLISHED</strong> – The connection is already established.</span></li>
<li><span style="color: #000000;"><strong>INVALID</strong> – The traffic couldn’t be identified for some reason.</span></li>
</ul>
<p><span style="color: #000000;"><strong>-m limit:</strong> Require the rule to match only a limited number of times. Allows the use of the –limit option.</span></p>
<p><span style="color: #000000;"><strong>Useful for limiting logging rules:</strong></span></p>
<ul>
<li><span style="color: #000000;">–limit – The maximum matching rate, given as a number followed by “/second”, “/minute”, “/hour”, or “/day” depending on how often you want the rule to match. If this option is not used and -m limit is used, the default is “3/hour”.</span></li>
</ul>
<p><span style="color: #000000;"><strong>-p: </strong>Describe the connection protocol used.</span></p>
<p><span style="color: #000000;"><strong>–dport :</strong>  The destination port(s) required for this rule. A single port may be given, or a range may be given as start: end, which will match all ports from start to end, inclusive.</span></p>
<p><span style="color: #000000;"><strong>-j :</strong>  Jump to the specified target. By default, iptables allows four targets:</span></p>
<ul>
<li><span style="color: #000000;"><strong>ACCEPT </strong>– Accept the packet and stop processing rules in this chain.</span></li>
<li><span style="color: #000000;"><strong>REJECT</strong>– Reject the packet and notify the sender that we did so, and stop processing rules in this chain.</span></li>
<li><span style="color: #000000;"><strong>DROP</strong>– Silently ignore the packet, and stop processing rules in this chain.</span></li>
<li><span style="color: #000000;"><strong>LOG</strong>– Log </span></li>
</ul>
<p><span style="color: #000000;"><strong>-I</strong><strong>:</strong> Inserts a rule. Takes two options, the chain to insert the rule into, and the rule number it should be.</span></p>
<p><span style="color: #000000;"><strong>-I:</strong>  INPUT 5 would insert the rule into the INPUT chain and make it the 5th rule in the list.</span></p>
<p><span style="color: #000000;"><strong>-s:</strong> –source – address [/mask] source specification</span></p>
<p><span style="color: #000000;"><strong>-d:</strong> –destination – address[/mask] destination specification</span></p>
<p><span style="color: #000000;">Iptables follow Ipchain rules which is nothing but the bunch of firewall rules to control incoming and outgoing traffic</span></p>
<p><span style="color: #000000;"><strong>Three Important Types Iptable chains</strong></span></p>
<p><span style="color: #000000;"><strong>Input Chain:</strong>  Input chain rule is used to manage the activities of incoming traffic towards the server.</span></p>
<p><span style="color: #000000;"><strong>Output Chain:</strong> Output chain rule is used to manage the activities of outgoing traffic from your server.</span></p>
<p><span style="color: #000000;"><strong>Forward Chain:</strong> A forward chain rule is used for adding up rules related to forwarding of an IP packet. This is usually used while you have a Linux machine as router linking two networks collectively.</span></p>
<p><span style="color: #000000;">As described above by default install iptable is available in all Ubuntu distribution but if it is not installed in any Linux based system and you want to install it then execute given below command.</span></p>
<pre class="lang:default decode:true">sudo apt-get install iptables</pre>
<p><span style="color: #000000;">By default, iptable is blank which allows all incoming and outgoing connection traffic without filtering them. In order to verify inbuilt rules of iptable, we need to execute the following command which displays the list of rules if added in iptables.</span></p>
<pre class="lang:default decode:true ">sudo iptables -L -v</pre>
<p><span style="color: #000000;">here <strong>-L </strong>has used for display the chain rules of iptables and  <strong>-v</strong> for complete information.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-BQhUbHEWkUA/Wn27qT0rXqI/AAAAAAAAUN8/f2H7pUX2Fy8QmirIYOpSKa6lhcm9UOiwQCEwYBhgL/s1600/1.png"/></span></p>
<h3><span style="color: #800000;"><strong>Allow Incoming Traffic</strong></span></h3>
<p><span style="color: #000000;">In order to allow traffic for any particular port you can use given below command here we have accepted incoming on port 22 for SSH, 80 for HTTP and 443for HTTPS respectively</span></p>
<pre class="lang:default decode:true ">sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 443 -j ACCEPT</pre>
<p><span style="color: #000000;">So it will allow tcp connection when traffic will coming on port 22, 80 and 443.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-UO8jCHa-UP0/Wn27sNrOR0I/AAAAAAAAUN4/dZdtYSCzDooEBFupb9_meLAu_Au0wrZGACEwYBhgL/s1600/2.png"/></span></p>
<h3><span style="color: #800000;"><strong>Drop/Deny Incoming Traffic</strong></span></h3>
<p><span style="color: #000000;">In order to deny traffic for any particular port you can use given below command here we have drop incoming on port 21 for FTP and 23 for Telnet respectively</span></p>
<pre class="lang:default decode:true ">sudo iptables -A INPUT -p tcp --dport 21 -j DROP
sudo iptables -A INPUT -p tcp --dport 23 -j DROP</pre>
<p><span style="color: #000000;">So it will deny tcp connection when traffic will coming on port 21, 23 and give a message <strong>Time Out</strong>.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-AGOxv5vpNUs/Wn27srXXXWI/AAAAAAAAUOI/vETuD6Tqb_sCtmZRDbzf0wN3uQlBcBBewCEwYBhgL/s1600/3.png"/></span></p>
<h3><span style="color: #800000;"><strong>Reject Incoming Traffic</strong></span></h3>
<p><span style="color: #000000;">Reject and Drop action closely work same in order to obstruct the incoming traffic from establishing a connection with the server only the difference is that, here it will send a message with “<strong>ICMP message Port Unreachable</strong>” and drop the incoming packet. You can use given below command here we have to reject incoming on port 25 for SMTP.</span></p>
<pre class="lang:default decode:true">sudo iptables -A INPUT -p tcp --dport 25 –j REJECT
</pre>
<p><span style="color: #000000;">So it will drop tcp connection when traffic will coming on port 25 and give a message<strong> Destination Port Unreachable</strong>.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-CoLDf-n2cSk/Wn27smzcnTI/AAAAAAAAUOI/bsWFCJhmjsIJM_OV2QaRqczB82DYB99NwCEwYBhgL/s1600/4.1.png"/></span></p>
<h3><span style="color: #800000;"><strong>Allow Incoming Traffic from Specific IP</strong></span></h3>
<p><span style="color: #000000;">In order to allow traffic form only a particular IP to establish a secure connection between server and client you can execute given below command</span></p>
<pre class="lang:default decode:true ">sudo iptables -A INPUT -s 192.168.1.104 -j ACCEPT</pre>
<p><span style="color: #000000;">It will accept packet coming from network 192.168.1.104</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-mcp6Y4J9kps/Wn27swypMeI/AAAAAAAAUN8/nRvI6sjdLCYIDob43QrYYwRDsedJWEiPgCEwYBhgL/s1600/4.png"/></span></p>
<h3><span style="color: #800000;"><strong>Block Specific Network IP</strong></span></h3>
<p><span style="color: #000000;">In order to deny traffic form only a particular IP to establish a secure your server from attacker’s IP you can execute given below command</span></p>
<pre class="lang:default decode:true ">sudo iptables -A INPUT -s 192.168.1.102 -j DROP</pre>
<p><span style="color: #000000;">It will deny packet coming from network 192.168.1.102</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-xr9QWh8La8Q/Wn27tS6j0LI/AAAAAAAAUOI/-YL-_l9POzIgMkbQ7htoybTKpjKWvk4ZgCEwYBhgL/s1600/5.png"/></span></p>
<h3><span style="color: #800000;"><strong>Block Specific Network Interface</strong></span></h3>
<p><span style="color: #000000;">To block a specific network interface, for example, eth0, execute given below command which drops the incoming traffic coming from 10.10.10.10</span></p>
<pre class="lang:default decode:true">sudo iptables -A INPUT -i eth0 -s 10.10.10.10 -j DROP</pre>
<p><span style="color: #000000;">Here you can change the action to allow traffic from a particular network interface using –j ACCEPT options.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-LBWUDm6iyuE/Wn27trswPjI/AAAAAAAAUOA/waauodV0Q5wRGAFXnzDh0fbGOf1nNzXdACEwYBhgL/s1600/6.png"/></span></p>
<h3><span style="color: #800000;"><strong>Block Specific IP Range</strong></span></h3>
<p><span style="color: #000000;">To block a specific IP range in order to deny, the incoming traffic coming from a specific range of IP. Execute given below command which drops incoming packet coming from IP 192.168.1.100 till IP 192.168.1.200</span></p>
<pre class="lang:default decode:true ">sudo iptables -A INPUT -m iprange --src-range 192.168.1.100-192.168.1.200 -j DROP</pre>
<p><span style="color: #000000;">Here you can change the action to allow traffic from a particular IP range using –j ACCEPT options.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-FzAMl159_0Q/Wn27thNyvQI/AAAAAAAAUOE/tUDLP_QYfhwaVQg41vb15skda6wXfIJZACEwYBhgL/s1600/7.png"/></span></p>
<h3><span style="color: #800000;"><strong>Block Specific Mac Address</strong></span></h3>
<p><span style="color: #000000;">To block a specific Mac address in order to deny, the incoming traffic coming from a specific machine. Execute given below command which drops incoming packet coming from given Mac address or attacker machine.</span></p>
<pre class="lang:default decode:true ">sudo iptables -A INPUT -m mac --mac-source FC:AA:14:6A:9A:A2 -j DROP</pre>
<p><span style="color: #000000;">Here you can change the action to allow traffic from a particular Mac address using –j ACCEPT options.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ySunA3NW7qk/Wn27uHZQDBI/AAAAAAAAUOE/0dQmQIBMGw4MgvMWl2N9n3CZa_0oO5r6wCEwYBhgL/s1600/8.png"/></span></p>
<h3><span style="color: #800000;"><strong>Block Ping Request</strong></span></h3>
<p><span style="color: #000000;">Network administrator always concerns with network security, therefore, they always Block Ping request either by using Drop or Reject action, here we are blocking Ping request using DROP option as given in below command.</span></p>
<pre class="lang:default decode:true ">sudo iptables -A INPUT -p icmp -i eth0 -j DROP</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-UHpL_KgfVLo/Wn27uSm6B0I/AAAAAAAAUOI/8vgBqk19DCgghMgPSGaKsoUQ87hyhydDQCEwYBhgL/s1600/9.png"/></span></p>
<p><span style="color: #000000;"><strong>View List of Applied Chain rules</strong></span></p>
<p><span style="color: #000000;">In order to view our applied chain rules once again, we are going to execute given below command which will dump the list of Iptable rules.</span></p>
<pre class="lang:default decode:true ">sudo iptables -L</pre>
<p><span style="color: #000000;">From given below image you can observe 4 columns which contain records of IPtable rules.</span></p>
<p><span style="color: #000000;">Here these columns define the following information:</span></p>
<p><span style="color: #000000;"><strong>Target:</strong> Defines applied action</span></p>
<p><span style="color: #000000;"><strong>Prot:</strong> stand for Protocol type that can TCP, ICMP or UDP</span></p>
<p><span style="color: #000000;"><strong>Option:</strong> further option to define the rule, here it is blank</span></p>
<p><span style="color: #000000;"><strong>Source:</strong> Incoming traffic network IP Address</span></p>
<p><span style="color: #000000;"><strong>Destination:</strong> Host IP address which will receive incoming traffic packet.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-K4bOr8CoTmM/Wn27qf08M0I/AAAAAAAAUOI/XF2NBq7ojgotH83w2MMM4HTFjN5H1DwwACEwYBhgL/s1600/11.png"/></span></p>
<p><span style="color: #000000;">Now if someone tries to Ping the server machine as shown in given below image, so here you can read the message “Request timed out” which means the server machine has dropped our ICMP request packet.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-nELgUVMDxME/Wn27qVaeTrI/AAAAAAAAUOA/CyWOppHlPwYsGKVE5Ype2jzWrG4vrtrZQCEwYBhgL/s1600/12.1.png"/></span></p>
<h3><span style="color: #800000;"><strong>Deleting Any Rule </strong></span></h3>
<p><span style="color: #000000;">In order to delete any rule of your Iptable to remove it from inside your filter table, you can use <strong>option -D</strong> with input rule number.  We are going to remove our last rule ICMP drop connection which was at number 12 in the given list of the rule.</span></p>
<pre class="lang:default decode:true ">sudo iptables -D INPUT 12</pre>
<p><span style="color: #000000;">Here you can replace number 12 from any other number which rule you wish to remove according to your list of rules.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-wGUP0i3VeK0/Wn27rVzVriI/AAAAAAAAUOE/g9XJVr9IPBconbZAzcYKXIwb6syxRPWcACEwYBhgL/s1600/12.png"/></span></p>
<p><span style="color: #000000;">Let’s view our remaining chain rules once again using the -L option as done above. From given below image you can observe that now the list contain only 11 rules and eliminated rule ICMP drop the connection.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-zB0CVxBiVKM/Wn27r3Q4RdI/AAAAAAAAUN8/_aJS5oHuMSQ_IpZQ3LPc47s9KPXG_C_swCEwYBhgL/s1600/13.png"/></span></p>
<h3><span style="color: #800000;"><strong>Flush IPtables</strong></span></h3>
<p><span style="color: #000000;">If you want to remove the entire set of rule in order to flush your Iptable then use option -F to flush your ipatble applied rules and execute given below command.</span></p>
<pre class="lang:default decode:true ">sudo iptables -F</pre>
<p><span style="color: #000000;">Now once again when we had viewed the list of the rule, this time we got the empty table as shown in the given below image.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-49A1wrFGCBA/Wn27r1l0GHI/AAAAAAAAUOE/XuULscyLZlMrU3CROIYgfog-g_R6J_0YQCEwYBhgL/s1600/14.png"/></span></p>
<p><span style="color: #000000;"><strong>Source: https://help.ubuntu.com/community/IptablesHowTo</strong></span></p>
<p><strong>Author: </strong>AArti Singh is a Researcher and Technical Writer at Hacking Articles an Information Security Consultant Social Media Lover and Gadgets. Contact<strong><a href="https://www.linkedin.com/in/aarti--singh/"> here</a></strong></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
