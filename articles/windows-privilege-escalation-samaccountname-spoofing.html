<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/red-teaming/" rel="category tag">Red Teaming</a></span>            </div>
            <h1 class="post-title entry-title">Windows Privilege Escalation: sAMAccountName Spoofing</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/windows-privilege-escalation-samaccountname-spoofing/" rel="bookmark"><time class="entry-date published" datetime="2022-01-10T21:13:03+00:00">January 10, 2022</time><time class="updated" datetime="2025-05-10T20:52:40+00:00">May 10, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">This post discusses how CVE-2021-42278 allows potential attackers to gain high privileged user access (domain controllers Administrator level access) via a low privileged user (any normal Domain user)</span></p>
<p><span style="color: #000000;"><strong>Description:</strong> Active Directory Domain Services Elevation of Privilege Vulnerability This CVE ID is unique from CVE-2021-42278, CVE-2021-42282, CVE-2021-42291.</span></p>
<p><span style="color: #000000;"><strong>Release Date:</strong> Nov 9, 2021</span></p>
<p><span style="color: #000000;"><strong>Impact:</strong> Elevation of Privilege</span></p>
<p><span style="color: #000000;"><strong>Severity:</strong> Important</span></p>
<p><span style="color: #000000;"><strong>CVSS score:</strong> 8.8</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEhUJzqlbnxZrQF73l7wPdStpxlqspAIMUGK4x2Zk1-OHoRWcWeVfVwC3D7ckvbIae9jjwilQL6kW1-xe_7v6GbCHOo5oiYUSje9yJ714WPuD4DzQ-xh52JGLx4qmuYbGoJyiRJIUmTzaWC3qb_t6npbW0S8KCdDzuwLJOsFgNZHh9Um4vgtfbcEia9lNA=s16000"/></span></p>
<h3><span style="color: #800000;"><strong>Pentest Lab setup</strong></span></h3>
<p><span style="color: #000000;">In our lab setup, we use a <strong data-start="761" data-end="772">Kali VM</strong> as the attacker machine, and a <strong data-start="804" data-end="833">Windows domain controller</strong> (running on vulnerable <strong data-start="857" data-end="878">Windows platforms</strong>) serves as the target system. This <strong data-start="914" data-end="935">domain controller</strong> remains unpatched since <strong data-start="960" data-end="980">November 9, 2021</strong>, which makes it vulnerable to <strong data-start="1011" data-end="1027">exploitation</strong>.</span></p>
<p><span style="color: #000000;">Next, we will create a <strong data-start="452" data-end="460">user</strong> with <strong data-start="466" data-end="499">normal domain user privileges</strong> in the test <strong data-start="512" data-end="533">Domain Controller</strong> lab setup. This step is essential to simulate a low-privileged user scenario.</span></p>
<p><span style="color: #000000;">To check user details on the <strong data-start="642" data-end="663">Domain Controller</strong>, run the following command. As you can see, the <strong data-start="712" data-end="720">user</strong> appears as a <strong data-start="734" data-end="756">normal domain user</strong> (highlighted in red), confirming the privilege level.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">net user sakshi</pre>
<p><span style="color: #000000;"><strong><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEjimJpxnvI0YnvCZvfez16f-y3jqhrFe_fEfNn3MoLodMxxYdsU119qQjwF-ibUB0Epq4mL6EjoE2_3819nG26bAxTK2lha2N8gXL8iL56VVTsbEzzjB_zyIV6ATLLsJsrbEnsljEq3-GPmvjwz5v9zdN0t63LFo1OwfG1hdaSZksYKqjD5DILbM6d7ug=s16000"/></strong></span></p>
<h3><span style="color: #800000;"><strong>Exploitation</strong></span></h3>
<p><span style="color: #000000;">Now on your attacker system, which is Kali VM, you have to clone the exploit from the git repository provided below.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone https://github.com/Ridter/noPac</pre>
<p><span style="color: #000000;">After cloning the repo <strong><a style="color: #000000;" href="https://github.com/Ridter/noPac"><span style="color: #0000ff;">https://github.com/Ridter/noPac</span></a></strong>, navigate to the noPac folder</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cd noPac
ls -al</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEgWBhW8jZIbBB_rHqPUzSNMphKReY58NktDe5W8Wfj-HdTmJNpuqWonnTDWomDMhttz6SsQmvbj_BI4TOgseYCt8-50EpJR_Hys0oaaosTiCL8PTDyJxVOuDBATjKwdvrvDdfuD12Yp7qHQDYAiXLfJ9AGnuYgEJ5v9HmQ8TiEagTBSTrWYpziH8m7owQ=s16000"/></span></p>
<p><span style="color: #000000;">And then execute the command</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python3 noPac.py ignite.local/sakshi:'Password@1' -dc-ip 192.168.1.182 -shell --impersonate administrator -use-ldap</pre>
<p><span style="color: #000000;">This <strong data-start="439" data-end="446">CVE</strong> represents a security bypass vulnerability caused by Kerberos’s PAC confusion and the impersonation of domain controllers.</span></p>
<p><span style="color: #000000;">It <strong data-start="575" data-end="585">allows</strong> potential attackers to impersonate domain controllers by requesting TGTs from <strong data-start="664" data-end="676">Kerberos</strong> without a PAC. Consequently, the attacker impersonates a <strong data-start="306" data-end="332">highly privileged user</strong> as soon as Kerberos issues the TGT without a <strong data-start="378" data-end="385">PAC</strong>.</span></p>
<p><span style="color: #000000;">To achieve this, you configure the <a style="color: #000000;" href="https://docs.microsoft.com/en-us/windows/win32/ad/security-properties">“<span style="color: #0000ff;"><strong>altSecurityIdentities</strong></span>“</a> attribute to make the <strong data-start="475" data-end="496">domain controller</strong> add a <strong data-start="503" data-end="510">PAC</strong> when it receives a service ticket (ST) request using a TGT without a PAC.</span></p>
<p><span style="color: #000000;">This process involves modifying the <em>altSecurityIdentities</em> attribute of an account in a foreign domain to <strong>Kerberos:[samaccountname]@[domain]</strong> to impersonate that user.</span></p>
<p><span style="color: #000000;"><strong><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEjK8ZAWY-v4W80_VthPFYWwury6Lc3ReJm_X6s3bRBsqL1o3v_YSMyLy6lpeJ1mFGG3qi30GshEko_2qQI_AsW4SuXCgyyFQlmGACW6VutWb7feE_twToPAsEox1F_mxinY46bW7mIskJx6r9t-k83dvUfvZCGCe9vlxZMnzLoRQYsnpdzXcQB9tp90Dg=s16000"/></strong></span></p>
<p><span style="color: #000000;">As a result, the command execution on the attacker machine (<strong data-start="650" data-end="661">Kali VM</strong>) displays that it has acquired <code data-start="693" data-end="716">"NT AUTHORITY\SYSTEM"</code> privileges.</span></p>
<h3><span style="color: #800000;"><strong>Mitigation</strong></span></h3>
<p><span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://support.microsoft.com/en-us/topic/november-14-2021-kb5008602-os-build-17763-2305-out-of-band-8583a8a3-ebed-4829-b285-356fb5aaacd7">KB5008602</a></strong></span></p>
<p><span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://support.microsoft.com/en-us/topic/kb5008380-authentication-updates-cve-2021-42287-9dafac11-e0d0-4cb8-959a-143bd0201041">KB5008380</a> </strong></span></p>
<h3><span style="color: #000000;"><strong><span style="color: #800000;">References</span>:</strong></span></h3>
<p><span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2021-42287">CVE-2021-42287</a></strong></span></p>
<p><span style="color: #000000;"><strong>Author details:</strong> Amit Kishor is having 10 plus years of Network Security experience with expertise on multiple Firewall products as well as SaaS products.  C</span><span style="color: #000000;">ontact on <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="http://linkedin.com/in/amit-kishor-627a8b39">LinkedIn</a></strong></span></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
