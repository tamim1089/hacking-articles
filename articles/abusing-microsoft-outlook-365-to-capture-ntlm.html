<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/red-teaming/" rel="category tag">Red Teaming</a></span>            </div>
            <h1 class="post-title entry-title">Abusing Microsoft Outlook 365 to Capture NTLM</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/abusing-microsoft-outlook-365-to-capture-ntlm/" rel="bookmark"><time class="entry-date published" datetime="2020-05-25T09:11:23+00:00">May 25, 2020</time><time class="updated" datetime="2025-06-01T18:14:49+00:00">June 1, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="ai-optimize-6 ai-optimize-introduction"><span style="color: #000000;">In this post we will discuss “How the attacker uses the Microsoft office for phishing attack to get the NTLM hashes from Windows.” Since we all knew that Microsoft Office applications like Word , PowerPoint , Excel and Outlook are the most reliable resource for any organization, and an attacker takes advantage of this reliance to masquerade the user.</span></p>
<p class="ai-optimize-7"><span style="color: #000000;">Here, we’ve been trying to explain what a different approach an attack uses for a phishing attack to capture Microsoft Windows NTLM hashes.</span></p>
<p class="ai-optimize-8"><span style="color: #000000;">In actual fact, the attacker tried to use the UNC path injection technique to capture the Windows NTLM hashes and use phishing to achieve his goal.</span></p>
<h3 class="ai-optimize-9"><span style="color: #800000;">Table of Content</span></h3>
<ul>
<li class="ai-optimize-10"><span style="color: #000000;">Link UNC Path in an Image</span></li>
<li class="ai-optimize-11"><span style="color: #000000;">Link UNC PATH in a Text File</span></li>
<li class="ai-optimize-12"><span style="color: #000000;">Link UNC PATH Word Document</span></li>
</ul>
<h3 class="ai-optimize-13"><span style="color: #000000;"><span style="color: #800000;">Walkthrough</span> </span></h3>
<p class="ai-optimize-14"><span style="color: #000000;">Here we are using Kali Linux and its IP is 192.168.1.112, this IP will be used for UNC Path.</span></p>
<p class="ai-optimize-15"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-SI_IXsHa2wk/XsuIbdQ6SRI/AAAAAAAAkQ0/WpIxY5-DGVoSQJW_NKJArod-5PItlje0QCLcBGAsYHQ/s1600/0.png"/></span></p>
<h3 class="ai-optimize-16"><span style="color: #800000;">Link UNC Path in an Image</span></h3>
<p class="ai-optimize-17"><span style="color: #000000;"><strong>Objective 1: send phishing mail to the target user that contains malicious image.</strong></span></p>
<p class="ai-optimize-18"><span style="color: #000000;">Firstly, use office 365 to linking UNC path within an image. To insert an image and draft a mail for your Victim to masquerade him/her.</span></p>
<p class="ai-optimize-19"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-KCFiCAdhgmA/XsuIbTVX5fI/AAAAAAAAkQw/LnTdVtx-qI4thkGkwwyJNdU9okT5MbzmQCLcBGAsYHQ/s1600/1.png"/></span></p>
<p class="ai-optimize-20"><span style="color: #000000;">Inject the UNC path by adding a hyperlink to the image as shown below. Now-a-day attackers use the COVID-19 precaution images to carry out a large-scale phishing attack.</span></p>
<p class="ai-optimize-21"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ls2Au9exq7Y/XsuIesK36CI/AAAAAAAAkRY/qEs3iPZUTusKocd6M9z97-35d-T9FQBEwCLcBGAsYHQ/s1600/2.png"/></span></p>
<p class="ai-optimize-22"><span style="color: #000000;">And we used our Kali Linux IP here to steal the NTLM hashes. Threat hunters could consider this phase an easy one while hunting for IOC as per the pyramid of plain. Here, the attacker uses the malicious domain address or IP in dword format to evade the intruder detection system.</span></p>
<p class="ai-optimize-23"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-XB7tI51QDuE/XsuIfHfycKI/AAAAAAAAkRg/TDgreK_-llkun2gn2swgJ0ssnnksYCJxQCLcBGAsYHQ/s1600/3.png"/></span></p>
<p class="ai-optimize-24"><span style="color: #000000;">Once you have drafted your message using office 365, install the <strong>responder</strong> in your Kali Linux which to capture the NTLM hashes.</span></p>
<p class="ai-optimize-25"><span style="color: #000000;">Responder is a LLMNR, NBT-NS and MDNS poisoner, with built-in HTTP/SMB/MSSQL/FTP/LDAP rogue authentication server supporting NTLMv1/NTLMv2/LMv2, Extended Security NTLMSSP and Basic HTTP authentication.</span></p>
<p class="ai-optimize-26"><span style="color: #000000;">Run the given command and just after executing responder send the mail to the victim.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">responder -I eth0 -v</pre>
<p class="ai-optimize-27"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-rgR8jo2P0I4/XsuIfRf4DsI/AAAAAAAAkRk/MOLK-DjBC5o4vKCGBSiuhOuKoRVnpIcvACLcBGAsYHQ/s1600/4.png"/></span></p>
<p class="ai-optimize-28"><span style="color: #000000;">Then, when the victim opens the mail and clicks on the image or opens a new tab, or saves the image. Someone has stolen his/her NTLM hashes without his/her knowledge.</span></p>
<p class="ai-optimize-29"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-fMgNKVOiZ_Q/XsuIf2WsThI/AAAAAAAAkRo/gRXgBgobWfABm4FyTc0IDyKYizYrj2vKACLcBGAsYHQ/s1600/5.png"/></span></p>
<p class="ai-optimize-30"><span style="color: #000000;">As a result, the attacker will obtain the NTLM hashes of the victim’s machine as shown in the image given below. Here, you can observe that it has given NetBIOS username along with hashes.</span></p>
<p class="ai-optimize-31"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-w_4tay8mthk/XsuIgMgrARI/AAAAAAAAkRs/W4wVRW2fB1oBJz5ajJXI5n5d5L_cNqMpgCLcBGAsYHQ/s1600/6.png"/></span></p>
<p class="ai-optimize-32"><span style="color: #000000;">An attacker may use John’s ripper or other NTLM hashed cracking tools to retrieve a password. As you can see here, we used the above NTLM hashes file generated by the responder to extract Victim’s password with the help of john the ripper.</span></p>
<p class="ai-optimize-33"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-iy29syGGbfg/XsuIgb1eukI/AAAAAAAAkRw/fwC7hlx5mKIeka064t9CB3HxoPM9fWSiACLcBGAsYHQ/s1600/7.png"/></span></p>
<h3 class="ai-optimize-34"><span style="color: #800000;">Link UNC PATH in a Text File</span></h3>
<p class="ai-optimize-35"><span style="color: #000000;"><strong>Objective 2: Send phishing mail to the target user that contains the Object.</strong></span></p>
<p class="ai-optimize-36"><span style="color: #000000;">Till Office 2013 it was possible to send a malicious attachment by injecting UNC Path. But after Office 2013, the link to the file option is disabled. This prevents an attacker from carrying out a phishing attack via a malicious attachment.</span></p>
<p class="ai-optimize-37"><span style="color: #000000;">Yet the attacker still figures out about the second alternative to send malicious attachment. Despite sending attachment they try to link object in the mail.</span></p>
<p class="ai-optimize-38"><span style="color: #000000;">Here we have added a text file as object, here we cannot use “link to file” feature for injecting UNC path.</span></p>
<p class="ai-optimize-39"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-eQve6FM0SVI/XsuIgtNyM1I/AAAAAAAAkR0/qOPcxpA712k4Fu-TTKVUJhbIS4ViTF6mQCLcBGAsYHQ/s1600/8.png"/></span></p>
<p class="ai-optimize-40"><span style="color: #000000;">Once you will add the object, inject the hyperlink for UNC Path as done above, i.e. \\192.168.1.112 and mail to the victim. On other hand use responder, the to steal NLTM hashes as done above.</span></p>
<p class="ai-optimize-41"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-0YX0rfVaUho/XsuIgj0Dx0I/AAAAAAAAkR4/9JFu74KoKEYMwkYYhJdh4K-3xG2XSA_swCLcBGAsYHQ/s1600/9.png"/></span></p>
<p class="ai-optimize-42"><span style="color: #000000;">Then, when the victim opens the mail and clicks on the text or opens it in a new tab, an attacker steals his/her NTLM hashes without their knowledge.</span></p>
<p class="ai-optimize-43"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-CbLdEiaV3gs/XsuIbXrycnI/AAAAAAAAkQ4/DpACXZTSbXcZ_ldIRytWbBnvpDWXSPZ4gCLcBGAsYHQ/s1600/11.png"/></span></p>
<p class="ai-optimize-44"><span style="color: #000000;">As result the attacker will obtain the NTLM hashes of the victim’s machine as shown in the image given below. Here, you can observe that it has given NetBIOS username along with hashes.</span></p>
<p class="ai-optimize-45"><span style="color: #000000;"><strong><img decoding="async" src="https://1.bp.blogspot.com/-CdsyNSMYjX4/XsuIcdkAwUI/AAAAAAAAkQ8/B5jFgpCxYrMzh-_C1FctYk_3xheKBWynQCLcBGAsYHQ/s1600/12.png"/></strong></span></p>
<h3 class="ai-optimize-46"><span style="color: #000000;"><span style="color: #800000;">Link UNC PATH Word Document</span> </span></h3>
<p class="ai-optimize-47"><span style="color: #000000;"><strong>Objective:</strong> <strong> Send phishing mail to the target user that contains Word Document Attachment.</strong></span></p>
<p class="ai-optimize-48"><span style="color: #000000;">In most scenarios, the attacker uses a Word Document to make the email appear authentic. So, he injects the UNC path inside the document file by hyperlinking the file inside. But as we mention, Outlook removed the option “link to file” or “insert as a link” to prevent attackers from sending malicious documents.</span></p>
<p class="ai-optimize-49"><span style="color: #000000;">There is an alternative technique that allows an attacker to inject the UNC Path into the attachment. We have written the HTML code in a text file containing the UNC Path link in the src image as shown in the html image.</span></p>
<p class="ai-optimize-50"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-3YsMXUWiQ5Q/XsuIc8y2kTI/AAAAAAAAkRA/1IkWK4AEhZcORY_RouBGKiKdQWVrv212ACLcBGAsYHQ/s1600/13.png"/></span></p>
<p class="ai-optimize-51"><span style="color: #000000;">Then open a Word Document and link the HTML file as an object. Thus we move to <strong>“Insert&gt; Object &gt; Text from file”</strong>.</span></p>
<p class="ai-optimize-52"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-uPOPNcOnnBI/XsuIdCp4_-I/AAAAAAAAkRE/JUOba36-goQcdKiMNSTUPXsUfR-IRMwNgCLcBGAsYHQ/s1600/14.png"/></span></p>
<p class="ai-optimize-53"><span style="color: #000000;">Now insert the HTML file and select the option “insert as Link” as shown the image.</span></p>
<p class="ai-optimize-54"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-7eZAJup4iys/XsuIdbMVQvI/AAAAAAAAkRI/qpmVBEEDhd0Xt8iTF17bQJgwcRGXNu91QCLcBGAsYHQ/s1600/15.png"/></span></p>
<p class="ai-optimize-55"><span style="color: #000000;">Then use the Word Document that contains a link to the HTML file, attach it, and send the mail to the victim. Then wait for the victim to respond by putting the responder in the back door.</span></p>
<p class="ai-optimize-56"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-YT0OHurKHAc/XsuIdg1IlPI/AAAAAAAAkRM/jISz3dC_-gMC9wcXGOyo4SDPf-ewXcnmQCLcBGAsYHQ/s1600/16.png"/></span></p>
<p class="ai-optimize-57"><span style="color: #000000;">Now, when the victim opens the mail and clicks on the text or opens a new tab. His/her NTLM hashes have been stolen without his/her knowledge.</span></p>
<p class="ai-optimize-58"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Q7A3CfBUbkc/XsuIeN_XZaI/AAAAAAAAkRQ/7jeO44zMtpoEQYjS5Hgdj9-WwbRwjGlQgCLcBGAsYHQ/s1600/18.png"/></span></p>
<p class="ai-optimize-59"><span style="color: #000000;">As a result, the attacker will obtain the NTLM hashes of the victim’s machine as shown in the image given below. Here you can observe that it has given NetBIOS username along with hashes.</span></p>
<p class="ai-optimize-60"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-alB3d6LOrZg/XsuIeyYf6vI/AAAAAAAAkRc/z1Wuucg_QIcDbya6xEDDxtprlLZJwA9xACLcBGAsYHQ/s1600/20.png"/></span></p>
<p class="ai-optimize-61"><span style="color: #000000;"><strong>Conclusion:</strong> So we saw how the attacker cleverly injected the UNC path into an image or text file or Word document and masquerade the victim by sending Phishing mail.</span></p>
<p class="ai-optimize-6"><span style="color: #000000;">To learn more about Red Teaming. Follow this</span> <a href="https://www.hackingarticles.in/category/red-teaming/">Link.</a></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
