<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/red-teaming/domain-enumeration/" rel="category tag">Domain Enumeration</a>, <a href="https://www.hackingarticles.in/category/red-teaming/" rel="category tag">Red Teaming</a></span>            </div>
            <h1 class="post-title entry-title">Empire for Pentester: Active Directory Enumeration</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/empire-for-pentester-active-directory-enumeration/" rel="bookmark"><time class="entry-date published" datetime="2021-04-28T18:45:19+00:00">April 28, 2021</time><time class="updated" datetime="2025-05-30T09:12:09+00:00">May 30, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="ai-optimize-6 ai-optimize-introduction"><span style="color: #000000;">In this article, we take a look inside Active Directory through PowerShell Empire. PowerShell Empire consists of some post-exploitation modules inside the situational awareness section. PowerView is integrated inside the Empire to extract data from a Domain.  </span></p>
<h3 class="ai-optimize-7"><span style="color: #800000;">Table of Contents</span></h3>
<ul>
<li class="ai-optimize-8"><span style="color: #000000;"><strong>Introduction</strong></span></li>
<li class="ai-optimize-9"><span style="color: #000000;"><strong>Get User</strong></span></li>
<li class="ai-optimize-10"><span style="color: #000000;"><strong>Get Computer</strong></span></li>
<li class="ai-optimize-11"><span style="color: #000000;"><strong>Get Loggedon</strong></span></li>
<li class="ai-optimize-12"><span style="color: #000000;"><strong>Process Hunter</strong></span></li>
<li class="ai-optimize-13"><span style="color: #000000;"><strong>Get OU</strong></span></li>
<li class="ai-optimize-14"><span style="color: #000000;"><strong>Get Session</strong></span></li>
<li class="ai-optimize-15"><span style="color: #000000;"><strong>Get Domain Controller</strong></span></li>
<li class="ai-optimize-16"><span style="color: #000000;"><strong>Get Group</strong></span></li>
<li class="ai-optimize-17"><span style="color: #000000;"><strong>Get Group Member</strong></span></li>
<li class="ai-optimize-18"><span style="color: #000000;"><strong>Get Cached RDP Connection</strong></span></li>
<li class="ai-optimize-19"><span style="color: #000000;"><strong>Find Local Admin Access</strong></span></li>
<li class="ai-optimize-20"><span style="color: #000000;"><strong>Share Finder</strong></span></li>
<li class="ai-optimize-21"><span style="color: #000000;"><strong>Get Subnet Ranges</strong></span></li>
<li class="ai-optimize-22"><span style="color: #000000;"><strong>Get Forest</strong></span></li>
<li class="ai-optimize-23"><span style="color: #000000;"><strong>Get Forest Domain</strong></span></li>
<li class="ai-optimize-24"><span style="color: #000000;"><strong>Get GPO</strong></span></li>
<li class="ai-optimize-25"><span style="color: #000000;"><strong>Get Domain Policy</strong></span></li>
<li class="ai-optimize-26"><span style="color: #000000;"><strong>Get RDP Session</strong></span></li>
<li class="ai-optimize-27"><span style="color: #000000;"><strong>Get Site</strong></span></li>
<li class="ai-optimize-28"><span style="color: #000000;"><strong>Conclusion</strong></span></li>
</ul>
<h3 class="ai-optimize-29"><span style="color: #000000;"><span style="color: #800000;">Introduction</span> </span></h3>
<p class="ai-optimize-30"><span style="color: #000000;">In our previous article focused on <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.hackingarticles.in/active-directory-enumeration-powerview/">Active Directory Enumeration: PowerView</a></strong></span>, we discussed a ton of options some of those are also present in Empire so those can seem to be repeating the similar approach but there are some more interactive modules here that are worth looking into.  We will be using the same Active Directory Lab configuration from the PowerView Article mentioned above. In this Article/Demonstration, we focus on our ability to enumerate information that we can then use to elevate privileges or help with Lateral Movement. A tool by the name of PowerView was developed and integrated <strong>by <a style="color: #000000;" href="https://x.com/harmj0y"><span style="color: #0000ff;">Will Schroeder</span></a> (a.k.a harmj0y)</strong> for PowerSploit. It soon became an integral toolkit to perform Active Directory Attacks and Enumeration. We will be using PowerShell Empire to demonstrate the various Enumeration Tactics by PowerView.</span></p>
<h5 class="ai-optimize-31"><span style="color: #000000;"><strong>What is Situational Awareness?</strong></span></h5>
<p class="ai-optimize-32"><span style="color: #000000;">Situational Awareness refers to: “Within a volume of time and space, individuals perceive an enterprise’s security posture and its threat environment; they comprehend/mean both taken together (risk); and they project their status into the near future.” In simpler terms, individuals learn and understand the structure of any enterprise or network in a particular set of time while noting potential risks and making a plan of action, which is called Situational Awareness.</span></p>
<h3 class="ai-optimize-33"><span style="color: #800000;">Get User</span></h3>
<p class="ai-optimize-34"><span style="color: #000000;">In our Active Directory Lab Setup, we created 8 users with different roles and privileges. Then when we emulate the attack on the AD from PowerShell Empire using Kali Linux as demonstrated, we generate the following result.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule situational_awareness/network/powerview/get_user 
execute</pre>
<p class="ai-optimize-35"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-5-V7slsF9pw/YImm_oA7dpI/AAAAAAAAvlM/CMeFX5MoED4ECoI-p_dGPw14lTMCmwVmgCLcBGAsYHQ/s16000/1.png"/></span></p>
<p class="ai-optimize-36"><span style="color: #000000;">Users that are enumerated are not just restricted to Usernames. Data collected consist of logoncount that can give an idea of an active or inactive user in the network. Next, a badpasswordtime indicates the last time and date that someone attempted to log on with an invalid password on this account. Then a small description of the user with the names of groups that this particular user is part of. At last, it shows the date and time since the last password change. All this information is very important when the attacker is trying to learn about the User Behavior.</span></p>
<p class="ai-optimize-37"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-FSypfnekN_o/YImnYuccsBI/AAAAAAAAvlU/-yTMWql1BmgEnC4lOEGRMxyBV4pmirb6ACLcBGAsYHQ/s16000/2.png"/></span></p>
<p class="ai-optimize-38"><span style="color: #000000;">Users Extracted are Administrator, Guest, Yashika, Geet. It is clear from the output that the user’s Administrator and Guest are the part of Users Group. This can be verified using our Active Directory Setup as shown below.</span></p>
<p class="ai-optimize-39"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-kH-jZClFdpw/YImnc8D2LdI/AAAAAAAAvlY/-981RbjMUQMUjEcfs9uXPMSDF9aMX_MFQCLcBGAsYHQ/s16000/3.png"/></span></p>
<p class="ai-optimize-40"><span style="color: #000000;">And the users Yashika, Geet, etc are part of Tech OU. More data will be extracted on OU later.</span></p>
<p class="ai-optimize-41"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-SpblinNTEnI/YImnhedOW2I/AAAAAAAAvlc/e0G2mrFbTQkNW6q7CXtZvh3vWNAmhbhvACLcBGAsYHQ/s16000/4.png"/></span></p>
<h3 class="ai-optimize-42"><span style="color: #800000;">Get Computer</span></h3>
<p class="ai-optimize-43"><span style="color: #000000;">The next module that the attacker can use against the target server is the Get Computer module. The information this module target is primarily the Computer Name. It also extracts other information as demonstrated.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">situational_awareness/network/powerview/get_computer 
execute</pre>
<p class="ai-optimize-44"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-E60-ykb7BHA/YImnlcX5NFI/AAAAAAAAvlg/gcQlziADVf4ClTWTReBLRIEogsH5umqNQCLcBGAsYHQ/s16000/6.png"/></span></p>
<h5 class="ai-optimize-45"><strong><span style="color: #000000;">Analyzing Computer Information</span></strong></h5>
<p class="ai-optimize-46"><span style="color: #000000;">The output of the result that is generated by the module starts with information like pwdlastset information. This is the date and time when the user has reset their password. As discussed earlier it can help the attacker distinguish between active and inactive users. It can also help the user distinguish between the users that use proper security mechanisms and change passwords regularly and those who don’t.  Moving on, it also prints the username that is logged in on the Computer. Then it informs the attacker about the Operating System that is running on the target machine.</span></p>
<p class="ai-optimize-47"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-LREQNbq8zGA/YImnpquRkKI/AAAAAAAAvlk/4I0T9j6CWaETJ_gMR2GTBk146uzBLYwNACLcBGAsYHQ/s16000/7.png"/></span></p>
<p class="ai-optimize-48"><span style="color: #000000;">The output also provides the attacker with the last time the target machine logged off. This can also help them differentiate among users. They extract some other information, including the badpwdcount, which indicates the number of times someone attempted an incorrect password on that particular machine. Finally, the when-created option can help the attacker identify the older accounts and relatively new users created on the target machine.</span></p>
<p class="ai-optimize-49"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-xy3VnJGahes/YImnuKuPiII/AAAAAAAAvls/LC0HVOTWTAsYiEQ06EM3hBwlPAiDZIGogCLcBGAsYHQ/s16000/8.png"/></span></p>
<p class="ai-optimize-50"><span style="color: #000000;">Moreover, the attacker can also enumerate the SID of the user and OU of the particular user logged in on the machine. This can also inform the attacker if a particular user is about to expire or if it is set to never expire. Then we have the Group Details of the user as well.</span></p>
<p class="ai-optimize-51"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-y6oB3uawufM/YImnzcs-FMI/AAAAAAAAvl0/ddlByggVE1Qp9tZu8VwRb1Wh92lhHZBdACLcBGAsYHQ/s16000/9.png"/></span></p>
<h5 class="ai-optimize-52"><span style="color: #000000;"><strong>Verifying Machine Data from Domain Controller</strong></span></h5>
<p class="ai-optimize-53"><span style="color: #000000;">We can see that the output suggests that there are 3 machines in the Domain. Named as CLIENT, DESKTOP-ATNONJ9, and WIN-3Q7NEB12561. This can be verified from the Domain Controller as shown in the image below.</span></p>
<p class="ai-optimize-54"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-BnPN4C4vqGY/YImn4FkXECI/AAAAAAAAvl4/DH0lxJ1gYPUIRJojCEsl4whneJEm0ILZgCLcBGAsYHQ/s16000/10.png"/></span></p>
<h3 class="ai-optimize-55"><span style="color: #800000;">Get Loggedon</span></h3>
<p class="ai-optimize-56"><span style="color: #000000;">To enumerate users on the local or remote machine the attacker can take advantage of the GetLoggedon module. You need Administrative Rights to use this module. This module executes the NetWkstaUserEnum Win32API call to extract the users that are currently logged on. You can observe that the module has extracted the users that are logged in.  </span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule situational_awareness/network/powerview/get_loggedon 
execute</pre>
<p class="ai-optimize-57"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-CG7P20Jjpk4/YImn7wERx3I/AAAAAAAAvmA/i1Hrj0CKuRgQBv6286i8JZuK8AGmXYdPwCLcBGAsYHQ/s16000/12.png"/></span></p>
<h3 class="ai-optimize-58"><span style="color: #800000;">Process Hunter</span></h3>
<p class="ai-optimize-59"><span style="color: #000000;">Process Hunter module is an interesting one as it enumerates the running process on the target machine. It can help the attacker deduce a lot about its target. It can extract information about any services that might be vulnerable. Process Hunter can tell if any process is running with elevated privileges. It also tells the Process ID of the process so if the attacker has access to that process, they can tinker around with it such as stopping or restarting such process.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule situational_awareness/network/powerview/process_hunter 
execute</pre>
<p class="ai-optimize-60"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-yvGnXQlwZwE/YImoBiDPFZI/AAAAAAAAvmE/KWL-1r9c5okgGLEOMckpfJwANFKRpqILgCLcBGAsYHQ/s16000/13.png"/></span></p>
<p class="ai-optimize-61"><span style="color: #000000;">You can correlate the extracted data from Process Hunter with the actual tasks running on the machine by listing the processes on the target machine. The demonstration below uses the tasklist command. You can use the PID to verify the process status.</span></p>
<p class="ai-optimize-62"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-iwohunMyYdE/YImoFpXz4vI/AAAAAAAAvmM/OeEJtfwXnFkjyQit8ej7I5OGxFWePCCOQCLcBGAsYHQ/s16000/14.png"/></span></p>
<h3 class="ai-optimize-63"><span style="color: #800000;">Get OU</span></h3>
<p class="ai-optimize-64"><span style="color: #000000;">OUs are the smallest unit in the Active Directory system. OU is abbreviated from is Organizational Unit. OUs are containers for users, groups, and computers, and they exist within a domain. They are useful when an administrator wants to deploy Group Policy settings to a subset of users, groups, and computers within your domain. OUs also allows Administrators to delegate admin tasks to users/groups without having to make him/her an administrator of the directory.</span></p>
<p class="ai-optimize-65"><span style="color: #000000;">To Enumerate, Choose the Agent and then Load the module using the usemodule command. Then run execute the command.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule situational_awareness/network/powerview/get_ou 
execute</pre>
<p class="ai-optimize-66"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-2RfnI4nRtsQ/YImoKpCmZMI/AAAAAAAAvmU/4GaYW19PCrYWUmuERQyKacKvKXd13DzZwCLcBGAsYHQ/s16000/15.png"/></span></p>
<p class="ai-optimize-67"><span style="color: #000000;">As soon as the module executes, it contacts the Target Server, extracts the requested information, and then PowerShell Empire prints the response. The system prints information such as gplink, object class, name of OUs, Date and Time of Creation, etc., for each OU.</span></p>
<p class="ai-optimize-68"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Z2TvTJ5hlQk/YImoPEdHbNI/AAAAAAAAvmc/-GJCEgszY0gaii7RpT0ve4EKGs-zIHT3wCLcBGAsYHQ/s16000/16.png"/></span></p>
<p class="ai-optimize-69"><span style="color: #000000;">It can be observed that there are 4 OUs on the Target Server. Namely, Tech, VPN, Sales, and HR. To verify, we can take a look at the OUs directly from the Server. There are 4 OUs listed. This means that our module worked accurately.</span></p>
<p class="ai-optimize-70"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-lcDJRR4Buk8/YImoUKkYP3I/AAAAAAAAvmk/3V2G9yBDnxUc27PLaDvHpCq6c0wsxXDsACLcBGAsYHQ/s16000/17.png"/></span></p>
<h3 class="ai-optimize-71"><span style="color: #800000;">Get Session</span></h3>
<p class="ai-optimize-72"><span style="color: #000000;">Get Session module can enumerate the sessions that are generated inside a Domain. Upon running this module, the attacker can extract the session information for the local or a remote machine. This function executes the NetSessionEnum Win32API call for extracting the session information.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule situational_awareness/network/powerview/get_session 
execute</pre>
<p class="ai-optimize-73"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-f_iArkl56uc/YImoaCj2k7I/AAAAAAAAvmw/ZEBAtOVp79ECcSQY4JcMFObYWQFTBJeRQCLcBGAsYHQ/s16000/18.png"/></span></p>
<h3 class="ai-optimize-74"><span style="color: #800000;">Get Domain Controller</span></h3>
<p class="ai-optimize-75"><span style="color: #000000;">Next on the lineup, we have the Get DomainController. This provides the information of the particular server device instead of the domain. When an attacker wants to extract the data about the Domain Controller Machine then this tool can be used. It extracts the Forest Information, with the Time and Date configured on the Server. It tells the OS Version that can help constraint the search for Kernel Exploits for the attacker. Then the attacker has the IP Addressing data with the Inbound and Outbound connections.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule situational_awareness/network/powerview/get_domain_controller 
execute</pre>
<p class="ai-optimize-76"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-1SRA_uIJNSc/YImoeoEUvCI/AAAAAAAAvm4/UObTemtxf3YIOAAQ9gBltQYP1rJ-il5wACLcBGAsYHQ/s16000/19.png"/></span></p>
<h3 class="ai-optimize-77"><span style="color: #800000;">Get Group</span></h3>
<p class="ai-optimize-78"><span style="color: #000000;">Enumerating group information is one of the most important pieces of information an attacker should enumerate on its target. Group Information categories the uses and helps understand the users that have the high privilege or they might be the one that has the access to a particular database. This can be performed using the get group module as demonstrated.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule situational_awareness/network/powerview/get_group 
execute</pre>
<p class="ai-optimize-79"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-yRBELmMj1Hs/YImoi5zDikI/AAAAAAAAvm8/oqD9bMJ_1yklRGlb6exzyqapsNZRNcRAQCLcBGAsYHQ/s16000/20.png"/></span></p>
<h4 class="ai-optimize-80" data-start="520" data-end="555"><span style="color: #000000;">Analyzing Group Memberships</span></h4>
<p class="ai-optimize-81"><span style="color: #000000;">Upon analyzing the output of the module that we just discussed, we can see that we get a group by the name of Print Operators. To find the user inside that particular group there is a parameter named member. It can be seen that user Japneet is a part of the Print Operators group. Similarly, the Backup Operators group has the user geet. The interesting part about the backup operators is that they can read almost all the files on the system as you cannot make a backup of a file that you don’t have permission to read. Hence it is worth trying to take over the user that is a part of the Backup Operators group.</span></p>
<p class="ai-optimize-82"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-RRr-NAKnsKw/YImon6TK_2I/AAAAAAAAvnE/yCRX4yP538YGZfAqLtIPEekfrZYI2ZQ9wCLcBGAsYHQ/s16000/21.png"/></span></p>
<h5 class="ai-optimize-83" data-start="709" data-end="748"><span style="color: #000000;"><strong data-start="713" data-end="748">Exploring Other Critical Groups</strong></span></h5>
<p class="ai-optimize-84"><span style="color: #000000;">Moving down the output we can see that there is a group by the name of Replicator. The member of Replicator is an aarti user. The members of this group can replicate the Active Directory Architecture. Next, we have the Remote Desktop Users group. This is also a group if compromised can pose disastrous consequences. This a group of users that have the privilege to access the desktop users. As can be observed from the screenshot the Jeenali user is a member of the Remote Desktop Users group.</span></p>
<p class="ai-optimize-85"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-zB7igyggOs8/YImosXNkgTI/AAAAAAAAvnM/CiOfiwhOdOYnvpGoH5UF5DooHa8X6kWWgCLcBGAsYHQ/s16000/22.png"/></span></p>
<p class="ai-optimize-86"><span style="color: #000000;">All the information that we extracted using the PowerView Module can be directly verified from the Domain Controller by checking the Properties of users. The properties will have a tab named Member Of. It will contain the name of the group that the user is part of.</span></p>
<p class="ai-optimize-87"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-oKUouyxa818/YImoxBVHbcI/AAAAAAAAvnU/GGpm222M-YAa600Zd3oZZVPLV1_a5DPQwCLcBGAsYHQ/s16000/23.png"/></span></p>
<h3 class="ai-optimize-88"><span style="color: #800000;">Get Group Member</span></h3>
<p class="ai-optimize-89"><span style="color: #000000;">In the previous stage, we extracted the groups from usernames but this next module named get group member does the exact opposite. It requires the attacker to provide a group name and then it works to extract all the members of that particular user. In the demonstration below, we try to enumerate the users of the Domain Admin group. The module tells us that the Yashika user a member of the Domain Admin Group.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule situational_awareness/network/powerview/get_group_member 
set Recursive "Domain Admins" 
execute</pre>
<p class="ai-optimize-90"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-PcewT0u_L2s/YImo2DD6EDI/AAAAAAAAvnY/UowS0FxnoBY7gOw4hca2GIFIHQ9vwiWcQCLcBGAsYHQ/s16000/24.png"/></span></p>
<p class="ai-optimize-91"><span style="color: #000000;">As always this can be simply verified on the Domain Controller by running the net group command with the group whose member you are trying to enumerate.</span></p>
<p class="ai-optimize-92"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-jDLUIOeubpQ/YImo9A3w1SI/AAAAAAAAvng/emdEHN0q--8Z8rGM5r0SCyjxPX0nLHxFgCLcBGAsYHQ/s16000/25.png"/></span></p>
<h3 class="ai-optimize-93"><span style="color: #800000;"> Get Cached RDP Connection</span></h3>
<p class="ai-optimize-94"><span style="color: #000000;">RDP or Remote Desktop Connections rank among the most used functionalities in an enterprise. Individual employees heavily depend on Remote Desktop connections while working from home. Windows caches the devices that users try to connect to using RDP. The cached RDP connection employs remote registry functionality to query all entries for the “Windows Remote Desktop Connection Client” on the local (or a remote) machine.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule situational_awareness/network/powerview/get_cached_rdpconnection 
execute</pre>
<p class="ai-optimize-95"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-MyyPvTSfuHs/YImpBXY42SI/AAAAAAAAvno/k0-AQLSj3FQWVyTDJ3uirNWN8YPbYIUwACLcBGAsYHQ/s16000/26.png"/></span></p>
<p class="ai-optimize-96"><span style="color: #000000;">The above image shows that the module extracted 2 users who should be cached in the registry of the target machine. This can be verified from the RDP Connection Windows as shown below. Attackers control the devices with IP Address 192.168.1.16 and 192.168.1.45 using RDP. The attacker can map other machines in the network and learns that RDP is enabled on these machines.</span></p>
<p class="ai-optimize-97"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-6KyRncWO4is/YImpF9yihzI/AAAAAAAAvns/m1LQgp6SfvszDNzAEz9wAkyO5dLUR8TQwCLcBGAsYHQ/s16000/27.png"/></span></p>
<h3 class="ai-optimize-98"><span style="color: #800000;">Find Local Administered Access</span></h3>
<p class="ai-optimize-99"><span style="color: #000000;">This next module helps that attacker to enumerate where the current user has local administration access. In simpler terms, it enumerates all machines on the current domain and for each machine, it checks if the current users have local administrator access. From the demonstration, it can be concluded that DC1 user has local administration access on this machine only.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule situational_awareness/network/powerview/find_localadmin_access 
execute</pre>
<p class="ai-optimize-100"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-esy7PwETwxk/YImpK5er2dI/AAAAAAAAvnw/Hf9CVgibrzE-gr6d3yapxhdRHu1vAFDtwCLcBGAsYHQ/s16000/28.png"/></span></p>
<h3 class="ai-optimize-101"><span style="color: #800000;">Share Finder</span></h3>
<p class="ai-optimize-102"><span style="color: #000000;">As the name suggests that this module can help the attacker extract shares hosted on the network. Any inexperienced attacker can understand why they need to enumerate the shares when they can do that externally using the SMB enumeration. But an experienced attacker will realize that some shares are not visible to everyone. The configuration determines whether a particular share is visible and accessible to everyone or to specific users.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule situational_awareness/network/powerview/share_finder 
execute</pre>
<p class="ai-optimize-103"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-lRwmlyFSBss/YImpPsWw63I/AAAAAAAAvn0/N_MtRt9O6iAYFdW2aC2v9vncA5uDNfi8ACLcBGAsYHQ/s16000/29.png"/></span></p>
<p class="ai-optimize-104"><span style="color: #000000;">The module above and the image of Server Manager below show that the network contains shares by the name of Confidential and Sales Report.</span></p>
<p class="ai-optimize-105"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-IwyXhXGJ1PI/YImpTg7Y4DI/AAAAAAAAvn4/xaYeH33NgEwo9JO9wLd_1NrnvYoQ-AaYACLcBGAsYHQ/s16000/30.png"/></span></p>
<h3 class="ai-optimize-106"><span style="color: #800000;">Get Subnet Ranges</span></h3>
<p class="ai-optimize-107"><span style="color: #000000;">Enumerating Subnets may seem unhelpful, but it can aid the attacker in understanding the layout of the domain. This particular subnet connects several hosts. It can also inform the attacker about other subnets that divide the network. In the demonstration below, we see 4 hosts connected to this particular subnet. That would probably split into 3 clients.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule situational_awareness/network/powerview/get_subnet_ranges 
execute</pre>
<p class="ai-optimize-108"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-5JgeTM1Zn9M/YImpZHdQSMI/AAAAAAAAvoA/mYw_iksDXQA6Mi5veK___9Ks4-clODoAACLcBGAsYHQ/s16000/31.png"/></span></p>
<h3 class="ai-optimize-109"><span style="color: #800000;">Get Forest</span></h3>
<p class="ai-optimize-110"><span style="color: #000000;">Apart from the domain information and the user information, the attacker can also gain information about the forests and there can be multiple forests inside a domain. To procure information about the forest in the current user’s domain is to use the get forest module.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule situational_awareness/network/powerview/get_forest 
execute</pre>
<p class="ai-optimize-111"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-5RKjbj-Z-A0/YImpeMh_mWI/AAAAAAAAvoI/FY3B2M0Ic6oNHsbJ1RpvaSNZoCoyIU_IgCLcBGAsYHQ/s16000/32.png"/></span></p>
<h3 class="ai-optimize-112"><span style="color: #800000;">Get Forest Domain</span></h3>
<p class="ai-optimize-113"><span style="color: #000000;">In simpler terms, a domain is a set of computers inside a boundary, which have a particular rule for accessing data and administering data values. Domains are situated inside trees. It can be said that a tree is a group or collection of domains that are arranged systematically bearing the same namespace. To enumerate the Forest Domain details including the name of the forest with its children and Domain Level then the attacker can use the get forest domain module.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule situational_awareness/network/powerview/get_forest_domain 
execute</pre>
<p class="ai-optimize-114"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-udSMi_c6wdY/YImpmPkKzMI/AAAAAAAAvoQ/ZG_XnNM3GzUt6m0AG4bIU8w4NqxMzvyPwCLcBGAsYHQ/s16000/33.png"/></span></p>
<h3 class="ai-optimize-115"><span style="color: #800000;">Get GPO</span></h3>
<p class="ai-optimize-116"><span style="color: #000000;">The Administrator creates a Group Policy to figure out how the Domain is set up and what set of rules and policies govern the Domain. This module can enumerate them. It will extract all the information regarding Group Policies that the Target System has configured.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule situational_awareness/network/powerview/get_gpo 
execute</pre>
<p class="ai-optimize-117"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-viPiCIxxD5w/YImpqObvJgI/AAAAAAAAvoY/tfKLvOTdpwgmfvqDZ4gGAQ0_xVv9ftl9QCLcBGAsYHQ/s16000/34.png"/></span></p>
<h3 class="ai-optimize-118"><span style="color: #800000;">Get Domain Policy</span></h3>
<p class="ai-optimize-119"><span style="color: #000000;">The Domain Policy of a Domain can reveal some information such as extracting the policy of the current domain. It reads the default domain policy or the domain controller policy for the current domain or a specified domain/domain controller. In the demonstration, a defined set of System Access Policies includes the Password Expiration Time and Minimum Password Length.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">situational_awareness/network/powerview/get_domain_policy
execute</pre>
<p class="ai-optimize-120"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-jYMM-9dW3NI/YImpuHmyc9I/AAAAAAAAvog/xxHiNzwu8KMwRTbKXle0Lc2hFZ4-hdolACLcBGAsYHQ/s16000/35.png"/></span></p>
<p class="ai-optimize-121"><span style="color: #000000;">This can be verified from the Group Policy Management Editor on the Domain Controller. You can create more policies and just configure other policies.</span></p>
<p class="ai-optimize-122"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-pIs6UtD38vU/YImpzC0KQfI/AAAAAAAAvok/e8Y5zjbQeLkRSss1MTUQp6TI0h5jutILACLcBGAsYHQ/s16000/36.png"/></span></p>
<h3 class="ai-optimize-123"><span style="color: #800000;">Get RDP Session</span></h3>
<p class="ai-optimize-124"><span style="color: #000000;">This module enumerates the remote (or local) RDP sessions on a remote machine that the Administrator has access to. It also pulls in the originating IP of the connection as well. In the demonstration, we can observe 3 connections, one of which is Active with an IP of 192.168.1.45. The attacker can also provide the ComputerName option to get refined results.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">situational_awareness/network/powerview/get_rdp_session
set ComputerName DC1
execute</pre>
<p class="ai-optimize-125"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-lqgdG3pOo10/YImp5t8IWaI/AAAAAAAAvoo/f2m-nFdnoMY1IIpwomv-qZfZpNyBE-lYQCLcBGAsYHQ/s16000/37.png"/></span></p>
<h3 class="ai-optimize-126"><span style="color: #800000;">Get Site</span></h3>
<p class="ai-optimize-127"><span style="color: #000000;">Finally, this module enumerates and provides the attacker with a list of all the sites in the current domain. This can help the attacker to get details about the sites and their location. Coupled with other vulnerabilities this kind of information can lead to big attacks.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">situational_awareness/network/powerview/get_site
execute</pre>
<p class="ai-optimize-128"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-PhWRiOlRGLk/YImqBdtdvbI/AAAAAAAAvo0/wyWs4hNHpmgqDOrv-p1CuI6Jk3aRKRoAgCLcBGAsYHQ/s16000/38.png"/></span></p>
<h3 class="ai-optimize-129"><span style="color: #800000;">Conclusion</span></h3>
<p class="ai-optimize-130"><span style="color: #000000;">This concludes our second article on Active Directory. It is still a very extensive topic. We provide this detailed resource so that you can enumerate your Active Directory Deployment from Kali and with the help of PowerShell Empire and understand the information that an attacker can extract. If you want a direct PowerShell-based enumeration, check out this <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.hackingarticles.in/active-directory-enumeration-powerview/">article</a></strong></span>.</span></p>
<p class="ai-optimize-131"><span style="color: #000000;"><strong>Author: Pavandeep Singh</strong> is a Technical Writer, Researcher, and Penetration Tester. Can be Contacted on</span> <strong>Twitter</strong> and <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.linkedin.com/in/pavan2318/">LinkedIn</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
