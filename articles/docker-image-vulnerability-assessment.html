<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/container-security/" rel="category tag">Container Security</a>, <a href="https://www.hackingarticles.in/category/container-security/docker-pentest/" rel="category tag">Docker Pentest</a>, <a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Docker for Pentester: Image Vulnerability Assessment</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/docker-image-vulnerability-assessment/" rel="bookmark"><time class="entry-date published" datetime="2020-09-11T18:01:41+00:00">September 11, 2020</time><time class="updated" datetime="2025-05-16T16:25:15+00:00">May 16, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">We are moving from virtualization to containerization and we are all familiar with the container services such as docking or quay.io. You can pick a dock image for a particular application by selecting several choices. As you know, when a developer works with a container, it not only packs the program but is part of the OS, and we do not know whether the connect libraries have been patched or vulnerable.</span></p>
<p><span style="color: #000000;">So, we will show “<strong>how to perform a container audit and vulnerability assessment</strong>” in any infrastructure in this role.</span></p>
<h3><span style="color: #800000;">Table of Contents</span></h3>
<p><span style="color: #000000;"><strong>Prerequisites </strong></span></p>
<p><span style="color: #000000;"><strong>Clair</strong></span></p>
<ul>
<li><span style="color: #000000;">Installation</span></li>
<li><span style="color: #000000;">Docker Image Vulnerability Scanning</span></li>
</ul>
<p><span style="color: #000000;"><strong>Bench-security: Container Hardening</strong></span></p>
<h3><span style="color: #800000;">Prerequisites</span></h3>
<ul>
<li><span style="color: #000000;">Docker</span></li>
</ul>
<h3><span style="color: #800000;">Clair: Vulnerability</span></h3>
<h4><span style="color: #800000;">Installation</span></h4>
<p><span style="color: #000000;">CoreOS has created an awesome container scan tool called Clair. Clair is an open-source project for the static analysis of vulnerabilities in apps and Docker containers. You can clone the package with the help of git, using the following command</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone https://github.com/arminc/clair-scanner.git</pre>
<p><span style="color: #000000;"><img fetchpriority="high" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-iZEVp3padlM/X1u4VN1wZOI/AAAAAAAAoXA/LXjIpNp2y0gyh9kH7YKsQkXGJVwYJCgDwCLcBGAsYHQ/s1600/2.png" alt="Docker Image Vulnerability Assessment" width="692" height="178"/></span></p>
<p><span style="color: #000000;">The scanner is developed in go language, therefore golang on your local machine over which is docker is running.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">apt install golang</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-aEQYCK_Az_Y/X1u4ZAFEtbI/AAAAAAAAoXE/XhHn92B_fh8AHPPVaNUoRIx-0_7KePsKQCLcBGAsYHQ/s1600/3.png"/></span></p>
<p><span style="color: #000000;">Build the library to install all dependencies of the Clair.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cd clair-scanner
make build</pre>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-anPoG4JP4p8/X1u4dAqUFdI/AAAAAAAAoXI/yIKZlzC1dbYe9TKkDvNfa7O0TB0B8C6_gCLcBGAsYHQ/s1600/4.png" alt="Docker Image Vulnerability Assessment" width="485" height="166"/></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">make cross</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-_2Vcaqc0Occ/X1u4g7fdEuI/AAAAAAAAoXM/OwmnbAOW7d4bx811o47hl0uzQzilAgzrwCLcBGAsYHQ/s1600/5.png"/></span></p>
<p><span style="color: #000000;">As you can see, we have the following file in the bucket list.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-w82XfoxAcsY/X1u4kZBEOqI/AAAAAAAAoXQ/yXXKJeL33Y08Bc4wfwq80jiD1TmCeJzCwCLcBGAsYHQ/s1600/6.png"/></span></p>
<p><span style="color: #000000;">If in your host machine, you don’t have a docker image, you can pull a new image, as we did here to illustrate vulnerability assessment.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">docker pull ubuntu:16.04</pre>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-zeuVbNUJPUM/X1u4oM0rutI/AAAAAAAAoXU/DQglqGlJFgEu2_uqUdkGS0TomXb5KbyxQCLcBGAsYHQ/s1600/7.png" alt="Docker Image Vulnerability Assessment" width="516" height="167"/></span></p>
<h4><span style="color: #800000;">Docker Image Vulnerability Scanning</span></h4>
<p><span style="color: #000000;">Now, run the docker image of the Clair that will listen at local port 5432.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">docker run -d -p 5432:5432 --name db arminc/clair-db:latest</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Vz5uMD06YBI/X1u4upLOSgI/AAAAAAAAoXk/2z-iNjkH6cE2uGWl2ZPVz_DFx6UZHQnDwCLcBGAsYHQ/s1600/8.png"/></span></p>
<p><span style="color: #000000;">Also, run the docker image for postgres to link Clair scan with the help of the following command.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">docker run -p 6060:6060 --link db:postgres -d --name clair arminc/clair-local-scan:latest</pre>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/--48_LQncYkk/X1u4yw_cuNI/AAAAAAAAoXo/kOgOjsDr1R0IUgAL6CD6Y6jR1DPrbKa3QCLcBGAsYHQ/s1600/9.png" alt="Docker Image Vulnerability Assessment" width="1000" height="288"/></span></p>
<p><span style="color: #000000;">Now, let’s use the Clair for scanning the vulnerability of a container or docker image, with the help of the following command.</span></p>
<p><span style="color: #000000;">Syntax: ./clair-scanner -ip &lt;docker ip&gt; -r output.jason &lt;docker-image&gt;</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./clair-scanner --ip 172.17.0.1 -r report.json ubuntu:16.04</pre>
<p><span style="color: #000000;">Booom!!!! And we got the scanning output which is showing 50 unapproved vulnerabilities.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-rft05n8HqjU/X1u420YB_0I/AAAAAAAAoXs/4Vp1Vg5-BAEm1eQ-otLM4Gn34KSJnmgZQCLcBGAsYHQ/s1600/10.png"/></span></p>
<h3><span style="color: #800000;">Bench-Security: Container Hardening</span></h3>
<p><span style="color: #000000;">The Docker Bench for Security is a script that checks for dozens of common best-practices around deploying Docker containers in production. The tests are all automated and are inspired by the <a style="color: #000000;" href="https://www.cisecurity.org/benchmark/docker/"><span style="color: #0000ff;"><strong>CIS Docker Benchmark v1.2.0</strong></span></a>.</span></p>
<p><span style="color: #000000;">So, as you can see, we have a few docker images on our host.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-5It-6_g-0vg/X1u47OWkKaI/AAAAAAAAoX0/0C9G4o2oZ70fG9tTLRAzt3bpXF8JzQEgwCLcBGAsYHQ/s1600/16.png" alt="Docker Image Vulnerability Assessment" width="685" height="181"/></span></p>
<p><span style="color: #000000;">Let’s start docker audit for container hardening by executing a set of command as shown here.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">docker run -it --net host --pid host --userns host --cap-add audit_control \
-e DOCKER_CONTENT_TRUST=$DOCKER_CONTENT_TRUST \
-v /etc:/etc:ro \
-v /usr/bin/containerd:/usr/bin/containerd:ro \
-v /usr/bin/runc:/usr/bin/runc:ro \
-v /usr/lib/systemd:/usr/lib/systemd:ro \
-v /var/lib:/var/lib:ro \
-v /var/run/docker.sock:/var/run/docker.sock:ro \
--label docker_bench_security \
docker/docker-bench-security</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-YGqIj__WXXI/X1u4_ACDJHI/AAAAAAAAoYA/Er9Iy-gDW80D2hnPNHfhxfc5gQdlSuI_QCLcBGAsYHQ/s1600/17.png"/></span></p>
<p><span style="color: #000000;">The output results as <strong>Info</strong>, <strong>Warning</strong>, <strong>Pass </strong>and <strong>Notes</strong> for each of the configuration recommendations as mention below:</span></p>
<ol>
<li><span style="color: #000000;">Host Configuration</span></li>
<li><span style="color: #000000;">Docker Daemon Configuration</span></li>
<li><span style="color: #000000;">Docker Daemon Configuration Files</span></li>
<li><span style="color: #000000;">Container Images and Build Files</span></li>
<li><span style="color: #000000;">Container Runtime</span></li>
<li><span style="color: #000000;">Docker Security Operations</span></li>
</ol>
<p><span style="color: #000000;">Let me explain this in a better way: You can observe in the highlighted session that it has created alert against root privilege for running the docker image.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-yaFXQveIAoA/X1u5HomtnYI/AAAAAAAAoYI/Q4Ao-FHWa0809icJ7ZyVIZHtnCFr1h4DgCLcBGAsYHQ/s1600/18.png" alt="Docker Image Vulnerability Assessment" width="677" height="530"/></span></p>
<p><span style="color: #000000;">To fix such type of misconfiguration, stop the running process for docker and then again, run the docker image with low privilege user access as shown below.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">docker stop $(docker ps -aq)
docker rm $(docker ps -aq)
docker run -itd --user 1001:1001 ubuntu
docker exec -it &lt;container-id&gt; /bin/bash</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-QtfbT13uK58/X1u5PgkasNI/AAAAAAAAoYU/ES445h3LCCY2mWdFQacLJw18TIo7SmY4wCLcBGAsYHQ/s1600/19.png"/></strong></span></p>
<p><span style="color: #000000;">If the loophole is closed, use the bench again for cross-validation and this time ensure you have passed the warning. As you can see, this time we got the Green sign that shows we got the loopholes patched.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-4pJTc_uojJE/X1u5T_ZWg4I/AAAAAAAAoYY/91vInOV8V7IYPkxDh6fAOWndVFuqsIayACLcBGAsYHQ/s1600/20.png" alt="Docker Image Vulnerability Assessment" width="662" height="262"/></span></p>
<p><span style="color: #000000;">To Learn more about Container Security. Follow this <strong><a href="https://www.hackingarticles.in/category/container-security/">Link.</a></strong></span></p>
<p><span style="color: #000000;"><b>Author</b>: Geet Madan is a Certified Ethical Hacker, Researcher and Technical Writer at Hacking Articles on Information Security<b>. </b>Contact <span style="color: #0000ff;"><a style="color: #0000ff;" href="https://www.linkedin.com/in/geet-madan/"><b>here</b></a></span></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
