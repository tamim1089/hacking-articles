<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/credential-dumping/" rel="category tag">Credential Dumping</a>, <a href="https://www.hackingarticles.in/category/red-teaming/domain-credential/" rel="category tag">Domain Credential</a></span>            </div>
            <h1 class="post-title entry-title">Credential Dumping: Group Policy Preferences (GPP)</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/credential-dumping-group-policy-preferences-gpp/" rel="bookmark"><time class="entry-date published" datetime="2020-03-29T14:46:47+00:00">March 29, 2020</time><time class="updated" datetime="2025-05-16T21:05:56+00:00">May 16, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">People might be aware of “<em>Group Policy Preferences”</em> in Windows Server 2008 that allows system administrators to set up specific configurations. It can be used to create a username and encrypted password on machines. But do you know, that a normal user can elevate privilege to the local administrator and probably compromise the security of the entire domain because passwords in preference items are not secured?</span></p>
<h3><span style="color: #800000;">Table of Contents</span></h3>
<ul>
<li><span style="color: #000000;">What is Group Policy Preferences?</span></li>
<li><span style="color: #000000;">Why using GPP to create a user account is a bad idea?</span></li>
<li><span style="color: #000000;">Lab Setup Requirement</span></li>
<li><span style="color: #000000;">Create an Account in Domain Controller with GPP</span></li>
<li><span style="color: #000000;">Exploiting Group Policy Preferences via Metasploit -I</span></li>
<li><span style="color: #000000;">Exploiting Group Policy Preferences via Metasploit -II</span></li>
<li><span style="color: #000000;">Gpp-Decrypt</span></li>
<li><span style="color: #000000;">GP3finder</span></li>
<li><span style="color: #000000;">Powershell Empire</span></li>
<li><span style="color: #000000;">Windows Powershell (powersploit)</span></li>
</ul>
<h3><span style="color: #800000;">What is Group Policy Preferences?</span></h3>
<p><span style="color: #000000;">Group Policy preferences shortly term as GPP permit administrators to configure and install Windows and application settings that were previously unavailable using Group Policy. One of the most useful features of Group Policy Preferences (GPP) is the ability to store, and moreover, these policies can make all kinds of configuration changes to machines, like:</span></p>
<ul>
<li><span style="color: #000000;">Map Drives</span></li>
<li><span style="color: #000000;">Create Local Users</span></li>
<li><span style="color: #000000;">Data Sources</span></li>
<li><span style="color: #000000;">Printer configuration</span></li>
<li><span style="color: #000000;">Registry Settings</span></li>
<li><span style="color: #000000;">Create/Update Services</span></li>
<li><span style="color: #000000;">Scheduled Tasks</span></li>
<li><span style="color: #000000;">Change local Administrator passwords</span></li>
</ul>
<h3><span style="color: #800000;">Why using GPP to create a user account is a bad Idea?</span></h3>
<p><span style="color: #000000;">If you use Microsoft GPP to create a local administrator account, consider the safety consequences carefully. Since the password is stored in SYSVOL in a preferred item. SYSVOL is the domain-extensive share folder in the Active Directory accessed by all authenticated users.</span></p>
<p><span style="color: #000000;">All domain Group Policies are stored here: \\&lt;DOMAIN&gt;\SYSVOL\&lt;DOMAIN&gt;\Policies\</span></p>
<p><span style="color: #000000;">When a new GPP is created for the user or group account, it’ll be interrelated with a Group.XML file created in SYSVOL with the relevant configuration information and the password is AES-256 bit encrypted. Therefore the password is not secure at all authenticated users have access to SYSVOL.</span></p>
<p><span style="color: #000000;"><em>“In this article, we will be doing active directory penetration testing through Group Policy Preferences and try to steal store password from inside SYSVOL in multiple ways”.</em></span></p>
<p><span style="color: #000000;"><strong>Let’s Start!!</strong></span></p>
<p><span style="color: #000000;">Lab Setup Requirement</span></p>
<ul>
<li><span style="color: #000000;">Microsoft Windows Server 2008 r2</span></li>
<li><span style="color: #000000;">Microsoft Windows 7/10</span></li>
<li><span style="color: #000000;">Kali Linux</span></li>
</ul>
<h3><span style="color: #800000;">Create an Account in Domain Controller with GPP</span></h3>
<p><span style="color: #000000;">On your Windows Server 2008, you need to create a new group policy object (GPO) under “<em>Domain Controller”</em> using Group Policy Management.</span></p>
<p><span style="color: #000000;"><img fetchpriority="high" decoding="async" class="alignnone" src="//3.bp.blogspot.com/-YnTeMPXfBV4/XCeGq6dGuyI/AAAAAAAAb58/IgWdMWAhYDYSrTknx01TCWcCu7fre0S6QCLcBGAs/s1600/1.png" alt="Credential Dumping via Group Policy Preferences (GPP)" width="759" height="531"/></span></p>
<p><span style="color: #000000;">Now create a new user account by navigating to <strong><em>Computer Configuration &gt; Control Panel Settings &gt; Local Users and Groups.</em></strong></span></p>
<p><span style="color: #000000;">Then Right click in the “Local Users and Groups” option and select the<strong><em> New &gt; Local User</em></strong>.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-TqBoUI-xBuA/XCeGsLVBrHI/AAAAAAAAb6Q/lLlSRo6QfFkbtOKrnuvcBGaZ0HcLTZ2vgCLcBGAs/s1600/2.png"/></span></p>
<p><span style="color: #000000;">Then you get an interface for new local user property where you can create a new user account.</span></p>
<p><span style="color: #000000;">As you can observe from the given below image, we had created an account for user “raaz”.</span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="//3.bp.blogspot.com/-yE0I57rtmho/XCeGsMN3DTI/AAAAAAAAb6M/ZaEU7-c3CpsQTXGSryu8cVqWLmrEl2tCwCLcBGAs/s1600/3.png" alt="Credential Dumping via Group Policy Preferences (GPP)" width="395" height="440"/></span></p>
<p><span style="color: #000000;">Don’t forget to update the group policy configuration.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-paESuvWyZTQ/XCeGsq4fCHI/AAAAAAAAb6U/Nw4BqhwDIswxWQdrkLCNeQMxqhAWu4lkgCLcBGAs/s1600/4.png"/></span></p>
<p><span style="color: #000000;">So as I had already discussed above, that, whenever a new gpp is created for the user or group account, it will be associated with a Group.XML which is stored inside /SYSVOl.</span></p>
<p><span style="color: #000000;">From the image below, you can see the entire path that leads to the file <strong>Group.xml</strong>. As you can see, this XML file holds<strong> cpassword</strong> for user raaz within the property tags in plain text.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/--TBswRAxKtg/XCeGs3HQeRI/AAAAAAAAb6Y/w72iTcsYKYYUONoqEtM9dJ27-zL-CsDYACLcBGAs/s1600/5.png"/></span></p>
<h3><span style="color: #800000;">Exploiting Group Policy Preferences via Metasploit -I</span></h3>
<p><span style="color: #000000;">As we know an authorized user can access SYSVOL and suppose I know the client machine credential, let say raj: Ignite@123 then with help of this I can exploit Group Policy Preference to get the XML file. Metasploit auxiliary module lets you enumerate files from target domain controllers by connecting to SMB as the rouge user.</span></p>
<p><span style="color: #000000;">This module enumerates files from target domain controllers and connects to them via SMB. It then looks for Group Policy Preference XML files containing local/domain user accounts and passwords and decrypts them using Microsoft’s public AES key. This module has been tested successfully on a Win2k8 R2 Domain Controller.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use auxiliary/scanner/smb/smb_enum_gpp
set rhosts 192.168.1.103
set smbuser raj
set smbpass Ignite@123
exploit</pre>
<p><span style="color: #000000;">Hence you can observe, that it has dumped the <strong>password:abcd@123</strong> from inside Group.xml file for user raaz.</span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="//4.bp.blogspot.com/-egKgmfL49kI/XCeGtLSK67I/AAAAAAAAb6c/00nNjh6MDJINJUneivcjcmVvqQ6qMHs4gCLcBGAs/s1600/6.png" alt="Credential Dumping via Group Policy Preferences (GPP)" width="843" height="561"/></span></p>
<h3><span style="color: #800000;">Exploiting Group Policy Preferences via Metasploit -II</span></h3>
<p><span style="color: #000000;">Metasploit also provide a post exploit for enumerating cpassword, but for this, you need to compromised target’s machine at least once and then you will be able to run below post exploit.</span></p>
<p><span style="color: #000000;">This module enumerates the victim machine’s domain controller and connects to it via SMB. It then looks for Group Policy Preference XML files containing local user accounts and passwords and decrypts them using Microsoft’s public AES key. Cached Group Policy files may be found on end-user devices if the group policy object is deleted rather than unlinked.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use post/windows/gather/credentials/gpp
set session 1
exploit</pre>
<p><span style="color: #000000;">From the given below image you can observe, it has been found cpassword twice from two different locations:</span></p>
<ul>
<li><span style="color: #000000;"><em>C:\ProgramData\Microsoft\Group Policy\History\{ EE416E94-7362-4587-9CEC-651656DB7538}\Machine\Preferences\Groups\Groups.xml </em></span></li>
<li><span style="color: #000000;"><em>C:\Windows\SYSVOL\sysvol\Pentest.Local\Policies\{ EE416E94-7362-4587-9CEC-651656DB7538}\Machine\Preferences\Groups\Groups.xml </em></span></li>
</ul>
<p><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-ecKShERM1Bs/XCeGq9OaiWI/AAAAAAAAb54/7fUnHLaDA_MzQveO5M_zEVOI-9L5SXQYgCLcBGAs/s1600/11.png"/></span></p>
<h3><span style="color: #800000;">Gpp-Decrypt</span></h3>
<p><span style="color: #000000;">Another method is to connect with the target’s machine via SMB and try to access /SYSVOL with the help smbclient. Therefore execute its command to access shared directory via authorized account and then move to following path to get Group.xml file: <em>SYSVOL\sysvol\Pentes.Local\Policies\{ EE416E94-7362-4587-9CEC-651656DB7538}\Machine\Preferences\Groups\Groups.xml</em></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">smbclient //192.168.1.103/SYSVOL -U raj</pre>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//4.bp.blogspot.com/-mJ-QOSMzp7M/XCeGqn380UI/AAAAAAAAb50/jSHVA7hSa7ASBplXfcSwyX2q0gTUJZ-TACLcBGAs/s1600/12.png" alt="Credential Dumping via Group Policy Preferences (GPP)" width="837" height="861"/></span></p>
<p><span style="color: #000000;">As you can observe, we have successfully transfer Group.xml in our local machine. As this file holds cpassword, so now we need to decrypt it.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-BTlHYikT7oY/XCeGrZAgfKI/AAAAAAAAb6A/foM5SavIB1EMKuY1xhsFJ86vuJt3Fe6AACLcBGAs/s1600/13.png"/></span></p>
<p><span style="color: #000000;">For decryption, we use ” <strong>gpp-decrypt</strong>” which is embedded in a simple ruby script in Kali Linux which decrypts a given GPP encrypted string.</span></p>
<p><span style="color: #000000;">Once you got access to Group.xml file, you can decrypt cpassword with the help of the following syntax:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">gpp-decrypt &lt;encrypted cpassword &gt;
gpp-decrypt qRI/NPQtItGsMjwMkhF7ZDvK6n9KlOhBZ/XShO2IZ80</pre>
<p><span style="color: #000000;">As a result, it dumps password in plain text as shown below.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-Px1JwAYXEFU/XCeGrvI4ChI/AAAAAAAAb6I/shoeh2WT-Dsw3iwrvQADMpdmaBOYj92iACLcBGAs/s1600/15.png"/></span></p>
<h3><span style="color: #800000;">GP3finder</span></h3>
<p><span style="color: #000000;">This is another script written in python for decrypting cpassword and you can download this tool from <a style="color: #000000;" href="//www.sec-1.com/blog/wp-content/uploads/2015/05/gp3finder_v4.0.zip"><span style="color: #3366ff;">here</span></a>.</span></p>
<p><span style="color: #000000;">Once you got access to Group.xml file, you can decrypt cpassword with the help of the following syntax:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">gpp-decrypt &lt;encrypted cpassword &gt;
gp3finder.exe -D qRI/NPQtItGsMjwMkhF7ZDvK6n9KlOhBZ/XShO2IZ80</pre>
<p><span style="color: #000000;">As a result, it dumps password in plain text as shown below.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//1.bp.blogspot.com/-VqncAUVFNko/XCeGrp_vPcI/AAAAAAAAb6E/vUceibiITgA_1zBgM31ylWLkH_5cAr01ACLcBGAs/s1600/16.png" alt="Credential Dumping via Group Policy Preferences (GPP)" width="694" height="250"/></span></p>
<h3 style="font-weight: 400;" data-blogger-escaped-style="clear: both; text-align: center;"><span style="color: #800000;"><strong>PowerShell Empire</strong></span></h3>
<p style="font-weight: 400;" data-blogger-escaped-style="clear: both; text-align: center;"><span style="color: #000000;">This another framework just like Metasploit where you need to access low privilege shell. once you exploit the target machine then use privesc/gpp module to extract the password from inside Group.xml file.</span></p>
<p style="font-weight: 400;" data-blogger-escaped-style="clear: both; text-align: center;"><span style="color: #000000;">This module Retrieves the plaintext password and other information for accounts pushed through Group Policy Preferences.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">agents
usemodule privesc/gpp
execute</pre>
<p><span style="color: #000000;">As a result, it dumps password in plain text as shown below.</span></p>
<p><img decoding="async" src="//3.bp.blogspot.com/-bwDWSkfSqRA/XEH8OBEgvfI/AAAAAAAAcH0/YCCjkQp1ofYsns4HiQ4UqanB_IitUvzAACLcBGAs/s1600/a.png"/></p>
<h3><span style="color: #800000;">Windows Powershell</span></h3>
<p><span style="color: #000000;">There is another method to retrieves the plaintext password and other information for accounts pushed through Group Policy Preferences locally with the help of powersploit “Get-GPPPaswword”. You can download the module from <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Get-GPPPassword.ps1">here</a></strong></span>, it is a powershell script which you need</span></p>
<p><span style="color: #000000;">Get-GPPPassword searches a domain controller for groups.xml, scheduledtasks.xml, services.xml and datasources.xml and returns plaintext passwords.</span></p>
<p><span style="color: #000000;">Now run the following command in the powershell:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Import-Module .\Get-GPPPassword.ps1
Get-GPPPassword</pre>
<p><span style="color: #000000;">As, result you can observe that, it has dumped the saved password from inside group.xml file.</span></p>
<p><img loading="lazy" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-GZRF6PObu18/Xo9dKqDkjAI/AAAAAAAAjdk/5CReg3M2U4g6Qp7-MU_QDF9H5Asv7ndFACLcBGAsYHQ/s1600/gpp.png" alt="Credential Dumping via Group Policy Preferences (GPP)" width="839" height="215"/></p>
<p><span style="color: #000000;"><strong>Author</strong>: <strong>Yashika Dhir</strong> is a passionate Researcher and Technical Writer at Hacking Articles. She is a hacking enthusiast. contact</span> <strong><a class="broken_link" href="https://www.linkedin.com/in/yashika-dhir/">here</a></strong></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
