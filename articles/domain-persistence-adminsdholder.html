<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/persistence/" rel="category tag">Persistence</a></span>            </div>
            <h1 class="post-title entry-title">Domain Persistence AdminSDHolder</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/domain-persistence-adminsdholder/" rel="bookmark"><time class="entry-date published" datetime="2020-06-06T15:14:43+00:00">June 6, 2020</time><time class="updated" datetime="2025-05-11T20:40:17+00:00">May 11, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">In this post, we will discuss the Persistence attack on Active Directory by abusing AdminSDHolder. This attack is an actual threat because of This attack leverages another dynamic attack, such as  <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.hackingarticles.in/credential-dumping-dcsync-attack/">DCSync Attack</a></strong></span> and <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.hackingarticles.in/domain-persistence-golden-ticket-attack/">Golden Ticket Attack</a>.</strong></span></span></p>
<h3><span style="color: #800000;">AdminSDHolder</span></h3>
<p><span style="color: #000000;">Active Directory Domain Services uses AdminSDHolder, protected groups, and Security Descriptor propagator (SD propagator or SDPROP for short). To secure privileged users and groups from unintentional modification. Unlike most objects in the Active Directory domain, which are owned by the Administrators group, AdminSDHolder is owned by the Domain Admins group.</span></p>
<p><span style="color: #000000;">The AdminSDHolder object has a unique Access Control List (ACL). This is used to control the permissions of security principals that are members of built-in privileged Active Directory groups.  Every hour, a background process runs on the domain controller to compare manual modifications to an ACL. Then, overwrites them so that the ACL matches the ACL on the AdminSDHolder object.</span></p>
<p><span style="color: #000000;">Read from <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://docs.microsoft.com/en-us/previous-versions/technet-magazine/ee361593(v=msdn.10)?redirectedfrom=MSDN#id0250006">here</a> </strong></span>for more details.</span></p>
<h3><span style="color: #800000;">AdminSDHolder Persistence Attack</span></h3>
<p><span style="color: #000000;">On a compromised domain controller with administrator privileges, the attacker is capable of creating a permanent backdoor for future attacks by abusing AdminSDHolder. With the help of this attack, we will be able to alter AdminSDHolder by adding a new user to its Access Control List.</span></p>
<p><span style="color: #000000;">Here we will try to add user Yashika to the ACL of the AdminSDHolder object in order to change the privilege for user Yashika. Current User yashika is a domain user as shown below.</span></p>
<p><span style="color: #000000;"><img fetchpriority="high" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-6Yefwxfh4zA/XtuxM2UDu8I/AAAAAAAAkds/oQ37t5qWUYsg6ukGd3wjw08UchThpqzbgCLcBGAsYHQ/s1600/0.png" alt="Domain Persistence AdminSDHolder" width="629" height="526"/></span></p>
<p><span style="color: #000000;">Follow the step to learn how an attacker can conduct AdminSDHolder attack.</span></p>
<ol>
<li><span style="color: #000000;">Navigate to Active Director User and Computers</span></li>
<li><span style="color: #000000;">Explore Menu &gt; View&gt; Advanced Features</span></li>
</ol>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-CMoYo2ss35I/XtuxNHPxniI/AAAAAAAAkd0/x36WLTXe-ko19N53h6Ji5xKumhv9kNM1wCLcBGAsYHQ/s1600/1.png"/></span></p>
<ol start="3">
<li><span style="color: #000000;">Explore System &gt; AdminSDHolder &gt; Properties</span></li>
</ol>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-nFe9I0zAhq8/XtuxNHkmUKI/AAAAAAAAkdw/FmWY7Bajqpssym5udowuQI1RwuWRLfkkACLcBGAsYHQ/s1600/2.png" alt="Domain Persistence AdminSDHolder" width="683" height="469"/></span></p>
<h5><strong><span style="color: #000000;">Add the user to whom you want to give Full Permission. Here I have chosen user: “Yashika”</span></strong></h5>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-qkG_F9M25Vk/XtuxNorMQ8I/AAAAAAAAkd4/w9Q8qrXh4FoCU6eZeMAjC_JOFGlei3qpACLcBGAsYHQ/s1600/3.png"/></span></p>
<h5><strong><span style="color: #000000;"> Give Full Permission by enabling All checkbox.</span></strong></h5>
<p><span style="color: #000000;">As we mentioned, the background process typically runs every sixty (60) minutes by default. However, you can change the default frequency for the Security Descriptor Propagator process. You can do this by creating a <strong data-start="311" data-end="324">REG_DWORD</strong> registry entry and then setting the new frequency value.</span></p>
<p><span style="color: #000000;">Additionally, if you have compromised a Domain Controller (DC), you can reset the Security Descriptor Propagator process to run every 3 minutes. You can do this by executing the following command in the command prompt. Note that 300 is the decimal equivalent, while 12c is the hexadecimal equivalent.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">REG ADD HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters /V AdminSDProtectFrequency /T REG_DWORD /F /D 300</pre>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-OnMY1Bp8kUA/XtuxOQyXDGI/AAAAAAAAkeA/pMlHVQbqELUypKgM3gdMwm2Cqd5VvY1EQCLcBGAsYHQ/s1600/5.png" alt="Domain Persistence AdminSDHolder" width="793" height="203"/></span></p>
<p><span style="color: #000000;">To ensure the fruitful result of the above command, explore the following path: <strong>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters</strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-2jeJo01Eesk/XtuxOVYUF3I/AAAAAAAAkeE/X95KE51fASQ4HkZFFYTzT6INDJjStXoUgCLcBGAsYHQ/s1600/6.png"/></span></p>
<p><span style="color: #000000;">After three minutes, we checked to identify for user “yashika” using the net user command. We noticed Yashika has become a member of the domain admin group.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">net user yashika /Domain</pre>
<p><span style="color: #000000;">Even if the administrator tries to remove Yashika from the domain admin group. After 3 minutes, due to the Security Descriptor Propagator process, it will again add Yashika into the  Domain Admin Group.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-XnDtcVWyZPU/XtuxO4lIhvI/AAAAAAAAkeI/HJAlGfn6TtAJf49TezxQs7vavnzM5duFACLcBGAsYHQ/s1600/7.png" alt="Domain Persistence AdminSDHolder" width="632" height="1016"/></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
