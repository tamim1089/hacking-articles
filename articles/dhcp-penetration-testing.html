<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">DHCP Penetration Testing</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/dhcp-penetration-testing/" rel="bookmark"><time class="entry-date published updated" datetime="2017-12-29T16:32:26+00:00">December 29, 2017</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">DHCP stands for <strong>Dynamic Host Configuration Protocol</strong> and a DHCP server dynamically assigns an IP address to enable hosts (DHCP Clients). Basically, the DHCP server reduces the manual effort of the administrator of configuring the IP address in client machine by assigning a valid IP automatically to each network devices. A DHCP is available for distributing IP address of any Class among A B C D E basis on their netmask description which means it is applicable even for a small network or a huge network.</span></p>
<p><span style="color: #000000;">DHCP uses UDP as its transport protocol. The client sends messages to the server on port 67 and the server sends messages to the client on port 68.</span></p>
<p><span style="color: #000000;">There are three mechanisms used to assign an IP address to the client. They are:</span></p>
<ul>
<li><span style="color: #000000;"><strong>Automatic allocation</strong> – DHCP assigns a permanent IP address to a client</span></li>
<li><span style="color: #000000;"><strong>Manual allocation</strong> – Client’s IP address is assigned by the administrator, DHCP conveys the address to the client.</span></li>
<li><span style="color: #000000;"><strong>Dynamic allocation</strong>– DHCP assigns an IP address to the client for a limited period of time (lease).</span></li>
</ul>
<p><span style="color: #000000;"><strong>Mode of Operation DHCP server and DHCP Client</strong></span></p>
<ul>
<li><span style="color: #000000;"><strong>DHCP Discover: </strong>DHCP client broadcast a DHCP discover message to DHCP server for an IP address lease request through subnet mask for e.g. 255.255.255.255.</span></li>
<li><span style="color: #000000;"><strong>DHCP Offer: </strong>DHCP server receives DHCP Discover message for an IP address lease from DHCP client and reserve IP for it and sends DHCP OFFER message to DHCP Client for IP lease.  </span></li>
<li><span style="color: #000000;"><strong>DHCP Request: </strong>DHCP client broadcast a message to DHCP server for acceptance of IP by receiving Offered IP packets and make DHCP request for IP parameter configuration.</span></li>
<li><span style="color: #000000;"><strong>DHCP Acknowledgment: </strong>DHCP server receives DHCP client request for IP configuration process and as responds DHCPACK message sent to the client with committed IP address and its configuration and with some additional information such lease time of offered IP.</span></li>
<li><span style="color: #000000;"><strong>DHCP Release: </strong>DHCP client sends a DHCP Release packet to the DHCP server to release the IP address.</span></li>
</ul>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-22sGThRIBBA/WkZqQMjR9wI/AAAAAAAAS3c/chV-LCJ6KP0dInVbgF7ZehZ3Cj5RAHAwgCEwYBhgL/s1600/1.png"/></span></p>
<h3><span style="color: #800000;"><strong>DHCP Starvation Attack</strong></span></h3>
<p><span style="color: #000000;">A DHCP starvation attack may also categories as DHCP DOS attack where the attacker broadcasting fake DHCP requests with spoofed MAC addresses. If official replies to this fake request then it can exhaust the address space available to the DHCP servers for a period of time. This can be performed by using attacking tools such as “Yersinia”.</span></p>
<p><span style="color: #000000;">Now the attacker may place the rouge server in the network and respond to new DHCP requests from clients.</span></p>
<p><span style="color: #000000;">in given below image you can observe that by executing given command we discovered bind hardware with our official router. Here we had used CISCO router for DHCP penetration testing.</span></p>
<pre class="lang:default decode:true">ip dhcp binding</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-Fy89oybstwE/WkZqQtzXZgI/AAAAAAAAS3k/10BxokDTXXsIMJVNC-FxaUeThwncQTpoACEwYBhgL/s1600/2.png"/></span></p>
<h3><span style="color: #800000;"><strong>Launch DHCP Starvation Attack using Yersinia</strong></span></h3>
<p><span style="color: #000000;"><strong>Yersinia</strong> is a network tool designed to take advantage of some weakness in different network protocols. It pretends to be a solid framework for analyzing and testing the deployed networks and systems.</span></p>
<p><span style="color: #000000;">Currently, yersinia supports:</span></p>
<ul>
<li><span style="color: #000000;">Spanning Tree Protocol (STP)</span></li>
<li><span style="color: #000000;">Cisco Discovery Protocol (CDP)</span></li>
<li><span style="color: #000000;">Dynamic Trunking Protocol (DTP)</span></li>
<li><span style="color: #000000;">Dynamic Host Configuration Protocol (DHCP)</span></li>
<li><span style="color: #000000;">Hot Standby Router Protocol (HSRP)</span></li>
<li><span style="color: #000000;">IEEE 802.1Q</span></li>
<li><span style="color: #000000;">IEEE 802.1X</span></li>
<li><span style="color: #000000;">Inter-Switch Link Protocol (ISL)</span></li>
<li><span style="color: #000000;">VLAN Trunking Protocol (VTP)</span></li>
</ul>
<p><span style="color: #000000;"><strong>From http://www.yersinia.net/</strong></span></p>
<p><span style="color: #000000;">By default in Kali Linux installed yersinia is available for DHCP penetration testing, open the terminal and execute given command which will open yersinia in GUI mode as shown in given below image.</span></p>
<pre class="lang:default decode:true">yersinia -G</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-7Qp4aZCLSqM/WkZqQ0VohDI/AAAAAAAAS4I/0415L1fq4oUQ9lwlpjO7GFG9vjwckr6UACEwYBhgL/s1600/3.png"/></span></p>
<p><span style="color: #000000;">You will observe few tabs in the menu bar click on <strong>launch attack</strong>; a small window will pop up for choosing the protocol for attack here we had select DHCP, now enable the option for sending  DISCOVER packet.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-KJTVZULXbVM/WkZqRo3W6LI/AAAAAAAAS4I/4Tv9cZBSXKkdbMmZL1nalWw_8O46aj3SACEwYBhgL/s1600/4.png"/></span></p>
<p><span style="color: #000000;">Now it will start sending a <strong>Discover</strong> packet to the router for release IP for each of its fake Discover messages as shown in the given image.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-L1aFNDAXHW8/WkZqRzZMCEI/AAAAAAAAS4I/zt_noHBu8OQibdmpmT31oiZ-9bvU83bIQCEwYBhgL/s1600/5.png"/></span></p>
<p><span style="color: #000000;">From given below image you can observe Wireshark has captured the DHCP packet where the attacker machine as source 0.0.0.0 is broadcasting DISCOVER message to Destination on 255.255.255.255. This is DHCP starvation attack which also considered as DHCP Dos attack because its send Discover message infinitely in the network to block the responded server for another genuine request from another DHCP client.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-xO1FxB_EJ8o/WkZqSDJ0G5I/AAAAAAAAS4I/IH1NJE3Oq84TB_Fzv1rPcQNWPmjvHZrfwCEwYBhgL/s1600/6.png"/></span></p>
<p><span style="color: #000000;">Now when again you will check our router IP table then you will observe that all IP is allocated on some different-different Hardware address as shown in given below image.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-9dfqlwQYuuc/WkZqSLzOwKI/AAAAAAAAS4I/kjuRPeEicFgpK4q3QTKSjq1I4E38Rjb8QCEwYBhgL/s1600/7.png"/></span></p>
<h3><span style="color: #800000;"><strong>Rogue DHCP Server</strong></span></h3>
<p><span style="color: #000000;">A rough DHCP server is a forged server of attacker which is placed in a local network for stealing information that is being shared among several clients. After DHCP starvation attack, the official DHCP server is unable to Offer IP to DHCP client. Therefore when a client releases its old IP and requests new IP by broadcasting DHCP Discover message than rough server offers an IP as the response to the DHCP client and hence Client request for IP configuration from the fake server and get trap into the fake network. Now if the client is transferring any information over the fake network that can easily sniff by the rough server. </span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-GY0v1SC2PNQ/WkZqSjKtE7I/AAAAAAAAS4I/vL3TfClTjtsGP0Mk6STMb5ReuxJ3mu2egCEwYBhgL/s1600/8.1.png"/></span></p>
<p><span style="color: #000000;">in below image, you check attacker’s machine IP is 192.168.1.104 which will reflect as DNS address in victim’s machine (Windows’s).</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-gFAnOAmHGX4/WkZqTHomGnI/AAAAAAAAS4I/d-Ld2beSjTok07AUzgtmPI8E-ZEqVaergCEwYBhgL/s1600/8.png"/></span></p>
<p><span style="color: #000000;">Now open the terminal and type “msfconsole” for Metasploit framework and execute given below commands which will create your Rouge server in the network.</span></p>
<pre class="lang:default decode:true ">use auxiliary/server/dhcp
msf auxiliary(dhcp) &gt;set srvhost 192.168.1.104
msf auxiliary(dhcp) &gt;set netmask 255.255.255.0
msf auxiliary(dhcp) &gt;set DHCPIPSTART 192.168.1.200
msf auxiliary(dhcp) &gt;set DHCPIPEND 192.168.1.205
msf auxiliary(dhcp) &gt;exploit</pre>
<p><span style="color: #000000;">If you perceive above command then you will find that it will Start DHCP service and behave like a DHCP server which will offer Class C IP to official DHCP client from specified pool between 192.168.1.200 to 192.168.1.205.</span></p>
<p><span style="color: #000000;">Now turn on any another system in the network and check its IP configuration.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-tSjjwRizLmA/WkZqTt7EbuI/AAAAAAAAS4I/nDw2VNpegW4B0rjjZpkqEFFbJ6L0Co2xACEwYBhgL/s1600/9.png"/></span></p>
<p><span style="color: #000000;">Let’s study the given image where the attack is broadcasting Offer packet in the network and then in the 2<sup>nd</sup> packet we saw DHCP ACK which means some DHCP client ask for offered IP configuration then we can see DNS query send from an IP 192.168.1.202 to 192.168.1.104.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-xKoAU41IzpI/WkZqP5FRkzI/AAAAAAAAS4I/E0MbGYLLIvAgkXupa17w-LhrL9IU5TXNACEwYBhgL/s1600/10.png"/></span></p>
<p>in given below image you can observe that 192.168.1.202 IP is allocated to Ubuntu which is an official DHCP client. Now if the client is transferring any information over the fake network that can easily sniff by<span style="color: #000000;"> the rough server.  For detail read our previous article “</span><a style="color: #000000;" href="http://www.hackingarticles.in/comprehensive-guide-to-sniffing/"><strong>Comprehensive guide on sniffing</strong></a><span style="color: #000000;">”</span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignleft" src="https://3.bp.blogspot.com/-rEIKAZ1Rv4o/WkZqQGfU2lI/AAAAAAAAS4I/kcW6UZp4TtEplMayilyTckBrrrX5XJbxwCEwYBhgL/s1600/11.png"/></span></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><span style="color: #000000;"><strong>Author: </strong>AArti Singh is a Researcher and Technical Writer at Hacking Articles an Information Security Consultant Social Media Lover and Gadgets. Contact<a style="color: #000000;" href="https://www.linkedin.com/in/aarti--singh/"> <strong>here</strong></a></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
