<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Bypass SSH Restriction by Port Relay</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/bypass-ssh-restriction-by-port-relay/" rel="bookmark"><time class="entry-date published" datetime="2018-03-07T12:27:34+00:00">March 7, 2018</time><time class="updated" datetime="2025-05-27T12:03:22+00:00">May 27, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Today we are going to access the ssh port which is blocked by the firewall and is forwarded to another port through Port relay tool. Netcat relay is quite a useful tool to connect with any remote system by evading the firewall restriction.</span></p>
<p><span style="color: #000000;"><strong>Attacker:</strong> Kali Linux (IP: 192.168.1.2)</span></p>
<p><span style="color: #000000;"><strong>Victim:</strong> Ubuntu Server (IP: 192.168.1.7)</span></p>
<h3><span style="color: #800000;"><strong>Connect to SSH via port 22</strong></span></h3>
<p><span style="color: #000000;">Lets first try to get the normal SSH shell.  As you can see in the given screenshot we successfully get the ssh shell on the port 22 of the Server 192.168.1.7.</span></p>
<pre class="lang:default decode:true">ssh pavan@192.168.1.7</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-aKwh8kcNZW8/Wp_W-T392-I/AAAAAAAAVEU/Vb9KSUMSjgAkdaH_hqc0g_bCNwF-lcvigCEwYBhgL/s1600/1.png"/></span></p>
<h3><span style="color: #800000;"><strong>Block Port 22 for Incoming TCP Packet </strong></span></h3>
<p><span style="color: #000000;">Now let’s block SSH service Port 22 for Incoming TCP Packet using Iptables. Here we are making an inbound rule to block the TCP packets on the port 22 if the packet source is Kali (192.168.1.2)</span></p>
<pre class="lang:default decode:true">iptables -A INPUT -s 192.168.1.2 -p tcp --dport 22 -j DROP</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-HxtUYkbcDq4/Wp_W-KazhAI/AAAAAAAAVEQ/9RbWatQepn8C6kYSfpFm3eox4FuhQZ4dACEwYBhgL/s1600/2.png"/></span></p>
<p><span style="color: #000000;">After Blocking the port let’s try to get a shell. From given below image you can observe that we got a <strong>Connection Time Out Error</strong> as the packets are dropped by the firewall.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-n5PLIW6HOt0/Wp_W-ZdTA5I/AAAAAAAAVEY/UT82Th7ZWl4DMtiIwlHHw3kAERUIf1vvgCEwYBhgL/s1600/3.png"/></span></p>
<h3><span style="color: #800000;"><strong>Allow TCP Packets on another port</strong></span></h3>
<p><span style="color: #000000;">Now let’s make a rule in the firewall to accept the TCP packets on the port 4444 if the packet source is Kali (192.168.1.2).</span></p>
<pre class="lang:default decode:true ">iptables –I INPUT 1 –s 192.168.1.2 –p tcp --dport 4444 –j ACCEPT</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-2bcYTz2Qtp8/Wp_W_Lbm7dI/AAAAAAAAVEc/tB0BOe_Ixk8K4qGrIsqFDhU8UV25l4iwwCEwYBhgL/s1600/4.png"/></span></p>
<p><span style="color: #000000;"><strong>Check Netcat communication between Attacker and Client</strong></span></p>
<p><span style="color: #000000;">Let’s check if we can get a netcat session on the port 4444 to the Kali (192.168.1.2).</span></p>
<pre class="lang:default decode:true">nc –v –l –p 4444</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Z4uDpbrbJOI/Wp_W_Rq8SWI/AAAAAAAAVEg/4Bv_X8cP52crZMo0IiCDuFxk5xwt_e0KwCEwYBhgL/s1600/5.png"/></span></p>
<pre class="lang:default decode:true">nc 192.168.1.7 4444</pre>
<p><span style="color: #000000;">As you can see in the given Image that we have received a netcat session on the port 4444 from SSH server on the Kali (192.168.1.2).</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-aVzfR9HZWm0/Wp_W_odgF3I/AAAAAAAAVEk/U_NQexciGJwMoWNlpN6uNrpi67_aBuc3wCEwYBhgL/s1600/6.png"/></span></p>
<h3><span style="color: #800000;"><strong>Use Netcat Relay backpipe to access SSH service</strong></span></h3>
<p><span style="color: #000000;">Now we will have to make a Relay. But first, let’s understand, what the commands depicted below do?</span></p>
<p><span style="color: #000000;">The First command makes a special type of file called a FIFO or <strong>named pipe</strong>. We call it backpipe because it is going to carry our responses back through the relay.</span></p>
<p><span style="color: #000000;">Now the second command makes a netcat listener that is allowed through the firewall. This Netcat listener will connect its standard input (0&lt;) to the backpipe. We then forward the standard output of this Netcat listener to Netcat client, which connects to our localhost (127.0.0.1) on TCP port 22 where sshd listens. We then use the forward pipe (1&gt;) to send data and receive responses simultaneously. We need a back and forward pipe because Netcat provides two-way communication.</span></p>
<pre class="lang:default decode:true">mknod /tmp/backpipe p</pre>
<p>Here,</p>
<p><span style="color: #000000;"><strong>[p]: </strong>Tells the mknod to create a FIFO</span></p>
<pre class="lang:default decode:true">nc –l –p 4444 0&lt;/tmp/backpipe | nc localhost 22 1&gt;/tmp/backpipe</pre>
<p>Here,</p>
<p><span style="color: #000000;"><strong>[-l]: Listener</strong></span></p>
<p><span style="color: #000000;"><strong>[-p]: Port</strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-L-AIvkKFX4A/Wp_XAEls7VI/AAAAAAAAVEo/ZMHR5ZwZ1PwGiiGCQFB0X32iamWa54wOQCEwYBhgL/s1600/7.png"/></span></p>
<h3><span style="color: #800000;"><strong>Access SSH through Netcat Relay</strong></span></h3>
<p><span style="color: #000000;">Now let’s try to connect the ssh connection through the port 4444.</span></p>
<pre class="lang:default decode:true">ssh pavan@192.168.1.7 –p 4444</pre>
<p><span style="color: #000000;">Here,<strong><br/>
</strong></span></p>
<p><span style="color: #000000;"><strong>[-p]: To specify Port</strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-fSmkmmhfroI/Wp_XA0n6OzI/AAAAAAAAVEs/oxLkKpUVaakQZNpTCZ5YkwSlR_aivxk8gCEwYBhgL/s1600/8.png"/></span></p>
<p><span style="color: #000000;"><strong>Author: Pavandeep Singh</strong> is a Technical Writer, Researcher and Penetration Tester Contact <a style="color: #000000;" href="https://www.linkedin.com/in/pavandeep-singh-6b1074132"><strong>here</strong></a></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
