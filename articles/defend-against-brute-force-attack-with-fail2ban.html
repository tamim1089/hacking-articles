<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/collection-of-hacking-tools/" rel="category tag">Hacking Tools</a>, <a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Defend against Brute Force Attack with Fail2ban</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/defend-against-brute-force-attack-with-fail2ban/" rel="bookmark"><time class="entry-date published" datetime="2018-12-24T16:59:09+00:00">December 24, 2018</time><time class="updated" datetime="2025-05-29T12:20:50+00:00">May 29, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="ai-optimize-6 ai-optimize-introduction"><span style="color: #000000;">Daily we hear some news related to cybercrime just, like, some malicious users or bots have successfully defaced some publicly accessible websites or some services. We always try to explain through our articles how such types of activities can occur when someone weakly configures or misconfigures the system. It is therefore important to build some security measures, such as IDS / IPS in the firewall, to defend your server and clients while configuring it. We will defend against Brute Force Attack with Fail2ban.</span></p>
<p class="ai-optimize-7"><em><span style="color: #000000;">In this article, we will show how you can protect your network from brute force attacks and running network services?</span></em></p>
<p class="ai-optimize-8"><em><span style="color: #000000;">The answer is: Using IPS in your network.</span></em></p>
<h3 class="ai-optimize-9"><span style="color: #800000;">Table of Content</span></h3>
<ul>
<li class="ai-optimize-10"><span style="color: #000000;">What is an IPS?</span></li>
<li class="ai-optimize-11"><span style="color: #000000;">Introduction to fail2ban</span></li>
<li class="ai-optimize-12"><span style="color: #000000;">Lab Setup Requirement</span></li>
<li class="ai-optimize-13"><span style="color: #000000;">Brute Force Attack in Absence of IPS</span></li>
<li class="ai-optimize-14"><span style="color: #000000;">Intrusion Prevention Lab Set-Up</span></li>
<li class="ai-optimize-15"><span style="color: #000000;">Configure Fail2Ban</span></li>
<li class="ai-optimize-16"><span style="color: #000000;">Protect SSH Against Brute Force Attack</span></li>
<li class="ai-optimize-17"><span style="color: #000000;">Testing Fail2ban</span></li>
<li class="ai-optimize-18"><span style="color: #000000;">How to unban IP in fail2ban for SSH</span></li>
<li class="ai-optimize-19"><span style="color: #000000;">Protect FTP against Brute Force Attack</span></li>
<li class="ai-optimize-20"><span style="color: #000000;">Testing Fail2ban for VSFTP</span></li>
<li class="ai-optimize-21"><span style="color: #000000;">Unban IP for VSFTPD</span></li>
</ul>
<h3 class="ai-optimize-22"><span style="color: #800000;">What is an IPS?</span></h3>
<p class="ai-optimize-23"><span style="color: #000000;">Intrusion Prevention System is short-term as IPS, it networks security measures to examine the incoming traffic to perform intrusion detection and then block the detected incidents. For example, IPS can drop malicious packets, ban the traffic coming from an offending IP address.</span></p>
<h3 class="ai-optimize-24"><span style="color: #800000;">Introduction to fail2ban</span></h3>
<p class="ai-optimize-25"><span style="color: #000000;">Fail2ban scans log files (e.g. /var/log/apache/error_log) and ban IPs that show the malicious signs — too many password failures, seeking for exploits, etc. Generally, Fail2Ban is then used to update firewall rules to reject the IP addresses for a specified amount of time.</span></p>
<p class="ai-optimize-26"><span style="color: #000000;"><em>In this article, I will discuss how to prevent your running services against brute force attack using fail2ban.</em></span></p>
<p class="ai-optimize-27"><span style="color: #000000;"><em>Source: <span style="color: #3366ff;">https://www.fail2ban.org/wiki/index.php/Main_Page</span></em></span></p>
<p class="ai-optimize-28"><span style="color: #000000;"><b style="color: #000000;">Lab </b><span style="color: #000000;"><b>Setup</b></span><b style="color: #000000;"> Requirement </b></span></p>
<p class="ai-optimize-29"><span style="color: #000000;">Victim’s Machine: Ubuntu 14.04  (192.168.0.105)</span></p>
<p class="ai-optimize-30"><span style="color: #000000;">Pentester’s Machine: Kali Linux (192.168.0.105)</span></p>
<h3 class="ai-optimize-31"><span style="color: #800000;">Brute Force Attack in Absence of IPS</span></h3>
<p class="ai-optimize-32"><span style="color: #000000;">Now let’s try to launch a brute force attack when on port 22 which is open in the target’s network to make unauthorized login. With the help hydra, we will try to guess SSH login credential.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">hydra -L user.txt -P pass.txt 192.168.0.105 ssh</pre>
<p class="ai-optimize-33"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-owfDrp41D7k/XCEOHjkrp4I/AAAAAAAAb0c/0IJwBbZuBXAE0aTa1LFEU2m-cQw_nwQqACLcBGAs/s1600/0.1.png"/></span></p>
<p class="ai-optimize-34"><span style="color: #000000;">As you can observe in the above image that it has successfully found aarti:123 for ssh login. Similarly, let’s try to launch a brute force attack when on port 21 which is open in the target’s network to make unauthorized login. With the help hydra, we will try to guess FTP login credential.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">hydra -L user.txt -P pass.txt 192.168.0.105 ftp</pre>
<p class="ai-optimize-35"><span style="color: #000000;">And from the given below image, you can observe, how badly these services are configured. Even the network administrator has not followed the password complexity rules as a result, it is so easy to launch a brute force against such type of network.</span></p>
<p class="ai-optimize-36"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-CQ-OZbV9JuM/XCEOHkcklsI/AAAAAAAAb0Y/4NkSYx6uMhkrQHLpPj_xzjdf439IVEg0QCLcBGAs/s1600/0.2.png"/></span></p>
<h3 class="ai-optimize-37"><span style="color: #800000;">Intrusion Prevention Lab Set-Up</span></h3>
<p class="ai-optimize-38"><span style="color: #000000;">Therefore, I decided to set up the Intrusion Prevention system in this network which will monitor the incoming packets and detects the malicious activities and blocks that traffic coming from wicked IP. It is very easy to install fail2ban as Ubuntu already has a package for fail2ban in apt-repositories.</span></p>
<p class="ai-optimize-39"><span style="color: #000000;">First of all, let me show you, the iptables rule list, which is empty as shown in the below image and then executes the installation command. Once it gets completed, then <strong>copy</strong> the configuration of <strong>jail.conf</strong> file inside <strong>jail.local</strong> file.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sudo iptables -S
sudo apt-get install fail2ban</pre>
<p class="ai-optimize-40"><span style="color: #000000;"><strong>NOTE: </strong>While configuring fail2ban in your local machine, you must have root access or can use a non-root user with sudo rights.</span></p>
<p class="ai-optimize-41"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-VVyeMXLO1Xk/XCEOHXzH5HI/AAAAAAAAb0U/N2-e9lIMrT0yRLs_VIBndMMHXRKAkqNdACLcBGAs/s1600/1.png"/></span></p>
<h3 class="ai-optimize-42"><span style="color: #800000;">Configure Fail2Ban</span></h3>
<p class="ai-optimize-43"><span style="color: #000000;">The service fail2ban has its default configuration files “jail.local” in the /etc/fail2ban directory. Therefore, you should not edit this file, but you can override this into jail.local file with the help of below command and then open that file for configuring it as per your requirement.</span></p>
<p class="ai-optimize-44"><span style="color: #000000;">Above you have seen that we had successfully launched brute force attack on SSH and FTP. Therefore I will configure fail2ban to stop brute force attack in the network.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
sudo gedit /etc/fail2ban/jail.local</pre>
<p class="ai-optimize-45"><span style="color: #000000;">Once you open the file, you need to focus on a few things such as “ignoreip, bantime, maxretry” and then modify their value as per your requirement. Set the IPs you want fail2ban to ignore as ignoreip, set the ban time (in seconds) for a particular time period and maximum number for the user attempts.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ignoreip = 192.168.0.105 127.0.0.1
bantime = 600
maxretry = 3</pre>
<p class="ai-optimize-46"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-jiChwok5l9c/XCEOKWKxXVI/AAAAAAAAb04/2iII8qB4BqUKTiRXsbOsrIYrf4JomNE3QCLcBGAs/s1600/3.png"/></span></p>
<h3 class="ai-optimize-47"><span style="color: #800000;">Protect SSH Against Brute Force Attack</span></h3>
<p class="ai-optimize-48"><span style="color: #000000;">Ultimately, we come towards that portion of the configuration file which deals with specific services. These are identified by the section headers, such as [ssh].</span></p>
<p class="ai-optimize-49"><span style="color: #000000;">To enable each of these sections to uncomment header [ssh] and modify the enabled value into “true” as shown in the below image, and then save the jail.local file and restart the fail2ban service:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">[ssh]
enabled = true
service fail2ban restart</pre>
<p class="ai-optimize-50"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-j-cL_4RdZOc/XCEOKcQO8XI/AAAAAAAAb08/DzV8-lI2wjoaQeHHlY_oXLX4OH41lH7DACLcBGAs/s1600/4.png"/></span></p>
<h3 class="ai-optimize-51"><span style="color: #800000;">Testing Fail2ban for SSH</span></h3>
<p class="ai-optimize-52"><span style="color: #000000;">Fail2ban offers a command <em>“fail2ban-client”</em> that can be used to execute Fail2ban from the command line. To check that the Fail2Ban is running and the SSH jail is enabled you can follow the given syntax to confirm its status.</span></p>
<p class="ai-optimize-53"><span style="color: #000000;"><em>Syntax: fail2ban-client COMMAND</em></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sudo fail2ban-client status
sudo fail2ban-client status ssh</pre>
<p class="ai-optimize-54"><span style="color: #000000;">As you can observe, the current filter list and action list is set as 0 or all I can say, it is empty. These values will get change if someone tries to cross the limit of maxretry.</span></p>
<p class="ai-optimize-55"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-F93TUBZidwA/XCEOKu0-43I/AAAAAAAAb1A/z98V2Y4rAkgwRMqjP_C7QvC2HaKETvedQCLcBGAs/s1600/5.png"/></span></p>
<p class="ai-optimize-56"><span style="color: #000000;">As said above fail2ban will update iptables rules to reject the IP addresses for a specified amount of time. From the given below image you can observe, last 3 policies are automatically created by fail2ban.</span></p>
<p class="ai-optimize-57"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-4ZkDw5A91e8/XCEOLNbay1I/AAAAAAAAb1E/Rkq-ORjzVNwOnggBTbJyoqIp38HjYmD9QCLcBGAs/s1600/6.1.png"/></span></p>
<p class="ai-optimize-58"><span style="color: #000000;">Now let’s test host machine against brute force attack for ssh login once again:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">hydra -L user.txt -P pass.txt 192.168.0.105 ssh</pre>
<p class="ai-optimize-59"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-qrjlvhPw4jg/XCEOLff5rPI/AAAAAAAAb1I/AfjmhWwkQLkwUy8NV7c9oFaKvSlt1XJFACLcBGAs/s1600/6.png"/></span></p>
<p class="ai-optimize-60"><span style="color: #000000;">And as you can obverse, this time we got “<em>Connection refused</em>” error while brute forcing attack on port 22.</span></p>
<p class="ai-optimize-61"><span style="color: #000000;">Hmm!! Not bad, let’s also check the status for ssh jail status after this attack.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sudo fail2ban-client status ssh</pre>
<p class="ai-optimize-62"><span style="color: #000000;">Now you can observe that in the given below image. It has shown <em>1 ban IP:</em> <em>192.168.0.104</em> and anybody can explore log file too for more details.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">tail /var/log/auth.log</pre>
<p class="ai-optimize-63"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-USOASC_pwd8/XCEOLZwU9UI/AAAAAAAAb1M/sEAbRWK6DfcZma3hZT0EzALpfAvYGs2pwCLcBGAs/s1600/7.png"/></span></p>
<h3 class="ai-optimize-64"><span style="color: #800000;">How to unban IP in fail2ban for SSH</span></h3>
<p class="ai-optimize-65"><span style="color: #000000;">If you wish to unban the IP then again, you can go with fail2ban-client commands and do the same as done here:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">fail2ban-client -i
set ssh unbanip 192.168.0.104
exit
sudo fail2ban-client status ssh</pre>
<p class="ai-optimize-66"><span style="color: #000000;">And when you will check ssh jail status one more time, this time it won’t be showing any IP in the IP list.</span></p>
<p class="ai-optimize-67"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-OqKXpWXwMcU/XCEOMCWCeII/AAAAAAAAb1Q/jeoA--d0iUMuf80dcUVaOR8EeTOM6LgAwCLcBGAs/s1600/8.png"/></span></p>
<h3 class="ai-optimize-68"><span style="color: #800000;">Protect FTP against Brute Force Attack</span></h3>
<p class="ai-optimize-69"><span style="color: #000000;">Similarly, to enable FTP sections to uncomment [vsftpd] header and change the enabled line to be “true” as shown in the below image and even you can modify maxretry or log file path as per your requirement.</span></p>
<p class="ai-optimize-70"><span style="color: #000000;">[vsftpd]</span></p>
<p class="ai-optimize-71"><span style="color: #000000;">enabled = true</span></p>
<p class="ai-optimize-72"><span style="color: #000000;">maxretry = 3</span></p>
<p class="ai-optimize-73"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-w966ISrCOro/XCEOIV3aLnI/AAAAAAAAb0g/RdofSnbXUTU-MGR1AnO-6mNpFsd3i80LACLcBGAs/s1600/10.png"/></span></p>
<h3 class="ai-optimize-74"><span style="color: #800000;">Testing Fail2ban for VSFTPD</span></h3>
<p class="ai-optimize-75"><span style="color: #000000;">Now save jail.local file and restart the fail2ban service and then you can check fail2ban and its Jail status including iptables rules.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sudo service fail2ban restart
sudo fail2ban-client status
sudo fail2ban-client status vsftpd
iptables -S</pre>
<p class="ai-optimize-76"><span style="color: #000000;">With the help of the above command, we concluded that now there are two jails: ssh and vsftpd, and we also created some new fail2ban policies within iptables.</span></p>
<p class="ai-optimize-77"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-19kp2Ryx-HQ/XCEOIm0VYpI/AAAAAAAAb0k/d0FBj6wYAyMyYo8WqBE76eMBPEe317zDwCLcBGAs/s1600/11.png"/></span></p>
<p class="ai-optimize-78"><span style="color: #000000;">Now let’s test host machine against brute force attack for FTP login:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">hydra -L user.txt -P pass.txt 192.168.0.105 ftp</pre>
<p class="ai-optimize-79"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-dw_iR78Al-0/XCEOIn6P1KI/AAAAAAAAb0o/ASXp6ZWTCBcOyG2Miqvl1-dmcsSFusJKACLcBGAs/s1600/12.1.png"/></span></p>
<p class="ai-optimize-80"><span style="color: #000000;">And as you can observe, this time we received a connection refused error during the brute force attack, and let’s check the status for vsftpd jail status once again.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sudo fail2ban-client status vsftpd</pre>
<p class="ai-optimize-81"><span style="color: #000000;">Yet again you can observe that in the given below image. It has shown <em>1 ban IP: 192.168.0.104</em> and anybody can check log file too for more details.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">tail /var/log/vsftpd.log</pre>
<p class="ai-optimize-82"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-oMMpJFRVV8o/XCEOJMMQ3iI/AAAAAAAAb0s/ezSy4U98CY8LM7Op53U7fhYNsKnS_QspACLcBGAs/s1600/12.png"/></span></p>
<p class="ai-optimize-83"><span style="color: #000000;">And look at the vsftpd log file, contains all detailed related to login attempt.</span></p>
<p class="ai-optimize-84"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-5fAe1ho8aA4/XCEOJzk9FJI/AAAAAAAAb00/DZWCQ_pwyEIOCofP2ZnXYDBA05-NgnTVwCLcBGAs/s1600/13.png"/></span></p>
<h3 class="ai-optimize-85"><span style="color: #800000;">Unban IP in fail2ban for VSFTPD</span></h3>
<p class="ai-optimize-86"><span style="color: #000000;">If you wish to unban or unblock the IP then again. You can go with fail2ban-client commands and do the same as done here:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sudo fail2ban-client -i
set vsftpd unbanip 192.168.0.104
exit
sudo fail2ban-client status vsftpd</pre>
<p class="ai-optimize-87"><span style="color: #000000;">And when you will check vsftpd jail status once again. This time it won’t be showing any IP in the IP list.</span></p>
<p class="ai-optimize-88"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-y8Il3Ho0fY0/XCEOJkOVnwI/AAAAAAAAb0w/Zjz-N22wy3gPfnwq_lpbMfA8Hc9HVDbVQCLcBGAs/s1600/14.png"/></span></p>
<p class="ai-optimize-89"><span style="color: #000000;">Hope! You people will enjoy the article and find helpful in your network penetration testing and you can do more with fail2ban for securing your network.</span></p>
<p class="ai-optimize-6"><span style="color: #000000;">To gain more knowledge about hacking tools. Click on this</span> <strong><a href="https://www.hackingarticles.in/category/collection-of-hacking-tools/">link.</a></strong></p>
<p class="ai-optimize-90"><span style="color: #000000;"><strong>Author: </strong>Aarti Singh is a Researcher and Technical Writer at Hacking Articles an Information Security Consultant Social Media Lover and Gadgets. Contact<strong><a style="color: #000000;" href="https://www.linkedin.com/in/aarti--singh/"> here</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
