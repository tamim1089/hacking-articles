<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/credential-dumping/" rel="category tag">Credential Dumping</a>, <a href="https://www.hackingarticles.in/category/red-teaming/domain-credential/" rel="category tag">Domain Credential</a></span>            </div>
            <h1 class="post-title entry-title">Credential Dumping: Domain Cache Credential</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/credential-dumping-domain-cache-credential/" rel="bookmark"><time class="entry-date published" datetime="2020-06-13T11:13:22+00:00">June 13, 2020</time><time class="updated" datetime="2025-05-16T21:05:53+00:00">May 16, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">In this post, we are going to discuss the domain cache credential attack and various technique to extract the password hashes by exploiting domain user.</span></p>
<h3><span style="color: #800000;">Table of Content</span></h3>
<ul>
<li><strong><span style="color: #000000;">Domain Cache credential</span></strong></li>
<li><strong><span style="color: #000000;">Metasploit</span></strong></li>
<li><strong><span style="color: #000000;">Impacket</span></strong></li>
<li><strong><span style="color: #000000;">Mimikatz</span></strong></li>
<li><strong><span style="color: #000000;">PowerShell Empire</span></strong></li>
<li><strong><span style="color: #000000;">Koadic</span></strong></li>
<li><strong><span style="color: #000000;">Python Script</span></strong></li>
</ul>
<h3><span style="color: #800000;">Domain Cache credential (DCC2)</span></h3>
<p><span style="color: #000000;">Microsoft Windows stores previous users’ logon information locally so that they can log on if a logon server is unreachable during later logon attempts. This is known as <strong>Domain Cache credential</strong> (DCC) but in-actually it is also known as <strong>MSCACHE</strong> or <strong>MSCASH </strong>hash. It sorted the hash of the user’s password that you can’t perform pass-the-hash attacks with this type of hash. It uses MSCACHE algorithm for generating password hash and that are stored locally in the Windows registry of Windows operating system. These hashes are stored in the Windows registry, by default the last 10 hashes.</span></p>
<p><span style="color: #000000;">There two versions of MSCASH/MSCACHE or DCC</span></p>
<ul>
<li><span style="color: #000000;">MSCACHEV1 or DCC1 used before Vista Server 2003</span></li>
<li><span style="color: #000000;">MSCACHEV2 or DCC2 used after Vista &amp; Server 2003</span></li>
</ul>
<h3><span style="color: #000000;"><span style="color: #800000;">Walkthrough</span> </span></h3>
<h3><span style="color: #800000;">Metasploit</span></h3>
<p><span style="color: #000000;">Metasploit helps the pen tester to extract the stored hashes by exploit registry for MSCACHE stored hashes. This module uses the registry to extract the stored domain hashes that have been cached as a result of a GPO setting. The default setting on Windows is to store the last ten successful logins.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use post/windows/gather/cachedump
set session 2
exploit</pre>
<p><span style="color: #000000;">As a result it will dump the password hashes, and these fetched from inside DCC2/MSCACHE as shown in the image given below.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-AhgTnlmegXc/XuSyYwIGGzI/AAAAAAAAku0/rYO582w7nXo77u10U72m35y9plx9D28MwCLcBGAsYHQ/s1600/1.png"/></span></p>
<h3><span style="color: #800000;">Impacket </span></h3>
<p><span style="color: #000000;">This hash can be extracted using python impacket libraries, this required system and security files stored inside the registry. With the help of the following command, you can pull out these files from the registry and save on your local machine.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">reg save hklm\system c:\system
reg save hklm\security c:\secuirty</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-kzPuFpHZdL0/XuSyZn9MS2I/AAAAAAAAku8/IqtKZdKibYUYZ1ySSNcNcMATuoJUBNt4wCLcBGAsYHQ/s1600/2.png"/></span></p>
<p><span style="color: #000000;">Further copy the system and security file on that platform where impacket is installed, in our case we copied it inside kali Linux and use the following for extracting DCC2/MSCACHE hashes.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python secretsdump.py -security -system system LOCAL</pre>
<p><span style="color: #000000;">Boom!!!! You will get the DCC2/MSCACHEv2 hashes on your screen.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-h8zslH_Swbg/XuSyaGBVy7I/AAAAAAAAkvA/u-xhcFPOQ0Mo9PH12g1ttvck6qbDlKr0QCLcBGAsYHQ/s1600/3.png"/></span></p>
<h3><span style="color: #800000;">Mimikatz</span></h3>
<p><span style="color: #000000;">As we all know, mimikatz is one of the best penetration testing tools for credential dumping windows. So, we can get DCC2 / MSCACHEv2 hashes using mimikatz by installing it on a compromised host and executing the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">privilege::debug
token::elevate
lsadump::cache</pre>
<p><span style="color: #000000;">And again, you will get the MSCACHEv2 hashes on your screen.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-bwIOkh6xUHk/XuSyaKBlaPI/AAAAAAAAkvE/D9ZgvPwOtoYQMqbtT7JYHm8bMDke_D8GACLcBGAsYHQ/s1600/4.png"/></span></p>
<h3><span style="color: #000000;"><span style="color: #800000;">PowerShell Empire</span> </span></h3>
<p><span style="color: #000000;">Moving to our next technique, PowerShell Empire has a module that extracts the MSCACHEV2 hashes from the inside registry of the compromised machine. So, download and run Empire on your local machine and compromise the host machine once to use the empire post module and then type as follows:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule credentails/mimikatz/cache
set agent &lt;agent_id&gt;
execute</pre>
<p><span style="color: #000000;">And again, you will get the MSCACHEv2 hashes on your screen.</span></p>
<p><span style="color: #000000;"><strong><img decoding="async" src="https://1.bp.blogspot.com/-Kf3MEOhWOvc/XuSyamfYrCI/AAAAAAAAkvI/UhbXYHyyAj4JOm_x9xE-26U50ipZ93-XQCLcBGAsYHQ/s1600/5.png"/></strong></span></p>
<h3><span style="color: #800000;">Koadic </span></h3>
<p><span style="color: #000000;">Just like the Powershell empire, you can use koadic to extract the DCC2 hashes. You can read more about koadic from <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.hackingarticles.in/koadic-com-command-control-framework/">here</a></strong></span>. Run following module to hashes:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use mimikatz_dotnet2js
set MIMICMD lsadump::cache</pre>
<pre class="lang:default decode:true"><span style="color: #000000;">And again, you will get the MSCACHEv2 hashes on your screen.</span></pre>
<p><span style="color: #000000;"><strong><img decoding="async" src="https://1.bp.blogspot.com/-Abr5bYgjl1I/XuSybKrONUI/AAAAAAAAkvM/HlgSaZwhgS8rojkX4VZwIngLXm28KdF2wCLcBGAsYHQ/s1600/8.png"/></strong></span></p>
<h3><span style="color: #000000;"><span style="color: #800000;">Python Script</span> </span></h3>
<p><span style="color: #000000;">Just like impacket, you can download the MSCACHEV2 python script to extract the stored hashes. Download the script from <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/QAX-A-Team/mscache.git">github</a> </strong></span>and then use security and system files  (As discussed in Impacted)</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python mscache.py --security /root/Desktop/security –system /root/Desktop/system</pre>
<p><span style="color: #000000;">And again, you will get the MSCACHEv2 hashes on your screen.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-hDLJ7GvbDNo/XuSyZJQNqyI/AAAAAAAAku4/lKib38rwkxAmBsgKBnVQ19rZDs4M1cKHgCLcBGAsYHQ/s1600/10.png"/></span></p>
<h3><span style="color: #800000;">Cracking DCC2 or MACHACHE2/MSCASH2</span></h3>
<p><span style="color: #000000;">As we know, attackers do not use these hashes in PASS The Hash attacks, so you need to use <strong data-start="166" data-end="185">John the Ripper</strong> to crack these hashes for further utilization.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">john --format=mscash2 --wordlist=/usr/share/wordlists/rockyou.txt mhash</pre>
<p><span style="color: #000000;">As a result, it has dumped the password in clear text for the given hash file. Hence don’t get confused between DCC2 or MSCACHEV2/MSCASH hash these all are same and you can use the above-discussed the method to extract them.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-8u9t4Da302w/XuSyY4bUURI/AAAAAAAAkuw/SKf0I_5_eSc7WbtOZswjFL0IP3fQUkvsQCLcBGAsYHQ/s1600/11.png"/></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
