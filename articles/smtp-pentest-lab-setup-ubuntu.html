<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a>, <a href="https://www.hackingarticles.in/category/pentest-lab-setup/" rel="category tag">Pentest Lab Setup</a></span>            </div>
            <h1 class="post-title entry-title">SMTP Pentest Lab Setup in Ubuntu (Port 25)</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/smtp-pentest-lab-setup-ubuntu/" rel="bookmark"><time class="entry-date published" datetime="2017-09-15T18:09:44+00:00">September 15, 2017</time><time class="updated" datetime="2025-05-13T09:00:58+00:00">May 13, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Wonder, how your email travels from one device to another? Today in this article, we’ll analyze how an <strong>SMTP server </strong>is responsible for setting up a connection between two different users in order to share an email over the desired network.</span></p>
<h3><span style="color: #800000;"><strong>Table of Content</strong></span></h3>
<ul>
<li><span style="color: #000000;">Understanding the SMTP Protocol</span></li>
<li><span style="color: #000000;">Introduction to Rain Loop</span></li>
<li><span style="color: #000000;">Adding a Hostname and Domain name</span></li>
<li><span style="color: #000000;">Postfix installation</span></li>
<li><span style="color: #000000;">Configuring Postfix</span></li>
<li><span style="color: #000000;">Installation of Dovecot</span></li>
<li><span style="color: #000000;">Setting the lab for Dovecot</span></li>
<li><span style="color: #000000;">Installation of Rain Loop</span></li>
</ul>
<h3><span style="color: #800000;"><strong>Understanding the SMTP Protocol</strong></span></h3>
<p><span style="color: #000000;"><strong>Simple</strong> <strong>Mail</strong> <strong>Transfer</strong> <strong>Protocol</strong> abbreviated as <strong>“SMTP”</strong> – an application layer <strong>TCP/IP</strong> protocol, which run over port <strong>25 </strong>in order to allow the applications to transfer an email to and through networks by following up a method called <strong>“inventory</strong> and <strong>forward”. </strong></span></p>
<p><span style="color: #000000;">This protocol closely works with something called as <strong>Mail Transfer Agent</strong> <strong>(MTA)</strong> in order to send your communication emails to the correct computer and inbox.</span></p>
<p><span style="color: #000000;">SMTP sets out and guides, how your email travels to another device from the MTA of your device to the MTA of others. Using the above-mentioned <strong>“store and forward”</strong> function, the message will travel from your device to its destination in steps. At each step, the Simple Mail Transfer Protocol will do its job.</span></p>
<p><span style="color: #000000;">Let’s check out the other different protocols that the client applications use in order to retrieve messages.</span></p>
<ul>
<li><span style="color: #000000;"><strong>POP3 </strong>which stands for “Post Office Protocol 3”- is an Internet standard application layer protocol used by the local email clients to access emails from a remote server over a TCP/IP connection. It runs over port<strong> 110</strong> to capture the emails.</span></li>
<li><span style="color: #000000;"><strong>IMAP </strong>termed as “Internet Mail Access Protocol” which is also an Internet standard protocol used by email clients to retrieve email messages from a mail server via a TCP/IP connection. It uses port<strong> 143</strong> to receive emails.</span></li>
</ul>
<h3><span style="color: #800000;"><strong>Introduction to Rain Loop</strong></span></h3>
<p><span style="color: #000000;">Rain loop is a simple <strong>PHP scripted,</strong> web-based email client application, that allows the users to access their emails from a single web interface from all their external mailboxes. This is a perfect way to get all of your external mails like Google, Yahoo, and other SMTP inboxes on your own server.</span></p>
<p><span style="color: #000000;">Let’s check out how we can set up an<strong> “SMTP mail server”</strong> over our <strong>“<em>Ubuntu 18.4” </em></strong>machine<strong>.</strong></span></p>
<p><span style="color: #000000;">Adding Hostname and Domain Name</span></p>
<p><span style="color: #000000;">Initially, we need to <strong>fix</strong> <strong>our</strong> <strong>hostname</strong>. Simply open the host file with <strong>“root privilege”</strong> to add up a hostname and domain name using the following command:</span></p>
<pre class="lang:default decode:true">sudo nano /etc/hosts</pre>
<p><span style="color: #000000;">Now add the domain name to the host file and save it.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-yXpFmXnazJk/Xw9Qvuf2xCI/AAAAAAAAl3w/3e1W-tLruXYB6EKqTZSplDF2CwhKoa4WACLcBGAsYHQ/s1600/1.png"/></span></p>
<p><span style="color: #000000;">To modify the default hostname, just open the hostname file with the <strong>root privileges </strong>again. Now rewrite and save the default hostname as <strong>“ignite”,</strong> which we have listed in the host file earlier.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-6O8E6wbQNqs/Xw9Q2QH79uI/AAAAAAAAl34/nqH03IGpM0QMxcWP7YmDu7Ahe6qks0XJQCLcBGAsYHQ/s1600/2.png"/></span></p>
<p><span style="color: #000000;">Now check the hostname and domain by typing the following command and in order to be sure with the changes you had made.</span></p>
<pre class="lang:default decode:true">hostname
hostname -f</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-ljd1T1640DE/Xw9Q8to_QJI/AAAAAAAAl38/wl9d5KyLDqc5zOdcIdV8dCD_5BguMnNtgCLcBGAsYHQ/s1600/3.png"/></strong></span></p>
<h3><span style="color: #800000;"><strong>Postfix Installation</strong></span></h3>
<p><span style="color: #000000;">Postfix is Ubuntu’s default “Mail Transfer Agent” (MTA). This resides in the central repository of Ubuntu, such that it could get all the security updates. Over this section, we’ll learn how to use a safe link to install and configure postfix and set it up as an SMTP server.</span></p>
<pre class="lang:default decode:true">apt-get install postfix</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-u88q2dh7ynI/Xw9RBSYeTmI/AAAAAAAAl4E/aliopPwJbkwvrBLEHsV256z5bSD29_HGACLcBGAsYHQ/s1600/4.png"/></span></p>
<p><span style="color: #000000;">For the Postfix configuration, you will be popped up with a dialog box, where you must select the “<strong>Internet Site</strong>” as a general type of mail configuration as shown in the below image.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-adcNi8eeGLU/Xw9RGaF7ixI/AAAAAAAAl4M/REzVerJfabEGTX30GMGM3vGne_umzXLVQCLcBGAsYHQ/s1600/5.png"/></span></p>
<p><span style="color: #000000;">Enter the domain name as (<strong>mail.ignite.lab</strong>), which we have saved as a machine mail name within the host file, and further hit the<strong> OK </strong>tab.</span></p>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-Ye0vI7A9iA4/Xw9RMsm_eVI/AAAAAAAAl4Q/Z04D5BhYgoMsclQNLWYBVxdBZXMAuLv5wCLcBGAsYHQ/s1600/6.png"/></strong></span></p>
<h3><span style="color: #800000;"><strong>Configuring Postfix</strong></span></h3>
<p><span style="color: #000000;">Postfix was already using the “Maildir” format. It is thus set with the home mailbox = Maildir/ parameter in /etc/postfix/main.cf. Open <strong>main.cf</strong> file and make the following changes in it and further save that.</span></p>
<pre class="lang:default decode:true">sudo nano /etc/postfix/main.cf</pre>
<p><span style="color: #000000;">Add subnet IP my networks = 127.0.0.0/8 <strong>192.168.1.0/24</strong></span></p>
<p><span style="color: #000000;">Enter inet_protocols = <strong>ipv4</strong></span></p>
<p><span style="color: #000000;">Add new line <strong>home_mailbox = Maildir/</strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-H71-nYgHN0U/Xw9RTbfH28I/AAAAAAAAl4c/MqEDdnStrisHg_YeGoBuVSa8B3hitXimgCLcBGAsYHQ/s1600/7.png"/></span></p>
<p><span style="color: #000000;">After making changes to the configuration file, simply <strong>restart</strong> the <strong>postfix service</strong> by:</span></p>
<pre class="lang:default decode:true">service postfix restart</pre>
<p><span style="color: #000000;">Now type the following command to view the list of the open ports to listen for incoming connections. You can observe the <strong>STATE</strong> of port <strong>25</strong> from the below image.</span></p>
<pre class="lang:default decode:true">netstat -tnl</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-mZhtWx0qry0/Xw9RcpIqByI/AAAAAAAAl4k/P7q7GCQG-1kvX7-pqy90vELF6Rt89POCACLcBGAsYHQ/s1600/8.png"/></span></p>
<h3><span style="color: #800000;"><strong>Installation of Dovecot</strong></span></h3>
<p><span style="color: #000000;">Dovecot is a “Mail Delivery Service”, written mainly with some security sections in mind. This delivery service majorly supports the following mailbox formats i.e. <strong>mbox</strong> or <strong>Maildir</strong>.</span></p>
<p><span style="color: #000000;">Therefore in this section, you’ll learn <strong>“how to set up an IMAP or a POP3 server”</strong>.  Run the following command to move further in the league.</span></p>
<pre class="lang:default decode:true">apt-get install dovecot-imapd dovecot-pop3d</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-asaRJpnkHRE/Xw9Rh9NNKZI/AAAAAAAAl4s/theB32DxqigdhlH02OlFl_QsMC3zu_0oACLcBGAsYHQ/s1600/9.png"/></strong></span></p>
<h3><span style="color: #800000;"><strong>Dovecot configuration setting</strong></span></h3>
<p><span style="color: #000000;">Open “<strong>10-auth.conf</strong>” file through given below path and make the following changes in it as shown in the given image then save it.</span></p>
<pre class="lang:default decode:true">sudo nano /etc/dovecot/conf.d/10-auth.conf
disable_plaintest_auth = yes</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-uRJD1G-hgPo/Xw9Ro6Vtp6I/AAAAAAAAl40/tIELOkEQAY4npwyxSQrYZvLElYdryyK3wCLcBGAsYHQ/s1600/10.png"/></span></p>
<p><span style="color: #000000;">Change auth mechanisms = <strong>plain login</strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-wkxrUDiw98U/Xw9RzX9geFI/AAAAAAAAl5A/Z6-WaiRX_i4J_wWfRK6v5USP_LDKxhgfQCLcBGAsYHQ/s1600/11.png"/></span></p>
<p><span style="color: #000000;">Open the <strong>10-mail.conf</strong> file with-</span></p>
<pre class="lang:default decode:true">sudo nano /etc/dovecot/conf.d/10-mail.conf</pre>
<p><span style="color: #000000;">Now make the following changes in this as shown in the given image and then save it.</span></p>
<pre class="lang:default decode:true">mail_location =  maildir:/home/%u/Maildir</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-gIED5x-uZyc/Xw9R54FEIeI/AAAAAAAAl5I/OnVy4JQigbIegToaBDcLb-QQYl-WVcsXwCLcBGAsYHQ/s1600/12.png"/></span></p>
<p><span style="color: #000000;">Further, open the <strong>10-master.conf</strong> file through the given path and make the amendments:</span></p>
<pre class="lang:default decode:true">sudo nano /etc/dovecot/conf.d/10-master.conf
port = 143
port = 110</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-UhaXMzCPDm4/Xw9SALGeOZI/AAAAAAAAl5M/_JGkpGSjS64T_QcWlgUOsfzvBduDDdr3ACLcBGAsYHQ/s1600/13.png"/></span></p>
<p><span style="color: #000000;">Time to give permissions for unix_listener auth-user DB with:</span></p>
<pre class="lang:default decode:true">Mode = 0600
User = postfix
Group = postfix</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-1mTkCvTkFQw/Xw9SHZ9F9SI/AAAAAAAAl5U/no3pciGuAGEmHV4zHu4Xm8bCzbB3gnbkACLcBGAsYHQ/s1600/14.png"/></span></p>
<p><span style="color: #000000;">We’re are almost there, just restart the <strong>dovecot</strong> service by running up the following command-</span></p>
<pre class="lang:default decode:true">service dovecot restart</pre>
<p><span style="color: #000000;">Scan the running service by using <strong>netstat –tnl,</strong> to check the available ports to listen to the incoming connections</span></p>
<p><span style="color: #000000;">From the below image, you can observe the <strong>STATE LISTEN</strong> for the ports <strong>110</strong> and <strong>143</strong>.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-8JLKob5B6uI/Xw9SN_kYLTI/AAAAAAAAl5c/Ic-HV1D-IGA7oU7VhCJEtoGfRjxfK41sACLcBGAsYHQ/s1600/15.png"/></span></p>
<h3><span style="color: #800000;"><strong>Installing Rain Loop</strong></span></h3>
<p><span style="color: #000000;">As everything is now at its position. Its time to install <strong>Rain Loop</strong>. Without the need for a database, Rain Loop comes with decent performance, easy installation and update and support for IMAP and SMTP protocols (SSL, STARTTLS), sieve scripts support, Facebook, Google, Twitter, and Dropbox integration and much more.</span></p>
<p><span style="color: #000000;">Let’s start!!</span></p>
<p><span style="color: #000000;">Run the following command in Ubuntu to install Rain Loop.</span></p>
<pre class="lang:default decode:true">sudo apt install apache2 php php-curl php-json php-iconv php-xml php-dom php-mysql php-pdo libapache2-mod-php</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-2NRLHlnX4eM/Xw9SVy4C1YI/AAAAAAAAl5g/2rqEdckovI8dUFnMQQGMgOv2TZB9Cs_WACLcBGAsYHQ/s1600/16.png"/></span></p>
<p><span style="color: #000000;">Let’s install Curl, which could help us in our future progress.</span></p>
<pre class="lang:default decode:true">apt install curl</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-r64UqK77ELo/Xw9SeK_ZKGI/AAAAAAAAl5o/iyQrESkHC_QcK0WaM8PN9ulybh7iZPrAQCLcBGAsYHQ/s1600/17.png"/></span></p>
<p><span style="color: #000000;">Now in the <strong>var/www/htm</strong>l folder, simply run the following command-</span></p>
<pre class="lang:default decode:true">curl -s http://repository.rainloop.net/installer.php | sudo php</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-kASjGdUISkE/Xw9SjbM_PaI/AAAAAAAAl5s/e0JeMQp7Z_4Be-mH4Nu4dLZPKSAacIsJgCLcBGAsYHQ/s1600/18.png"/></span></p>
<p><span style="color: #000000;">As we’ve installed the Rain Loop server, let’s not try to create some new users. From the below image you can see that I’ve created two users as:</span></p>
<pre class="lang:default decode:true">adduser geet
adduser aarti</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-fZhppmM2Gm4/Xw9SrMJgTnI/AAAAAAAAl50/fHhXnUHn634K1Dm0zERH1t3kCbzaMJpMgCLcBGAsYHQ/s1600/19.png"/></span></p>
<p><span style="color: #000000;">Now simply surf <strong>localhost/?admin </strong>in your browser and set up the <strong>admin</strong> account there.</span></p>
<pre class="lang:default decode:true">http://localhost/?admin</pre>
<p><span style="color: #000000;">From the below image, you can see that as we surf the above URL, we’re redirected to the default Rain loop’s admin portal.Default credentials for admin:</span></p>
<pre class="lang:default decode:true  ">Username: admin
Password: 12345</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-wIj63bxavuU/Xw9Sx7beuvI/AAAAAAAAl58/Dlh4WJaKivQuP4Hi8fLW3o9Hx9_VkPTTACLcBGAsYHQ/s1600/21.png"/></span></p>
<p><span style="color: #000000;">In the dashboard, select the <strong>Domains</strong> section over in the left-hand panel.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-CipHS8Fyhd0/Xw9S5Q5Y6iI/AAAAAAAAl6A/60fJhaW00NMaCZONC5VTogv55TFqTi65gCLcBGAsYHQ/s1600/22.png"/></span></p>
<p><span style="color: #000000;">Now click on the <strong>Add Domain </strong>option provided.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-eaj27kQUYTs/Xw9TCmmEaKI/AAAAAAAAl6M/pl_OWXs4odIS2rReY04Rdti4PmQj9PCNQCLcBGAsYHQ/s1600/23.png"/></span></p>
<p><span style="color: #000000;">Navigate to the <strong>Domains</strong> menu, hit on <strong>Add Domain</strong>, and enter your <strong>domain name settings</strong> and do the modifications as shown in the below image.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ss5hpuHgDMs/Xw9TIli13SI/AAAAAAAAl6Q/MzzTpW9UMi024jK8k7eiu055fCWHPltEwCLcBGAsYHQ/s1600/24.png"/></span></p>
<p><span style="color: #000000;">Now, we are all set to send the email. Fire up <strong>“ifconfig” </strong>in the terminal to check the <strong>IP address</strong>.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-nc82UV7CtRw/Xw9TPzBuv9I/AAAAAAAAl6U/po7x9DgsyP4XRoyLR9v4NPek42kEEgzggCLcBGAsYHQ/s1600/25.png"/></span></p>
<p><span style="color: #000000;">I’ve now browsed the <strong>ubuntu’s IP</strong> and logged in inside RainLoop as <strong>“geet@mail.ignite.lab : 123”</strong>. As soon as I hit enter, I got landed into the account, where I can send any mail to any user in the domain, as of like the other mail agents.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-mKbs7rko19Y/Xw9TXZ7iqDI/AAAAAAAAl6c/1aHxuJeA4YkpCZ5_0yvcgx03GWgorDueACLcBGAsYHQ/s1600/26.png"/></span></p>
<p><span style="color: #000000;">From the below image, you can observe that the user <strong>geet</strong> is trying to send a mail to the user <strong>aarti </strong>of the same domain.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-e687hTPs_QA/Xw9TcndTttI/AAAAAAAAl6k/TsYuMibYX7skfPUUJ-yCDLd9y42zYU6twCLcBGAsYHQ/s1600/27.png"/></span></p>
<p><span style="color: #000000;">Now, as the user <strong>aarti</strong> logs in into her account to verify whether she had <strong>received</strong> <strong>the</strong> <strong>email</strong> from the user <strong>geet</strong> or not.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Y2Y-C_32x7A/Xw9TiwvDD3I/AAAAAAAAl6s/7c_cNIBGc7Ep_kvpmWGmeaKBlSW4BdDqACLcBGAsYHQ/s1600/28.png"/></span></p>
<p><span style="color: #000000;">Great!! From the below image, you can see that the user <strong>Aarti</strong> has successfully got the mail from the user <strong>Geet.</strong></span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-A7L0yLsz1gk/Xw9Tp8FnupI/AAAAAAAAl6w/W1vASfUTckUfjmAeEQHhfPJt1O8NUXrrwCLcBGAsYHQ/s1600/29.png"/></p>
<p><span style="color: #000000;"><b>Author</b>: <strong>Geet Madan</strong> is a Certified Ethical Hacker, Researcher and Technical Writer at Hacking Articles on Information Security<b>. </b>Contact <a style="color: #000000;" href="https://www.linkedin.com/in/geet-madan/"><b>here</b></a></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
