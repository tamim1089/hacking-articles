<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Thick Client Penetration Testing: Traffic Analysis</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/thick-client-penetration-testing-traffic-analysis/" rel="bookmark"><time class="entry-date published updated" datetime="2021-03-18T14:25:19+00:00">March 18, 2021</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Traffic analysis is one of the crucial parts of any successful penetration test. In this article, we’re going to discuss some of the different techniques that can be used to analyze thick client applications. If a thick client using HTTP traffic then it is pretty straight forward to intercept the traffic.  We can use tools like</span></p>
<p><strong><span style="color: #000000;">To Intercept the HTTP like Traffic: –</span></strong></p>
<ul>
<li><span style="color: #000000;">Burp Suite</span></li>
</ul>
<p><strong><span style="color: #000000;">To Intercept TCP like Traffic: –</span></strong></p>
<ul>
<li><span style="color: #000000;">Wireshark</span></li>
<li><span style="color: #000000;">MITM Relay + Burp Suite</span></li>
<li><span style="color: #000000;">Echo Mirage (Properly Maintained)</span></li>
</ul>
<p><span style="color: #000000;">As we’re pen-testing Damn Vulnerable thick client applications and DVTA is using non-HTTP protocols for example., FTP. It doesn’t make any HTTP connections so we can’t use Burp Suite directly. So, we have another option to monitor the traffic by using a tool like Wireshark but it doesn’t allow you to tamper with the traffic you can only monitor and understand the traffic. But if our goal is to intercept and modify the traffic, we will have to go with a tool called Echo Mirage.</span></p>
<p><span style="color: #000000;">So, without wasting much time let’s begin the Traffic Analysis.</span></p>
<h3><span style="color: #800000;">Table of Content</span></h3>
<ul>
<li><span style="color: #000000;">Prerequisites</span></li>
<li><span style="color: #000000;">What is Traffic Analysis</span></li>
<li><span style="color: #000000;">Traffic Analysis Via Wireshark</span></li>
<li><span style="color: #000000;">Traffic Analysis Via Echo Mirage</span></li>
<li><span style="color: #000000;">Traffic Analysis Via Burp Suite + MITM Relay</span></li>
</ul>
<p><strong><span style="color: #000000;">Traffic Analysis</span></strong></p>
<p><span style="color: #000000;">Any Thick client application communicating with the backend means they are sending some data to its backend components like web server, FTP Server, database server, etc. Analyzing the data during transfer is a very crucial part of the analysis of an application. some applications perform data transit without enforcing any encryption. So, the concept of intercepting traffic of thick clients is not much different than thin clients, the tools will differ depending on the protocols used by the application also these applications are non-proxy aware as well the intercepting techniques also will slightly vary.</span></p>
<p><strong><span style="color: #000000;">Prerequisites</span></strong></p>
<ul>
<li><span style="color: #000000;">Wireshark</span></li>
<li><span style="color: #000000;">Python 3</span></li>
<li><span style="color: #000000;">Burp Suite</span></li>
<li><span style="color: #000000;">Echo Mirage</span></li>
<li><span style="color: #000000;">Python pip script</span></li>
<li><span style="color: #000000;">MITM Relay</span></li>
</ul>
<h3><span style="color: #800000;">Traffic Analysis via Wireshark</span></h3>
<p><span style="color: #000000;">As a penetration tester, you must have good knowledge of how to use a network packet sniffer is essential for day-to-day operations. Whether you are trying to understand a protocol, debug a network client or analyze traffic, you’ll always end up needing a network sniffer.</span></p>
<p><span style="color: #000000;">Examining the traffic between the tested thick client application and the server might reveal sensitive and unencrypted data such as:</span></p>
<ul>
<li><span style="color: #000000;">Most Sensitive data transferred over an unencrypted tunnel such as clear-text credentials/secrets/API Keys etc.</span></li>
<li><span style="color: #000000;">HTTP and HTTPS web endpoints</span></li>
<li><span style="color: #000000;">File blobs/chunks sent over the wire</span></li>
<li><span style="color: #000000;">Proprietary protocols used by the program</span></li>
</ul>
<p><span style="color: #000000;">We are going to analyze FTP traffic that’s generated by DVTA. For this, we are going to use the LoopBack address. So, first of all, Launch Wireshark and choose “Adapter for loopback Traffic Capture”.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-nsCNLxEMnRU/YFNBxrDZWdI/AAAAAAAAuwM/uHxZJ6Bw3ag503IJpNqli4Lm4TyvQriiwCLcBGAsYHQ/s16000/1.png"/></span></p>
<p><span style="color: #000000;">Then after launch modified DVTA application and login to the application by using admin credentials as shown below.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-d7gZuDEJbkw/YFNB3mCjDsI/AAAAAAAAuwQ/XOzI8JWvd4IxAb2h_pCbxebSx-BHzwJegCLcBGAsYHQ/s16000/2.png"/></span></p>
<p><span style="color: #000000;">As you can see, we have successfully logged in and it showing Backup data to FTP server</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-allZ6bSpxZ8/YFNB8DgpkfI/AAAAAAAAuwU/0sFFyx77kPU2SbWgL4xCnpbAKLlPaBR1ACLcBGAsYHQ/s16000/3.png"/></span></p>
<p><span style="color: #000000;">When you click backup data to FTP server it will make an FTP connection with the FTP server and it will try to upload some data to FTP server. After uploading the data, it will show you a Success message as shown below.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-vAO35-j_PkI/YFNCAdsLgUI/AAAAAAAAuwY/ZIaSzYRSQ2gZ2havjpPm39P_JbFCYdFrQCLcBGAsYHQ/s16000/4.png"/></span></p>
<p><span style="color: #000000;">Just after Backup data to the FTP server come back to Wireshark and stop capturing the data so that it won’t capture unnecessary data as shown in the below image. Apply the filter of FTP protocol so that only shows the traffic captured of DVTA application while uploading data to the FTP server.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-6Xt2f4cYWks/YFNCEDO1zDI/AAAAAAAAuwg/75jVdase2tQFdzeNWFRUXCZPheK7lNrWACLcBGAsYHQ/s16000/5.png"/></span></p>
<p><span style="color: #000000;">Now what we are interested in is the credentials that might be used by the DVTA application to login to the FTP server. We can check them by observing the captured FTP traffics. If you notice the first packet is the response from the FileZilla server and then we have a command <strong>“USER and the USER name: DVTA”</strong>. Then after in the third line, there is a response from the FTP server saying the password is Required for DVTA and in the next line, there is a <strong>“Password: p@ssw0rd” </strong>that was sent by the client.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-_Wf6oJbUNco/YFNCIlv7S5I/AAAAAAAAuwk/vcKk_uFdEK01uCCqz_k4eA_PuJ6aSTQpACLcBGAsYHQ/s16000/6.png"/></span></p>
<p><span style="color: #000000;">Now it’s pretty clear that the user name and password are available for us. So, let’s quickly open a browser and surf to <strong><a style="color: #000000;" href="ftp://127.0.0.1">ftp://127.0.0.1</a></strong> and try to use the credentials here that we have captured as shown below.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-TCZSOqLaWAQ/YFNCPbeUBpI/AAAAAAAAuws/ipLVu9mpObUSjpmmZgDK1GpiW-gleoHOwCLcBGAsYHQ/s16000/7.png"/></span></p>
<p><span style="color: #000000;">And here you go…, as you can see, we have successfully connected to the FTP server and we can download everything that is available in that folder as shown below. This is how an attacker grab credentials that are being used by the application in the client site. They can probably do some Wireshark capture and if the credentials are found in clear text, they can easily login to the FTP server and can tamper or download the data easily.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-mZo_d59G3nc/YFNCSyWMNTI/AAAAAAAAuw0/Dc4wytHAzQYF1Q2ibsh9-Yx1rYssVVlGwCLcBGAsYHQ/s16000/8.png"/></span></p>
<h3><span style="color: #800000;">Traffic Analysis via Echo mirage</span></h3>
<p><span style="color: #000000;">Download and Extract Echo Mirage into your desirable folder. You can download Echo Mirage from here: <span style="color: #0000ff;"><strong>https://mega.nz/file/bHhQ3QrA#l4d-lc3bL1tm8AOUcMzlkbN6SaMYFPXNjRr1caD0m1E</strong></span></span></p>
<p><span style="color: #000000;"> Let’s open up the EchoMirage application.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-PbXYN-RpHJo/YFNChjUyzqI/AAAAAAAAuw8/rndsF-JMpvMUjhopwQB_ItT55QafBDGugCLcBGAsYHQ/s16000/9.png"/></span></p>
<p><span style="color: #000000;">and it will open EchoMirage for us</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-MEOAjL4ALmI/YFNCl2Z6T7I/AAAAAAAAuxE/o5oc3WnPb84_FK4EMge_s_PU0jVqJxgawCLcBGAsYHQ/s16000/10.png"/></span></p>
<p><span style="color: #000000;">But also remember one thing don’t forget to delete the FTP CSV file that you have uploaded earlier by using DVTA application so that we can upload a new copy again. Now again open the DVTA application and login into the Application by using admin credentials.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-HelyhMjBFn4/YFNCsOhH0KI/AAAAAAAAuxI/GW37SrYGY4Y2LpuU8ZiVAEigZrPEywSvgCLcBGAsYHQ/s16000/11.png"/></span></p>
<p><span style="color: #000000;">So, we have successfully logged into DVTA application and when we click on <strong><em>“Backup data to FTP server”</em></strong> then we want to be able to see what’s going on using EchoMirage. To do this create a new Rule by going to <strong><em>“Rule &gt; New Rules” </em></strong> choose the direction to “Any” as we want to capture traffic only from the port of 21 so <strong><em>“set the Port to Port no. 21”</em></strong>  then after click on <strong><em>“intercept”</em></strong> and then save the configuration by hitting <strong><em>“ok”</em> </strong>as shown below                                                                                                                <img decoding="async" src="https://1.bp.blogspot.com/-EskOgGxsjNc/YFNC3TwJSvI/AAAAAAAAuxQ/yI8jHErK9YgsSj_aCN-CGMDAC0_AmL4BgCLcBGAsYHQ/s16000/12.png"/>                                                               </span></p>
<p><span style="color: #000000;">Now here we can see the Rules created by us, as we can see we are going to intercept all the traffic that’s going to outbound and inbound also we are going to intercept the traffic of port 21 only.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Dc2oUGwB8d8/YFNDHGJBqtI/AAAAAAAAuxg/752QQULv-FY-eNtjR-7x5l2nBoChqcICwCLcBGAsYHQ/s16000/13.png"/></span></p>
<p><span style="color: #000000;">Now, navigate to Process and click on inject</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-YQVzs6X2u6E/YFNDMfWBfjI/AAAAAAAAuxk/IpUZGzXrg-I2SA81YB8hi-y7kqN5L7oxQCLcBGAsYHQ/s16000/14.png"/></span></p>
<p><span style="color: #000000;">and we are going to see all the process that is running on your machine. But we are interested to see the traffic only from DVTA.exe so select it and inject it into a process</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ZIm51xBjoWs/YFNDQh6Qe7I/AAAAAAAAuxo/ydYCYKqxrqAtVp4t-5eyqtTyNyky1ydpACLcBGAsYHQ/s16000/15.png"/></span></p>
<p><span style="color: #000000;">Navigate to the tab of Traffic.Log then go to the DVTA application and click on Backup Data to FTP Server. Come back to Echo Mirage and here If you see it started capturing traffic from DVTA.exe.</span></p>
<p><span style="color: #000000;">But we’re not interested in this so just hit OK and forward the traffic.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-x9Z-wdEFCbQ/YFNDVRQWQtI/AAAAAAAAuxw/XuSAXk_Scro2RvyP3PtlT5YADkxoG9EDACLcBGAsYHQ/s16000/16.png"/></span></p>
<p><span style="color: #000000;">If you see there is a response coming from files FileZilla server and click ok once again..</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-P1Kngu0LRH4/YFNDb1yuomI/AAAAAAAAux0/zAc47wE0ZMEheK9RREAerE0shcorEdA_QCLcBGAsYHQ/s16000/17.png"/></span></p>
<p><span style="color: #000000;">And if you see here the user name is being sent to the FTP server</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-VtAbhB5dGRY/YFNDgob_QdI/AAAAAAAAux8/5PIfTQ5S8AsSD-zFip_zKd2KHPVBqdWvgCLcBGAsYHQ/s16000/18.png"/></span></p>
<p><span style="color: #000000;">And the response from FTP server says that password required for DVTA. Hit ok and forward the Traffic.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-0RRA5Q5VWFk/YFNDkMF5NSI/AAAAAAAAuyA/jD5ikDYajeUlAU1ocm52EvCpP0uxY0IXgCLcBGAsYHQ/s16000/19.png"/></span></p>
<p><span style="color: #000000;">As you can see the password can bee is seen in clear text <strong><em>“p@ssw0rd”.  </em></strong>The DVTA client is sending its password to the FTP server</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-SLAhVA0xQ1E/YFNDqr8plCI/AAAAAAAAuyE/Q0cLsIOZeUMYfFKwu6X6YF6ixzD15OYlwCLcBGAsYHQ/s16000/20.png"/></span></p>
<p><span style="color: #000000;">And as you can see, you’re logged in now</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-VUCxFOPt418/YFND-I8p-OI/AAAAAAAAuyQ/8ElhT9jxNu8TT_tdJ_P1KiNS6Q40oybLwCLcBGAsYHQ/s16000/21.png"/></span></p>
<p><span style="color: #000000;">If you are still observing the traffic then you should see some file being uploaded onto their FTP server just hit ok and forward the traffic.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-aSl9Hy9h2E8/YFNEE1ipbgI/AAAAAAAAuyU/y4aPFGVkVjcVZIA1iCLl_NkciqSXVE0wACLcBGAsYHQ/s16000/22.png"/></span></p>
<p><span style="color: #000000;">You can see here that ftp-admin.csv is being uploaded here.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-6R3dp8QNh3Y/YFNEMimyTlI/AAAAAAAAuyY/fqAnPhIB0bUYelwPwHCdi6VNbdC7gIF-gCLcBGAsYHQ/s16000/23.png"/></span></p>
<p><span style="color: #000000;">In the last, you can see the response successfully transferred ftp-admin.csv and you can find that file on your desktop</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-TwgNbsovVVw/YFNEWxv4Y7I/AAAAAAAAuyk/4fkrg8SmZK8n16NE_W0fSnUPLLfSWdTSACLcBGAsYHQ/s16000/24.png"/></span></p>
<h3><span style="color: #800000;">Traffic Analysis via Burp Suite + MITM Relay</span></h3>
<p><span style="color: #000000;">First of all, you need to download MITM Relay from GitHub or also you can directly download it from here: – <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/jrmdev/mitm_relay">https://github.com/jrmdev/mitm_relay</a></strong></span></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-i6X0Uy17iac/YFNEhZBZ-yI/AAAAAAAAuys/tNVxIuIEw-sCaF-tFrYXZQPzpCl5yhlVQCLcBGAsYHQ/s16000/25.png"/></span></p>
<p><span style="color: #000000;">Download and Extract in your work folder</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-QlBzpQPdh04/YFNEmRk9_ZI/AAAAAAAAuy0/zrLmWmVhjs4n2zIEeZGVEvNfmLfkWCfgQCLcBGAsYHQ/s16000/26.png"/></span></p>
<p><span style="color: #000000;">MITM Relay is a python script and it works fine with Python 3 so download and installs it by going to the official website of python or you can also download it from here: – </span></p>
<p><strong><span style="color: #0000ff;"><a style="color: #0000ff;" href="https://www.python.org/ftp/python/3.9.2/python-3.9.2-amd64.exe">https://www.python.org/ftp/python/3.9.2/python-3.9.2-amd64.exe</a></span></strong></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-yzTINLjln-Q/YFNEtt_zsbI/AAAAAAAAuy4/0nNCPTqsBZMlwBjoM-38uqlHqHbwl-LiQCLcBGAsYHQ/s16000/27.png"/></p>
<p><span style="color: #000000;">In manner to download repositories from python, <strong><em>“get-pip”</em></strong> needs to be available in your system you can get it from here: – <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://bootstrap.pypa.io/get-pip.py">https://bootstrap.pypa.io/get-pip.py</a></strong></span></span></p>
<p><span style="color: #000000;">All you need to do is save the source code by giving it a <strong><em>right-click</em></strong> and <strong><em>select</em></strong> the option <strong><em>“save as”</em></strong> and save it into your working folder by the name of get-pip as shown below</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-R7FEMeHXyxs/YFNEy5fEi4I/AAAAAAAAuzA/sAoe9arwQMAD1BR8tY4q2Brkt88kWqBGgCLcBGAsYHQ/s16000/28.png"/></span></p>
<p><span style="color: #000000;">Let’s quickly open up the Power Shell and navigate to the directory of python3. It can easily be founded in c drive and then run get-pip.py script from here as shown below</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-iBSv0-SbKuY/YFNE6Ktz8CI/AAAAAAAAuzI/MOILwhH8HKMiLsAbqbw5r6CMKLJgampfQCLcBGAsYHQ/s16000/29.png"/></span></p>
<p><span style="color: #000000;">As you can see pip is successfully downloaded in the above Image now let’s install the Requests module because if you look at MITM Relay it makes use of a module called Requests. To check this all you need to do is go to the directory of MITM Relay and open MITM relay with the option of <strong><em>“Edit with IDLE”</em></strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-PIPl28f2SEk/YFNFB6ocahI/AAAAAAAAuzQ/agFuN3WzLEYm-U5mNsJV4BaK5v5-d4FyQCLcBGAsYHQ/s16000/30.png"/></span></p>
<p><span style="color: #000000;">As you can see here MITM Relay makes use of a module named Requests</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-V37aIpvjZRA/YFNFIXkWlHI/AAAAAAAAuzY/qjbcUduWXIwhFZHU4qrkWND0qp2yHo4MQCLcBGAsYHQ/s16000/31.png"/></span></p>
<p><span style="color: #000000;">And by default, the Requests module is not installed. This can be installed by running this command</span></p>
<pre class="font-size-enable:false lang:default decode:true">python3 -m pip install requests</pre>
<p><span style="color: #000000;">And it will install the requests module for us.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-oa7KN9Wi9l8/YFNFOvLF-bI/AAAAAAAAuzg/p7eVjZC7prUj4vAxmSKsp7g2hQ963cPIwCLcBGAsYHQ/s16000/32.png"/></span></p>
<p><span style="color: #000000;">Let’s install Burp Suite</span></p>
<p><span style="color: #000000;">You can download the Burp Suite community edition from here: – <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://portswigger.net/burp/releases/professional-community-2020-11-3">https://portswigger.net/burp/releases/professional-community-2020-11-3</a></strong></span></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-3XRU-9a_OEw/YFNFWpqkUGI/AAAAAAAAuzo/OoWlayWpei0-H607DkaCHgDHiAdACZqwACLcBGAsYHQ/s16000/34.png"/></span></p>
<p><span style="color: #000000;">The installation is straight forward you don’t need to change anything during the installation process. After downloading the Burp Suite open it</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-qLNu3fkB8rw/YFNFa_bcN6I/AAAAAAAAuzw/a-n58GXz9qsc8BMP7XgehbZCni1rhp5ygCLcBGAsYHQ/s16000/35.png"/></span></p>
<p><span style="color: #000000;">Start the Burp Suite and go to the proxy and select options and if you see it is listening on the <strong><em>“port 8080”</em></strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-lIQ7ym5kgqw/YFNGDVADGOI/AAAAAAAAu0A/nMsyhsGsWEUb-_3hFqR_FtGgPyS2H5H3ACLcBGAsYHQ/s16000/36.png"/></span></p>
<p><span style="color: #000000;">Let’s open up the DVTA.exe application and configure the server to the IP address of the local machine such as 192. 168.0.103.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-CXFXy5516JY/YFNGNXtm8XI/AAAAAAAAu0E/L4uNLvZZmUIbD6nmw4BflTp6_XAiCdzmQCLcBGAsYHQ/s16000/38.png"/></span></p>
<p><span style="color: #000000;">Now open up the FileZilla Server interface and stop the FTP server interface</span></p>
<p><span style="color: #000000;">and then go to <strong><em>“Edit &gt; Settings”</em></strong> and change the value of “Listen on these ports: 2111” because in this scenario our MITM Relay is also running on port no. 21 and FileZilla server is also listening on port no. 21 and it is not possible to run both services on same port so, that’s why we change the port 21 to 2111 here. This happens just because of we are running FileZilla server and MITM relay in same machine in the real-life penetration testing these services are running on different machines so we don’t face these problems there. <strong>There is another setting that you have to change in security settings that is to <em>“Disable IP check”</em></strong>.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-R-C7xU7kEw0/YFNGYDQgaAI/AAAAAAAAu0M/IoBhj_4L2fcG61UGeYdj7HLKu9YCa90RQCLcBGAsYHQ/s16000/39.png"/></span><br/>
<span style="color: #000000;">Then go to <strong><em>“Edit &gt; Settings”</em></strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-HV20nyMKBO0/YFNGf5NeXqI/AAAAAAAAu0U/VugMH-HhBF8EnV00HF3xmxAxoivGWiTRwCLcBGAsYHQ/s16000/40.png"/></span></p>
<p><span style="color: #000000;"> and change the value of “Listen on these ports: 2111” because in this scenario our MITM Relay is also running on port no. 21 and FileZilla server is also listening on port no. 21 and it is not possible to run both services on same port so, that’s why we change the port 21 to 2111 here. This happens just because of we are running FileZilla server and MITM relay in same machine in the real-life penetration testing these services are running on different machines so we don’t face these problems there.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-uPg6I8g-1ZI/YFNGnNmPC4I/AAAAAAAAu0Y/2l-uvzycqzM-BiF3pKW-n8s3hnhnIJREACLcBGAsYHQ/s16000/41.png"/></span></p>
<p><span style="color: #000000;">There is another setting that you have to change in security settings that is to<strong> <em>“Disable IP check”</em></strong>. If you don’t do this the file upload will fail because the source which is originating the file transfer and the address where the data connection is controlled are not going to match that’s why we disabled the IP check.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-JzCUao57imU/YFNG2l29UfI/AAAAAAAAu0s/ANs-XSUj4LAYwCAKUHzK3akZAcPvbwv9ACLcBGAsYHQ/s16000/42.png"/></span></p>
<p><span style="color: #000000;">And at last start the FTP server.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-lrRH3musOP0/YFNHAHCCysI/AAAAAAAAu00/9uPR4rmn1HwpUBiOocsapNHhqFzXfvywACLcBGAsYHQ/s16000/43.png"/></span></p>
<p><span style="color: #000000;">Come back to the Power Shell and start the MITM Relay</span></p>
<p><span style="color: #000000;">All you need to do is go to the directory of MITM Relay and copy the location of MITM Relay and open it into a power shell by just running these commands.</span></p>
<p><span style="color: #000000;">cd (directory of MITM Relay)</span></p>
<pre class="lang:default decode:true">python3.exe .\mitm_relay.py -l 0.0.0.0 -r tcp:21:192.168.0.103:2111 -p http://127.0.0.1:8080</pre>
<p><span style="color: #000000;">where -l is the listening address which is 0.0.0.0 so that we can listen to all the interfaces.</span></p>
<p><span style="color: #000000;">-r stands for the relay. We are setting up relay here using tcp:21 and the destination address is going to be 192.168.0.103 this is the destination address where FTP server is running and the port on which the FTP server on the destination server is running is 2111.</span></p>
<p><span style="color: #000000;">And in last -p stands for the proxy. We set it up to 127.0.0.1:8080 this is the address where the Burp Suite is running.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-9wzh-JHoZRE/YFNHH2MVBBI/AAAAAAAAu08/qxGuefhtYOQDLjHRKcw7T7wt8v_D7q_GwCLcBGAsYHQ/s16000/44.png"/></span></p>
<p><span style="color: #000000;">Let’s come back to the DVTA application and log In to the application using the admin credentials</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-xcfrV66REwc/YFNHMqBb5bI/AAAAAAAAu1A/uYhjWhGWp8ATGI9r_efh0bF-t_uQg4EegCLcBGAsYHQ/s16000/45.png"/></span></p>
<p><span style="color: #000000;">And then come back to Burp Suite and navigate to the tab of <strong><em>“proxy &gt; Intercept”</em></strong> and “<strong><em>Turn on the Intercept”</em></strong> and so that it will start capturing the traffic coming from DVTA.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-QdVLek6iDeE/YFNHQtL4q6I/AAAAAAAAu1I/oXXYgmfaCyE-o105Bt1fQnVzXjIftEi7wCLcBGAsYHQ/s16000/46.png"/></span></p>
<p><span style="color: #000000;">Now, come back to DVTA application and hit <strong><em>“Backup Data to FTP Server”</em></strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-uqm6ACFiySs/YFNHVMiYa2I/AAAAAAAAu1M/QsTo5Ez6Aa8m6dbPVaZL6f3tHC89ro6LgCLcBGAsYHQ/s16000/47.png"/></span></p>
<p><span style="color: #000000;"> Come back to the Burp Suite and look at where it started intercepting the Traffic from DVTA that is a response coming from the FTP server.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-PrmyFT7rqOM/YFNHZWqKYdI/AAAAAAAAu1U/5I6VpL88JBEJeV9ZKB0J4ujQu1MSyAPlACLcBGAsYHQ/s16000/48.png"/></span></p>
<p><span style="color: #000000;">Click forward and look on the next screen there is a user name with the user command being sent from the client. On the first line there you can see the client request and forward this</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-VbMGw0YndWw/YFNHdzEemBI/AAAAAAAAu1c/asM0oMTcXDYGb4-ArSUd2OQ9hAiVBXxiwCLcBGAsYHQ/s16000/49.png"/></span></p>
<p><span style="color: #000000;">Now we’re getting server response which is the password required for the DVTA. On the next screen, the client may send the password to see this just forward the Traffic</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-UeuJOLBdOt0/YFNHh4ZsWTI/AAAAAAAAu1k/kEYteACxr5g65rCEb9455lhxbEaEBoTfwCLcBGAsYHQ/s16000/50.png"/></span></p>
<p><span style="color: #000000;">Look at the bottom using the pass command it sending the password: – P@ssw0rd</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-lF_fuU1ANvA/YFNHypTILNI/AAAAAAAAu10/aYk3Nfx5T7IU1YhssohDe-mcJpruPcdaACLcBGAsYHQ/s16000/51.png"/></span></p>
<p><span style="color: #000000;">Now the next subsequent request will upload the file onto the server so we can see that here on next request the user is logged on forward the traffic</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-xYdJz-Cj7hg/YFNH2qJyZZI/AAAAAAAAu14/t6EJTKzCybwcwDXMGtIX20LcWK91TbzIgCLcBGAsYHQ/s16000/52.png"/></span></p>
<p><span style="color: #000000;">After forwarding some of requests there is a store request which is uploading the <strong><em>“ftp-admin.csv” </em></strong>file. Forward the request to next</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-SuddtvEQlqQ/YFNH7ILDKHI/AAAAAAAAu18/8jyd_LDkjLcIBHaAKH4-qllKnSL4tEAdgCLcBGAsYHQ/s16000/53.png"/></span></p>
<p><span style="color: #000000;">And on the next request there is a response from the server that is opening the data channel for the file upload</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ZxuBqLjZQic/YFNH-5_DJhI/AAAAAAAAu2A/P7Ti5tbjAw8Qbe3b_kzLaOEwZGE_iMlOgCLcBGAsYHQ/s16000/54.png"/></span></p>
<p><span style="color: #000000;">Let’s forward the traffic and it is completed the upload.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-6soeEnTVDxU/YFNICyxhZYI/AAAAAAAAu2E/UTNm66GoocYyutOkAN8-EDUCpDlC1hMRgCLcBGAsYHQ/s16000/55.png"/></span></p>
<p><span style="color: #000000;">This is how we can use MITM Relay to intercept and analyze the TCP traffic using Burp Suite.</span></p>
<p><span style="color: #000000;">This is looking good we have grabbed the FTP username and password that is coming from the client. In the next part, we will perform some attacks on the thick client.</span></p>
<p><span style="color: #000000;"><strong>Author – </strong>Vijay is a Certified Ethical Hacker, Technical writer and Penetration Tester at Hacking Articles. Technology and Gadget freak. Contact <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.linkedin.com/in/vijay-igcbr/">Here</a></strong></span></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
