<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/red-teaming/" rel="category tag">Red Teaming</a></span>            </div>
            <h1 class="post-title entry-title">nps_payload: An Application Whitelisting Bypass Tool</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/nps_payload-an-application-whitelisting-bypass-tool/" rel="bookmark"><time class="entry-date published" datetime="2019-03-08T13:42:52+00:00">March 8, 2019</time><time class="updated" datetime="2025-06-19T21:22:40+00:00">June 19, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="ai-optimize-6 ai-optimize-introduction"><span style="color: #000000;">In this </span>article<span style="color: #000000;">, we will create payloads using a tool named nps_payload and get meterpreter sessions using those payloads. This tool is written by <a style="color: #000000;" href="//github.com/Spoonman1091">Larry Spohn</a> and Ben Mauch. Find this tool on <span style="color: #000080;"><a style="color: #000080;" href="//github.com/trustedsec/nps_payload">GitHub</a>.</span></span></p>
<p class="ai-optimize-7"><span style="color: #000000;"><strong>Attacker:</strong> Kali Linux</span></p>
<p class="ai-optimize-8"><span style="color: #000000;"><strong>Target:</strong> Windows 10</span></p>
<h3 class="ai-optimize-9"><span style="color: #800000;">Table of Content</span></h3>
<ul>
<li class="ai-optimize-10"><span style="color: #000000;"><strong>Downloading and Installing</strong></span></li>
<li class="ai-optimize-11"><span style="color: #000000;"><strong>Getting session using MSBuild</strong></span></li>
<li class="ai-optimize-12"><span style="color: #000000;"><strong>Getting session using MSBuild HTA</strong></span></li>
</ul>
<h3 class="ai-optimize-13"><span style="color: #800000;">Downloading and Installing</span></h3>
<p class="ai-optimize-14"><span style="color: #000000;">First, we will get the tool in </span>our<span style="color: #000000;"> attacker machine. It is Kali Linux in our case. The tool is available at GitHub. We will use </span>the git<span style="color: #000000;"> clone command to download it on our machine.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone //github.com/trustedsec/nps_payload.git</pre>
<p class="ai-optimize-15"><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-5nL2LYPeF3k/XIJt2CniV3I/AAAAAAAAdYo/Kh5xmE4Y0boCzNvfYdR6NVG5p9ADzUE1ACLcBGAs/s1600/1.png"/></span></p>
<p class="ai-optimize-16"><span style="color: #000000;">Now we will traverse inside the folder that we downloaded using git clone, and we can check if we successfully downloaded the file using the ls command. After that, use cd to get inside the nps_payload folder. Some requirements are necessary for the nps_payload to run. Those are mentioned in the requirements text file. Now we can either install each of those requirements individually but that would be time-consuming. We will use the pip install command and then mention the requirements file. It will automatically pick the requirements from the file and install it.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">pip install -r requirements.txt</pre>
<p class="ai-optimize-17"><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-BXMxpE3DXD4/XIJt3pOi9qI/AAAAAAAAdY8/RnHvxz2UqBQEcTHPgoj9I5JdxovpJ0jKgCLcBGAs/s1600/2.png"/></span></p>
<h3 class="ai-optimize-18"><span style="color: #800000;">Getting session using MSBuild</span></h3>
<p class="ai-optimize-19"><span style="color: #000000;">Now that we have successfully downloaded the tool and installed the requirements now it’s time to launch the tool and create some payloads and get some sessions. To launch the tool, we can either use command</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python nps_payload.py</pre>
<p class="ai-optimize-20"><span style="color: #000000;">or we could just</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./nps_payload.py</pre>
<h5 class="ai-optimize-55"><span style="color: #000000;"><strong>Payload Generation and Configuration</strong></span></h5>
<p class="ai-optimize-21"><span style="color: #000000;">After launching the tool, we receive options to choose the technique we need to use. Is it going to be a default msbuild payload or the one in the HTA </span>format?<span style="color: #000000;"> We are going to use both but </span>first<span style="color: #000000;">, we will choose the default msbuild payload. Next, we have to choose the type of payload, is going to be reverse_tcp or reverse_httpor reverse_https or a custom one. We can choose anyone, but here we are choosing the reverse_tcp.</span></p>
<p class="ai-optimize-22"><span style="color: #000000;">Following </span>this<span style="color: #000000;">, we are asked to enter the Local IP Address. This is the IP address of the machine where we want the session to reach. That is the attacker machine. In our </span>case<span style="color: #000000;">, it is Kali Linux. After </span>that<span style="color: #000000;">, we are asked to enter the listener port. The system selects 443 by default. We are not changing it. That’s it, we are now told that the payload is successfully created as </span>a msbuild_nps.xml<span style="color: #000000;"> file. Also, we are told to start a listener.</span></p>
<p class="ai-optimize-23"><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-kTFEmmUB0hQ/XIJt4EQvIXI/AAAAAAAAdZA/KAKU7bLXhi8hXAz_YW4YULpdXhYFHJTtQCLcBGAs/s1600/3.png"/></span></p>
<h5 class="ai-optimize-56"><span style="color: #000000;">Listener Setup and Payload Delivery</span></h5>
<p class="ai-optimize-24"><span style="color: #000000;">We will start the listener before anything else. To do this we have to be inside the nps_payload folder. Now the author has provided us with a script that will create a listener for us. So, we will run it as shown below.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msfconsole -r msbuild_nps.rc</pre>
<p class="ai-optimize-25"><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-fdPSrwSzRBs/XIJt4AUCbWI/AAAAAAAAdZE/YO9yupBH9CoKYbWnQNN7A3u4_GSEtVWcgCLcBGAs/s1600/4.png"/></span></p>
<p class="ai-optimize-26"><span style="color: #000000;">Let’s check the file that we created earlier using the ls command. Now to send the file to the target we will host the directory using the HTTP server as shown below:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python -m SimpleHTTPServer 80</pre>
<p class="ai-optimize-27"><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-zJtYaySrWFA/XIJt4tddE3I/AAAAAAAAdZI/NTwxDjcZIu0MNkUFuiT5hGIG8c-RF2ivACLcBGAs/s1600/5.png"/></span></p>
<p class="ai-optimize-28"><span style="color: #000000;">Now onto the target machine. We browse the IP Address of the attacker machine and we see that we have the file msbuild_nps.xml. Now to use the msbuild to execute this </span>XML<span style="color: #000000;"> file, we will have to shift this payload file inside this path:</span></p>
<p class="ai-optimize-29"><strong><span style="color: #000000;">C:\Windows\Microsoft.NET\Framework\v4.0.30319</span></strong></p>
<p class="ai-optimize-30"><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-lxC4uVaMjBw/XIJt4692sjI/AAAAAAAAdZM/oOBgdTz7Bs8MnIuSOV1yR3kVbGWbWYeCwCLcBGAs/s1600/6.png"/></span></p>
<p class="ai-optimize-31"><span style="color: #000000;">Once we got the nps_payload.xml file inside the depicted path. Now we need a command prompt terminal (cmd) at that particular path. After we have a cmd at this path we will execute the nps_payload command as shown below.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">MSBuild.exe msbuild_nps.xml</pre>
<p class="ai-optimize-32"><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-m_-4vTWz1Q8/XIJt5T8nxNI/AAAAAAAAdZQ/69WKYeJ9uE8vThNvP8W_9_QQHvzncr_sQCLcBGAs/s1600/7.png"/></span></p>
<p class="ai-optimize-33"><span style="color: #000000;">Now back to our attacker machine, here we created a listener earlier. We see that we have a meterpreter session. This concludes out </span>the attack<span style="color: #000000;">.</span></p>
<p class="ai-optimize-34"><span style="color: #000000;"><strong>NOTE:</strong> If we do not open a session, please be patient. It sometimes takes a </span>bit<span style="color: #000000;"> of time to generate a stable session.</span></p>
<p class="ai-optimize-35"><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-zkJWAN5skX8/XIJt5h51S7I/AAAAAAAAdZU/ApQEnUk3UG4ZFK8wBS_0b_iABxNR_RTCACLcBGAs/s1600/8.png"/></span></p>
<h3 class="ai-optimize-36"><span style="color: #800000;">Getting session using MSBuild HTA</span></h3>
<p class="ai-optimize-37"><span style="color: #000000;">Let’s get another session using </span>the HTA<span style="color: #000000;"> file. To do this we will generate an HTA file. First, we will launch the tool using the command below.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./nps_payload.py</pre>
<p class="ai-optimize-38"><span style="color: #000000;">After launching the tool, we are going to choose the HTA payload. Next, we have to choose the type of payload, is going to be reverse_tcp or reverse_httpor reverse_https or a custom one. We can choose anyone, but here we are choosing the reverse_tcp.</span></p>
<p class="ai-optimize-39"><span style="color: #000000;">Following </span>this<span style="color: #000000;">, we are asked to enter the Local IP Address. This is the IP address of the machine where we want the session to reach. That is the attacker machine. In our </span>case<span style="color: #000000;">, it is Kali Linux. After </span>that<span style="color: #000000;">, we are asked to enter the listener port. We select 443 by default. We are not changing it. That’s it, we now receive the information that the payload successfully creates the msbuild_nps.hta file. Also, we receive instructions to start a listener.</span></p>
<p class="ai-optimize-40"><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-IvPGHgXZHiE/XIJt55LDpGI/AAAAAAAAdZY/54-dS-TBbvQb9xi7dxKuRupHsuoWp8mOgCLcBGAs/s1600/9.png"/></span></p>
<h5 class="ai-optimize-53"><span style="color: #000000;"><strong>Setting Up the Listener and Hosting the Payload</strong></span></h5>
<p class="ai-optimize-41"><span style="color: #000000;">We will start the listener as we did earlier.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msfconsole -r msbuild_nps.rc</pre>
<p class="ai-optimize-42"><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-8t0ZXnh2TKI/XIJt2PSCAUI/AAAAAAAAdYs/zGB9igHdRqMRhXm04YUlxcKiRBgt91IbACLcBGAs/s1600/10.png"/></span></p>
<p class="ai-optimize-43"><span style="color: #000000;">Let’s check the file that we created earlier using the ls command. Now to send the file to the target we will host the directory using the HTTP server as shown below:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python -m SimpleHTTPServer 80</pre>
<p class="ai-optimize-44"><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-3TNreN10dSo/XIJt16M6JZI/AAAAAAAAdYk/TXLoL0NwaXsAxp9MAJ2U4ylF7Slc8z4qgCLcBGAs/s1600/11.png"/></span></p>
<h5 class="ai-optimize-54"><span style="color: #000000;">Executing the Payload and Gaining Session</span></h5>
<p class="ai-optimize-45"><span style="color: #000000;">Now onto the target machine. We browse the IP Address of the attacker machine and we see that we have the file msbuild_nps.hta. Right click on it and </span>choose<span style="color: #000000;"> to Save the Link As. This will download the payload.</span></p>
<p class="ai-optimize-46"><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-eSSOe6OmDUQ/XIJt2jsUdNI/AAAAAAAAdYw/ecqQBQA7S0UYVrMiGlh6FARMPVF5Zv9RwCLcBGAs/s1600/12.png"/></span></p>
<p class="ai-optimize-47"><span style="color: #000000;">Once we got the nps_payload.hta file. Now we need a command prompt terminal (cmd) at that path where we saved the payload file. In our case is the Downloads Folder of </span>the current<span style="color: #000000;"> user. After we have a cmd at this path we will execute the nps_payload command as shown below.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">mshta.exe msbuild_nps.hta</pre>
<p class="ai-optimize-48"><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-NJxHEcTNfc0/XIJt2006CXI/AAAAAAAAdY0/D0PtZrynDZECZM6uSQyv3iTMIG81X0fagCLcBGAs/s1600/13.png"/></span></p>
<p class="ai-optimize-49"><span style="color: #000000;">Now back to our attacker machine, here we created a listener earlier. We see that we have a meterpreter session. This concludes </span>the attack<span style="color: #000000;">.</span></p>
<p class="ai-optimize-50"><span style="color: #000000;"><strong>NOTE: If a session is not opened, please be patient. It sometimes takes a bit of time to generate a stable session.</strong></span></p>
<p class="ai-optimize-51"><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-TuGNfV2s3Us/XIJt24GCHvI/AAAAAAAAdY4/HRde0Qmu-vMvkRCLIBTuFZ4rJGOd0CEmQCLcBGAs/s1600/14.png"/></span></p>
<p class="ai-optimize-6"><span style="color: #000000;">To learn more about Red Teaming. Follow this</span> <strong><a href="https://www.hackingarticles.in/category/red-teaming/">link.</a></strong></p>
<p class="ai-optimize-52"><span style="color: #000000;"><strong>Author</strong>: Shubham Sharma is a Cybersecurity enthusiast and Researcher in the field of WebApp Penetration testing. Contact <a style="color: #000000;" href="https://www.linkedin.com/in/shubham-sharma-626964153/"><strong>here</strong></a></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
