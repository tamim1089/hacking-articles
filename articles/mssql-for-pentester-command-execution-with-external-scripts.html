<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/ms-sql-penetration-testing/" rel="category tag">MS-SQL Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">MSSQL for Pentester: Command Execution with External Scripts</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/mssql-for-pentester-command-execution-with-external-scripts/" rel="bookmark"><time class="entry-date published" datetime="2021-09-06T15:32:37+00:00">September 6, 2021</time><time class="updated" datetime="2025-05-10T18:15:40+00:00">May 10, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">This article will learn about SQL servers and how to exploit their external scripts to our potential.</span></p>
<h3><span style="color: #800000;">Table of content</span></h3>
<ul>
<li><span style="color: #000000;">Introduction to SQL Server</span></li>
<li><span style="color: #000000;">Installation of SQL Server</span></li>
<li><span style="color: #000000;">Executing Python Script</span></li>
<li><span style="color: #000000;">Executing R Script</span></li>
</ul>
<h3><span style="color: #800000;">Introduction to SQL Server</span></h3>
<p><span style="color: #000000;">Microsoft has released a lot of versions for SQL servers. Microsoft has released version 2019 of this server more than twenty times. When you look at the different versions, you quickly get a sense of how their goal continues to be moving towards making improvements and innovations to the product every year. This goes on for even the minor changes that include an updated name or logo for each new release. In short, there is something for everyone in each release, and more importantly, that means there is something new for your business or organization that wants to use a particular version of SQL Server.</span></p>
<p><span style="color: #000000;">In the same fashion, this 2019 version of SQL Server adds several improvements and new features to give it a slight edge over its predecessors in providing a higher level of performance. With that in mind, I thought it would be a good idea to bring you up to speed on all the new features in this version and what they can do. The big news with this version is that SQL Server 2019 changes to different areas within the server. In doing so, the following are some of the immediate changes such as MISRA C#/Clojure/Python/Java/etc. with SQL Server.</span></p>
<h3><span style="color: #800000;">Installation of SQL Server</span></h3>
<p><span style="color: #000000;">For this article, we have performed all our practicals on SQL Server 2019. You can download this version of the server from <strong><span style="color: #0000ff;"><a style="color: #0000ff;" href="https://www.microsoft.com/en-in/sql-server/sql-server-downloads">here</a></span></strong>. Once the server is downloaded, let’s install it. For installation of the said server, choose the <strong>Basic</strong> option as shown in the image below:</span></p>
<h4><span style="color: #000000;">Basic SQL Server Installation Steps</span></h4>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-80xqZalJcLM/YTXsBE3G2UI/AAAAAAAAydA/33TQsSeS-I0r-cwQmDJUPzII4kJihN0JQCLcBGAsYHQ/s16000/1.png"/></span></p>
<p><span style="color: #000000;">Now, choose the location for the server, then click on the <strong>Install</strong> button; as shown in the image below:</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-NGMqaXU2VXw/YTXsU5XuzUI/AAAAAAAAydI/c3TwdaFuRW4se9N997fmMNZcQzYuBNd6gCLcBGAsYHQ/s16000/2.png"/></span></p>
<p><span style="color: #000000;">Now from the SQL server Installation Centre, choose the <strong>New SQL Server stand-alone installation or add features to an existing installation</strong> option as shown in the image below:</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-LzOhttsNJsc/YTXslL5DP7I/AAAAAAAAydQ/ctSS8pFZaeMThef-Qh3nXQ9U5dcIlSelQCLcBGAsYHQ/s16000/3.png"/></span></p>
<p><span style="color: #000000;">And then, from the Feature Selection dialogue box, select <strong>Machine Learning Services and Languages</strong> and check the boxes <strong>for R, Python, Java</strong>. These options are offered only in the versions of SQL, which were launched after 2015. The same can be seen in the image below:</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Pqmm1ljUZj0/YTXsxnS5TzI/AAAAAAAAydU/RMi2otK3UbscZQGW_ybgD3ofyMNp0fjRgCLcBGAsYHQ/s16000/4.png"/></span></p>
<p><span style="color: #000000;">Now from Java Install Location, choose the <strong>Install Open JRE 11.0.3 included with this installation</strong> option. And then click on the <strong>Next</strong> button as shown in the image below:</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-9i78dci_glw/YTXtC4BEvhI/AAAAAAAAydg/_VfYOmr9FnohhI7gGmSAC4DdumI-vDuygCLcBGAsYHQ/s16000/5.png"/></span></p>
<p><span style="color: #000000;">And then, for the server configuration, select the <strong>Automatic</strong> option and then press the <strong>Next </strong>button as shown in the image below:</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-CoLd7XNu96w/YTXtOuOXk7I/AAAAAAAAydk/YOTwXBJNSW4TQrIxatmV_xRBZObJr83eACLcBGAsYHQ/s16000/6.png"/></span></p>
<h4><span style="color: #000000;">Finalizing Installation and Configuration</span></h4>
<p><span style="color: #000000;">From the Consent to install Microsoft R open dialogue box, click on the <strong>Accept</strong> button and then click on the <strong>Next</strong> button as shown in the image below:</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-y4ngCAOeBBU/YTXtdjvaKqI/AAAAAAAAyds/9p_kIs5WlPg1gufkyssJD5ti-4NW20SMgCLcBGAsYHQ/s16000/7.png"/></span></p>
<p><span style="color: #000000;">Do the same when the <strong>Consent to install Python</strong> dialogue box opens; as shown in the image below:</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-qDA3PP50XQ0/YTXtnoSw1CI/AAAAAAAAyd0/aFOIFq5CRlkl8fPynZ9Dfxja5IpGWWtowCLcBGAsYHQ/s16000/8.png"/></span></p>
<p><span style="color: #000000;">Once the installation is successful, click on the<strong> Close</strong> button as shown in the image below:</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-KRw4DCOkphI/YTXtwoXcMMI/AAAAAAAAyd8/0MDLF1Cm3AE6soEDPCEryahYO1I2V4ZvQCLcBGAsYHQ/s16000/9.png"/></span></p>
<p><span style="color: #000000;">Following the previous steps has allowed us to install the SQL server 2019 install successfully.</span></p>
<p><span style="color: #000000;">Enable External Scripts</span></p>
<p><span style="color: #000000;">As our SQL server is installed, we will now try to manipulate external scripts to our advantage. But first, we have to check that whether the external scripts are enabled or not. To check the said, we will run the following query:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sp_configure 'external scripts enabled'
GO</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-xMD-zW071tw/YTXt2X8180I/AAAAAAAAyeA/kbPYluNyHIgrU175OZM5ux0hogPS70p3wCLcBGAsYHQ/s16000/10.png"/></span></p>
<p><span style="color: #000000;">The result of the above query, which you can see in the image above, tells us that config_value and run_value are 0, which means that external scripts are not enabled. Hence, we will enable the scripts now. For this, we will execute the following query:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">EXECUTE sp_configure 'external scripts enabled', 1;
GO
RECONFIGURE;
GO</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ScEpoKq8UNw/YTXuCX2ncaI/AAAAAAAAyeI/oLxrjgq0xRsLiQ7as40G1Obngibw_d8MQCLcBGAsYHQ/s16000/11.png"/></span></p>
<p><span style="color: #000000;">As you can see in the image above, the query has been executed successfully. Now, let us confirm if the scripts are enabled or not, and for this, run the following query:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sp_configure 'external scripts enabled'
GO</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-EFlkJkJJlsw/YTXwPuprgyI/AAAAAAAAyes/N3jRNc0NyZ0zLKPhh9XnmsmE5joFAUyCwCLcBGAsYHQ/s16000/12.png"/></span></p>
<p><span style="color: #000000;">As the result of the above query, <strong>Config_value and run_value</strong> have been changed to 1, which means that the externals scripts are enabled now.</span></p>
<h3><span style="color: #800000;">Executing Python Script</span></h3>
<p><span style="color: #000000;">As we have enabled External scripts. We will now execute the Python script. This python script will run the command “ipconfig”. And if successfully executed, it will give us the result for the said command. To execute python script type:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">EXECUTE sp_execute_external_script @language = N'Python', @script = N'print(__import__("os").system("ipconfig"))'</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-mgjL_YBTxno/YTXuvbkHGII/AAAAAAAAyeg/lLmCBmHecvUsnB7yfdAqRRDeDuqz8xwPgCLcBGAsYHQ/s16000/13.png"/></strong></span></p>
<p><span style="color: #000000;">As you can see in the image above, the Python script was executed successfully.</span></p>
<h3><span style="color: #800000;">Executing R Script</span></h3>
<p><span style="color: #000000;">Now we will execute R script. To do so, execute the following commands:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">EXEC sp_execute_external_script
@language=N'R',
@script=N'OutputDataSet &lt;- data.frame(system("cmd.exe /c ipconfig",intern=T))'
WITH RESULT SETS (([cmd_out] text));
GO</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-t-jRaW4-2Fs/YTXuiEk4AmI/AAAAAAAAyeY/QazfJaGrt2cwzR_ZmD0DTMbLRe4Ff0LcgCLcBGAsYHQ/s16000/15.png"/></span></p>
<p><span style="color: #000000;">And as you can see in the image above, the R script has been executed successfully. So, this way, we can use external scripts to our advantage. And use various programming languages to get the desired results.</span></p>
<p><span style="color: #000000;"><strong>Author: </strong>Yashika Dhir is a Cyber Security Researcher, Penetration Tester, Red Teamer, Purple Team enthusiast. Contact her on</span> <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.linkedin.com/in/yashika-dhir/">Linkedin</a> </strong></span><span style="color: #000000;">and </span><span style="color: #0000ff;"><strong>Twitter</strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
