<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Penetration Testing in SMB Protocol using Metasploit (Port 445)</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/penetration-testing-in-smb-protocol-using-metasploit/" rel="bookmark"><time class="entry-date published" datetime="2016-08-14T20:10:19+00:00">August 14, 2016</time><time class="updated" datetime="2025-05-12T21:19:39+00:00">May 12, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p style="text-align: justify;"><span style="color: #000000;">In Hacking, Ports and Protocols play a major role as hacking is not possible without them. And to work with them, let us first understand ports and protocols.</span></p>
<p style="text-align: justify;"><span style="color: #000000;">In information technology, a protocol is the special set of rules that end points in a telecommunication connection use when they communicate. Protocols specify interactions between the communicating entities. So, basically, Network protocols are the language of rules and conventions used for handling communicated between network devices and ensuring the optimal operation of a network. Network protocols include key internet protocols such as IP and IPv6 as well as DNS and FTP, and it also includes more network-specific protocols like SNMP and NTP.</span></p>
<p style="text-align: justify;"><span style="color: #000000;">In the internet protocol suite, a port is an endpoint of communication in an operating system. A port in computer networking is a logical access channel for communication between two devices. Bi-directional communications and more complex connections may use multiple ports (channels) simultaneously. It is always associated with an IP address of a host and the protocol type of the communication, and thus completes the destination or origination address of a communication session.</span></p>
<p style="text-align: justify;"><span style="color: #000000;">A port is identified for each address and protocol by a 16-bit number, commonly known as the port number.</span></p>
<p style="text-align: justify;"><span style="color: #000000;">This understood Ports and Protocols. Now, to work with the SMB protocol, let us understand it.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>SMB</strong>:  Server Message Block, the modern dialect of which was known as Common Internet File System, operates as an application-layer network protocol for file sharing that allows applications on a computer to read and write to files and to request services from server programs in a computer network. The SMB protocol can be used on top of its TCP/IP protocol or other network protocols. Using the SMB protocol, an application (or the user of an application) can access files or other resources at a remote server. This allows applications to read, create, and update files on the remote server. It can also communicate with any server program that is set up to receive an SMB client request.</span></p>
<p style="text-align: justify;"><span style="color: #000000;">Presently, the latest version of SMB is the <strong>SMB 3.1.1 </strong>which was introduced with Windows 10 and Windows Server 2016. This version supports AES 128 GCM encryption in addition to AES 128 CCM encryption added in SMB3 and implements pre-authentication integrity check using SHA-512 hash. SMB 3.1.1 also makes secure negotiation mandatory when connecting to clients using SMB 2.x and higher.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>Working of SMB:</strong> SMB functions as a request-response or client-server protocol. The only time that the protocol does not work in a response-request framework is when a client requests an opportunistic lock (oplock) and the server has to break an existing oplock because the current mode is incompatible with the existing oplock. Client computers using SMB connect to a supporting server using NetBIOS over TCP/IP, IPX/SPX, or NetBEUI. Once the connection is established, the client computer or program can then open, read/write, and access files similar to the file system on a local computer.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>SMB Protocol Security:</strong> The SMB protocol supports two levels of security. The first is the share level. The server is protected at this level and each share has a password. The client computer or user has to enter the password to access data or files saved under the specific share. This is the only security model available in the Core and Core plus SMG protocol definitions. User level protection was later added to the SMB protocol. It is applied to individual files and each share is based on specific user access rights. Once a server authenticates the client, he/she is given a unique identification (UID) that is presented upon access to the server. The SMB protocol has supported individual security since LAN Manager 1.0 was implemented.</span></p>
<p style="text-align: justify;"><span style="color: #000000;">In Metasploit, there are very simple commands to know if the remote host or remote PC support SMB or not.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>SMB 2.0 Protocol Detection</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;">Detect systems that support the SMB 2.0 protocol</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>use auxiliary/scanner/smb/smb2</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf exploit</strong> (<span style="color: #800000;"><strong>smb2</strong></span>)&gt;<strong>set rhosts 192.168.0.104</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf exploit</strong> (<span style="color: #800000;"><strong>smb2</strong></span>)&gt;<strong>set rport 445</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf exploit</strong> (<span style="color: #800000;"><strong>smb2</strong></span>)&gt;<strong>exploit</strong></span></p>
<p style="text-align: justify;"><img decoding="async" src="//2.bp.blogspot.com/-FIFNVTOZK-I/V7DNv-x_ylI/AAAAAAAANGs/Hoy1hvXwfgE21Be84ec7RCVGb5wNr6hhACLcB/s1600/1.png"/></p>
<p style="text-align: justify;"><span style="color: #000000;">Once you hit enter after exploit, you will see the result providing you with all the information about the opened SMB Protocol.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>SMB Version Detection</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;">Display version information about each system</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>use auxiliary/scanner/smb/smb_version</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf exploit</strong> (<span style="color: #800000;"><strong>smb_version</strong></span>)&gt;<strong>set rhosts 192.168.0.104</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf exploit</strong> (<span style="color: #800000;"><strong>smb_version</strong></span>)&gt;<strong>exploit</strong></span></p>
<p style="text-align: justify;"><img decoding="async" src="//1.bp.blogspot.com/-u6BqmKqzFiY/V7DNvtbPdhI/AAAAAAAANGo/CeCxofRwkN80R-sdTEjjOJtnFzvgu5tOgCLcB/s1600/2.png"/></p>
<p style="text-align: justify;"><span style="color: #000000;">After the command has been run, it will inform you about the version of SMB running on our remote PC.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>SMB Share Enumeration</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;">This module determines what shares are provided by the SMB service and which ones are readable/writable. It also collects additional information such as share types, directories, files, timestamps, etc. By default, a netshareenum request is done in order to retrieve share information, but if this fails, you may also fall back to SRVSVC.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>use auxiliary/scanner/smb/smb_enumshares</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf exploit</strong> (<span style="color: #800000;"><strong>smb_enumshares</strong></span>)&gt;<strong>set rhosts 192.168.0.104</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf exploit</strong> (<span style="color: #800000;"><strong>smb_enumshares</strong></span>)&gt;<strong>set smbuser raj</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf exploit</strong> (<span style="color: #800000;"><strong>smb_enumshares</strong></span>)&gt;<strong>set smbpass raj</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf exploit</strong> (<span style="color: #800000;"><strong>smb_enumshares</strong></span>)&gt;<strong>exploit</strong></span></p>
<p style="text-align: justify;"><img decoding="async" src="//4.bp.blogspot.com/-U8uI5gAUW_A/V7DNwcLVUqI/AAAAAAAANGw/yrWy0HUfOyozl6XN_LI0rxLXq0LxnL89wCLcB/s1600/3.png"/></p>
<p style="text-align: justify;"><span style="color: #000000;">And so, after the execution of the command, the result will be displayed. Some of the access is denied most of the systems that are probed. Passing user credentials to the scanner will produce many different results.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>SMB User Enumeration (SAM EnumUsers)</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;">Determine what local users exist via the SAM RPC service</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>use auxiliary/scanner/smb/smb_enumusers</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf exploit</strong> (<span style="color: #800000;"><strong>smb_enumusers</strong></span>)&gt;<strong>set rhosts 192.168.0.104</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf exploit</strong> (<span style="color: #800000;"><strong>smb_enumusers</strong></span>)&gt;<strong>set smbuser raj</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf exploit</strong> (<span style="color: #800000;"><strong>smb_enumusers</strong></span>)&gt;<strong>set smbpass raj</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf exploit</strong> (<span style="color: #800000;"><strong>smb_enumusers</strong></span>)&gt;<strong>exploit</strong></span></p>
<p style="text-align: justify;"><img decoding="async" src="//1.bp.blogspot.com/-F80rWVBo93s/V7DNxRmauDI/AAAAAAAANG0/QIQKfO7uO5I1AcaANHCL4S5jm6caLNJ_ACLcB/s1600/4.png"/></p>
<p style="text-align: justify;"><span style="color: #000000;">As the command executes we can see that it has provided us with the list of users of our remote PC.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>SMB SID User Enumeration (LookupSid)</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;">Determine what users exist via brute force SID lookups. This module can enumerate both local and domain accounts by setting ACTION to either LOCAL and DOMAIN</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong> </strong><strong>use auxiliary/scanner/smb/smb_lookupsid</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf exploit</strong> (<span style="color: #800000;"><strong>smb_lookupsid</strong></span>)&gt;<strong>set rhosts 192.168.0.104</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf exploit</strong> (<span style="color: #800000;"><strong>smb_lookupsid</strong></span>)&gt;<strong>set smbuser raj</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf exploit</strong> (<span style="color: #800000;"><strong>smb_lookupsid</strong></span>)&gt;<strong>set smbpass raj</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf exploit</strong> (<span style="color: #800000;"><strong>smb_lookupsid</strong></span>)&gt;<strong>exploit</strong></span></p>
<p style="text-align: justify;"><img decoding="async" src="//1.bp.blogspot.com/-foAeqBDHc6A/V7DNyiaB0MI/AAAAAAAANG4/n_pnKm7KTJ4laLod1K_YrjRl5QIbVTZuwCLcB/s1600/5.png"/></p>
<p style="text-align: justify;"><span style="color: #000000;">And so, you can find all the users which you never even knew that existed.</span></p>
<p style="text-align: justify;"><span style="color: #000000;">Now that you scan your remote PC’s IP with nmap you will see that these ports were opened through which you gathered all the desired information.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>nmap -sV 192.168.0.104</strong></span></p>
<p style="text-align: justify;"><img decoding="async" src="//1.bp.blogspot.com/-KdQ2A6vlrkQ/V7DNy68YFMI/AAAAAAAANG8/kl-s7vOZetE6GV3E41Rdyur6eGwoB9rrACLcB/s1600/6.png"/></p>
<p style="text-align: justify;"><span style="color: #000000;">And in the result, as above, you can see that Ports 445, 139 were infecting open.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>Conclusion</strong>: Understanding a port and finding such things through a given port helps us to exploit our victim much more accurately as gather the most minute piece of information. Collecting such information about a port and knowing what to do with it give the exploiter certain power of manipulation. Therefore, understanding a port and what it can do and how to find information about it on our remote PC helps us improve our hacking skills as this is the foundation of hacking.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>Author</strong>: <strong>Yashika Dhir</strong> is a passionate Researcher and Technical Writer at Hacking Articles. She is a hacking enthusiast. contact <strong><a href="https://www.linkedin.com/in/yashika-dhir/">here</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
