<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Working of Traceroute using Wireshark</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/working-of-traceroute-using-wireshark/" rel="bookmark"><time class="entry-date published" datetime="2018-06-06T14:08:19+00:00">June 6, 2018</time><time class="updated" datetime="2025-06-05T20:14:30+00:00">June 5, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="ai-optimize-6 ai-optimize-introduction"><span style="color: #000000;">In this Post, we are going to discuss working with traceroute using UDP/ICMP/TCP packets with the help of Wireshark.</span></p>
<p class="ai-optimize-7"><span style="color: #000000;"><strong>Traceroute or Tracert</strong>: It is a CUI based computer network diagnostic tools used in UNIX and Windows-like system respectively. It traces the path of a packet from the source machine to an Internet host such as Google.com by calculating the average time taken each hop. Traceroute sends a UDP packet to the destination by taking benefit of ICMP’s messages. It uses the ICMP error-reporting messages –Destination Unreachable and Time exceeded.</span></p>
<p class="ai-optimize-8"><span style="color: #000000;"><strong>TTL:</strong> The time-to-live value, also known as the hop limit, is a mechanism that limits the lifespan or lifetime of data in a computer or network.</span></p>
<p class="ai-optimize-9"><span style="color: #000000;"><strong>Hop:</strong> A hop is one portion of the path between source and destination. Data packets pass through bridges, routers, and gateways as they travel between source and destination. On the internet, before the data reaches its final destination, it goes through several routers and a hop occurs when an incoming packet is forwarded to the next router.</span></p>
<p class="ai-optimize-10"><span style="color: #000000;"><strong>The asterisk (*):</strong> Denotes probe timeout which means that the router at that hop doesn’t respond to the packet received from the source used for the traceroute due to firewall filter.</span></p>
<h3 class="ai-optimize-11"><span style="color: #800000;">Working of Traceroute</span></h3>
<p class="ai-optimize-12"><span style="color: #000000;"><strong> <img decoding="async" src="https://2.bp.blogspot.com/-bJD787kOoXg/WxfnpFe4tVI/AAAAAAAAXN4/XTCxg0nFEAQOjtEVcvDzL2N-pK-EbQA2wCLcBGAs/s1600/0.png"/></strong></span></p>
<h5 class="ai-optimize-13"><span style="color: #000000;"><strong>Read the steps below:</strong></span></h5>
<ul>
<li class="ai-optimize-14"><span style="color: #000000;">Traceroute sends a UDP packet with a TTL = 1 from the source to destination.</span></li>
<li class="ai-optimize-15"><span style="color: #000000;">When the first router receives the UDP packet it reduces the TTL value by 1 (1-1=0) then drop the packet and sends an ICMP message “Time exceeded” to the source. Thus Traceroute makes a list of the router’s address and the time taken for the round-trip.</span></li>
</ul>
<p class="ai-optimize-16"><span style="color: #000000;">The TTL time exceeded ICMP message is sent after the TTL value of a UDP packet gets zero. In typical condition, a network doesn’t have such a diameter that lead the TTL=0. This could be possible when there is a routing loop. In this case, as the packet is sent back and forth between the looping points, the TTL keeps getting decrement until it becomes zero. And at last, the source receives ICMP error message sent by the router.</span></p>
<ul>
<li class="ai-optimize-17"><span style="color: #000000;">Again source device sends two more packets, in the same way, to get an average value of the round-trip time and again TTL gets zero when it reaches to the 2<sup>nd</sup> router and responds through ICMP error message time exceeds.</span></li>
<li class="ai-optimize-18"><span style="color: #000000;">Traceroute keeps on doing this, and records the IP address and name of every router until the UDP packets reach to the destination address. Once it reaches at the destination address, the Time Exceeded ICMP message is NOT sent back to the source.</span></li>
<li class="ai-optimize-19"><span style="color: #000000;">Since Traceroute uses a random port for sending UDP packets, as a result destination machine will drop the packet and send a new ICMP error message- Destination Unreachable to the source, which indicates the UDP packets have reached the destination address.</span></li>
</ul>
<h3 class="ai-optimize-20"><span style="color: #000000;"><span style="color: #800000;">Tracert with Wireshark</span> </span></h3>
<p class="ai-optimize-21"><span style="color: #000000;"><strong> </strong>As discussed above, tracert is a CLI utility for Windows systems to trace the path of a packet from source to destination. So, herewith the help of the following command, we can observe the path of the packet that travels to reach Google DNS.</span></p>
<p class="ai-optimize-22"><span style="color: #000000;"><strong>Syntax:</strong> tracert [options] Host IP</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">tracert 8.8.8.8</pre>
<p class="ai-optimize-23"><span style="color: #000000;">or</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">tracert -d 8.8.8.8</pre>
<p class="ai-optimize-24"><span style="color: #000000;">Traceroute generates a list of each hop by entering IP of routers that traversed between source and destination and average round-trip time. As a result <strong>hop 22 denotes</strong> entry of destination i.e. Google DNS.</span></p>
<p class="ai-optimize-25"><span style="color: #000000;">In order to notice the activity of traceroute, we have turned on Wireshark in the background.</span></p>
<p class="ai-optimize-26"><span style="color: #000000;"><strong> </strong><strong>Note:</strong> Result of tracert can vary each time for hop count but does not go beyond 30 hops because it is the maximum hop limit. </span></p>
<p class="ai-optimize-27"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-m2ATV0_wy0Q/Wxfno6tYnXI/AAAAAAAAXN0/6XzPMPbkzwcC9Xn1hiU8OH0EZPdGJsqkgCLcBGAs/s1600/1.png"/></span></p>
<h5 class="ai-optimize-28"><span style="color: #000000;"><strong>At Wireshark we notice the following points:</strong></span></h5>
<ul>
<li class="ai-optimize-29"><span style="color: #000000;">ICMP echo request packet is used instead of UDP to send DNS query.</span></li>
<li class="ai-optimize-30"><span style="color: #000000;">The packet first goes from source 192.168.1.101 to first router 192.168.1.1 having ICMP echo request packet with TTL=1</span></li>
<li class="ai-optimize-31"><span style="color: #000000;">The router will drop that packet and send ICMP Time Exceeded error message to the source.</span></li>
<li class="ai-optimize-32"><span style="color: #000000;">All this happens 3 times before the source machine sends next packet by incrementing TTL value by 1 i.e. TTL=2.</span></li>
</ul>
<p class="ai-optimize-33"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-SVXLiqZuBG8/WxfnsKkCsTI/AAAAAAAAXOk/Uq56RmHTZKsZkEy0d-qTQOp_Xc59kGkYgCLcBGAs/s1600/2.png"/></span></p>
<p class="ai-optimize-34"><span style="color: #000000;">Form this image we can observe ICMP echo reply message is sent from 8.8.8.8 (destination) to 192.168.1.101 (source) for TTL 22.</span></p>
<p class="ai-optimize-35"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-thMb-TDWdGE/Wxfnr23vbFI/AAAAAAAAXOg/WLyXUJ0Iulg9xQ4pyMc05zbCmib3i7FmQCLcBGAs/s1600/3.png"/></span></p>
<h3 class="ai-optimize-36"><span style="color: #800000;">Traceroute with Wireshark (via UDP packets)</span></h3>
<p class="ai-optimize-37"><span style="color: #000000;">As discussed above traceroute in utility for Unix -like the system to trace the path of a packet from source to destination. So here with the help of the following command, we can observe the path of packet travels to reach Google DNS.</span></p>
<p class="ai-optimize-38"><span style="color: #000000;"><strong>Syntax:</strong> traceroute [options] Host IP</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">traceroute 8.8.8.8</pre>
<p class="ai-optimize-39"><span style="color: #000000;"><strong> <img decoding="async" src="https://3.bp.blogspot.com/-kCMJh6tybsU/WxfnsGKD1hI/AAAAAAAAXOo/dbynCrnZuF46SyhX4YHORDjfau4ePm7lQCLcBGAs/s1600/4.png"/></strong></span></p>
<p class="ai-optimize-40"><span style="color: #000000;">Traceroute generates a list of each hop by entering IP of routers that comes between source and destination and average round-trip time. As a result <strong>hop 21 denotes</strong> entry of destination i.e. Google DNS.</span></p>
<p class="ai-optimize-41"><span style="color: #000000;">In order to notice the activity of traceroute, we have turned on Wireshark in the background.</span></p>
<p class="ai-optimize-42"><span style="color: #000000;"><strong> </strong><strong>Note:</strong> Result of traceroute can vary each time for hop count but does not go beyond 30 hops because it is maximum hop limit. </span></p>
<h5 class="ai-optimize-43"><span style="color: #000000;"><strong>At Wireshark we notice the following points:</strong></span></h5>
<ul>
<li class="ai-optimize-44"><span style="color: #000000;">UDP packet is used to send DNS query with help of 32-bit payload.</span></li>
<li class="ai-optimize-45"><span style="color: #000000;">The packet first goes from source 192.168.1.101 to first router 192.168.1.1 having ICMP request packet with TTL=1</span></li>
<li class="ai-optimize-46"><span style="color: #000000;">The router will drop that packet and send ICMP Time Exceeded error message to the source.</span></li>
<li class="ai-optimize-47"><span style="color: #000000;">All this happens 3 times before the source sent next packet with increment TTL value by 1 i.e. TTL=2.</span></li>
</ul>
<p class="ai-optimize-48"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-XzrhiAs4iyI/WxfnsjJQ65I/AAAAAAAAXOs/w0tuZZAx5pshUlbjY5WectTQjq-ItGNmgCLcBGAs/s1600/5.png"/></span></p>
<p class="ai-optimize-49"><span style="color: #000000;">In tracert we have seen that each TTL value between source to the first router proceeds 3 times, similarly, same technique is followed by UDP. To demonstrate this we have explored UDP packets 5,6,7 and 8th continuously.</span></p>
<p class="ai-optimize-50"><span style="color: #000000;">In the 5<sup>th</sup> packet, we observe the UDP packet sent by source (192.168.1.102) to destination 8.8.8.8 on port 33435 and count as <strong>Hop #1, attempt #1</strong>.</span></p>
<p class="ai-optimize-51"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-YpHpAJ2E-rA/Wxfns-AuL-I/AAAAAAAAXO0/aYE6bu0uee0lHuq635q2LWwG8sUOvmqIACLcBGAs/s1600/6.png"/></span></p>
<p class="ai-optimize-52"><span style="color: #000000;">In the 6<sup>th</sup> packet, we observe the UDP packet sent by source (192.168.1.102) to destination 8.8.8.8 on port 33436 and count as <strong>Hop #1, attempt #2</strong>.</span></p>
<p class="ai-optimize-53"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-VRJA0kl_BqU/WxfnsxHOGRI/AAAAAAAAXOw/7xSzQIiX1S4WYa4UrpiqEbYgejWEkcrOQCLcBGAs/s1600/7.png"/></span></p>
<p class="ai-optimize-54"><span style="color: #000000;">Similarly, in the 7<sup>th</sup> packet, we observe the UDP packet sent by source (192.168.1.102) to destination 8.8.8.8 on port 33437 and count as <strong>Hop #1, attempt #3</strong>.</span></p>
<p class="ai-optimize-55"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-IG0lLIbJhFk/WxfntUu6Z8I/AAAAAAAAXO4/YL0-zNXi_gMmNwwRt8-IwbYuw-PDt4bKwCLcBGAs/s1600/8.png"/></span></p>
<p class="ai-optimize-56"><span style="color: #000000;">In the 8<sup>th</sup> packet, we observe the UDP packet sent by source (192.168.1.102) to destination 8.8.8.8 on port 33436 and count as <strong>Hop #2, attempt #1</strong> and repeat so on process till reaches the destination.</span></p>
<p class="ai-optimize-57"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-4zstIqNDNwg/Wxfnt2F689I/AAAAAAAAXO8/7y6EAdK1y7w7IcctGrtLhzP70cwBfyEFwCLcBGAs/s1600/9.png"/></span></p>
<p class="ai-optimize-58"><span style="color: #000000;">In packet 79<sup>th</sup> we observe that the last hop captured was hop #10 attempt #3 when the UDP packet sent by source (192.168.1.102) to destination 8.8.8.8 on port 33464 and Time exceeded ICMP message is NOT sent back to the source after this.</span></p>
<p class="ai-optimize-59"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-sh9Vptj3Azs/WxfnowS3dBI/AAAAAAAAXNw/diQZRz9MoUsVPMHgGAj_VEuyejH6w_m6QCLcBGAs/s1600/10.png"/></span></p>
<p class="ai-optimize-60"><span style="color: #000000;">As a result, at last, source received ICMP message Destination Port Unreachable which means our UDP packet reaches on the destination address.</span></p>
<p class="ai-optimize-61"><span style="color: #000000;">At last from given below image we observed the following:</span></p>
<ul>
<li class="ai-optimize-62"><span style="color: #000000;">Source sent DNS query to the router for DNS lookup 8.8.8.8</span></li>
<li class="ai-optimize-63"><span style="color: #000000;">Router sent a response to source as the answer of DNS Name Google-Public-DNS-google.com</span></li>
</ul>
<p class="ai-optimize-64"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-b2FvxCzphqw/Wxfnp-O2w-I/AAAAAAAAXOA/j-V09Rd2KUQsQgGM9WFU3De5BHLcdIN-QCLcBGAs/s1600/11.png"/></span></p>
<h3 class="ai-optimize-65"><span style="color: #800000;">Traceroute with Wireshark (via ICMP packets)</span></h3>
<p class="ai-optimize-66"><span style="color: #000000;">As you know, by default, traceroute uses a UDP packet, but with help of the <strong>-I option,</strong> you can make it work as tracert, which uses an ICMP request packet.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">traceroute -I 8.8.8.8</pre>
<p class="ai-optimize-67"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-tYhRb1ItwYo/WxfnpkslY8I/AAAAAAAAXN8/WIe4vuaEGSwvv0i3rFgcFW0ydUPM9x7DwCLcBGAs/s1600/12.png"/></span></p>
<p class="ai-optimize-68"><span style="color: #000000;">It generates a list of each hop by entering IP of routers that comes between source and destination and average round-trip time. As a result <strong>hop 22 denotes</strong> entry of destination i.e. Google DNS. In order to notice the activity of traceroute, we have turned on Wireshark in the background.</span></p>
<h5 class="ai-optimize-69"><span style="color: #000000;"><strong>At Wireshark we notice the following points:</strong></span></h5>
<p class="ai-optimize-70"><span style="color: #000000;">First ICMP echo request packet will be sent to the first router with TTL 1 and it will send back an ICMP error message time exceed which follow the same technique as explained above in tracert with Wireshark.</span></p>
<p class="ai-optimize-71"><span style="color: #000000;">At last from given below image we observed the following:</span></p>
<ul>
<li class="ai-optimize-72"><span style="color: #000000;">ICMP echo reply message is sent from 8.8.8.8 (destination) to 192.168.1.101 (source) for TTL 22.</span></li>
<li class="ai-optimize-73"><span style="color: #000000;">Source sent DNS query to the router for DNS lookup 8.8.8.8</span></li>
<li class="ai-optimize-74"><span style="color: #000000;">Router sent the response to source as the answer of DNS Name Google-Public-DNS-google.com</span></li>
</ul>
<p class="ai-optimize-75"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-IvD8YmE1IHM/WxfnqK32NsI/AAAAAAAAXOE/TuiGJK90-DEaQUcoFrb6AaQDaye3RaCswCLcBGAs/s1600/13.png"/></span></p>
<h3 class="ai-optimize-76"><span style="color: #800000;">Traceroute with Wireshark (via TCP packets)</span></h3>
<p class="ai-optimize-77"><span style="color: #000000;">As you know by default traceroute use UDP packet with the use of ICMP error message for generating a response but with the help of <strong>-T option</strong>, you can use TCP packet, which uses syn request packet via port 80. It is most useful in diagnosing connection issues to a specific service eg. Web server.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">tcptraceroute - 8.8.8.8
or
traceroute -T 8.8.8.8</pre>
<p class="ai-optimize-78"><span style="color: #000000;">As we know, the maximum hop limit is 30 and but here till the 30<sup>th</sup> hop we didn’t find a desirable output. TCP traceroute follows TCP half communication and waits for the sys-ack packet from the destination till the last hop.  </span></p>
<p class="ai-optimize-79"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-NtvPW0BQA_E/Wxfnqf3V1BI/AAAAAAAAXOI/DnF_HxzWfdkrPWY1_TJVwzR8tunVGJZdQCLcBGAs/s1600/14.png"/></span></p>
<p class="ai-optimize-80"><span style="color: #000000;">In order to notice the activity of tcp traceroute, we have turned on Wireshark in the background where we noticed that it works same as UDP but here the syn packets are used to send the requests to the destination. Tcptraceroute does not measure the time it takes to complete the three-way handshake because that never occurs in such a situation. It only measures the time from the initial SYN to the SYN/ACK.</span></p>
<p class="ai-optimize-81"><span style="color: #000000;">Since Wireshark also didn’t notice any syn-ack packet from destination to source, therefore, Tcptraceroute didn’t edit destination response in its record list this is due to because it is useful while diagnosing web server.</span></p>
<p class="ai-optimize-82"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-L8Bn2sRSCZE/WxfnqRRbtpI/AAAAAAAAXOM/tXkit0HMJ60XfrdxtYfLrfmsnHOFJOE-ACLcBGAs/s1600/15.png"/></span></p>
<p class="ai-optimize-83"><span style="color: #000000;">Therefore, let’s check the path of Google.com and notice the behavior of tcptraceroute. And you compare both results and behaviour of TCP in case of Google DNS server and Google web server.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic"> tcptraceroute google.com</pre>
<p class="ai-optimize-84"><span style="color: #000000;">Here we can clearly observe the response of destination machine through SYN, ACK and a complete entry recorded by traceroute.</span></p>
<p class="ai-optimize-85"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-aOiNaYFVPMg/WxfnqqceH1I/AAAAAAAAXOQ/U94iSIoWjcsEuF2tcbAtnG1Q-FtawD4HACLcBGAs/s1600/16.png"/></span></p>
<p class="ai-optimize-86"><span style="color: #000000;">It is similar to above, the source sent the TCP-SYN packet to the destination machine on port 80 and received an ICMP error message from the router for a time exceeded, and repeated the process till it received ACK_SYN from the destination.</span></p>
<p class="ai-optimize-87"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-6fkM3_yzNWc/WxfnrDnciMI/AAAAAAAAXOU/WKY8M9QL5LoSNQCJhu7_U0ObGJtu02lpgCLcBGAs/s1600/17.png"/></span></p>
<p class="ai-optimize-88"><span style="color: #000000;">Here we can observe ACK-SYN packet from the destination (172.168.161.14) is sent to source (192.1681.103) from port 80 and source again sent RST packet to the destination via port 80.</span></p>
<p class="ai-optimize-89"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-e9u9PMtjB0E/WxfnreEYJlI/AAAAAAAAXOY/_yNUBXyMwr425w2Xig5uB7V3Xp4xwc9zwCLcBGAs/s1600/18.png"/></span></p>
<p class="ai-optimize-90"><span style="color: #000000;">At last from given below image we observed the following:</span></p>
<ul>
<li class="ai-optimize-91"><span style="color: #000000;">Source sent DNS query to the router for DNS lookup 172.161.217.14</span></li>
<li class="ai-optimize-92"><span style="color: #000000;">The router sent the response to the source as the answer of DNS Name del03s10-in-f14.1e100.net</span></li>
</ul>
<p class="ai-optimize-93"><span style="color: #000000;">This entry will get recorded by traceroute in its record list.</span></p>
<p class="ai-optimize-94"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-w5ET61Z6fsY/WxfnrgG2j0I/AAAAAAAAXOc/wk1QqKmlpW8c5i-oK7_Gh8EYJ0d9ALW7gCLcBGAs/s1600/19.png"/></span></p>
<p class="ai-optimize-95"><span style="color: #000000;"><strong>Author: </strong>Aarti Singh is a Researcher and Technical Writer at Hacking Articles, an Information Security Consultant, Social Media Lover, and Gadgets. Contact<strong><a style="color: #000000;" href="https://www.linkedin.com/in/aarti--singh/"> here</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
