<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/persistence/" rel="category tag">Persistence</a></span>            </div>
            <h1 class="post-title entry-title">Windows Persistence: Accessibility Features</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/windows-persistence-accessibility-features/" rel="bookmark"><time class="entry-date published" datetime="2020-05-18T06:03:17+00:00">May 18, 2020</time><time class="updated" datetime="2025-05-12T11:59:39+00:00">May 12, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Today, we are going to shed some light on a very sticky persistence method in Windows systems. In fact, it is so persistent that it has been around for a long time and isn’t going away anytime soon. Specifically, this method, often referred to as Windows Persistence using Accessibility Features, leverages tools like Sticky Keys to maintain access even after system reboots or user logouts. As a result, this classic technique remains a favorite among attackers for its simplicity and effectiveness. With this in mind, let’s dive in.</span></p>
<h3><span style="color: #800000;">Table of Content</span></h3>
<ul>
<li><strong><span style="color: #000000;">Accessibility Features</span></strong></li>
<li><strong><span style="color: #000000;">Configurations Used Practical</span></strong></li>
<li><strong><span style="color: #000000;">Enable RDP</span></strong></li>
<li><strong><span style="color: #000000;">Metasploit: sticky_keys</span></strong></li>
<li><strong><span style="color: #000000;">Empire: debugger</span></strong></li>
<li><strong><span style="color: #000000;">Empire: Enable_rdp</span></strong></li>
<li><strong><span style="color: #000000;">Logon Backdoor</span></strong></li>
<li><strong><span style="color: #000000;">PowerShell: stickeykeys.ps1</span></strong></li>
<li><strong><span style="color: #000000;">Detection</span></strong></li>
<li><strong><span style="color: #000000;">Mitigation</span></strong></li>
<li><strong><span style="color: #000000;">References</span></strong></li>
</ul>
<h3><span style="color: #800000;">Accessibility Features</span></h3>
<p><span style="color: #000000;">Windows Accessibility Features are a set of tools available on the Windows logon screen, such as <strong data-start="188" data-end="203">Sticky Keys</strong>. These tools are designed to be triggered using pre-configured key combinations to assist users. However, these features became widely known when an APT group abused them to backdoor target systems. To exploit this method, you need administrative privileges. This allows you to replace the genuine Windows binary of the tool (<strong data-start="530" data-end="543">sethc.exe</strong>, <strong data-start="545" data-end="561">narrator.exe</strong>, <strong data-start="563" data-end="578">magnify.exe</strong>, etc.) with a <strong data-start="593" data-end="604">cmd.exe</strong>.</span></p>
<p><span style="color: #000000;">Some of the Accessibility features and their trigger options and location are:</span></p>
<p><strong><span style="color: #000000;">Accessibility Shortcut Keys</span></strong></p>
<p><span style="color: #000000;"><strong>Location:</strong> C:\Windows\System32\setc.exe</span></p>
<p><span style="color: #000000;"><strong>Trigger:</strong> Shift 5 times</span></p>
<p><strong><span style="color: #000000;">Utility Manager</span></strong></p>
<p><span style="color: #000000;"><strong>Location:</strong> C:\Windows\System32\Utilman.exe</span></p>
<p><span style="color: #000000;"><strong>Trigger:</strong> Windows key + U</span></p>
<p><strong><span style="color: #000000;">On-Screen Keyboard</span></strong></p>
<p><span style="color: #000000;"><strong>Location:</strong> C:\Windows\System32\osk.exe</span></p>
<p><span style="color: #000000;"><strong>Trigger:</strong> Click on On-screen keyboard button</span></p>
<p><strong><span style="color: #000000;">Magnifier</span></strong></p>
<p><span style="color: #000000;"><strong>Location:</strong> C:\Windows\System32\Magnify.exe</span></p>
<p><span style="color: #000000;"><strong>Trigger:</strong> Windows Key + =</span></p>
<p><strong><span style="color: #000000;">Narrator</span></strong></p>
<p><span style="color: #000000;"><strong>Location:</strong> C:\Windows\System32\Narrator.exe</span></p>
<p><span style="color: #000000;"><strong>Trigger:</strong> Windows Key + Enter</span></p>
<p><strong><span style="color: #000000;">Display Switcher</span></strong></p>
<p><span style="color: #000000;"><strong>Location:</strong> C:\Windows\System32\DisplaySwitch.exe</span></p>
<p><span style="color: #000000;"><strong>Trigger:</strong> Windows Key + P</span></p>
<p><strong><span style="color: #000000;">Manages switching of apps between desktop</span></strong></p>
<p><span style="color: #000000;"><strong>Location:</strong> C:\Windows\System32\AtBroker.exe</span></p>
<p><span style="color: #000000;"><strong>Trigger:</strong> Have osk.exe, Magnify.exe, or Narrator.exe open the locked computer. AtBroker.exe will be executed upon locking and unlocking</span></p>
<p><span style="color: #000000;">The Assistive Features or as Microsoft likes to call them Assistive Technology (ATs). All of these are registered in the registry under the following registry location:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Accessibility\ATs</pre>
<h3><span style="color: #800000;">Configurations Used Practical</span></h3>
<ul>
<li><strong><span style="color: #000000;">Attacker Machine</span></strong>
<ul>
<li><span style="color: #000000;"><strong>OS:</strong> Kali Linux</span></li>
<li><span style="color: #000000;"><strong>IP Address:</strong> 192.168.1.112</span></li>
</ul>
</li>
<li><strong><span style="color: #000000;">Target Machine</span></strong>
<ul>
<li><span style="color: #000000;"><strong>OS:</strong> Windows 10</span></li>
<li><span style="color: #000000;"><strong>IP Address:</strong> 192.168.1.106</span></li>
</ul>
</li>
</ul>
<h3><span style="color: #800000;">Enable RDP</span></h3>
<p><span style="color: #000000;">Let’s start with enabling RDP on the Target Machine. As most of the attacks that we are going to perform will be targeted on the Accessibility Binaries that are accessible on the login screen when we take the RDP of the system. They are accessible on other locations when we have the access of the machine physically but for the remote-based attack, we need the RDP enabled. This can be done using the built-in script in meterpreter. It is based on Carlos Perez’s getgui script which enables the RDP and creates a user account to log in. Here we are just enabling the RDP with the -e parameter.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">run getgui -e</pre>
<p><img fetchpriority="high" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-mzmPneu7QPo/XsIetTb_wGI/AAAAAAAAkGY/YGLYcGZ0fC88CbhLhEbGtLbdsdMZTAzEQCLcBGAsYHQ/s1600/500.png" alt="Windows Persistence using Accessibility Features" width="727" height="200"/></p>
<h3><span style="color: #800000;">Metasploit: sticky_keys</span></h3>
<p><span style="color: #000000;">Metasploit has a post-exploitation module that can create a persistence method to exploit the target by making changes in the Registry. This requires the SYSTEM privilege. So first attack the system. Get a meterpreter session on the target machine then escalate the privileges on the machine and then use this particular post-exploitation module to create a persistence backdoor. Usage of this module is pretty simple. You select the module, set the session if and run the module. It adds makes changes in the registry and then we can exploit the machine by pressing Shift key 5 times and triggering the Sticky Key Accessibility Binary which is now running a Command Prompt with elevated privileges.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use post/windows/manage/sticky_keys
set session 1
exploit</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-pTOHoKHOqJk/XsIetTKqjOI/AAAAAAAAkGc/rb4M9Y8DKkwJiTRMy14ZNhWXhrm_jdWXACLcBGAsYHQ/s1600/501.png"/></p>
<p><span style="color: #000000;">Once the post-exploitation module executes, subsequently, we can use Rdesktop to connect to the target system. At this stage, we can verify that the system is operational. As expected, the login panel greeted us. Afterwards, upon hitting the Shift key, the Command prompt appeared in place of the sticky key prompt. Importantly, the command prompt that we received is the one with Administrative Rights, as shown in the image below.</span></p>
<p><img decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-BOdXbT09enQ/XsIetlXVw7I/AAAAAAAAkGg/U6w2zefobNEOMDpQgk97On2nQcx6tz7nQCLcBGAsYHQ/s1600/502.png" alt="Windows Persistence using Accessibility Features" width="850" height="567"/></p>
<h3><span style="color: #800000;">Empire: debugger</span></h3>
<p><span style="color: #000000;">This module allows the attacker to set the “Image File Execution Options” which is also known as the debugger, Hence the name. It does so for many executables that are accessible before logging in on the RDP connection. If used with the default setting it will trigger a command prompt with SYSTEM privileges through the RDP without logging on the machine. This module can be configured to target a different binary by providing the path to the Binary option in the module. We also need to set a Listener for the module.</span></p>
<p><span style="color: #000000;">Currently, the trigger options that are available in the module are:</span></p>
<ul>
<li><span style="color: #000000;"><strong>persistence/debugger/sethc</strong> – It will target the Sticky Key binary.</span></li>
<li><span style="color: #000000;"><strong>persistence/debugger/utilman</strong> – It will target the Utility Manager binary.</span></li>
<li><span style="color: #000000;"><strong>persistence/debugger/magnify</strong> – It will target the Magnifier binary.</span></li>
<li><span style="color: #000000;"><strong>persistence/debugger/narrator</strong> – It will target the Narrator binary.</span></li>
<li><span style="color: #000000;"><strong>persistence/debugger/osk</strong> – It will target the On-Screen Keyboard binary.</span></li>
</ul>
<p><span style="color: #000000;">We decide to use the module with the default permissions. We can see that the debugger module has sethc.exe set to cmd.exe.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule persistence/misc/debugger
execute</pre>
<h3><img decoding="async" src="https://1.bp.blogspot.com/-qjlEL-3nFb0/XsIeuEV-QsI/AAAAAAAAkGk/Qn3V5YBt8f8bVQtfQdxxbGrp9TNMSshCgCLcBGAsYHQ/s1600/503.png"/></h3>
<h3><span style="color: #800000;">Empire: Enable_rdp</span></h3>
<p><span style="color: #000000;">Now we need to enable the RDP on the target machine so we can access the machine remotely from our attacker machine. We will be using the enable_rdp module of the PowerShell Empire.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule management/enable_rdp
execute</pre>
<p><img decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-XkDA8XmexsQ/XsIeuU_R9nI/AAAAAAAAkGo/GW2DxYmBBekodybObomrjtZrHBGjo2rOwCLcBGAsYHQ/s1600/504.png" alt="Windows Persistence using Accessibility Features" width="630" height="140"/></p>
<p><span style="color: #000000;">After enabling the remote desktop on the target machine, we tried to access it through rdesktop.  After getting the login panel, we again pressed the Shift key 5 times as we need to trigger the sticky key binary. As soon as we trigger the setc.exe we see that we get the command prompt with administrative rights instead.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-QCcKHe6vxaY/XsIeu4NJQSI/AAAAAAAAkGs/ai6peVpdEgkXKYACYCKdCMSJqOE5jpTVACLcBGAsYHQ/s1600/505.png"/></p>
<h3><span style="color: #800000;">Logon Backdoor</span></h3>
<p><span style="color: #000000;">While researching for other tools that attack the Accessibility Features, I found this executable that pretty much sums up the practical that we were doing remotely with Kali Linux. It is a pretty simple executable that can be used if you have the physical access of the target system. It provides a simple menu as shown in the image given below. We select the first option that sets the backdoor and it does its job in a matter of seconds.</span></p>
<p><span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/szymon1118/logon_backdoor">Download Logon Backdoor</a></strong></span></p>
<p><img loading="lazy" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-sc8UB90FwA8/XsIeu4D4jOI/AAAAAAAAkGw/BbQNtaY6wGYRehQzvtX7cDr-tdIaEgKgQCLcBGAsYHQ/s1600/506.png" alt="Windows Persistence using Accessibility Features" width="662" height="328"/></p>
<p><span style="color: #000000;">It indicates that the operation has been completed successfully. Now, let’s give it a try. For this practical demonstration, we locked the system and triggered the sticky key binary by pressing the <strong data-start="289" data-end="298">Shift</strong> key five times. As a result, we now have a command prompt with administrative privileges, as shown in the image below.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-4Yj0f_SkKlY/XsIevWI1moI/AAAAAAAAkG0/R-5uBtJFA5Mo_SBV2oSHrjqQ5BA92TnqQCLcBGAsYHQ/s1600/507.png"/></p>
<h3><span style="color: #800000;">PowerShell: stickykeys.ps1</span></h3>
<p><span style="color: #000000;">Now that we have explored the remote modules from Metasploit and Empire and the executable, its time to discover the PowerShell script for the same. It is a very simple script that can be download from the link given below. To attack the target machine, we need permission to run scripts on the machine. After getting permission we import the PowerShell script. Then simply running the script as shown in the image will add the backdoor.</span></p>
<p><a href="https://github.com/Ignitetechnologies/Persistence-Accessibility-Features">Download stickykeys.ps1</a></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Import-Module .\stickykeys.ps1
.\stickykeys.ps1</pre>
<p><img loading="lazy" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-nOq0nGQRGng/XsIevghUpuI/AAAAAAAAkG4/yDXrAhfyHk0vpsNkyQeU-d4K-RdtYsHpACLcBGAsYHQ/s1600/508.png" alt="Windows Persistence using Accessibility Features" width="600" height="151"/></p>
<p><span style="color: #000000;">Time to test the working. Since we have added the backdoor it must have replaced the sethc.exe with the cmd.exe. To test it we will press the shift key 5 times as we did in our previous practicals and as seen in the image given below we have the cmd with administrative access.</span></p>
<p><img loading="lazy" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-MHkZ5o_nVJU/XsIev-JUk7I/AAAAAAAAkG8/j-6-W030X6Iw-Posa81P6-fhBIIg-KW1wCLcBGAsYHQ/s1600/509.png" alt="Windows Persistence using Accessibility Features" width="768" height="713"/></p>
<p><span style="color: #000000;">This tool can also remove the backdoor and fix the problem but it never solves it as Accessibility features are always there to exploit again.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Import-Module .\stickykeys.ps1</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-chDiNWOxec0/XsIewCgybII/AAAAAAAAkHA/8KfH2-2kxA880I_x0ka1YwYF56icJbCAwCLcBGAsYHQ/s1600/511.png"/></p>
<h3><span style="color: #800000;">Detection</span></h3>
<ul>
<li><span style="color: #000000;">Delete or replace the affected file</span></li>
<li><span style="color: #000000;">exe /scannow</span></li>
<li><span style="color: #000000;">Remove the affected registry entry</span></li>
</ul>
<h3><span style="color: #800000;">Mitigation</span></h3>
<ul>
<li><span style="color: #000000;">Restrict local administrative access</span></li>
<li><span style="color: #000000;">Enable Full Disk Encryption</span></li>
<li><span style="color: #000000;">Network Level Authentication for RDP Connection</span></li>
<li><span style="color: #000000;">Endpoint monitoring</span></li>
<li><span style="color: #000000;">Netflow analysis</span></li>
</ul>
<h3><span style="color: #800000;">References</span></h3>
<p><strong><span style="color: #0000ff;"><a style="color: #0000ff;" href="https://github.com/BC-SECURITY/Empire">PowerShell Empire</a></span></strong></p>
<p><strong><span style="color: #0000ff;"><a style="color: #0000ff;" href="https://twitter.com/oddvarmoe">Oddvar Moe</a></span></strong></p>
<p><span style="color: #000000;">To learn more about Windows Persistence. Follow this <strong><a href="https://www.hackingarticles.in/tag/windows-persistence/">Link.</a></strong></span></p>
<p><span style="color: #000000;"><strong>Author: Pavandeep Singh</strong> is a Technical Writer, Researcher, and Penetration Tester. Can be Contacted on <strong>Twitter</strong> and</span> <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.linkedin.com/in/pavan2318/">LinkedIn</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
