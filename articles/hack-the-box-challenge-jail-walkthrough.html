<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/ctf-challenges/" rel="category tag">CTF Challenges</a>, <a href="https://www.hackingarticles.in/category/ctf-challenges/hackthebox/" rel="category tag">HackTheBox</a></span>            </div>
            <h1 class="post-title entry-title">Hack the Box Challenge: Jail Walkthrough</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/hack-the-box-challenge-jail-walkthrough/" rel="bookmark"><time class="entry-date published" datetime="2018-07-03T10:00:34+00:00">July 3, 2018</time><time class="updated" datetime="2025-07-05T17:30:24+00:00">July 5, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Hello friends!! Today we are going to solve another CTF challenge “Jail” which is available online for those who want to increase their skill in penetration testing and black box testing. <strong>Hack the Box</strong> presents Jail, a retired vulnerable lab, for making online penetration practices according to your experience level; they have the collection of vulnerable labs as challenges from beginners to expert level.</span></p>
<p><span style="color: #000000;"><strong>Level:</strong> Expert</span></p>
<h5><strong><span style="color: #000000;">Task: find user.txt and root.txt file on victim’s machine.</span></strong></h5>
<p><span style="color: #000000;">Since these labs are online available therefore they have static IP and IP of sense is <strong>10.10.10.34.</strong> So let’s begin with nmap port enumeration.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nmap -sV –p- 10.10.10.34 --open</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-I8CKCCNaIjM/WztBwkQGBbI/AAAAAAAAX0k/TI1IT6HBtbMtQuHFmM9spCZHsI4nOi_KgCEwYBhgL/s1600/1.png"/></span></p>
<p><span style="color: #000000;">From given below image, you can observe we found port 22 and 80 are open on target system.</span></p>
<p><span style="color: #000000;">As port 80 is running http server we open the target machine’s ip address in our browser, and find an ascii art of prison cell on the webpage.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-iobZjoiFvxw/WztByl1HjDI/AAAAAAAAX0M/1pRrvTvaxd8Jv5Q_NssKWEjONk1xrNzQgCEwYBhgL/s1600/2.png"/></span></p>
<p><span style="color: #000000;">We run dirbuster on port 80, which reveals a directory entitled jailuser/, with a folder called dev/ inside the directory.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-sW1vWCZyLJQ/WztB0sQaJQI/AAAAAAAAX0c/AC678FvcLzAxRD9JZan2cPo8pDe91OQ9QCEwYBhgL/s1600/3.png"/></span></p>
<p><span style="color: #000000;">Inside the folder we see three files; a binary file, a c-program, and a bash script.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-bwp5cKDHt7k/WztB2aR7VfI/AAAAAAAAX0Y/Idv6M2PqJ8Uhf6x2xC56Pcmcd9_fTX7AwCEwYBhgL/s1600/4.png"/></span></p>
<p><span style="color: #000000;">We open the c-program and find that it is a program for some kind of authentication. We also find that it uses strcpy function for the variable password.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-sNMu2jvAmpk/WztB2tIxirI/AAAAAAAAX0g/LDdnhhH7GHoztVMf1INMsedJBTFCd22NQCEwYBhgL/s1600/5.png"/></span></p>
<p><span style="color: #000000;">Then, download the rest of the files, in the bash script there are just a few commands for a service called jail and by checking the jail binary we find that it is an ELF file.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-RzZjmG__wPU/WztB21JkRXI/AAAAAAAAX0g/pfMbEj3BkCMUkb9FV7u5bv8MqiQXRrobQCEwYBhgL/s1600/6.png"/></span></p>
<p><span style="color: #000000;">Now we give the binary executable permissions and run the binary.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-c0D07AlgPms/WztB23vrMUI/AAAAAAAAX0Y/9G1XLNL1bpQV_wrTEL0e1Pqpv4CrvRPQgCEwYBhgL/s1600/7.png"/></span></p>
<p><span style="color: #000000;">We check netstat and find that it opens up a port 7411. We check the nmap scan and find that port 7411 is open in the target machine.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-mU-yeKKFbBE/WztB3AjcJ2I/AAAAAAAAX0c/or-crZPk7XYk0gj9VaVE9CtQII0HCaBCACEwYBhgL/s1600/8.png"/></span></p>
<p><span style="color: #000000;">Now we open the binary in gdb to look at the assembly code. The binary works by forking itself to each server call, so in the event of a crash the primary process will still run.  We use the command below in gdb to make the process debug in forked process.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">gdb -q jail
(gdb)  set follow-fork-mode child
(gdb) set detach-on-fork off
(gdb) run</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://2.bp.blogspot.com/-E-8SZOtcaYE/WztB3fEzOQI/AAAAAAAAX0k/wa-YYCkSWmYtXV3uW5e04yg8QABhZ4kBQCEwYBhgL/s1600/9.png"/></strong></span></p>
<p><span style="color: #000000;">First we create a 50 bytes long string to find the EIP offset using patter_create script.</span></p>
<h5><span style="color: #000000;">./pattern_create –l 50</span></h5>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-hc7PLGKWSYk/WztBwiNqF_I/AAAAAAAAX0Q/_ulZeqHyAygFGRwXuA1VuILzBks1h8HPACEwYBhgL/s1600/10.png"/></span></p>
<p><span style="color: #000000;">Now we connect to the binary running on our system using netcat. We check the c program we found earlier to find the functions we need to use.</span></p>
<p><span style="color: #000000;">We know from the c-program that there is a strcpy function that copies the content of a variable called password to a variable called username. Now we use the pattern we created earlier and send it as password variable. We use the DEBUG function of the binary to get the address of the stack pointer.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nc localhost 7411
USER admin
DEBUG
PASS {pattern}</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-3RY3LUFw6Fk/WztBwtBNlBI/AAAAAAAAX0U/J10ylYpZzMUsFYZ1BZ-leumNfnUGbTjogCEwYBhgL/s1600/11.png"/></span></p>
<p><span style="color: #000000;">As soon as we pass the string we get a segmentation fault and find that the EIP register was overwritten with 0x62413961.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-n8z-sBZ8KDg/WztBxKBWLfI/AAAAAAAAX0M/MCSzS2KY9UI06rPRPAXZ4LMbDyOvfQ5twCEwYBhgL/s1600/12.png"/></span></p>
<p><span style="color: #000000;">We pass that into /usr/share/metasploit-framework/tools/pattern_offset.rb, we get an offset of28. So we need to write 28 characters and then write the address of the instructions we want to be executed.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">./pattern_offset.rb  -q 62413961 -l 50</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-fNK6NYAZEM0/WztBxRblCGI/AAAAAAAAX0Q/v87DFsFawkwFsnfq-DlghAHcYOwsAZA-ACEwYBhgL/s1600/13.png"/></span></p>
<p> </p>
<p><span style="color: #000000;">The off-set is 28 now we can proceed to create our python exploit using the available data to gain a shell. You can download the exploit used in the machine from <a style="color: #000000;" href="https://github.com/Sayantan5/jail_exploit.git">here</a>. After running the exploit we get a shell as user “nobody”.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-7rt9S2x0mNg/WztBxrs1u6I/AAAAAAAAX0M/CtLuAXmcmLEXkW-REzeCGqSz9k6uyJlewCEwYBhgL/s1600/14.png"/></span></p>
<p><span style="color: #000000;">Now for privilege escalation, we know that the machine is running NFS share we try to exploit it. We first find the shared folders of the target machine.</span></p>
<h5><span style="color: #000000;">showmount -e 10.10.10.34</span></h5>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-yYHjxAYgEEM/WztBxkfDi6I/AAAAAAAAX0c/myOSuC6QsogSxUgESmpjAT5zsvt2U_8RwCEwYBhgL/s1600/15.png"/></span></p>
<p><span style="color: #000000;">After finding the shared folders we mount them locally. After mounting the shared folder we find that only root user has read, write and execute permissions but a user with GID 1000 can write and execute files inside the folder.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/--spM4YOf-S8/WztBxyfkPQI/AAAAAAAAX0Y/fELDcZSsYN8xpUyqaJ4GaN7-Ld9Myo-7gCEwYBhgL/s1600/16.png"/></span></p>
<p><span style="color: #000000;">So we create a user with GID 1000, so that we can upload our shell to exploit this weak permission vulnerability.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-b-L2386aQt4/WztByPz_mFI/AAAAAAAAX0k/b3SwbrQ6vXMrKihqj6GvqZvIqqk0RXDSACEwYBhgL/s1600/18.png"/></span></p>
<p><span style="color: #000000;">We login as user frank and create a c-program inside the shared folder that can set the real and effective user id to be 1000 of the calling the process.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/--8xKeA6Zsbw/WztByaOCd1I/AAAAAAAAX0Q/O4MwDfu5NrMZWG_RBBvrhWbhk3BAZoy1ACEwYBhgL/s1600/19.png"/></span></p>
<p><span style="color: #000000;">Then we compile the program set the suid bit, so that we can spawn a shell with EUID 1000.</span></p>
<h5><span style="color: #000000;">vi shell.c</span></h5>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-aPYE60Jf4zU/WztByiB0w_I/AAAAAAAAX0g/yKt6Ra2INMoBTrkoOo927chsOy4S_GqrwCEwYBhgL/s1600/20.png"/></span></p>
<p><span style="color: #000000;">Now we go back to our reverse shell and run the binary that we just created. As soon as we run binary we spawn a shell as user “frank”.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-bN_R1Bvxfo0/WztBylnS_YI/AAAAAAAAX0Y/tFFi9t3EF0Q4cR-lEnSyJy0Vucr48gaxACEwYBhgL/s1600/21.png"/></span></p>
<p><span style="color: #000000;">We spawn a TTY shell and take a look at the sudoers list. We find that we can open jail.c file in /var/www/html/jailuser with rvim as user adm with no password.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python -c "import pty;pty.spawn(‘/bin/bash’)"
sudo -l</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-j4Dylvi2igQ/WztBzCAWgQI/AAAAAAAAX0U/WpiiZ9tooAYtnt23OgTdKlcvYqSvhkjPwCEwYBhgL/s1600/22.png"/></span></p>
<p><span style="color: #000000;">Before running the command we find in the sudoers list, first we go to /home/frank directory and find a file called “user.txt”. We take a look at the content of the file and find our first flag.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-kCZJeuIAcXo/WztBzK8eqlI/AAAAAAAAX0g/hQl3NkZRN0soDIUhautmdrWfrh0c-AZrwCEwYBhgL/s1600/23.png"/></span></p>
<p><span style="color: #000000;">Now we run the 2<sup>nd</sup> command we find in the sudoers list. Now we use rvim to spawn a shell, as rvim is running as user adm when we spawn a shell we will get a shell as user adm.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-LCBiq6KdStM/WztBzL7WTRI/AAAAAAAAX0k/_9DKq1Lf_M8ojOHJYKKQoGrrrl7wSLMHQCEwYBhgL/s1600/24.png"/></span></p>
<p><span style="color: #000000;">Inside adm’s home directory we find a hidden folder called “.keys”. We go inside the directory and find one rar file called “keys.rar”, and one text file called “note.txt”.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-_futGRnYfYQ/WztBztneu3I/AAAAAAAAX0c/ufvzTpoDOYM3kN0uqxeD2fehUem0_Xy1wCEwYBhgL/s1600/25.png"/></span></p>
<p><span style="color: #000000;">We take a look at the content of note.txt file and find a hint for a password that states that the password would be user Frank’s last name followed by 4 digits and a symbol.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-hkk95T615do/WztBz0YkC9I/AAAAAAAAX0U/Kews_aWtTYwErYtgm38r4hEzW4CkA9x8QCEwYBhgL/s1600/26.png"/></span></p>
<p><span style="color: #000000;">Now when we try to look for hidden directories, we find another folder called “.local”, we go inside that directory and find a hidden file called “.frank”.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-JYVsxpa12f4/WztB0BsjrBI/AAAAAAAAX0k/VOxuKONhIIgPAWR5EXtpYs1Z1yLwDVYCQCEwYBhgL/s1600/27.png"/></span></p>
<p><span style="color: #000000;">We open the file and find it that the content of the file is encrypted.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-0-hfhmUCA7E/WztB0NoHbJI/AAAAAAAAX0k/kEImSjKbmeY69_54fqXNYqTnQsR_mAcgwCEwYBhgL/s1600/28.png"/></span></p>
<p><span style="color: #000000;">We use the site https://quipqiup.com and find the decrypted text; it was related to someone escaping Alcatraz.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Wuy2d8u__wY/WztB0fx6OmI/AAAAAAAAX0c/bJFCZyryq-E0-22WGA1tgatclvY1vcIFgCEwYBhgL/s1600/29.png"/></span></p>
<p><span style="color: #000000;">Now we want to send keys.rar file from the target machine to our system. We first convert the content of keys.rar to base64 enoding, so that there are no bad characters.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Me-wYwMBKWE/WztB0jqtoOI/AAAAAAAAX0M/J2RHNLbGp-YG6HHz-eKEjObbGJPTPyGaACEwYBhgL/s1600/30.png"/></span></p>
<p><span style="color: #000000;">Now we recreate the file by decoding the string in our local system.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-PHlNGgbdR1s/WztB1AfklOI/AAAAAAAAX0c/vMWmeq_HUUonavPYFc8gmhtNR222j3LnACEwYBhgL/s1600/31.png"/></span></p>
<p><span style="color: #000000;">When we try to extract the rar file we are asked for a password.</span></p>
<h5><span style="color: #000000;">unrar x keys.rar</span></h5>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-TmzrWvus9UI/WztB1IKGU8I/AAAAAAAAX0Y/UhzafKRRk0sDToYz0wmUEvsISJM4iTNaACEwYBhgL/s1600/32.png"/></span></p>
<p><span style="color: #000000;">Now from the earlier hint we try to google search “frank Alcatraz” and discover that a guy called Frank Miller escaped Alcatraz prison in 1962.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-WicpNnhoAYM/WztB1Kp8NsI/AAAAAAAAX0Y/8Axq0a0dPPsZR3f95my_DRAMJSuNAImAQCEwYBhgL/s1600/33.png"/></span></p>
<p><span style="color: #000000;">We know that the administrator sent a message to Frank stating that his password is his last name followed by 4 digits and 1 symbol. Then, we use crunch to create a dictionary with this information. We assume the number is 1962 since Frank Miller escaped that year and it fits the 4 digit number in his password.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">crunch 11 11 -o jail-wlist -f /usr/share/crunch/charset.lst symbols-all -t Morris1962@</pre>
<p><span style="color: #000000;">After creating a wordlist, we use rar2john utility to convert keys.rar into a format suitable for use with john the ripper.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">rar2john keys.rar &gt; jail</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-Yd7XpKXqOdc/WztB1WGwYJI/AAAAAAAAX0Y/i5Zh4LhUdXkKAc64z8-5eliVlfRqU9CvgCEwYBhgL/s1600/34.png"/></span></p>
<p><span style="color: #000000;">We find the password to “Morris1962!”. Then we ran john the ripper to find the password for the rar file using the word list we created using crunch.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-doW2YkLR2w4/WztB1ufXIZI/AAAAAAAAX0c/a04J8Fq-M9QeaFiLv462E_CN9sXwsMRgwCEwYBhgL/s1600/35.png"/></span></p>
<p><span style="color: #000000;">Now we extract the file using the password we find earlier and find a public key.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-ce_AzYprbxc/WztB14HUybI/AAAAAAAAX0Y/FpbbQ4NqgP8LTIbcIvEuzAT93ookdtIEACEwYBhgL/s1600/37.png"/></span></p>
<p><span style="color: #000000;">We use rsactftool to convert the public key into private key so that we can use this to login through ssh. After getting the private key; we change the permission of the private key to read write for owner only. You can download the RsaCtfTool <a style="color: #000000;" href="https://github.com/Ganapati/RsaCtfTool">here</a>.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python RsaCtfTool.py --publickey /root/rootauthorizedsshkey.pub –private &gt; /root/id_rsa</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-UHD451uVgiM/WztB2OYv8vI/AAAAAAAAX0Y/pC3re9z5uuErw-0ggltv0K6DTDq_9SKRQCEwYBhgL/s1600/38.png"/></span></p>
<p><span style="color: #000000;">We use the ssh private key to login into the target machine. Once we connected through ssh we were login as root user we check the content for home directory of root and find a file called “root.txt”. We check inside the file and find our second and final flag.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ssh -i id_rsa 10.10.10.34</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-Y4p2m1mhG-M/WztB2UH_UCI/AAAAAAAAX0Q/l4rO5-gnu0I0VslsleY1ByCbXpR9SNMGQCEwYBhgL/s1600/39.png"/></span></p>
<p><span style="color: #000000;">Thank you for giving your precious time to read this walkthrough. If you want to read more HTB Write-ups. Follow this</span> <strong><a href="https://www.hackingarticles.in/category/ctf-challenges/hackthebox/">Link.</a></strong> <span style="color: #000000;">Happy Hacking!</span></p>
<p><span style="color: #000000;"><strong>Author</strong>: Sayantan Bera is a technical writer at hacking articles and cyber security enthusiast. Contact <a style="color: #000000;" href="https://www.linkedin.com/in/sayantan-bera-2098a613b/"><strong>Here</strong></a></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
