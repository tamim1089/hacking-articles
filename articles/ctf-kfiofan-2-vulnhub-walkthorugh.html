<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/ctf-challenges/" rel="category tag">CTF Challenges</a>, <a href="https://www.hackingarticles.in/category/ctf-challenges/vulnhub/" rel="category tag">VulnHub</a></span>            </div>
            <h1 class="post-title entry-title">CTF KFIOFan: 2 Vulnhub Walkthorugh</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/ctf-kfiofan-2-vulnhub-walkthorugh/" rel="bookmark"><time class="entry-date published" datetime="2019-08-23T14:11:59+00:00">August 23, 2019</time><time class="updated" datetime="2025-06-10T20:11:17+00:00">June 10, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Today we are going to take on a new challenge KFIOFan2. The credit for making this VM machine goes to “Khaos Farbauti Ibn Oblivion” and it is a boot2root challenge where we have to root the server to complete the challenge. You can download this VM <a style="color: #000000;" href="https://www.vulnhub.com/entry/ctf-kfiofan-2,325/">here</a></span></p>
<p><span style="color: #000000;"><strong>Security Level</strong>: Beginner</span></p>
<h3><span style="color: #800000;"><strong>Penetrating Methodology:</strong></span></h3>
<p><span style="color: #000000;"><strong>Scanning</strong></span></p>
<ul>
<li><span style="color: #000000;">Netdiscover</span></li>
<li><span style="color: #000000;">Nmap</span></li>
</ul>
<p><span style="color: #000000;"><strong>Enumeration</strong></span></p>
<ul>
<li><span style="color: #000000;">Enumerating ftp services</span></li>
</ul>
<p><span style="color: #000000;"><strong>Exploitation</strong></span></p>
<ul>
<li><span style="color: #000000;">Uploading php shell to get ssh key</span></li>
</ul>
<p><span style="color: #000000;"><strong>Privilege Escalation</strong></span></p>
<ul>
<li><span style="color: #000000;">Buffer Overflow to get sudo rights</span></li>
</ul>
<h3><span style="color: #800000;"><strong>Walkthrough</strong>:</span></h3>
<h3><span style="color: #800000;"><strong>Scanning:</strong></span></h3>
<p><span style="color: #000000;">First thing first, scan the vulnerable machine using nmap.</span></p>
<pre class="lang:default decode:true">nmap -p- -A 192.168.1.33</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-JjeRsOaWoXs/XV-3nvCapFI/AAAAAAAAgMY/B3K9REFTlRIGL5Ev_qEOCAME7v4oyEErQCLcBGAs/s1600/1.png"/></p>
<p><span style="color: #000000;">Here we found that the only port open is port 26921</span></p>
<p><span style="color: #000000;">Let’s take a look at what the ftp service has to offer. The ssh banner gave us a message</span></p>
<p><span style="color: #000000;">“Salut Alice ! Suite a l’attaque sur notre precedent serveur, j’en prepare un nouveau qui sera bien plus securise ! C’est en travaux pour l’instant donc s’il te plait ne touche a rien pour l’instant… Bob”</span></p>
<p><span style="color: #000000;">Which translates to</span></p>
<p><span style="color: #000000;">“Hi Alice! Following the attack on our previous server, I prepare a new one that will be much more secure! It is under construction for now so please do not touch anything for now … Bob”</span></p>
<p><span style="color: #000000;">We found anonymous login here.  After logging in, we found 4 images and a directory named `serrure`. We downloaded the images and checked the directory but found nothing in the directory</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-ICgRN78b3Mw/XV-3uIzaWTI/AAAAAAAAgNE/0pSPSAADhxkA-xb5d19cyCDcUFIr9ZxDwCLcBGAs/s1600/2.png"/></p>
<p><span style="color: #000000;">After getting not much information but only 4 images, we tried to decipher the hint behind this so we tried to find any kind of stegnographical content. So we tried to get some kind of information from the images by another method. We combined the images together and found that the catch was very simple. In the centre of the combined image, we found a name of a file named as “<strong>cle.txt</strong>”.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-EkbMAAOgElQ/XV-3xh95PbI/AAAAAAAAgNg/xiNp3T6K1UQKhSdwF88SOp1mP3qZen3XgCLcBGAs/s1600/4.png"/></p>
<p><span style="color: #000000;">We tried to find this file but did not find it anywhere. So we tried to do a little bit different step. We created a file with dummy content and put it into the target system through ftp</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-27J3IAz7ClY/XV-3xol0-kI/AAAAAAAAgNk/-a-0H7SKfhITq5kc5Ev98TUh0MCpo9pMgCLcBGAs/s1600/5.png"/></p>
<p><span style="color: #000000;">After putting the file in the <strong>serrure</strong> directory, we tried to scan the target system again. Looks like the <strong>cle.txt</strong> file worked as a key to unlock another port 26980 running http service</span></p>
<pre class="lang:default decode:true">nmap -p- -A 192.168.1.33</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-AUN5LmYNUdY/XV-3ximlmRI/AAAAAAAAgNo/czxgvJbmSzU4LzrHTXXHNh3GDqVc8Iz-wCLcBGAs/s1600/6.png"/></p>
<p><span style="color: #000000;">Now that we have found one other port, we tried to enumerate the website  but the welcome message looked something like this</span></p>
<p><span style="color: #000000;">“<strong>Tout ce qui est, est père du mensonge et fils du néant</strong>”</span></p>
<p><span style="color: #000000;">Which translates into</span></p>
<p><span style="color: #000000;">“<strong>All that is, is father of lies and sons of nothingness</strong>”</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-WPoEKgfJ4P4/XV-3yY2CvtI/AAAAAAAAgNs/okTuxK97neoz4x155x3gQpfdhuS-DlNewCLcBGAs/s1600/7.png"/></p>
<p><span style="color: #000000;">While analysing the page source of the webpage, we found a comment something like this</span></p>
<p><span style="color: #000000;">“<strong>&lt;!– Test présence fichier cle.txt : OK –&gt;</strong>”</span></p>
<p><span style="color: #000000;">“<strong>&lt;!– Test contenu fichier cle.txt  : Erreur –&gt;</strong>”</span></p>
<p><span style="color: #000000;">Which translates into</span></p>
<p><span style="color: #000000;">“<strong>&lt;! – Test presence cle.txt file: OK -&gt;</strong>”</span></p>
<p><span style="color: #000000;">“<strong>&lt;! – Test content cle.txt file: Error -&gt;</strong>”</span></p>
<p><span style="color: #000000;">Indicating that the content of cle.txt file needs to be changed</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-ay9dvgcEqC4/XV-3yj-sTPI/AAAAAAAAgNw/qc1zPgyNMV8NMh3hpOi9fJgnqgnkcDLqACLcBGAs/s1600/8.png"/></p>
<p><span style="color: #000000;">Alongside this we tried to get more details about the target machine and found a directory named uploads, but with none content</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-BoqlcVDO84c/XV-3y4Uy4aI/AAAAAAAAgN0/1A5HxzyjhAcXrW0RYkuLdR6zalnrN9DtgCLcBGAs/s1600/9.png"/></p>
<p><span style="color: #000000;">Now to put the correct content in the cle.txt file, we tried to look for a meaning for the hint. After some research, we found an article written by the author of this lab. In this article we found that the hint is the description of the author’s nickname i.e. <strong>Khaos Farbauti Ibn Oblivion.</strong></span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-TInFM4xRQwc/XV-3nr9rGlI/AAAAAAAAgMQ/zNYFbZlkp9EaKTa_AOJhUQVo9x4tF8TeQCLcBGAs/s1600/10.png"/></p>
<p><span style="color: #000000;">We used this name as the content of the <strong>cle.txt </strong> and replace this file in the <strong>serrure</strong> directory through ftp</span></p>
<pre class="lang:default decode:true">echo "Khaos Farbuti Ibn Oblivion" &gt; cle.txt
ftp 192.168.1.33 26921
cd serure
delete cle.txt
put cle.txt</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-DazwuKjBbRE/XV-3noIikoI/AAAAAAAAgMU/aIACLT4VTEUpGjpkcjA-hxDT_dy-1dZLACLcBGAs/s1600/11.png"/></p>
<p><span style="color: #000000;">Now let’s check the webpage again. This time we found a file upload module in place, looks like the content of cle.txt file was being used to change the functioning of the webpage. Now all we need to do is upload a shell, first, we tried to upload a txt file and the was uploaded easily</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-Y6os1AGMHR8/XV-3octNg4I/AAAAAAAAgMc/tmvSId-0k6YZ4vGC-qSjDQ5KbFkJ4mLwgCLcBGAs/s1600/12.png"/></p>
<p><span style="color: #000000;">Next, we tried uploading a php shell but was blocked</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-z1YdCwrx9Lw/XV-3pRAp_UI/AAAAAAAAgMg/JNYBvzYwrgwUO-Ehww9d8Mu0-2YDFcY-QCLcBGAs/s1600/13.png"/></p>
<p><span style="color: #000000;">To bypass the security we tried to upload a .php5 shell and succeded</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-tFj9KG4tAu0/XV-3p0fuKqI/AAAAAAAAgMk/GAFTVvOd3kwLObS38eT0tvVs_3F66q-gQCLcBGAs/s1600/14.png"/></p>
<p><span style="color: #000000;">Now to verify that our shell is uploaded, we tried to check the uploads directory and found that our file is there</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-aDJanm2fVVI/XV-3p9mkDcI/AAAAAAAAgMo/80zA2eaE4DQO9Jp_O9EIrkI2N19c9VVRACLcBGAs/s1600/15.png"/></p>
<p><span style="color: #000000;">Now we tried to execute the shell but failed, after some attempts we thought that there might be a .htaccess  which might be blocking us from executing a php application. So to override that we needed to overwrite the previous one, we tried to create a blank .htaccess file and tried to upload that.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-OoSC9veLGLk/XV-3qIYDpzI/AAAAAAAAgMs/eQrAkbm6B2cNqSo83h8hAeuwUaG9dREOgCLcBGAs/s1600/16.png"/></p>
<p><span style="color: #000000;">As we were able to upload the .htaccess file we tried to use the uploaded shell to run system commands and were able to do that.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-T9DrFiFwLKE/XV-3qhJoLVI/AAAAAAAAgMw/EM421Dx2vGIn7G2mjKfL72gSabF1stzrwCLcBGAs/s1600/17.png"/></p>
<p><span style="color: #000000;">After some searching, we found an ssh key</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-Qbs5kjM0ujk/XV-3q7xUSMI/AAAAAAAAgM0/mGEz1As0GrkDubOZA1e9Hx7QJ9IJ7tjKACLcBGAs/s1600/18.png"/></p>
<p><span style="color: #000000;">Now, all we need to find is an ssh port to connect. We did nmap scan again and this time we found an ssh port on 26922</span></p>
<pre class="lang:default decode:true">nmap -p- -A 192.168.1.33</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-T-0Pg3aj7N0/XV-3rGc8PFI/AAAAAAAAgM4/7f6-gnkCV6ozHOqNl9FYrsan4wEuz0nVwCLcBGAs/s1600/19.png"/></p>
<p><span style="color: #000000;">Now we have an ssh port and an ssh key, let’s try to combine them together and get an ssh connection. We saved the ssh key into a file named <strong>id_rsa, </strong>provided it 0600 permission and tried to use that key for connection. Once getting the connection we tried to find all the files with suid permissions and found that there is a file named test</span></p>
<pre class="lang:default decode:true">chmod 0600 id_rsa
ssh bob@192.168.1.33 -p 26922 -i id_rsa
find / -perm –u=s –type f 2&gt;/dev/null</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-KiKGPDAvqTE/XV-3uLp5b8I/AAAAAAAAgM8/mVCSY1sTC-w7I8cb5tTjiHEs_EeEje9UQCLcBGAs/s1600/20.png"/></p>
<p><span style="color: #000000;">When we tried to execute the file, it asked us for password and we don’t have any. We tried to check the strings in the file using the strings command and found some interesting things.</span></p>
<p><span style="color: #000000;">strings test</span></p>
<p><span style="color: #000000;">First, we found that there is a system function in use, meaning there is a system command being executed.</span></p>
<p><span style="color: #000000;">Second, we found a system command “<strong>touch /root/authorize_bob</strong>” indicating that this is the system command that we want to be executed</span></p>
<p><span style="color: #000000;">Third, we found a string “<strong>aliceestnulle</strong>” right below the password prompt “<strong>Mot de passe</strong>”</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-j8p-DjnuGy0/XV-3uOOCzlI/AAAAAAAAgNA/A6pgN3X5NuATVLpBZwluQq4OHj5aKcjWACLcBGAs/s1600/21.png"/></p>
<p><span style="color: #000000;">We tried to run the file again with the password that we found and got a message</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-WVXWvqubGwM/XV-3u4q8VTI/AAAAAAAAgNI/irYPjVf6zckrsnyDL04B8_oYDlOVw4jZQCLcBGAs/s1600/22.png"/></p>
<p><span style="color: #000000;">As we were not able to get anything even after entering the correct password, we tried to get details from gdb</span></p>
<pre class="lang:default decode:true">gdb test
set disassembly-flavor intel
disassemble main
start</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-200B9ZnznDk/XV-3u5kJz8I/AAAAAAAAgNM/c1bCTqtD2ZscnxiqNXmPvMeMNJjZ6063ACLcBGAs/s1600/23.png"/></p>
<p><span style="color: #000000;">We started the execution of the program using the start command when the program asked for a password, we tried to discover buffer overflow vulnerability. We created an input string of length 50 using pattern_create.rb file from Metasploit-framework. ­</span></p>
<pre class="lang:default decode:true">cd /usr/share/metasploitable-framework/tools/exploit
./pattern_create.rb -l  50</pre>
<p><span style="color: #000000;">After putting the input we found that after certain length our input is put into an executable stack</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-UsWtdrEM8R8/XV-3vhjHswI/AAAAAAAAgNY/r4Mu9DqbKBk_9vpQcfgMPUxTiMCx969rACLcBGAs/s1600/24.png"/></p>
<p><span style="color: #000000;">Before going on multiple types of buffer overflow exploitation, we went to our previous findings just to check whether we have some other hints to follow, fortunately, we found that when we found the touch command in the strings command output, right above that there was a string having content as</span></p>
<p><span style="color: #000000;"><strong>lancement debug</strong></span></p>
<p><span style="color: #000000;">when we translated this it resulted in</span></p>
<p><span style="color: #000000;"><strong>launch debug</strong></span></p>
<p><span style="color: #000000;">when we tried to check the debug function, we found that there is a system function being executed inside the debug function.</span></p>
<pre class="lang:default decode:true">disassemble debug</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-ea1zU3xh9lo/XV-3vuKX0DI/AAAAAAAAgNQ/3qfoSUi8R64vfjF-49nQR-c5KIdbPkyDwCLcBGAs/s1600/25.png"/></p>
<p><span style="color: #000000;">Next, we are left with the attempt to execute the debug function, so with took the length of the string which resulted in a buffer overflow, and replaced the characters which were stored in the executable stack with the address of the debug function.</span></p>
<pre class="lang:default decode:true  ">python -c 'print ("Aa0Aa1Aa2Aa3Aa4Aa5Aa6"+"\x20\x48\x55\x55\x55\x55")' | ./test</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-6IAb39rN8ik/XV-3vss9E-I/AAAAAAAAgNU/QBSd9mtZfCgO75uhl1coposWwdbtdihgQCLcBGAs/s1600/26.png"/></p>
<p><span style="color: #000000;">After running the same input for multiple attempts, we logged out of the ssh session and reconnected and tried sudo command and it worked.</span></p>
<pre class="lang:default decode:true ">ssh bob@192.168.1.33 -p 26922 -i id_rsa
sudo su</pre>
<p>Let’s capture the flag and get finished with the CTF</p>
<pre class="lang:default decode:true ">cd /root
cat flag.txt</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-QFEmt9Y47iw/XV-3wrvgGrI/AAAAAAAAgNc/NLzlWBBcICoUXfphMpfVyuuqpbz9NHE3ACLcBGAs/s1600/27.png"/></p>
<p><span style="color: #000000;"><strong>Author:</strong>Deepanshu is a Certified Ethical Hacker, Security Researcher, Pentester and Trainer at Ignite Technologies. Contact <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.linkedin.com/in/deepanshu-k-a4248b138/">here</a></strong></span></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
