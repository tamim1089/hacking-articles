<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/privilege-escalation/" rel="category tag">Privilege Escalation</a></span>            </div>
            <h1 class="post-title entry-title">Multiple Ways to Bypass UAC using Metasploit</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/multiple-ways-to-bypass-uac-using-metasploit/" rel="bookmark"><time class="entry-date published" datetime="2018-09-16T04:55:55+00:00">September 16, 2018</time><time class="updated" datetime="2025-05-12T21:17:41+00:00">May 12, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">In this Post, we are shedding light on <strong>User Account Control</strong> shortly known as UAC. We will also look at how it can potentially protect you from malicious software and ignoring UAC prompt can trouble your system.</span></p>
<h3><span style="color: #800000;"><strong>Table of Content</strong></span></h3>
<p><span style="color: #000000;"><strong>Introduction to UAC</strong></span></p>
<ul>
<li><span style="color: #000000;">What is UAC?</span></li>
<li><span style="color: #000000;">Working of UAC</span></li>
</ul>
<p><strong><span style="color: #000000;">Techniques </span></strong></p>
<ol>
<li><span style="color: #000000;">Windows Escalate UAC Protection Bypass</span></li>
<li><span style="color: #000000;">Windows Escalate UAC Protection Bypass (In Memory Injection)</span></li>
<li><span style="color: #000000;">Windows UAC Protection Bypass (Via FodHelper Registry Key)</span></li>
<li><span style="color: #000000;">Windows Escalate UAC Protection Bypass (Via Eventvwr Registry Key)</span></li>
<li><span style="color: #000000;">Windows Escalate UAC Protection Bypass (Via COM Handler Hijack)</span></li>
</ol>
<h3><span style="color: #800000;"><strong>Introduction to User Account Control </strong></span></h3>
<p><span style="color: #000000;"><strong>What is User Account Control?</strong></span></p>
<p><span style="color: #000000;">A well-structured User Account Control introduced with Microsoft’s Windows Vista and Windows Server 2008 operating systems to prevent unwanted system-wide changes in a way that is foreseen and requires a minimal effort.</span></p>
<p><span style="color: #000000;">In other words, it is a security feature of Windows which supports I preventing unauthorized modifications to the operating system UAC makes sure that the certain changes are made only with authorization from the administrator. If the changes are not permitted by the administrator, they are not executed, and Windows remains unchanged.</span></p>
<p><span style="color: #000000;"><strong>How does UAC work?</strong></span></p>
<p><span style="color: #000000;">UAC works by preventing a program from carrying out any tasks which involve system changes/specific tasks. The operations which will not work unless the process attempting to carry them out is running with administrator rights. If you run a program as administrator, it will have more privileges since it would be “elevated”, compared to the programs running which are not running as administrator.</span></p>
<p><span style="color: #000000;">Some things which cannot be done without administrator rights:</span></p>
<ul>
<li><span style="color: #000000;">Registry modifications (if the registry key is under e.g. HKEY_LOCAL_MACHINE (since it affects more than one user) it will be read-only)</span></li>
<li><span style="color: #000000;">Loading a device driver</span></li>
<li><span style="color: #000000;">DLL injection</span></li>
<li><span style="color: #000000;">Modifying system time (clock)</span></li>
<li><span style="color: #000000;">Modifying User Account Control settings (via Registry, it can be enabled/disabled but you need the correct privileges to do this)</span></li>
<li><span style="color: #000000;">Modify protected directories (e.g. Windows folder, Program Files)</span></li>
<li><span style="color: #000000;">Scheduled tasks (e.g. to auto-start with administrator privileges)</span></li>
</ul>
<p><span style="color: #000000;">UAC won’t just automatically block malicious software, the purpose wasn’t to determine if a program is malicious or not. It’s down to the user just as much. If a program is going to be executed with administrator privileges, the user will be alerted and will need to provide confirmation. </span></p>
<p><span style="color: #3366ff;">//malwaretips.com/threads/why-uac-is-important-and-how-it-can-protect-you.47157/</span></p>
<h3><span style="color: #800000;">Techniques </span></h3>
<p><span style="color: #000000;">Firstly exploit the target machine to obtain the meterpreter. Once you get the meterpreter session 1 then type the following command to check system authority and privileges.</span></p>
<pre class="lang:default decode:true">getsystem
getuid</pre>
<p><span style="color: #000000;">If you don’t have system/admin authorities and privileges. Then you should go for bypass UAC Protection of the targeted system.</span></p>
<h3><span style="color: #000000;"><strong>Windows Escalate UAC Protection Bypass</strong></span></h3>
<p><span style="color: #000000;">This module will bypass Windows UAC by utilizing the trusted publisher certificate through process injection. It will spawn a second shell that has the UAC flag turned off.</span></p>
<pre class="lang:default decode:true ">msf &gt; use exploit/windows/local/bypassuac
msf exploit windows/local/bypassuac) &gt; set session 1
msf exploit(windows/local/bypassuac) &gt; exploit</pre>
<p><span style="color: #000000;">From the given image you can observe that <strong>meterpreter</strong> <strong>session 2</strong> opened, now type the following command to determine the system authority privileges.</span></p>
<pre class="lang:default decode:true">getsystem
getuid</pre>
<p><span style="color: #000000;"><strong>Great!! </strong>Here we got NT AUTHORITY\SYSTEM Privilege, now if you will type “<strong>shell</strong>” command, you will get access of command prompt with administrator privilege.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-MLj6M5z9x50/W53gwey6pSI/AAAAAAAAaPU/W9QdjuMLjK4xkp-t9OT-QruLs9KQOjVPACLcBGAs/s1600/1.png"/></span></p>
<h3><span style="color: #800000;"><strong><span style="color: #000000;">Windows Escalate UAC Protection Bypass (In Memory Injection)</span></strong></span></h3>
<p><span style="color: #000000;">This module will bypass Windows UAC by utilizing the trusted publisher certificate through process injection. It will spawn a second shell that has the UAC flag turned off. This module uses the Reflective DLL Injection technique to drop only the DLL payload binary instead of three separate binaries in the standard technique. However, it requires the correct architecture to be selected, (use x64 for SYSWOW64 systems also). If specifying EXE::Custom your DLL should call ExitProcess() after starting your payload in a separate process.</span></p>
<pre class="lang:default decode:true">msf &gt; use exploit/windows/local/bypassuac_injection
msf exploit(windows/local/bypassuac_injection) &gt; set session 1
msf exploit(windows/local/bypassuac_injection) &gt; exploit</pre>
<p><span style="color: #000000;">From the given image you can observe that <strong>meterpreter</strong> <strong>session 2</strong> opened, now type the following command to determine the system authority privileges.</span></p>
<pre class="lang:default decode:true">getsystem
getuid</pre>
<p><span style="color: #000000;">Ultimately you will get NT AUTHORITY\SYSTEM Privilege, now if you will run “<strong>shell</strong>” command, you will get access of command prompt with administrator privilege.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//3.bp.blogspot.com/-wtjO0vwANDs/W53gwu8_-bI/AAAAAAAAaPY/b0SmuIsr6HAU_O6hSArtTi_BEO3YQojPQCLcBGAs/s1600/3.png"/></span></p>
<h3><span style="color: #800000;"><strong><span style="color: #000000;">Windows UAC Protection Bypass (Via FodHelper Registry Key)</span></strong></span></h3>
<p><span style="color: #000000;">This module will bypass Windows 10 UAC by hijacking a special key in the Registry under the current user hive and inserting a custom command that will get invoked when the Windows fodhelper.exe application is launched. It will spawn a second shell that has the UAC flag turned off. This module modifies a registry key but cleans up the key once the payload has been invoked. The module does not require the architecture of the payload to match the OS. If specifying EXE::Custom your DLL should call ExitProcess() after starting your payload in a separate process.</span></p>
<pre class="lang:default decode:true">msf &gt; use exploit/windows/local/bypassuac_fodhelper
msf exploit(windows/local/bypassuac_fodhelper) &gt; set session 1
msf exploit(windows/local/bypassuac_fodhelper) &gt; exploit</pre>
<p><span style="color: #000000;">From the given image you can observe that <strong>meterpreter</strong> <strong>session 2</strong> opened, now type the following command to determine the system authority privileges.</span></p>
<pre class="lang:default decode:true">getsystem
getuid</pre>
<p><span style="color: #000000;"><strong>Great!! </strong>Here we got NT AUTHORITY\SYSTEM Privilege, now if you will type “<strong>shell</strong>” command,  you will get access of command prompt with administrator privilege.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//2.bp.blogspot.com/-iH5Inc5GTg4/W53gw36Bo3I/AAAAAAAAaPc/PQpLFtETqMUEZrF-efd7TS6LMW9VGiDXwCEwYBhgL/s1600/4.png"/></span></p>
<h3><span style="color: #800000;"><strong>Windows Escalate UAC Protection Bypass (Via Eventvwr Registry Key)</strong></span></h3>
<p><span style="color: #000000;">This module will bypass Windows UAC by hijacking a special key in the Registry under the current user hive, and inserting a custom command that will get invoked when the Windows Event Viewer is launched. It will spawn a second shell that has the UAC flag turned off. This module modifies a registry key, but cleans up the key once the payload has been invoked. The module does not require the architecture of the payload to match the OS. If specifying EXE::Custom your DLL should call ExitProcess() after starting your payload in a separate process.</span></p>
<pre class="lang:default decode:true">msf &gt; use exploit/windows/local/bypassuac_eventvwr
msf exploit(windows/local/bypassuac_eventvwr) &gt; set session 1
msf exploit(windows/local/bypassuac_eventvwr) &gt; exploit</pre>
<p><span style="color: #000000;">From given image you can observe that <strong>meterpreter</strong> <strong>session 2</strong> opened, now type the following command to determine the system authority privileges.</span></p>
<pre class="lang:default decode:true">getsystem
getuid</pre>
<p><span style="color: #000000;">And again you will get NT AUTHORITY\SYSTEM Privilege.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//1.bp.blogspot.com/-enb14J_C8LA/W53gxPsr1DI/AAAAAAAAaPg/g2EUJutqTmM7MOYKK5gZDk-qXSWb9HMewCEwYBhgL/s1600/5.png"/></span></p>
<h3><span style="color: #800000;"><strong>Windows Escalate UAC Protection Bypass (Via COM Handler Hijack)</strong></span></h3>
<p><span style="color: #000000;">This module will bypass Windows UAC by creating COM handler registry entries in the HKCU hive. When certain high integrity processes are loaded, these registry entries are referenced resulting in the process loading user-controlled DLLs. These DLLs contain the payloads that result in elevated sessions. Registry key modifications are cleaned up after payload invocation. This module requires the architecture of the payload to match the OS, but the current low-privilege Meterpreter session architecture can be different. If specifying EXE::Custom your DLL should call ExitProcess() after starting your payload in a separate process. This module invokes the target binary via cmd.exe on the target. Therefore if cmd.exe access is restricted, this module will not run correctly.</span></p>
<pre class="lang:default decode:true">msf &gt; use exploit/windows/local/bypassuac_comhijack
msf exploit(windows/local/bypassuac_comhijack) &gt; set session 1
msf exploit(windows/local/bypassuac_comhijack) &gt; exploit</pre>
<p><span style="color: #000000;">From the given image you can observe that <strong>meterpreter</strong> <strong>session 2</strong> opened, now type the following command to determine the system authority privileges.</span></p>
<pre class="lang:default decode:true">getsystem
getuid</pre>
<p><span style="color: #000000;">Finally, you will get NT AUTHORITY\SYSTEM Privilege, now if you will again run “<strong>shell</strong>” command then you will get access of command prompt with administrator privilege and this way we can help of Metasploit post exploit to bypass UAC protection.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="//4.bp.blogspot.com/-E9UGfeePMbA/W53gxgN00NI/AAAAAAAAaPk/tsVTjUcnXJgqZKhdFGvE5p6t-WwUXDo-ACEwYBhgL/s1600/6.png"/></span></p>
<p><span style="color: #000000;"><strong>Author: </strong>AArti Singh is a Researcher and Technical Writer at Hacking Articles an Information Security Consultant Social Media Lover and Gadgets. Contact<strong><a style="color: #000000;" href="https://www.linkedin.com/in/aarti--singh/"> here</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
