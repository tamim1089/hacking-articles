<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/pentest-lab-setup/" rel="category tag">Pentest Lab Setup</a></span>            </div>
            <h1 class="post-title entry-title">Penetration Testing Lab Setup: Squid Proxy</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/penetration-testing-lab-setup-squid-proxy/" rel="bookmark"><time class="entry-date published" datetime="2018-11-15T18:36:35+00:00">November 15, 2018</time><time class="updated" datetime="2025-06-08T15:52:47+00:00">June 8, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p class="ai-optimize-6 ai-optimize-introduction"><span style="color: #000000;">In this article, we are going to set up Squid to use it as a Proxy Server on Ubuntu/Debian machines and will try to penetrate it.</span></p>
<h3 class="ai-optimize-7"><span style="color: #800000;">Table of content</span></h3>
<ul>
<li class="ai-optimize-8"><span style="color: #000000;">Introduction to Proxy Setting</span></li>
<li class="ai-optimize-9"><span style="color: #000000;">Squid Proxy Installation</span></li>
<li class="ai-optimize-10"><span style="color: #000000;">Squid Proxy Server Configuration</span></li>
<li class="ai-optimize-11"><span style="color: #000000;">Configuring Apache service for Web Proxy</span></li>
<li class="ai-optimize-12"><span style="color: #000000;">Web Proxy Penetration Testing</span></li>
<li class="ai-optimize-13"><span style="color: #000000;">Directory Brute force Attack on Proxy Server Using DIRB Tool</span></li>
<li class="ai-optimize-14"><span style="color: #000000;">Vulnerability Scanning on Proxy Server Using Nikto Tool</span></li>
<li class="ai-optimize-15"><span style="color: #000000;">SQL Injection on Proxy Server Using Sqlmap Tool</span></li>
<li class="ai-optimize-16"><span style="color: #000000;">WordPress Scanning on Proxy Server Using WPScan Tool</span></li>
</ul>
<h3 class="ai-optimize-17"><span style="color: #800000;">Introduction to Proxy Setting</span></h3>
<p class="ai-optimize-18"><span style="color: #000000;">A proxy is a computer system or program that acts as a kind of middle-man or an intermediary to come between your web browser and another computer. Your ISP operates servers– computers designed to deliver information to other computers. It uses proxy servers to accelerate the transfer of information between the server and your computer.</span></p>
<p class="ai-optimize-19"><span style="color: #000000;"><strong>For Example</strong>, Two users say A and B both have requested to access the same website of the server then Instead of retrieving the data from the original server, the proxy has “stored or cached” a copy of that site and sends it to User A without troubling the main server.</span></p>
<p class="ai-optimize-20"><span style="color: #000000;"><strong>Squid Proxy Installation</strong></span></p>
<p class="ai-optimize-21"><span style="color: #000000;">Squid is a cross-functional web proxy cache server application which offers proxy and cache services for HTTP, FTP, and other common network protocols such as proxying of Secure Sockets Layer (SSL) requests and caching of Domain Name Server (DNS) lookups and implement transparent caching. Moreover, it also maintains a wide variety of caching protocols.</span></p>
<p class="ai-optimize-22"><span style="color: #000000;"><strong>Let’s Begin!!</strong></span></p>
<p class="ai-optimize-23"><span style="color: #000000;">Open the host file in your local machine to add localhost address and hostname, because by default squid3 search for Ubuntu as the hostname for connection implementation.</span></p>
<p class="ai-optimize-24"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-noAiJvAvQJY/W-20_nfcawI/AAAAAAAAbIY/N86Wqoe1u-U3r470M-EIhvI9iO1YOFsBQCLcBGAs/s1600/0.png"/></span></p>
<p class="ai-optimize-25"><span style="color: #000000;">Now use apt Repository to install squid3 and enter the following command.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">apt-get install squid3</pre>
<p class="ai-optimize-26"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-M1LKzO3tHRk/W-20_joDnvI/AAAAAAAAbIg/tpgHQbeznNsUU70cy2O0v3sZh8o8fjmUwCLcBGAs/s1600/1.png"/></span></p>
<h3 class="ai-optimize-27"><span style="color: #800000;">Squid Proxy Server Configuration</span></h3>
<p class="ai-optimize-28"><span style="color: #000000;">Once the installation is completed, open its configuration file from the given path: <strong>/etc/squid3/squid.conf</strong></span></p>
<p class="ai-optimize-29"><span style="color: #000000;">With Squid’s access control, you may possibly shape the use of Internet services proxy by Squid to be accessible only employers with specific IP addresses.</span></p>
<p class="ai-optimize-30"><span style="color: #000000;">Suppose you want to grant access by users of the 192.168.1.0/24 subnetworks only, then add the following line to the  ACL section of the <strong>squid.conf</strong> file:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">acl lan src 192.168.1.0/24</pre>
<p class="ai-optimize-31"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-0kw_El5pYEg/W-21CcHJtAI/AAAAAAAAbJE/ndFWqjSt_SQ6TGGXccmH96BQ6nbNQzVrACLcBGAs/s1600/2.png"/></span></p>
<p class="ai-optimize-32"><span style="color: #000000;">Now permit your clients to access the HTTP service over the local network.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">http_access allow lan</pre>
<p class="ai-optimize-33"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-qNdFn2E0mPA/W-21CuXcZBI/AAAAAAAAbJI/3YLqyDQbfTspXEWfTZ1-awXUreDGCInSwCLcBGAs/s1600/3.png"/></span></p>
<p class="ai-optimize-34"><span style="color: #000000;">To set your Squid server to listen on the default TCP port 3128, change the http_port directive as given below:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">http_port 3128</pre>
<p class="ai-optimize-35"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-fuvtDCAz3tc/W-21C7lpUJI/AAAAAAAAbJM/UuZVPI_HHco_JCGvOxUj7SeEBm862Kc8QCLcBGAs/s1600/4.png"/></span></p>
<p class="ai-optimize-36"><span style="color: #000000;">Then add the following roles for squid after adding HTTP_Port</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">request_header_access Referer deny all
request_header_access X-Forwarded-For deny all
request_header_access Via deny all
request_header_access Cache-Control deny all</pre>
<p class="ai-optimize-37"><span style="color: #000000;"><strong> <img decoding="async" src="https://4.bp.blogspot.com/-Ucft8_8wSB8/W-21DCzFXmI/AAAAAAAAbJQ/efjnoDcUxe4w__oatpK2jDI_nVgPmDTCQCLcBGAs/s1600/5.png"/></strong></span></p>
<p class="ai-optimize-38"><span style="color: #000000;">You can Set forwarded_for :-     on|off|transparent|truncate|delete</span></p>
<ol>
<li class="ai-optimize-39"><span style="color: #000000;">If set to “on”, Squid will append your client’s IP address in the HTTP requests it forwards. By default it looks like:</span></li>
</ol>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">X-Forwarded-For: 192.1.2.3</pre>
<ol start="2">
<li class="ai-optimize-41"><span style="color: #000000;">If set to “off”, it will appear as</span></li>
</ol>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">X-Forwarded-For: unknown</pre>
<ol start="3">
<li class="ai-optimize-43"><span style="color: #000000;">If set to “transparent”, Squid will not alter the</span></li>
</ol>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">X-Forwarded-For header in any way.</pre>
<ol start="4">
<li class="ai-optimize-45"><span style="color: #000000;">If set to “delete”, Squid will delete the entire</span></li>
</ol>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">X-Forwarded-For header.</pre>
<ol start="5">
<li class="ai-optimize-47"><span style="color: #000000;">If set to “truncate”, Squid will remove all existing</span></li>
</ol>
<p class="ai-optimize-48"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-buyE2tCVoY4/W-21DG-6ivI/AAAAAAAAbJU/lZCOYIhKlBkw0jt3NKXkI1aGlYTgdBV7QCLcBGAs/s1600/6.png"/></span></p>
<p class="ai-optimize-49"><span style="color: #000000;">Here we had set <strong>forwarded_for off</strong> and save the file, then use the following command to restart the Squid Proxy.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sudo service squid3 restart</pre>
<p class="ai-optimize-50"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-O_QdjzX0twc/W-21DTdJBvI/AAAAAAAAbJY/-9KAQTpWjzo72pkKEzGOepmCydNC8zvDgCLcBGAs/s1600/7.png"/></span></p>
<h3 class="ai-optimize-51"><span style="color: #800000;">Configuring Apache service for Web Proxy </span></h3>
<p class="ai-optimize-52"><span style="color: #000000;">Then open the “000-default.conf” file from the path<em>: /etc/apache2/sites-available/</em> and add the following line to implement the following rules on /html directory over localhost or Machine IP (192.168.1.103)</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">&lt;Directory /var/www/html/&gt;
                Options Indexes FollowSymLinks MultiViews
                AllowOverride None
                Order deny,allow
                deny from all
        allow from 127.0.0.1 192.168.1.103
&lt;/Directory&gt;</pre>
<p class="ai-optimize-53"><span style="color: #000000;">Now the save the file and restart the apache service with the help of the following command.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">service apache2 start</pre>
<p class="ai-optimize-54"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-nn0T_UpJj-E/W-21Dl0Ee4I/AAAAAAAAbJc/WnONI5XuzSQNKCl4K7zWpvRPxM4XxXlmgCLcBGAs/s1600/8.png"/></span></p>
<p class="ai-optimize-55"><span style="color: #000000;">Now, when someone tries to access web services through our network i.e. 192.168.1.103, he/she will be welcomed by the following web page</span></p>
<p class="ai-optimize-56"><span style="color: #000000;"><em>“Error 403 forbidden You don’t have permission to access &lt;requested page&gt;”.</em></span></p>
<p class="ai-optimize-57"><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-q4RpDemsITc/W-21EHxuD3I/AAAAAAAAbJg/d9P_nMDdGzoU68wqf0TKTGXsg8Vsg3akgCLcBGAs/s1600/9.png"/></span></p>
<p class="ai-optimize-58"><span style="color: #000000;">When you face that such type of situation where port 80 is open but you are unable to access it, hence proved the network is running behind the proxy server.</span></p>
<p class="ai-optimize-59"><span style="color: #000000;"><strong><img decoding="async" src="https://4.bp.blogspot.com/-i-p2mi7dnT4/W-20_utinkI/AAAAAAAAbIc/Y7hINT_5BeQA3VwyPIcBHTbpsZYAHxWtgCLcBGAs/s1600/10.1.png"/></strong></span></p>
<h3 class="ai-optimize-60"><span style="color: #800000;">Web Proxy Penetration Testing</span></h3>
<p class="ai-optimize-61"><span style="color: #000000;">For web Proxy penetration testing we had already set-up lab for web application servers such as DVWA and SQli DHAKKAN (Read Article from <a style="color: #000000;" href="http://www.hackingarticles.in/configure-web-application-penetration-testing-lab/">here</a>) and WordPress (Read Article from <a style="color: #000000;" href="https://www.hackingarticles.in/wordpress-pentest-lab-setup-in-multiple-ways/">here</a>).</span></p>
<p class="ai-optimize-62"><span style="color: #000000;">Now to test whether our  proxy server is working or not by configuring , let’s open Firefox and go to <strong>Edit –&gt; Preferences –&gt; Advanced –&gt; Network –&gt; Settings </strong>and then select<strong> “Manual proxy configuration</strong>” and enter proxy server IP address (192.168.1.103) and Port (3128) to be used for all protocol.</span></p>
<p class="ai-optimize-63"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-zJyfl4XMp9Y/W-21Ai7BvvI/AAAAAAAAbIk/Gc5CpTvJSYIHFEoFFxLpwxYIE879nKY9wCLcBGAs/s1600/10.png"/></span></p>
<p> </p>
<p class="ai-optimize-64"><span style="color: #000000;">BOOMMM!! Connected to the Proxy server successfully using HTTP Proxy in our Browser.</span></p>
<p class="ai-optimize-65"><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-RsL8MmqOPTg/W-21A-icfII/AAAAAAAAbIo/9cZIuqlbUT4L3V_9P3VO6MOBTUihXBKjQCLcBGAs/s1600/11.png"/></span></p>
<h3 class="ai-optimize-66"><span style="color: #800000;">Directory Brute Force Attack on Proxy Server Using DIRB Tool</span></h3>
<p class="ai-optimize-67"><span style="color: #000000;">While making a directory brute force attack with the help of DIRB we can use <strong>–p option</strong>, it enables proxy URL to be used for all requests, by default it works on port 1080. As you have observed, on exploring target network IP in the web browser it put up “Access forbidden error” which means this web page is running behind some proxy.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">dirb http://192.168.1.103/dvwa
dirb http://192.168.1.103/dvwa –p 192.168.1.103:3128</pre>
<p class="ai-optimize-68"><span style="color: #000000;">From the given below image, you can take reference for the output result obtained for above commands, here we haven’t obtained any directory or file on executing 1st command whereas in 2<sup>nd</sup> command executed successfully.</span></p>
<p class="ai-optimize-69"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-PGcnLcLVyH0/W-21BArl0HI/AAAAAAAAbIs/5tQViK_zu7Uaokw5IyNXor8Mq0dW8QhDgCLcBGAs/s1600/12.png"/></span></p>
<h3 class="ai-optimize-70"><span style="color: #800000;">Vulnerability Scanning on Proxy Server Using Nikto Tool</span></h3>
<p class="ai-optimize-71"><span style="color: #000000;">Similarly, while scanning any network running behind a proxy server, we can use <strong>-useproxy option</strong> to scan the vulnerability.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nikto -h 192.168.1.103
nikto -h 192.168.1.103 -useproxy http://192.168.1.103:3128</pre>
<p class="ai-optimize-72"><span style="color: #000000;">From the image given below, you can take reference for the output result obtained for the above commands. Here we haven’t obtained any result on executing the 1st command, whereas in 2<sup>nd</sup> command executed successfully.</span></p>
<p class="ai-optimize-73"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-ftUo3E4_Whc/W-21BdbuFpI/AAAAAAAAbIw/PxEIS-btFF4wktrdiGwa0Y_F_o1Uz80xgCLcBGAs/s1600/13.png"/></span></p>
<h3 class="ai-optimize-74"><span style="color: #800000;">SQL Injection on Proxy Server Using Sqlmap Tool</span></h3>
<p class="ai-optimize-75"><span style="color: #000000;">As you have observed, on executing following command it put up “403 forbidden error” which means this web page is running behind some proxy.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sqlmap -u http://192.168.1.103/sqli/Less-1/?id=1 --dbs</pre>
<p class="ai-optimize-76"><span style="color: #000000;"><strong> <img decoding="async" src="https://3.bp.blogspot.com/-YjS9fAPSoK0/W-21BnaOnZI/AAAAAAAAbI0/5ETLLKQpFccIVmkTP1Es5b3o2ClBEWQTgCLcBGAs/s1600/14.png"/></strong></span></p>
<p class="ai-optimize-77"><span style="color: #000000;">Hence we can use <strong>–proxy options</strong> to connect to the target URL, therefore execute the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sqlmap -u http://192.168.1.103/sqli/Less-1/?id=1 --dbs --proxy http://192.168.1.103:3128</pre>
<p class="ai-optimize-78"><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-X1gT3l51oJo/W-21BxKFOEI/AAAAAAAAbI4/F7ZJjlWxmWwlYDI0mXwxe3K1hH0QDh_EQCLcBGAs/s1600/15.png"/></span></p>
<p class="ai-optimize-79"><span style="color: #000000;">Now from the given image below, you can observe that we have successfully retrieve database name by exploiting SQL injection vulnerability.</span></p>
<p class="ai-optimize-80"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-FY0JFaByAAU/W-21BzujkBI/AAAAAAAAbI8/62uCu5bGNlQn_6BSBAVAFXeOkuW5qF-2ACLcBGAs/s1600/16.png"/></span></p>
<h3 class="ai-optimize-81"><span style="color: #800000;">WordPress Scanning on Proxy Server Using WPScan Tool</span></h3>
<p class="ai-optimize-82"><span style="color: #000000;">As you have observed, on executing following command it put up “403 forbidden error” which means this web page is running behind some proxy.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">wpscan --url http://192.168.1.103/wordpress --wp-content-dir wp-content</pre>
<p class="ai-optimize-83"><span style="color: #000000;">Hence we can use <strong>–proxy options</strong> to connect to the target URL, therefore execute the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">wpscan --url http://192.168.1.103/wordpress --wp-content-dir wp-content  --proxy http://192.168.1.103:3128</pre>
<p class="ai-optimize-84"><span style="color: #000000;">Hopefully, you have found this article very helpful and completely understood the working of the Proxy server and another related topic cover in this article.</span></p>
<p class="ai-optimize-85"><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-GUCLGxHSSv4/W-21CEyYhXI/AAAAAAAAbJA/Tx0IudWmj8g7YjfI_Y4SHSYBlgIrfpQCACLcBGAs/s1600/17.png"/></span></p>
<p class="ai-optimize-86"><span style="color: #000000;"><strong>Author</strong>: Sanjeet Kumar is an Information Security Analyst | Pentester | and Researcher. Contact <a class="broken_link" style="color: #000000;" href="https://www.linkedin.com/in/sanjeet-kumar-27828058/"><strong>Here</strong></a></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-related-none yarpp-template-thumbnails">
