<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">A Detailed Guide on Responder (LLMNR Poisoning)</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/a-detailed-guide-on-responder-llmnr-poisoning/" rel="bookmark"><time class="entry-date published" datetime="2022-04-09T16:57:55+00:00">April 9, 2022</time><time class="updated" datetime="2025-06-23T18:57:45+00:00">June 23, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <article class="text-token-text-primary w-full" dir="auto" data-testid="conversation-turn-52" data-scroll-anchor="true">
<div class="text-base my-auto mx-auto py-5 [--thread-content-margin:--spacing(4)] @[37rem]:[--thread-content-margin:--spacing(6)] @[72rem]:[--thread-content-margin:--spacing(16)] px-(--thread-content-margin)">
<div class="[--thread-content-max-width:32rem] @[34rem]:[--thread-content-max-width:40rem] @[64rem]:[--thread-content-max-width:48rem] mx-auto flex max-w-(--thread-content-max-width) flex-1 text-base gap-4 md:gap-5 lg:gap-6 group/turn-messages focus-visible:outline-hidden" tabindex="-1">
<div class="group/conversation-turn relative flex w-full min-w-0 flex-col agent-turn">
<div class="relative flex-col gap-1 md:gap-3">
<div class="flex max-w-full flex-col grow">
<div class="min-h-8 text-message relative flex w-full flex-col items-end gap-2 text-start break-words whitespace-normal [.text-message+&amp;]:mt-5" dir="auto" data-message-author-role="assistant" data-message-id="0bc3edf3-eb1d-4ed1-bd0a-9ae2818adfbb" data-message-model-slug="gpt-4o">
<div class="flex w-full flex-col gap-1 empty:hidden first:pt-[3px]">
<div class="markdown prose dark:prose-invert w-full break-words dark">
<article class="text-token-text-primary w-full" dir="auto" data-testid="conversation-turn-54" data-scroll-anchor="true">
<div class="text-base my-auto mx-auto py-5 [--thread-content-margin:--spacing(4)] @[37rem]:[--thread-content-margin:--spacing(6)] @[72rem]:[--thread-content-margin:--spacing(16)] px-(--thread-content-margin)">
<div class="[--thread-content-max-width:32rem] @[34rem]:[--thread-content-max-width:40rem] @[64rem]:[--thread-content-max-width:48rem] mx-auto flex max-w-(--thread-content-max-width) flex-1 text-base gap-4 md:gap-5 lg:gap-6 group/turn-messages focus-visible:outline-hidden" tabindex="-1">
<div class="group/conversation-turn relative flex w-full min-w-0 flex-col agent-turn">
<div class="relative flex-col gap-1 md:gap-3">
<div class="flex max-w-full flex-col grow">
<div class="min-h-8 text-message relative flex w-full flex-col items-end gap-2 text-start break-words whitespace-normal [.text-message+&amp;]:mt-5" dir="auto" data-message-author-role="assistant" data-message-id="d92ac6b9-88b8-4ce6-8785-a11df4aa46cf" data-message-model-slug="gpt-4o">
<div class="flex w-full flex-col gap-1 empty:hidden first:pt-[3px]">
<div class="markdown prose dark:prose-invert w-full break-words dark">
<p data-start="0" data-end="141"><span style="color: #000000;"><strong data-start="0" data-end="13">Responder</strong> is a widely used tool in penetration testing scenarios, and red teamers often use it for lateral movement across the network.</span></p>
<p data-start="143" data-end="375"><span style="color: #000000;">Additionally, Responder offers many useful features, like LLMNR, NT-NS, and MDNS poisoning. It supports various Active Directory attacks and helps achieve objectives like hash capture or poisoned answer forwarding.</span></p>
<p data-start="377" data-end="603"><span style="color: #000000;">Moreover, Responder includes several built-in servers, such as HTTP, SMB, LDAP, and DCE-RPC Auth servers. In this article, we will cover a majority of these attacks that you can perform using Responder.</span></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
<h3 data-start="0" data-end="137"><span style="color: #800000;">Table of content</span></h3>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
<ul>
<li><strong><span style="color: #000000;">LLMNR, NBT-NS, MDNS and DHCP</span></strong></li>
<li><strong><span style="color: #000000;">Responder Installation</span></strong></li>
<li><strong><span style="color: #000000;">Attack 1: LLMNR/NBT-NS Poisoning through SMB</span></strong></li>
<li><strong><span style="color: #000000;">Attack 2: LLMNR/NBT-NS Poisoning through WPAD</span></strong></li>
<li><strong><span style="color: #000000;">Responder Analyze Mode</span></strong></li>
<li><strong><span style="color: #000000;">Responder Basic Authentication Mode</span></strong></li>
<li><strong><span style="color: #000000;">Responder Downgrade NTLMv2-SSP to NTLMv2</span></strong></li>
<li><strong><span style="color: #000000;">Responder external IP poisoning</span></strong></li>
<li><strong><span style="color: #000000;">Responder Multi-Relay: Shell on a system</span></strong></li>
<li><strong><span style="color: #000000;">Responder DNS injection in DHCP response</span></strong></li>
<li><strong><span style="color: #000000;">What are these servers in responder?</span></strong></li>
<li><strong><span style="color: #000000;">Recommendations</span></strong></li>
<li><strong><span style="color: #000000;">Conclusion</span></strong></li>
</ul>
<h3><span style="color: #800000;">LLMNR, NBT-NS, MDNS and DHCP</span></h3>
<h5><span style="color: #000000;"><strong>LLMNR: </strong> </span></h5>
<p><span style="color: #000000;">It is a protocol that allows name resolution without requiring a DNS server. Specifically, it provides a hostname-to-IP mapping by sending a multicast packet across the network, asking all listening network interfaces to reply if they authoritatively recognize the queried hostname. Moreover, it sends a network packet to UDP port 5355 at the multicast network address. LLMNR supports both IPv4 and IPv6 hosts and handles all current and future DNS formats, types, and classes. Notably, it succeeds the NBT-NS protocol.</span></p>
<h5><span style="color: #000000;"><strong>NBT-NS: </strong> </span></h5>
<p><span style="color: #000000;">NetBIOS Name Service (NBT-NS) is a Windows protocol that translates NetBIOS names to IP addresses within a local network. In fact, this process is similar to how DNS resolves names on the internet. The NBT-NS service assigns a unique NetBIOS name to each machine. Additionally, it operates over UDP port 137. Importantly, it served as the predecessor of LLMNR.</span></p>
<h5><span style="color: #000000;"><strong>MDNS: </strong> </span></h5>
<p><span style="color: #000000;">Multicast DNS (<strong data-start="350" data-end="358">mDNS</strong>) assists with name resolution on local networks. It multicasts the query to all clients in the network instead of querying a name server. Consequently, once the sender establishes a connection with the recipients, all participants receive the name-to-IP mapping update and can store it in their mDNS cache.</span></p>
<h5><span style="color: #000000;"><strong>LLMNR/NBT-NS Poisoning: </strong></span></h5>
<p><span style="color: #000000;">Let’s say a victim wants to connect to a shared drive <strong>\\wow </strong>so it sends the request to the DNS server. The only problem is that DNS can’t connect to <strong>\\wow</strong> as it doesn’t exist. Therefore, the server replies back saying he can’t connect the victim to <strong>\\wow</strong>. Thereafter, the victim will multicast this request to the entire network (using LLMNR) in case any particular user knows the route to the shared drive (\\wow).</span></p>
<p><span style="color: #000000;">An adversary can spoof an authoritative source for name resolution by responding to this multicast request by a victim as if they know the identity of the shared drive a victim wants to connect with and in turn request its NTLM hash. This means that the attacker has now poisoned the service!</span></p>
<p><span style="color: #000000;"><img fetchpriority="high" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgVE0JujaHdtgJn3sTMBXSiR4ruZ5alpr-8kGVAdsx6gzR4WmOPLAkERsX9sh8oJQNQcQLyJvBR3xQi6wMYUr6RjMPpXOBSKoVN1UwQJg478eWg8QSVW-q9QQD8eWrcJyZcHmHY-cRLF12lhmsokuIvj1YYZ7bRfVyZ7kJTZz5SHAfUeEhK9YTtkameBw/s16000/0.png" alt="LLMNR Poisoning" width="1316" height="727"/></span></p>
<h5><span style="color: #000000;"><strong>DHCP Poisoning: </strong></span></h5>
<p><span style="color: #000000;">Dynamic Host Client Protocol (DHCP) is used to provide a host with its IP address, subnet mask, gateway etc. Windows uses multiple custom DHCP options like NetBIOS, WPAD etc. By poisoning the DHCP response, an attacker would be able to help the victim pinpoint its own rogue server for any kind of authentication. In turn, compromising the credentials.</span></p>
<h3><span style="color: #800000;">Responder Installation</span></h3>
<p><span style="color: #000000;">Initially developed by SpiderLabs and now being developed by Laurent Gaffie (lgandx), Responder is a Python-coded tool that can be found <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/lgandx/Responder">here</a></strong></span>. The tool comes with built-in Kali OS. Responder.exe (Windows version) of the same can be found <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/lgandx/Responder-Windows">here</a></strong></span>.</span></p>
<p><span style="color: #000000;">It can be run using the command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">responder -h</pre>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgMdkuUouM8mVXnU_M0aSA58AgPqfdc6ViKx1v6O-_GzFN7aUwnvm4pztXOlOG0wFsotcYjIOHon9umSJnI7NuXBsLd1MWJ9mVuPCaAt054AIIq0_-FY2HSPlmO97g-QZlyKDKupmhdsPvAuI5OirmsezAGyn8VMCU_fGm7ow5SHg7iuJNeiYAcD5zxtw/s16000/1.png"/></strong></span></p>
<h3><span style="color: #800000;">Attack 1: LLMNR/NBT-NS Poisoning through SMB</span></h3>
<p><span style="color: #000000;">When a system tries to access an <strong data-start="393" data-end="406">SMB share</strong>, it sends a request to the <strong data-start="434" data-end="448">DNS server</strong>, which resolves the share name to the respective <strong data-start="498" data-end="512">IP address</strong>. Consequently, the requesting system can access it. However, if the provided share name doesn’t exist, the system sends out an <strong data-start="640" data-end="655">LLMNR query</strong> to the entire network. If any user (<strong data-start="692" data-end="706">IP address</strong>) has access to that share, they can reply and provide the communication to the <strong data-start="786" data-end="799">requestor</strong>.</span></p>
<p><span style="color: #000000;">For instance, let’s take a share called “<strong data-start="843" data-end="850">wow</strong>,” which doesn’t exist currently. If this share existed on the network, users could access it by typing “\wow” in the <strong data-start="969" data-end="984">address bar</strong> of <strong data-start="988" data-end="1005">file explorer</strong>. However, because it doesn’t exist, Windows throws an error.</span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgV3cMBH4XJOBR4BMZXMfl78WtWOqp_QFmtOsHmrNmGy0vszO3VuFBTLPyLq2Rkvu0grS1lUe4LC0xpOWvvv9-AZA3HO5O1aRwpzaDnE_Yp2LC4fKm7kkyTn2Jk2CrsJbCusCCMidSOmajsgvcmwmrLFy9mmiIaX020vL0a75-pt4s8Hhw00-b-KnanQg/s16000/2.png" alt="LLMNR Poisoning" width="685" height="377"/></span></p>
<h5><span style="color: #000000;">Responder Intervention</span></h5>
<p><span style="color: #000000;">At this point, <strong data-start="1111" data-end="1124">responder</strong> comes into play. The requesting machine (<strong data-start="1166" data-end="1180">Windows 10</strong>) sends out an <strong data-start="1195" data-end="1212">LLMNR request</strong>, and we configure <strong data-start="1231" data-end="1244">responder</strong> to poison that request. We need to specify the <strong data-start="1292" data-end="1299">NIC</strong> on which responder will listen for <strong data-start="1335" data-end="1353">LLMNR requests</strong>, which in this case is <strong data-start="1377" data-end="1385">eth0</strong>. By default, responder will start <strong data-start="1420" data-end="1429">LLMNR</strong> and <strong data-start="1434" data-end="1454">NBT-NS poisoning</strong>.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">responder -I eth0</pre>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj8rSxYx0GVfXz6W5907NN5x_n1AOhAICepo6t5OubuU9xpih2Zo9s9m2kF2eq8vBOJOUD2VKEqASl9ZbGJTm84Cvke2lxZTpDrUc-zkf1Exs4QLiSHQQcM_7I1vEFeMbJAUr4g4OQrlo7rtdB49gv-ZUAs9hNaEjFFX9AOntC2TSCI3v0p6jL-ycw75g/s16000/3.png" alt="LLMNR Poisoning" width="479" height="523"/></span></p>
<h5><span style="color: #000000;">Poisoned Response and Hash Capture</span></h5>
<p><span style="color: #000000;">Now, when the victim tries to access the shared drive “<strong data-start="1583" data-end="1590">wow</strong>,” they see the share suddenly become available. However, this is a <strong data-start="1658" data-end="1677">poisoned answer</strong> asking for <strong data-start="1689" data-end="1709">user credentials</strong>.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhSXuQwXX06KelgjXBPaEijOxw6z2yRzgZtXGBcDmfL7tKXj7ZdHcarGYd-9YTGb6nTCAHP2lg_87psy7DmtSlpjqq53AKJnjmzjY0WR8Rj4R8c2ziB81UDrzfPpoheMKn589dGU_Zx9aBrZovJC7tISqOpxaPUjd4SSX1SX-kOBlutR6KlCOts3UTwiQ/s16000/4.png"/></span></p>
<p><span style="color: #000000;">Even though <strong data-start="1724" data-end="1731">wow</strong> isn’t available at all, this trick allows the attacker to obtain <strong data-start="1797" data-end="1812">NTLM hashes</strong>. Even if the user doesn’t input credentials, <strong data-start="1858" data-end="1873">NTLM hashes</strong> will still be captured.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg68sVzz3F5qK6IjZRdLQqf4M90x1S8cI2kzi-bJdQiAhHBT4uI0fC95C4iELx5zkHh3UrVVTBmluQJsAIZQs4CCnjCOqjSIs3R8S1k1-Q5fnJ5OLidMfMRpU5r0LTbWGsb9EnrRPSRCiI9jD5CI5i2zSRhsjlDm7FxSX4gNTjAgMIOH7m3OZrUWkWnUA/s16000/5.png"/></span></p>
<p><span style="color: #000000;">We can save these <strong data-start="1917" data-end="1932">NTLM hashes</strong> into a file named <strong data-start="1951" data-end="1963">hash.txt</strong> and use <strong data-start="1972" data-end="1983">hashcat</strong> to crack them. To crack <strong data-start="2008" data-end="2018">NTLMv2</strong>, we use the <strong data-start="2031" data-end="2053">module number 5600</strong> in <strong data-start="2057" data-end="2068">hashcat</strong>. If you obtained a different version of <strong data-start="2109" data-end="2117">NTLM</strong>, be sure to follow the <strong data-start="2141" data-end="2160">hashcat modules</strong> to specify the correct one.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">hashcat -m 5600 hash.txt /usr/share/wordlists/rockyou.txt</pre>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhSR7vZLixbRxRQRUgE4Wli_MT1JIBNZNZf4CGLnwbodOeaqaoFpZC7G74jvyKP_nm1l7zV4awzfZwpvQDznmvseka_wmUYTSoyp-5Dpo5gJYoEG4SL1uvFEA3DpWb_ZWfj6GxpxQAMBhw9VTQpjd3Z0xYA_Q9Ev4WB1_yEAahB9oDs4lk2LjHpoHxI5g/s16000/6.png" alt="LLMNR Poisoning" width="866" height="722"/></span></p>
<p><span style="color: #000000;">As shown, the password has now been successfully cracked, revealing <strong data-start="2329" data-end="2343">Password@1</strong>.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhFXo7GTNv0Qkk9hryJmd2cU8caRbACms0XMYIX2xVHKSrQi9dytDxv26dABbSy8XNI1dWGjmyEXnLtABsWR-He91p09L44lR-ZsVQjRFrw970Fzmfm7WxwJo5mSIPDgwgTN7HQj2PhmRUhy1mNj4joJpVn_HwWsX6Nh-zFE5lHuZP54v3g5Ta0bUcz5w/s16000/7.png"/></span></p>
<p><span style="color: #000000;">Additionally, <strong data-start="2360" data-end="2373">responder</strong> creates logs of each session, and all the captured hashes are stored in the <strong data-start="2450" data-end="2479">/usr/share/responder/logs</strong> folder.</span></p>
<p><span style="color: #000000;"><strong> <img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg2_OmCmAS87AokK3bcm_H7ni328yUo_zABgh5a5DWIZbit_SW-8BvO49DAdqGkyPLLkEY9qQeXjaCmbGDljZgf5efw-Ulb-2MDjxRA0vAkUGONj5JW5SOyoL328o7AB3PjBGdR2ZcCrULgSq7lf9Fx9A9LDx-mtBT1RqhOh2sx_xgPvt0WrWix5ds_sQ/s16000/8.png" alt="LLMNR Poisoning" width="859" height="443"/></strong></span></p>
<h3><span style="color: #800000;">Attack 2: LLMNR/NBT-NS Poisoning through WPAD</span></h3>
<h5><span style="color: #000000;">WPAD: </span></h5>
<p><span style="color: #000000;">Web Proxy Autodiscovery Protocol is a method used by a browser to automatically locate and interface with cache services in a network so that information is delivered quickly. WPAD by default uses DHCP to locate a cache service to facilitate straightforward connectivity and name resolution.</span></p>
<p><span style="color: #000000;">In an organization that uses WPAD server, supply each browser with the same proxy configurations using a file called wpad.dat. Hence, any request going from any browser in a company domain first finds wpad.dat and then reads the configuration and finally sends the request to the destination.</span></p>
<p><span style="color: #000000;">When an invalid URL is an input in the browser, the browser fails to load that page using DNS and hence, sends out an LLMNR request to find a WPAD proxy server. This behaviour is there by default in browsers that have enabled “automatic configuration detection,” an option used often in corporate networks to route traffic through proxy. It then asks for wpad.dat which contains proxy’s auto-configuration data.</span></p>
<p><span style="color: #000000;">Responder (LLMNR poisoner) creates a rogue WPAD proxy server, poisons the request, and tells the browser that it has wpad.dat file and asks for authentication. When the user inputs his credentials, the hashes travel through the attacker!</span></p>
<h5><span style="color: #000000;">Attack: </span></h5>
<p><span style="color: #000000;">To configure WPAD rogue proxy server we use the -w option. Furthermore, we added an optional switch of DHCP injection. This switch would inject rogue proxy’s address (kali IP) in the DHCP response. The attack could still work without this switch.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">responder -I eth0 -wd</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjnV2okcE5GQHOMfODfMVdW26OkUKM1GDK2gb2Fy4qh1TyCiTnccmAJC4x9UuUP5evlPyqGHnyCvAuXiXU9RF_Nspd-1BmEloS5M9oNtGfY1mqSpRg9IZUxF3IKNdVNp2JswIazgWFo3GLhVRYi5DEWz3em8zc0_WEOBMy80IfwF6WhDxFA7z9cLXnlsg/s16000/9.png"/></span></p>
<p><span style="color: #000000;">As you can see above, that DHCP poisoner and WPAD proxy have now been turned on. Now, when a user inputs any wrong URL, let’s say, randomurl.local, browser couldn’t locate it. Responder poisons and injects DHCP response with WPAD’s IP and the browser tries to authenticate to the WPAD server and gives a login prompt.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEif4uHhGpYlrjRO12D4y46wRfTebdxqm7m7xISh2f3oVnPxZw4fT7Pa_3BnuvKoaOykdwSkN_5hIjakS8jgILXeYz5Os9t9pGJOhjv5N8doX2Dj-JBwXegz_YY74HuYPk4ua3jmo94VnaV9-yXG60kKTRrLgoTYcyoUMU00Yq8vgj9nw-wUNCDervPWGQ/s16000/10.png" alt="LLMNR Poisoning" width="930" height="689"/></span></p>
<p><span style="color: #000000;">As soon as the client inputs his credentials, we receive their NTLM hashes!</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg6aF-VeAAf614QPBCDoErcjyAbmvsPSI2d7hRViQeAkUW2E28TompJv9-QOsnBpQoZ5ndThdGTapjRoSju7zmUqs9shZQtCkTPfukek5A3Vy23IP6caEP_rA20RFacF7u_uDj_mVTvQzLTZfA0x-xdFX6xip3ttfEF4Hcgtf31vI5AgxoQv9SXpMRpaw/s16000/11.png"/></span></p>
<p><span style="color: #000000;">This can be viewed in the logs too, but this time under the name HTTP-NTLMV2-IPV6.txt format\</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhmMToBqe_Em2bQ3Kzh1Soa2FCDWhnihfK--vED8vxAX7O6tttcnT0qyLC-FGA0vMCw9iqyClSSgw-_nctU80d0iBFEBQgOpIkiU-tDiVaX31f7n0HOL5BATMqtiZpnHONcOJzMokGVvhPF-YkbtiXX85Yb4-SKvDOOwiK8a8l0TdmEpYaOoheUhzR0RA/s16000/12.png" alt="LLMNR Poisoning" width="864" height="455"/></span></p>
<p><span style="color: #000000;">We can crack it using hashcat now</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">hashcat -m 5600 HTTP-NTLMv2-fe80::ddc5:3b8f:e421:a88a.txt /usr/share/wordlists/rockyou.txt</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhSeuUPL41x8-4E_puFlUlyoYeCOrt3EIa7F_U0EtrO-_AS-nX9CengCfGrqTJEBIl0sVjUXwHQDE8KZj6_HqQd1km0DjiSqq3vo-yx5l0R5Fyr5D52VE8nhs1uC6wqSmUHw5TWx4wSA0ltAmLFYAulmHsUahzSqeX5r1mMhoKL2-o1IBaIDtIfhQZSnQ/s16000/13.png"/></span></p>
<p><span style="color: #000000;">Hash has been cracked and clear text password dumped!</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhmSoigDPRMIxysJXpOE-qMY3P2x6r3SucyK6M6J13rynU2Aq-xguX0H4aCZY0fs01bIBo0ZVLLMcqMBxB3kkrsUPEyXXQiN-upVW1nRvGpTfEO40sl0SVQMeR8psoW0kD63iwvH17Gmbhc0ZGViNppI7X3w0u-4nmkI6txIyrzWfPkPpWyBZwM0JVCaQ/s16000/14.png" alt="LLMNR Poisoning" width="864" height="371"/></span></p>
<h3><span style="color: #800000;">Responder Analyze Mode</span></h3>
<p><span style="color: #000000;">In <strong data-start="3" data-end="14">analysis</strong> mode, <strong data-start="21" data-end="34">Responder</strong> tracks the network flow of LLMNR requests instead of automatically poisoning them. It provides essential information, such as the name of the user, the machine account being used, the name of the DC, and the OS version. Additionally, you can activate this mode using the <strong data-start="306" data-end="312">-A </strong>switch</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">responder -I eth0 -A</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgOuNR1FbiOdh6wCLhAWYXnvHCkpf4MgsEhub-mhhNCBgxX7AdHrNDhXBDWryBxke-s-ycmqzBEHA45T6qugSJgS4m_99btwwCM4b2pRBdExjyC6iWcViPi3bTW6q7JxfYFQmVuOHD2oUgh0SIzND4aO7hgCkP40m6veA8x5o-hahscsu-qao5JsjLHyQ/s16000/15.png"/></span></p>
<p><span style="color: #000000;">When a victim tried to access wrong sharename (Attack 1 method), responder analyses the entire flow and gives us the DC name, Windows OS version etc.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgbUkr4OJW6VuQMnpict3K3gg1wlaik_3LmQYXrX-yerT_cTDokVzIVlpHPKtd8jNVfuH-469bF3YCLbtRQXQm5-WsD_Y4yQC7KaMAPt0W8wZgzv0OFX6yXIrqASlMs6vytgIz9S9yeU59mUDLL4-VGXoNPg_ugHef4oAXdO2VHAyWEFybhFQEtGTkh6Q/s16000/16.png" alt="LLMNR Poisoning" width="864" height="509"/></span></p>
<h3><span style="color: #800000;">Responder Basic Authentication Mode</span></h3>
<p><span style="color: #000000;">In attack 2, we saw how an NTLM authentication windows was opened when our rogue WPAD proxy server was being accessed by poisoning LLMNR. In turn, we were able to retrieve the NTLMv2 hashes. We will imitate the same attack but this time, try to gain clear text credentials of the user using basic authentication! This can be achieved using the -b flag. Further, we are using -F switch to force basic authentication!</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">responder -I eth0 -wdF -b</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiOpPK0XcbbInB5BoRS8VhcgsvIaFW4Kk4tlRo3V-7I87WH04pztzwZ-7kStR2uvijvqay7Bbaf7_R7IFnkiYulx1jYorRaTbaNidLf7wUYCXdDLEScfNVKs5xRE6lhDapkBetYXxajfy8sz7Ir5Bt1CWRQjqRSOTF5v9FBqMGOHw2IGRG5uh_vDKvu2A/s16000/17.png"/></span></p>
<p><span style="color: #000000;">Now, when a user tries to access any invalid URL, he sees the following prompt with the message saying that these credentials would be sent in clear text using basic authentication.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjuAE1L8VjA2t1R7gAbTeoL8BzUJitAGdpPyBIiAcPOtsq9LNxdNGKJgPFlEmItjBtHfUss0KPC93m-yTdsCjQhHQLvu4AP1Dh1bFxiVvF-L9NqUjK0WUOkl5U2q-L28hAYLLhVJpEKvIV2tOpVJQuiLQ-TlhQTD0LLlvwcYwEed4sEL0y2nKbE7diHPw/s16000/18.png" alt="LLMNR Poisoning" width="930" height="723"/></span></p>
<p><span style="color: #000000;">As soon as use inputs his credentials, responder receives them and displays password in clear text!</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhPnyExvjTWoK7UQw-7RvahNy4HbDzSNn9QSlmQRYgQBxb5u0Fv2yviG9Ew3WpM7cqipb4p_STfEIKmMV7LPn8O-ZQzRy2zjGeSg-T-a0NHEPIMgzE4KCUtDetiGb2t4prvoVnNsDWoEclEbxDVHhKhK7PHNxFdW4tCoUPdWc3TeHqeGNGljbohqj1iJw/s16000/19.png"/></span></p>
<h3><span style="color: #800000;">Responder Downgrade NTLMv2-SSP to NTLMv2</span></h3>
<p><span style="color: #000000;">NTLM provides <a style="color: #000000;" href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-nlmp/a92716d5-d164-4960-9e15-300f4eef44a8">ESS</a> functionality (Extended Session Security) which adds to the complexity of the NTLM hash. ESS functionality adds an “SSP” flag in the NTLM hash (NTLM2-SSP). This increases the length of our NTLM hash in turn increasing complexity to crack the hash. We can configure Responder to use simple NTLMv2 (without ESS) which would result in lower time complexity to crack hashes.</span></p>
<p><span style="color: #000000;">–disable-ess flag does that. –lm flag tries to force the NTLM authentication to version 1 instead of 2, which is not possible in later windows and windows server versions. Here, we will use Attack 2 procedure with disable-ess flag.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">responder -I eth0 -wdF --lm --disable-ess</pre>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEglJ1KdgpOp_SetRFRiiZD0ia-5kjaDV870C8HA0QjOWFlAAsc4Lhf3-LCgchtZTKdjvJVT-pNHJQcL6G5slsM5MyohwZLnDN3SNvoSVSYA7K0eqMoV-_pZ-C29aPCtf4sat6VolBjnVOWdgSEF8uOp1Dje886FvCYIcmb81Z10-vbpRBHdTSYjgkVNJg/s16000/20.png" alt="LLMNR Poisoning" width="503" height="659"/></span></p>
<p><span style="color: #000000;">This would give the user a pop-up</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjIefwDxzcX3Vag5pos72Uc9WkeYKEcU1AaaMOchlBZ_QUEr6jJ-C2K5AU1KKx_1wDyP9D0Y1_JCcGgOGPDkZ9iVcrhu-uj9pH2KaMtifyqw9HlsE-MO-7q8jjCPcmmkgBVnTCyihSX0vyY1RQKoGyaxvxLp9kKujT-aBta_4cK7X3qL8FXrMJnRHvJjA/s16000/21.png"/></span></p>
<p><span style="color: #000000;">As soon as Mufasa enters his credentials, we see that a downgraded version of the NTLMv2 hash has been obtained.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjZYXRMbw3_RhhuyeaEop7C2QWHFgG9FglCMKzMNvZ7wXgVmUhRvyIF_l3rggpvvyfhrPWY8Vf4TqtNY4mtrBbxOvcj5ZgUDb6uh65pT3sLgE3G2SCWlFfebJh4qrRBFjsuihr43Ng58qHjpqFhyXY2m70iKBsPxHGbc92Ry1tcDNTPlbfYNtMwXRYG0A/s16000/22.png"/></span></p>
<p><span style="color: #000000;">You can crack this hash using <strong data-start="146" data-end="157">hashcat</strong>, and you’ll notice it takes only 3 seconds, compared to 7 seconds in Attack 2—half the time it took before!</span></p>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHIJWbU_HHivcuyR4a9Ty3Qy51dThLvqpbzbaKWgdWykp6wOdVDP6SAKYddLYJrQuJd59a8UK4qF1pNOpd86sm5mLDaqEnFLxLZKXdhpMhIZGRxT8wdng7rkwLRdUHrl6MtLoNfDZBWeb_jFVTuQw--kquP7THTLV_TaADzSx6ebeCvM9eA7OJPgvNvw/s16000/23.png"/></strong></span></p>
<h3><span style="color: #800000;">Responder external IP poisoning</span></h3>
<p><span style="color: #000000;">Responder can be used to send LLMNR poisoned requests to the victim that contains another IP than the one we are currently using. It creates stealth and allows us to conduct more sophisticated attacks. This can be done using “-e” option</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">responder -I eth0 -e 192.168.1.2</pre>
<p><span style="color: #000000;"><strong> <img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhxl09uRWgufZvXGFjV4F1MEhiIRMZstEW9MlUYP6Wd1qQGmrXgqcHnzvXUwIAOeSS5FcfdEbb15XhI5JM4DKPuy9Azjb-HgZpNHKPcgR8I73jutGNDWxCcRicW3O1yMy3mfh0_d7MMdUGMfzVWkudltvqounStnk9_ocCU8riWEpQJZQkljFhSrgLWKw/s16000/24.png" alt="LLMNR Poisoning" width="469" height="629"/></strong></span></p>
<h3><span style="color: #800000;">Responder multi-relay: shell on a system</span></h3>
<p><span style="color: #000000;">Relaying is one of the most commonly used techniques used for credential access. A relay or forwarder receives valid authentication and then forwards that request to another server/system and tries to authenticate to that server/system by using the valid credentials so received. In Attack 1, we used an invalid SMB share to get hashes of the requesting system.</span></p>
<h5><strong><span style="color: #000000;">What if the requestor was Admin?</span></strong></h5>
<p><span style="color: #000000;">Sure, we can get his credentials and wait till hashcat cracks it or be smarter and use relay to forward this authentication on our desired host and gain shell on it directly!</span></p>
<p><span style="color: #000000;">To do that, lgandx has included a script called “MultiRelay.py” in /usr/share/Responder/tools folder. We need to install a few dependencies and build the supporting binaries that would run on the victim system and grant us a reverse shell.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">apt-get install gcc-mingw-w64-x86-64
x86_64-w64-mingw32-gcc ./MultiRelay/bin/Runas.c -o ./MultiRelay/bin/Runas.exe -municode -lwtsapi32 -luserenv                                                                                                         
x86_64-w64-mingw32-gcc ./MultiRelay/bin/Syssvc.c -o ./MultiRelay/bin/Syssvc.exe -municode
curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
python get-pip.py
pip install pycryptodome</pre>
<p><span style="color: #000000;"><strong> </strong>Once its done, we can run MultiRelay.py without any errors or warnings.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cd /usr/share/responder/tools
python3 MultiRelay.py</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiclVu9C20yW4shf3dcR6kX2OeHEPwrJKYA2MlLFh8Keuo809U7gvLRHx9gPUbh-kTOPsd0fTZKEQvYgEiSEFZI9UKX1ACjrAL3P-ayg2l1kOgzgH4E_m6skzGh7oKra4i8ITjcZvfk6S5iUe8yRu0iP0jniDfWYEeuaiFV3DzhyK4s15jmKe5X5MD5vg/s16000/25.png"/></span></p>
<h5><span style="color: #000000;"><strong data-start="1906" data-end="1946">Executing the Relay for Shell Access</strong></span></h5>
<p><span style="color: #000000;">Now, first criteria for this attack to work with SMB is that SMB signing has to be disabled. It is disabled by default so that checks our ease to exploit. It can be tested using the nmap script smb-security-mode</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nmap -p445 --script=smb-security-mode 192.168.1.3</pre>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjlrXdd01W44BylxgFDszgZzY7s_AadUOWiwWxzZpLDuw8GSrYXTI7J0FfX5RYyD6VGp_ip4IOdL0HKoZCtncpxgI0MeNxAuitzoVzrYe_9zJ7u1-3GQd3CedMw-gLpADeKorZ2smWWJ9dI9HFRq0bZavAY4ap1aiI76hbhk4F4JNWBPDexBHh0Nh206w/s16000/26.png" alt="LLMNR Poisoning" width="553" height="350"/></span></p>
<p><span style="color: #000000;">As you can see, SMB signing is disabled so the coast is cleared. We can run MultiRelay now. To run it we need to specify the target using “-t” and “-u” specifies users to which relay is to be forwarded. You can choose selectively too and create lesser noise in network.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python3 MultiRelay.py -t 192.168.1.3 -u ALL</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjZS7_orMHDvH0Ct64Qldv-js4GPXBBopDv0E5JyT4fgy0ojvQ9rBx1dyPHl1N7m80iPjpJLnpcQdOu4UKg3GaFQ6I2BMDoQU4wNHtKFNFkiHHogt8HY_IIa7gisJm1zhkovgcRikDc2utV4w0rL4OaiMADFowNPrYyuj0IOx0TRTuyPg0NfUVnt4v3pg/s16000/27.png"/></span></p>
<p><span style="color: #000000;">As you can see above, the script has detected my victim’s OS, computer account name (workstation01) and SMB signing status too. One other thing to note here is that this script is using HTTP and SMB ports. So, to prevent any conflict, we need to turn these servers OFF in responder.conf file. We just open the file in /usr/share/responder/Responder.conf and turn off HTTP and SMB. If done properly, when we launch responder next time, an OFF switch like this shall be there.</span></p>
<p><span style="color: #000000;">Now, as per Attack 1’s methodology, we run responder</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">responder -I eth0</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQ94WfyBjVthLSbN5RPjcE9ey4fOg7AgbUfyHkTs-vZXUGEexUGpLex01jw-kMuF69RUZJ4of-COrrzpNc8RApKEr-G4Q5ZITwLAljee8TfAQV8Xy-MHSNrdMwYTNPbxo-WBXXVFoTqhaRINvTBHJLt4wSbtXcsFreljTJM-5XTJq0UzFOMguVr54FLg/s16000/28.png"/></span></p>
<h5><strong><span style="color: #000000;">Triggering the Shell via Administrator Access</span></strong></h5>
<p><span style="color: #000000;">Now, an administrator tries to open a shared drive. He is unsuccessful as the share wowowow doesn’t exist! So, responder intervenes and poisons requests successfully.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiMrGlExC9rQTSvLwabDnDRRzVY6cw0yWhoo1VHh520n75ymi5OBwTNvDw_L2wYEXphQTHASufInSVGMg43RW-_flsxP0kjhevjHFLocPRUoi0srZfVAxDZZSGODsm_W9qd_oi9TuQGPCDsxn9Hv9bzUMlpDqAVewoUF-qQ7FfTXzKc22NgWa_l9T3wSQ/s16000/30.png" alt="LLMNR Poisoning" width="879" height="274"/></span></p>
<p><span style="color: #000000;">Now, in Attack 1, we had SMB server running in responder, so the victim authenticated to us and we were able to see creds. Here, SMB relaying is setup in MultiRelay.py, so that credential is now forwarded to our victim “192.168.1.3” and we gain a shell successfully on it! We received an NT AUTHORITY privilege too. This is possible because Admin had required rights on the C$ and the binary we compiled earlier was upload, ran and gave us a great shell. It could be done to gain access to a lower priv account too.</span></p>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj6oqfv1PAvzvSEcz3VlBnc1is2iWc1MnpN5oHwIO1dlBtXwQ-PyZcAWzkNsZQopJhnszKkngRn7p9Seop1y8p-8hf9zVSDsxBuQjIfO4uZCL5UZdS-E-Sy2ZmEFyqR_GK6LkqdglWkIJJgZq6WHHDq7aYPfiMMMaw7kZ0QBk20SCT54zhc4VJWgageww/s16000/31.png"/></strong></span></p>
<h3><span style="color: #800000;">Responder DNS injection in DHCP response</span></h3>
<p><span style="color: #000000;">In cases where DHCP identifies the IP hosting an SMB drive, like <strong data-start="65" data-end="74">“wow”</strong> (refer to attack 1), <strong data-start="96" data-end="109">Responder</strong> can also inject a rogue DNS record into DHCP responses.</span></p>
<p><span style="color: #000000;">Responder has a rogue DNS server set up. Basically, any victim trying to access a false shared drive tries to resolve the name by finding the correct DNS server. DHCP tries to resolve the IP by locating correct DNS server. It sends out a request. Responder replies to the DHCP request and injects its own DNS server IP in the DHCP response successfully poisoning the DHCP response. Victim receives this, sees our DNS server IP and tries to access the share “wow” by connecting to us. Victim now authenticates to our rogue DNS server rather than discarding the query.</span></p>
<p><span style="color: #000000;">The DHCP-DNS injection can be set up using “-D” option:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">responder -I eth0 -D</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhGAi6-2EZiRxVZD0edpvgVSGMFzKjrn8fkYNTBTf7XNcEL4-PyiUAMCnhl3tpO6AK4X5MdEn_Kg0ZkDXH1XKlOSai0O4KWdFUCfCmwf5-yQd3lDH9PeeYPrrmP6C64hWtSObcaAYBJgTYfKtyTOeGHxIPigaxXKbYKGD3C-MusyOYUMU1Ty1ukQhtMmg/s16000/32.png"/></span></p>
<p><span style="color: #000000;">When the victim accesses any invalid share, a prompt is now visible.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh-QRSQZRMgH4EQjLj8iNp5nE1K65eCbVLMZAWcbZXJ1eQToafQxy5KOVrZ_pd_Je4SOs3R-IfSR-vGgitlG5F2kUTNtI4vytnULvpEYBT72VcX4qNxDXwgZbKRVCJLzDM93juyn-h2ROzmWC1CNYgGfjXyu1xYK98mCA0Jk80me6XN8Ray3KJLSqV0eA/s16000/33.png" alt="LLMNR Poisoning" width="553" height="469"/></span></p>
<p><span style="color: #000000;">NTLM hashes have now been successfully retried by injecting our rogue DNS server IP!</span></p>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi3xw7MXhlS5Z-M8sQOEMmfWbW2vXcs9B34Pf5117cldu1Bip4-zC83sU5lOP4Pxqu8ri1SKQSHQhvrUCcACg3vP7LG7_XkNVOihzZNU8uwCHCwKyOmYdv46pageoUKD4qzhdLUYixux7mW8b3e1i_KwLxYSl4u0n4dX617fRi5epS4URio_fmC01Xqkw/s16000/34.png"/></strong></span></p>
<h3><span style="color: #800000;">What are these servers in responder?</span></h3>
<p><span style="color: #000000;">The Responder supports multiple servers, as shown in the screenshot below. These are rogue servers that may facilitate one or more attacks.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgY_PjzTPMfohz3HOZrWECnYG-OlJqy_WnRCcoJUbwBWJT1HG7-ncCMRx20T3OU1Rx2g9O9q2AB6OhmowStCObl4u7V-F-U6cwjWVA9FBb9s5oCD0nyRGuZk_ghUjeXHaC98H-dQFcmGPn1RFL-22Kq2m43yZlvwCospGGn3sjks3QI0_H8xkBNz2xlFg/s16000/35.png"/></span></p>
<p><span style="color: #000000;">Upon an nmap scan, we see that the servers are operable</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiguHEOuJnl6XOUTBeWSt2Xsa9qdhDEh4kEEDzRH9Eg1duhQ0Lil2YEA1sRKIGd5ZsB8DIk4MZFElX6ObvgQM5mh4L_dwHbSP5FzqCXu2o2MBV_ladn4MQ0-j62jzYUOEPCEzHEtgGLIO57F65b-BxXOd67ORZc71RXR4b5n3twJfCtpEZKeaf2yyKZFw/s16000/36.png" alt="LLMNR Poisoning" width="600" height="623"/></span></p>
<p data-start="0" data-end="183"><span style="color: #000000;">For example, in the demo above, the attacker needed a DNS server IP. To achieve this, <strong data-start="86" data-end="99">Responder</strong> created a rogue DNS server and added its own IP to facilitate DHCP-DNS poisoning.</span></p>
<p data-start="185" data-end="342"><span style="color: #000000;">Similarly, the SMB server captures the authentication credentials of a victim directly when the victim accesses a share on the attacker’s Kali machine, like:</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgrgbLuU0bou4CMn2lgobA8vdnMAK9vU3PUOYV918OToMGiZebQ966PtniACFQ4uzAxhD9FQ4SpjgLalrGisMkMa7QiEJt8vCuH9MRFcPQ-8Q8FZuSUzAff1WzzIEBxB25kLkUwyXsB86aVMs1A4I2iyZp4I32hWVVsw8Ud0yHGv6N8Gr3_RVaSiaxz0w/s16000/37.png"/></span></p>
<h5><strong><span style="color: #000000;">Responder successfully captures the NTLM hashes</span></strong></h5>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh7jtGkMq1FmySw4rh-Js1jambvGCe2z0mGnPt9PpTYDL8EqMc6o4qA8Rigc7XBlce2zyfMN8RBLrkTzzzffVElbvOxk6nTeMpxxlbJjVjRDMFg-_MUL_W8u3g1ZDxkGdDTcm63bV9hr7M8B-QE_jBxHCw2zd8whxifyekhv860C8cvGMbQ82uKUfXRWw/s16000/38.png"/></span></p>
<p><span style="color: #000000;">An FTP server is also given here. Let’s try and access it via victim’s browser</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg3DcxZkIASNlg-89jeotdSe4A8ki2ZN5jx0C-OIqe50lSaAN-rMUtJr60vRnkLHOH_wJeZhTlxWdZDY3tiX9iX6iJOoPsS7SKee9pcGOIBsl2gpCezG-Ii3YaLR_7UZ55tI7DWAfm2yie1GsfLGxRTebOesLXF38TT8LjJZWZbxe16ridGpJajF9kaNw/s16000/39.png"/></span></p>
<p><span style="color: #000000;">As you can see, the attacker obtains anonymous credentials. Additionally, when you access it with a browser, you can provide a valid username and password, which the attacker then captures in clear text.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhfsXQwN6GIRnGZ-LXS9VxRrOSf5lQkiKU4TWYsnvq1DZ4bIlLCboK5eaePGQzUI7OGk5zmbATJ95lUDthRDmFbbQDBhqRrehaTeVuzR8ZOPWdpklaQpgT1N1DW_XQuYq_R2DiDHbxZ1ztaHqYCCH9Okb03BiQs0YqVnR14XSalLsiw81TIO1ORf9hX8g/s16000/40.png"/></span></p>
<p><span style="color: #000000;">An RDP server is there as well. Lets access it using victim’s machine</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgJaXg9Vgv6HpLbSTzaaJcblhBpHclQe-3E8P8monGTJJew4aHcxyQdcYD5X6TbZfVHWM58YQ_10HdMhgenXLXlkUnPIo_m8dQKMF-QlvmO_SlT9GQVYPG26T-VmShmEPK_XaXfvgACMvT5kMCMfWsuAlfSRcMGDaQJiwNv4RkARlP7jeGLpLat4VteLQ/s16000/41.png"/></span></p>
<p><span style="color: #000000;">Upon entering the credentials, we receive the NTLMv2 hashes associated successfully</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgcWxrK-g5nK_IS-JKsfAt0r96kFAo2Lq5kiQo7FMqvDhBfgTnv3cED_BrjfXgK8I7fDPtj0sfmeU1fzmIxirJRwgm_UUvYk4lBCndlvbjp3zALJ_4iabB44TbUgjIDE95EcDhtTY5waXs-o2iU8kK7vLCp7wiM8s3UI5cn6XST2nmOvqAiIshzJ3ITzg/s16000/42.png" alt="LLMNR Poisoning" width="867" height="256"/></span></p>
<p><span style="color: #000000;">And a WinRM server is also given. It is a protocol use for powershell remoting. So, if a victim connects to this rogue WinRM server like this:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">New-PSSession -ComputerName 192.168.1.4 -Credential (get-credential)</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgAFF7ugiFHTrNun9WPmYKGrA78NF7_MYuRGAcm6VNWE29XL2icnFNEIc9queAx9yKC8E_ubbSzEKRgJyXp3OaeYKiHQGz6iwNvTW4oMxW_yaIMWahUHE8mfOG32OOHIuGg5f6bsuxvdWLrO0GjVni-abFMwcWCEbvle_iyDJuMpYdVxa9C8GIlRhJd5A/s16000/43.png"/></span></p>
<p><span style="color: #000000;">A hash is therefore obtained!</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjCMbZ3dtvQlgIYIDgZXdUmglyMJPS1x9VPEr-_UY9V0jJHkpo5hXVj_XB_HEQByrT1fMlFuwnJ26GWOVCEizhoWJrQVsPeO42yuU4ztLKCj4M8Tpy4IO-kP-Ee_KhUVC8m1dYqV9k1isAn5t46amZoUO-0DmVXSP7tCpr5B8prutfSzMi70jVRTlJtjg/s16000/44.png"/></span></p>
<p><span style="color: #000000;"><strong>WHATS THE POINT? </strong>Often in pentest scenarios, to conduct lateral movement, we need to compromise credentials. Sending in malicious attachments with links to our rogue servers may fool a user into authenticating and hence, give us his credentials. Alternately, we can us relaying (Impacket’s toolkit) to conduct various other attacks. For example, in <a style="color: #000000;" href="https://www.hackingarticles.in/lateral-movement-webclient-workstation-takeover/">this</a> article, we have conducted LDAP relaying using impacket’s ntlmrelay script and poisoning using responder in order to take over workstations.</span></p>
<h3><span style="color: #800000;">Recommendations</span></h3>
<p><span style="color: #000000;">To prevent the attacks demonstrated above, we recommend the following actions:</span></p>
<ul>
<li><span style="color: #000000;">Turn off LLMNR and NBT-NS in computer policy-&gt;computer configuration-&gt;admin templates-&gt;network</span></li>
<li><span style="color: #000000;">If an organization can’t turn it off, they must put network access control</span></li>
<li><span style="color: #000000;">Use strong user passwords.</span></li>
<li><span style="color: #000000;">To mitigate the WPAD attack, you can add an entry for “wpad” in your DNS zone, which prevents sending any LLMNR.</span></li>
<li><span style="color: #000000;">Use SMB signing to prevent SMB relay attacks</span></li>
</ul>
<h3><span style="color: #800000;">Conclusion</span></h3>
<p><span style="color: #000000;">Additionally, the article describes various useful attacks that you can perform with the help of <strong data-start="97" data-end="110">Responder</strong>. The developers coded the tool in Python, which makes it platform-independent. Red teamers heavily use this tool to conduct lateral movement. The article aims to serve as a ready reference when it comes to using a responder in pentest scenarios. Hope you liked the article. Thanks for reading.</span></p>
<p><span style="color: #000000;"><strong>Author: Harshit Rajpal </strong>is an InfoSec researcher and a left and right brain thinker. Contact</span><strong><span style="color: #000000;"> </span><a class="broken_link" href="https://in.linkedin.com/in/harshit-rajpal-79bb43103">here</a></strong></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
<!-- YARPP Thumbnails -->
<h3>Related posts:</h3>
<div class="yarpp-thumbnails-horizontal">
<a class="yarpp-thumbnail" rel="norewrite" href="https://www.hackingarticles.in/a-detailed-guide-on-log4j-penetration-testing/" title="A Detailed Guide on Log4J Penetration Testing">
<span class="yarpp-thumbnail-default"><img src="https://www.hackingarticles.in/wp-content/plugins/yet-another-related-posts-plugin/images/default.png" alt="Default Thumbnail" data-pin-nopin="true"/></span><span class="yarpp-thumbnail-title">A Detailed Guide on Log4J Penetration Testing</span></a>
<a class="yarpp-thumbnail" rel="norewrite" href="https://www.hackingarticles.in/a-detailed-guide-on-wfuzz/" title="A Detailed Guide on Wfuzz">
<span class="yarpp-thumbnail-default"><img src="https://www.hackingarticles.in/wp-content/plugins/yet-another-related-posts-plugin/images/default.png" alt="Default Thumbnail" data-pin-nopin="true"/></span><span class="yarpp-thumbnail-title">A Detailed Guide on Wfuzz</span></a>
</div>
</div>
            </div><!-- .entry-content -->
            <footer class="post-footer entry-footer">
                                                
            </footer><!-- .entry-footer -->
            
	<nav class="navigation post-navigation" aria-label="Posts">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://www.hackingarticles.in/a-detailed-guide-on-cewl/" rel="prev">A Detailed Guide on Cewl</a></div><div class="nav-next"><a href="https://www.hackingarticles.in/a-detailed-guide-on-amsi-bypass/" rel="next">A Detailed Guide on AMSI Bypass</a></div></div>
	</nav>        </div>
