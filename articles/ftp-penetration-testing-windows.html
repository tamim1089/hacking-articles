<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">FTP Penetration Testing on Windows (Port 21)</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/ftp-penetration-testing-windows/" rel="bookmark"><time class="entry-date published updated" datetime="2017-09-12T11:04:43+00:00">September 12, 2017</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Today we are sharing tips and tricks on FTP attacks and security through FTP penetration testing which will help to secure your server from any kind FTP attack.</span></p>
<p><span style="color: #000000;">FTP stands for <strong>File Transfer Protocol</strong> used for the transfer of computer files such as docs, PDF, multimedia and etc between a client and server on a computer network via port 21. Port 21 is default port which gets open when FTP is activated for sharing data.</span></p>
<p><span style="color: #000000;"><strong>Let’s start!!</strong></span></p>
<h3><span style="color: #800000;"><strong>Install &amp; Configure FTP Server on Windows 7</strong></span></h3>
<p><span style="color: #000000;">Firstly we are going to set up the FTP server on our Windows 7 for sharing the file in a LAN. In order to accomplish that we are going to open <strong>Control Panel</strong> &gt;<strong>Programs</strong> &gt;<strong>Programs and Features</strong> &gt;<strong>Turn Windows features on or off</strong> as shown below.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-EfQ9uoDX-_4/Wbe09LieT6I/AAAAAAAARU0/N22TxRRHHR4m_QR7BE0sDtTKyfeHSfD2QCLcBGAs/s1600/1.png"/></span></p>
<p><span style="color: #000000;">Here Expand <strong>Internet Information Services</strong> and check the <strong>FTP Server</strong> option.</span></p>
<p><span style="color: #000000;">Also, ensure that <strong>FTP Extensibility</strong> and <strong>FTP Service</strong> are both checked as shown below and click OK to begin Installation.</span></p>
<p><span style="color: #000000;">This Installs the IIS and FTP Service Manager, be patient it might take some time.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-WWrmC_5ZNlo/Wbe0-r9CnfI/AAAAAAAARVU/TMsCEoFs-Ck1aLU1dRje0Ta9Qi-OfO6QQCLcBGAs/s1600/2.png"/></span></p>
<p><span style="color: #000000;"><strong>Configure FTP Site in IIS</strong></span></p>
<p><span style="color: #000000;">Now to open <strong>IIS</strong>, we will open <strong>Control Panel </strong>after then select <strong>System and Security</strong> and here we will open <strong>Administrative Tools</strong>. In <strong>Administrative Tools</strong>, you will find <strong>IIS Manager</strong> as shown below, open it.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-XFkz2TUbkAU/Wbe1A9Sov3I/AAAAAAAARWA/WRPGbON-XHE2pTxbini7tcN4oIT9edd0wCLcBGAs/s1600/3.png"/></span></p>
<p><span style="color: #000000;">The new window of Internet information IIS Manager will come up; right-click <strong>Sites</strong> given in left panel under <strong>Connections</strong>, select <strong>Add FTP Site</strong>.</span></p>
<p><span style="color: #000000;">This will open a new window as shown below.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-ImallBWOZwI/Wbe1BCtX6wI/AAAAAAAARWI/M5VwyTcpblAg15FfT9aWj0xecDaupmENwCLcBGAs/s1600/4.png"/></span></p>
<p><span style="color: #000000;">Enter the name of the FTP site of your choice, as shown in given image<strong> ignite</strong>.</span></p>
<p><span style="color: #000000;">Enter the path to the FTP folder you want to use to send and receive files. In our case, we created a folder named ftp in location <strong>C:\ftp.</strong></span></p>
<p><span style="color: #000000;">And click next.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-xTp4WF_Q8Po/Wbe1BalzbxI/AAAAAAAARWM/h9zcytJ-EFs-YzZkZL8G6nmvB6u1x46WACLcBGAs/s1600/5.png"/></span></p>
<p> </p>
<p><span style="color: #000000;"><strong>Binding and SSL Settings</strong>, we will bind our IPv4 address to the server by allowing following setting then click on next.</span></p>
<ul>
<li><span style="color: #000000;">Enter <strong>IP:</strong>192.168.1.128 and <strong>Port: </strong>21.</span></li>
<li><span style="color: #000000;">Enable the checkbox for Start FTP site automatically</span></li>
<li><span style="color: #000000;">In SSL option select <strong>No SSL</strong> and click next.</span></li>
</ul>
<p><img decoding="async" src="https://4.bp.blogspot.com/-4HpxX0ep-yA/Wbe1BkG9iNI/AAAAAAAARWQ/cRIZ2kvS-pUgSCTmT4oDM-EpB8uhwZvPACLcBGAs/s1600/7.png"/></p>
<p> </p>
<p><span style="color: #000000;">Allow following setting in <strong>Authentication</strong> <strong>and Authorization </strong>for your FTP site and then click on Finish.</span></p>
<p><span style="color: #000000;"><strong>Authentication:</strong> Basic</span></p>
<p><span style="color: #000000;"><strong>Authorization:</strong> specific users (pc7)</span></p>
<p><span style="color: #000000;"><strong>Permission:</strong> read and write</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-6bNox5PLzFM/Wbe1BmpcuDI/AAAAAAAARWU/NWTny6h-7DYb7Umh7Ne2lqo58-UOCNj3wCLcBGAs/s1600/6.png"/></p>
<p><span style="color: #000000;">From the given image, you can see we had successfully configured an FTP server for Ignite. Now let’s try to connect with it for sharing files.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-XGFvpbWwTK0/Wbe1B9IPBvI/AAAAAAAARWY/-g5dRWdCo5Qmgis7xi6SxC6EHQ84eS6mgCLcBGAs/s1600/8.png"/></span></p>
<h3><span style="color: #800000;"><strong>Scanning FTP with nmap</strong></span></h3>
<p>An attacker may take help of nmap to verify whether port 21 is activated or not. For FTP penetration, we are also using nmap in order to scan the targeted system (192.168.1.128) for open FTP port.</p>
<pre class="lang:default decode:true">nmap -p 21 192.168.1.128</pre>
<p>If file transfer service is allowed then nmap will show OPEN as a state for port 21, as shown in the given image.</p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-_nX1NufWQSA/Wbe09Jsk8EI/AAAAAAAARUw/5RrQ7C-PT8s5jE9n0lSMCuc6D1rXyKtNACLcBGAs/s1600/10.png"/></p>
<p><span style="color: #000000;"><strong>Connect client to FTP Server through WinSCP</strong></span></p>
<p><span style="color: #000000;"><strong>WinSCP</strong> is a free software which is used to access the FTP server. You can download it from <a href="https://winscp.net/eng/download.php">here</a>.</span></p>
<ul>
<li><span style="color: #000000;"><strong>Protocol to: </strong>FTP</span></li>
<li><span style="color: #000000;"><strong>Encryption To: </strong>No Encryption</span></li>
<li><span style="color: #000000;"><strong>Hostname: </strong>IP of the FTP Server</span></li>
<li><span style="color: #000000;"><strong>Port:</strong> 21</span></li>
<li><span style="color: #000000;"><strong>Username and Password: </strong>Windows login credentials of the user<strong>.</strong></span></li>
</ul>
<p><span style="color: #000000;">Click on <strong>Login</strong>.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-YJg5tuPF0FM/Wbe1CCPgMgI/AAAAAAAARWc/OSSFjLSNvtgwp605sLLuwAZlJ_NnPJZCACLcBGAs/s1600/9.png"/></span></p>
<p><span style="color: #000000;">As you can see I have successfully connected to my FTP server which has a file called demo.txt.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-QIQ-l0vhmwM/Wbe09F2TgWI/AAAAAAAARU4/98-9RmtZ_HseUiY9C31BmkFcc8i6zYlrQCLcBGAs/s1600/10.2.png"/></span></p>
<p> </p>
<h3/>
<h3><strong style="color: #800000;">Version Enumeration on FTP</strong></h3>
<p><span style="color: #000000;">Now, let’s try to get the FTP version through ftp_version on <strong>Metasploit</strong></span></p>
<p><span style="color: #000000;">Open the terminal in your Kali Linux and Load Metasploit framework now type the following command to scan for FTP version.</span></p>
<pre class="lang:default decode:true">use auxiliary/scanner/ftp/ftp_version
msf auxiliary(ftp_version) &gt; set rhosts 192.168.1.128
msf auxiliary(ftp_version) &gt; exploit</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-rGbVQiepJcI/Wbe09kI5vWI/AAAAAAAARU8/h4a2ioSHT8YW3rA5zVxbSeuPGLUjJvOOwCLcBGAs/s1600/11.png"/></span></p>
<h3><span style="color: #800000;"><strong>Hiding Banner </strong></span></h3>
<p><span style="color: #000000;">Open IIS Manager.</span></p>
<p><span style="color: #000000;">Click on <strong>Features View</strong> has given in the bottom of the window.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-8v71SDS3coU/Wbe09qSOZ-I/AAAAAAAARVA/rfkkMV8CJvswEvQbsjkwWGhzYMsma6elACLcBGAs/s1600/12.png"/></span></p>
<p><span style="color: #000000;">A new window for FTP messages will come up where you can change Message Behavior.</span></p>
<ul>
<li><span style="color: #000000;"><strong>Enable</strong> suppress default banner</span></li>
<li><span style="color: #000000;"><strong>Enable</strong> Show detailed messages for local request</span></li>
</ul>
<p><span style="color: #000000;">Now let’s check if our FTP version is still visible or not.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-52ee3b3_ISo/Wbe090ITScI/AAAAAAAARVE/m6Blg5Ko2TU-LsV7ofbsTPp19x0tAUbzQCLcBGAs/s1600/13.png"/></span></p>
<p><span style="color: #000000;">You can verify it by executing following command in Kali Linux for NMAP version scan.</span></p>
<pre class="lang:default decode:true">nmap -p 21 -sV 192.168.1.128</pre>
<p><span style="color: #000000;">As you can see that our FTP version is no longer visible to anybody.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-AmKz7Mccs4Y/Wbe0-a96kHI/AAAAAAAARVM/zmTCRZPs5V4Y_Qa_5qy_bAQgt1uUv5m1QCLcBGAs/s1600/14.png"/></span></p>
<h3><span style="color: #800000;"><strong>FTP Brute force Attack</strong></span></h3>
<p><span style="color: #000000;">Let’s try to make Brute force attack on our FTP Server using Metasploit.</span></p>
<p><span style="color: #000000;">Open the terminal in your Kali Linux and Load Metasploit framework now type the following command to Brute force FTP login.</span></p>
<pre class="lang:default decode:true">use auxiliary/scanner/ftp/ftp_login
msf auxiliary(ftp_login) &gt; set rhosts 192.168.1.128
msf auxiliary(ftp_login) &gt; set user_file /root/Desktop/user.txt
msf auxiliary(ftp_login) &gt; set pass_file /root/Desktop/pass.txt
msf auxiliary(ftp_login) &gt; set stop_on_success true
msf auxiliary(ftp_login) &gt; exploit</pre>
<p><span style="color: #000000;">From the given image, you can observe that our FTP server is not secure against brute force attack because it is showing the matching combination of username and password for login. So let’s protect our FTP server against Brute force.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-j5AnBDxBi10/Wbe0-Ml_miI/AAAAAAAARVI/SjcV0xrrljQcvFZI14dfEb1_AMw0DLcfACLcBGAs/s1600/18.png"/></span></p>
<h3><span style="color: #800000;"><strong>Secure FTP server against Brute Force Attack</strong></span></h3>
<p><span style="color: #000000;">Open IIS Manager</span></p>
<p><span style="color: #000000;">Now open <strong>FTP IPv4</strong> <strong>Address and Domain Restrictions</strong>. Here we are going to <strong>allow </strong>only a particular <strong>IP address</strong> to access the FTP server. This will allow only valid IP to get connect with FTP.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-HalSIluzPw0/Wbe0-oo4pZI/AAAAAAAARVQ/wBZCl9gJB74CHr6JL_9tPYOZykagU0LXQCLcBGAs/s1600/19.png"/></span></p>
<h3><span style="color: #800000;"><strong>Allow specific IP to connect FTP</strong></span></h3>
<p><span style="color: #000000;">Now following given below step:</span></p>
<ul>
<li><span style="color: #000000;">Click on <strong>FTP IPv4 Address and Domain Restrictions</strong></span></li>
<li><span style="color: #000000;">Click on <strong>Add Allow Entry</strong> from the <strong>Actions</strong> Tab in the right panel</span></li>
<li><span style="color: #000000;">Select <strong>Specific IP Address</strong> and enter the IP address</span></li>
<li><span style="color: #000000;">Click OK</span></li>
</ul>
<p><span style="color: #000000;">Here you can also add a range of IPs of your network.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-weSh8Ho2jr8/Wbe0-wBwueI/AAAAAAAARVY/CGFd9Hy0RiMd18AZVFG3_wbmR2sniW49QCLcBGAs/s1600/20.png"/></span></p>
<h3><span style="color: #800000;"><strong>Restrict IPs to connect FTP</strong></span></h3>
<p><span style="color: #000000;">Now repeat the step with some changes to restrict other IPs for denying to access FTP services. </span></p>
<p><span style="color: #000000;">Now following given below step:</span></p>
<ul>
<li><span style="color: #000000;">Click on <strong>FTP IPv4 Address and Domain Restrictions</strong></span></li>
<li><span style="color: #000000;">Click on <strong>Add deny Entry</strong> from the <strong>Actions</strong> Tab in the right panel</span></li>
<li><span style="color: #000000;">Select <strong>Specific IP Address</strong> and enter the IP address</span></li>
<li><span style="color: #000000;">Click OK</span></li>
</ul>
<p><span style="color: #000000;">Hence if any other user or attacker finds out credential for FTP login he cannot able to connect with the server.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-WdfYHGGH1Zw/Wbe0_HHXY6I/AAAAAAAARVc/TQtayDcovj8feAzO-ZmPlEuEbhDViFgUgCLcBGAs/s1600/21.png"/></span></p>
<p><span style="color: #000000;">Let’s verify above setting by Brute force again in the same way we did before. From the given image, you can observe though it is showing <strong>incorrect</strong> combination <strong>for correct credentials</strong> also.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-U1avIhum20s/Wbe0_Vm2N5I/AAAAAAAARVg/vKLasM7vmF4wmC4VlLvS22XqSRdJ68VMACLcBGAs/s1600/22.png"/></span></p>
<h3><span style="color: #800000;"><strong>FTP Port Transfer</strong></span></h3>
<p><span style="color: #000000;">You can forward port 21 on another port for increasing server security although to perform this you need to open IIS.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-b6M42R2-sIM/Wbe0_Q8rnCI/AAAAAAAARVk/fESlJc82qYYNLh4zgP_e9g_Wa54JE-FHQCLcBGAs/s1600/23.png"/></span></p>
<p><span style="color: #000000;">Now click on the <strong>Bindings</strong> on Actions Tab.</span></p>
<p><span style="color: #000000;">It will open a window as shown below where it is showing that FTP service is activated on port 21, now click on edit to replace this port into another.             </span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-n9lQZ4ONxNQ/Wbe0_nC8riI/AAAAAAAARVo/_IO1RwYS3xcNekJo49oUEqcxo5aThegVQCLcBGAs/s1600/24.png"/></span></p>
<p><span style="color: #000000;">From the given image you can see we have are now using <strong>port 5000</strong> for FTP services.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-NyZ-_qSPbzM/Wbe0_9D60eI/AAAAAAAARVs/YAZEHpcjUyU59oj26ho_4ACjVo3_ydw5gCLcBGAs/s1600/25.png"/></span></p>
<p><span style="color: #000000;">Now let’s check using nmap</span></p>
<pre class="lang:default decode:true">nmap -p 5000 -sV 192.168.1.128</pre>
<p><span style="color: #000000;">As you can see the FTP service has been shifted to port 5000</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-UqFWKlrHbrw/Wbe0_zq9YcI/AAAAAAAARVw/1ajmtBsouCM-PLiA35KLo7imldHg3VL0ACLcBGAs/s1600/26.png"/></span></p>
<p><span style="color: #000000;">Now to verify if the service is actually running on port 5000 let’s login into FTP server using WinSCP and this time using port 5000 as shown below</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-J6wbo3l8jdE/Wbe1AFmRomI/AAAAAAAARV0/MyBSZgG0JLUqGj4Yb-WZkFSZr0eIXvwEACLcBGAs/s1600/27.png"/></span></p>
<p><span style="color: #000000;"><strong>Great!!!</strong> We are successfully connected with FTP server via port 5000</span></p>
<p><span style="color: #000000;"><strong><img decoding="async" src="https://2.bp.blogspot.com/-mDJVCVKIod0/Wbe1AUYSaJI/AAAAAAAARV4/W7K4ArWpyzobH9eO9raxcIYY2KITrjk2QCLcBGAs/s1600/28.png"/></strong></span></p>
<h3><span style="color: #800000;"><strong>FTP Log Monitoring  </strong></span></h3>
<p><span style="color: #000000;">In IIS Manager we can also manage Logs of our FTP Server. </span><span style="color: #000000;">Here, we can Schedule the Logging and also manage the size of logs and Location of Logs </span><span style="color: #000000;">For monitoring ftp log follow given below steps:</span></p>
<p><span style="color: #000000;"><strong>Open</strong> FTP Logging in the <strong>Features View</strong>.</span></p>
<ul>
<li><span style="color: #000000;"><strong>The format of the log file</strong>: click on the W3C field and then select the desired option such as date, time, client IP and etc.</span></li>
<li><span style="color: #000000;"><strong>Directory:</strong> browse a location where you want to save the logs</span></li>
<li><span style="color: #000000;"><strong>Schedule:</strong> Daily</span></li>
</ul>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-Mah3PBRnAZ4/Wbe1AWfWQOI/AAAAAAAARV8/7U2mE-F4qaciwq78_SvAC253J8awdqs3QCLcBGAs/s1600/29.png"/></span></p>
<p><span style="color: #000000;">Now if you want to view logs of FTP server you can open the directory which you have browsed for saving logs i.e. <strong>C:\inerpub\logs\Logsfiles</strong></span></p>
<p><span style="color: #000000;">From given below image you can observe logs for FTP login.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-7Vp9C8HVW2s/Wbe1A6XmPwI/AAAAAAAARWE/FxcXpjfOM_EfbajL6vqu6E2TSonykLUqQCLcBGAs/s1600/30.png"/></span></p>
<p><span style="color: #000000;"><strong>Author:</strong> Pavandeep Singh is An <strong>Ethical Hacker</strong>, <strong>Cyber Security Expert, Penetration Tester,</strong> India. Contact <a href="https://www.linkedin.com/in/pavandeep-singh-6b1074132"><strong>here</strong></a></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
