<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/credential-dumping/" rel="category tag">Credential Dumping</a></span>            </div>
            <h1 class="post-title entry-title">NTLM Downgrade Attack: Internal Monologue</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/ntlm-downgrade-attack-internal-monologue/" rel="bookmark"><time class="entry-date published" datetime="2021-05-15T17:56:49+00:00">May 15, 2021</time><time class="updated" datetime="2025-05-10T19:53:53+00:00">May 10, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">In this article, it’s time to explore the scenario where the attacker wants to extract the hash or credentials of the target user but cannot use Mimikatz or any other noisy tool. We call this attack a Downgrade Attack because the attacker downgrades the version of NTLM to extract the hash.</span></p>
<h3><span style="color: #800000;"><strong>Table of Content</strong></span></h3>
<ul>
<li><span style="color: #000000;"><strong>Introduction</strong></span></li>
<li><span style="color: #000000;"><strong>Exploitation</strong></span></li>
<li><span style="color: #000000;"><strong>PowerShell Empire Exploitation</strong></span></li>
<li><span style="color: #000000;"><strong>Decryption of Hash</strong></span></li>
<li><span style="color: #000000;"><strong>Conclusion</strong></span></li>
</ul>
<h3><span style="color: #800000;"><strong>Introduction</strong></span></h3>
<p><span style="color: #000000;">While performing Red Team Operations, it is possible to come across a scenario where the attacker cannot use Mimikatz. This can happen because almost all Antivirus or Malware software will detect the presence of Mimikatz as soon as it lands on the target machine. In such cases, the attacker can perform the Internal Monologue Attack. To carry out this attack, a tool is required that was developed by <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://twitter.com/elad_shamir">Elad Shamir</a></strong></span> from Missing Link Security.</span></p>
<p class="" data-start="631" data-end="1148"><span style="color: #000000;">Being familiar with the Windows Security Mechanism, you may already know about NetNTLM.</span></p>
<p class="" data-start="69" data-end="519">NetNTLM is a challenge-response-based protocol that Windows uses whenever it cannot apply Kerberos-based Authentication. In this method, the server sends an 8-byte challenge, using the NTLM hash as the key to the user. The hash is an MD4 hash of the user’s password. Two versions of NetNTLM exist, and both are vulnerable. Version 1 of NetNTLM was introduced quite a while ago and is disabled by default today.</p>
<h4 data-start="1166" data-end="1198"><span style="color: #000000;">The NTLM Downgrade Attack Process</span></h4>
<p class="" data-start="1150" data-end="1623"><span style="color: #000000;">In general, the attacker previously performed the downgrade attack using Mimikatz itself after exploiting the target machine. The attacker then, either using Mimikatz or manually, can edit Registry Keys such as the LMCompatibilityLevel with values such as 0, 1, and 2. These values can make the compromised device use the NTLM downgraded or older version to interact with other SMB servers. This can lead to pivoting to other users and servers.</span></p>
<p class="" data-start="1625" data-end="2442"><span style="color: #000000;">However, in the attack described in this demonstration, Mimikatz is not used. Instead, the attacker invokes a local procedure call from a user-mode application to the NTLM authentication package through the SSPI. This calculates the NetNTLM response discussed earlier in the context of the logged-on user. The attack inherently disables the NetNTLMv1 preventive controls, then proceeds to extract all non-network logon tokens from currently running processes and impersonates the associated users. For each impersonated user, NTLM SSP locally invokes an NTLMv1 response to the chosen challenge and then restores the original values of the registry keys discussed earlier. Finally, the captured hash can be cracked with a tool of your preference, such as John the Ripper or Hashcat.</span></p>
<p><span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/eladshamir/Internal-Monologue">GitHub: Internal Monologue</a></strong></span></p>
<h3><span style="color: #800000;"><strong>Exploitation</strong></span></h3>
<p><span style="color: #000000;">You have the option to compile the executable by yourself by getting the binaries from GitHub. However, for this demonstration, we will be downloading the executable itself.</span></p>
<p><span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://github.com/eladshamir/Internal-Monologue/blob/master/InternalMonologueExe/bin/Release/InternalMonologue.exe">Download InternalMonologue.exe</a></strong></span></p>
<p><span style="color: #000000;">After downloading the executable, assuming the attacker holds the initial foothold of the target machine. It is required to transfer the executable to the target machine and run it with certain parameters. The Downgrade parameter should have the value true to downgrade the version. Then, the <strong data-start="442" data-end="463">Threads parameter</strong> should also hold the true value. Finally, to perform the <strong data-start="521" data-end="538">Impersonation</strong>, the <strong data-start="544" data-end="569">Impersonate parameter</strong> value should also be true. Upon successfully running the executable, the attacker is able to extract the downgraded v1 hash of the target user as demonstrated.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">InternalMonologue.exe -Downgrade true -Threads true -Impersonate true</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-2PlSKbAcd_k/YKAKfhpcWSI/AAAAAAAAwAM/I23YHZ71jZgyQ5J22wzK1xgsS2kNrlhpgCLcBGAsYHQ/s16000/1.png"/></p>
<h3><span style="color: #800000;"><strong>PowerShell Empire Exploitation</strong></span></h3>
<p><span style="color: #000000;">In case, the attacker decided to compromise the target machine through the PowerShell Empire and has an agent active, then they can perform a downgrade attack directly from PowerShell Empire. Inside the Credentials, the PowerShell Empire has a module called invoke_internal_monologue that essentially performs the same attack as the executable discussed earlier. This method doesn’t involve transferring an executable and running it on the target machine is much stealthier.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">usemodule credentials/invoke_internal_monologue
execute</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-4Be0a4BcK8Y/YKAKkqRtEII/AAAAAAAAwAQ/bXBkNOUPm_8B0ENXuipzYXCPgCbGiU-XACLcBGAsYHQ/s16000/2.png"/></p>
<h3><span style="color: #800000;"><strong>Decryption of Hash</strong></span></h3>
<p><span style="color: #000000;">In both variants of the attacks performed earlier, we found that the hash for the <strong data-start="367" data-end="374">raj</strong> user was the same. Now, there are two ways in which this hash can be used. Firstly, the attacker can directly use the hash to log in by performing a Pass the Hash. But if the attacker wants, they can crack the hash using John the Ripper. Store the extracted hash of the raj user in a file on the Desktop of our Kali Linux and named its hash. Then using John the Ripper with describing the format to be NetNTLM as demonstrated below. It can be observed that the hash can be cracked. The hash was found to be the password “123”.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">john --format=netntlm hash --show</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-irWV32LPS1Y/YKAKoq542oI/AAAAAAAAwAU/6m6pYKnjFNQUzm8CesS7eYjeqEgzcPUcACLcBGAsYHQ/s16000/3.png"/></p>
<h3><span style="color: #800000;"><strong>Conclusion</strong></span></h3>
<p class="" data-start="202" data-end="690"><span style="color: #000000;">Sometimes, ideas as simple as <strong data-start="761" data-end="786">NTLM Downgrade Attack</strong>—specifically downgrading the version of the authentication mechanism—can serve to be dangerous. Moreover, since this attack doesn’t require any tools that are on the target of various <strong data-start="971" data-end="995">Defensive Mechanisms</strong>, it can easily fly under the radar. As a result, it can successfully retrieve those credentials. Consequently, this is a testament that <strong data-start="1132" data-end="1144">Security</strong> is ever-evolving. Therefore, the only way to get ahead of an attacker is to think like one.</span></p>
<p><span style="color: #000000;"><strong>Author: Pavandeep Singh</strong> is a Technical Writer, Researcher, and Penetration Tester. Can be Contacted on </span><strong>Twitter</strong> and <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.linkedin.com/in/pavan2318/">LinkedIn</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
