<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Multiple Ways to Secure SSH Port</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/multiple-ways-to-secure-ssh-port/" rel="bookmark"><time class="entry-date published updated" datetime="2018-09-18T07:27:54+00:00">September 18, 2018</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;"><strong>Secure Shell</strong> (<strong>SSH</strong>) is defined as a network protocol to operate network services securely over an unsecured network. The standard TCP port for SSH is 22. The best application of SSH is to remotely login into computer systems by users.</span></p>
<p><span style="color: #000000;">This article will be explaining about the network securities which help the network administrator to secure the service of SSH on any server through multiple ways.</span></p>
<p><span style="color: #000000;"><strong> Methods Used:</strong></span></p>
<ol>
<li><span style="color: #000000;"> Port Forwarding</span></li>
<li><span style="color: #000000;"> Disable Password-Based Login And Using PGP Key (Public Key)</span></li>
<li><span style="color: #000000;"> Disable Root Login and Limit SSH User’s Access</span></li>
<li><span style="color: #000000;"> Google Authenticator</span></li>
<li><span style="color: #000000;"> Time Scheduling</span></li>
<li><span style="color: #000000;"> Disable Empty Passwords</span></li>
</ol>
<p><span style="color: #000000;">Before moving on, Let us first install an SSH server on our client machine using the following command.</span></p>
<pre class="lang:default decode:true">sudo apt-get install openssh-server</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-bAz_BDoeJDU/W6cxv8XnYJI/AAAAAAAAabg/0Zp6HqKTv7ELgweJ1llYJbpF9vzvEc5SACEwYBhgL/s1600/1.png"/></p>
<h3><span style="color: #800000;"><strong>Port Redirection</strong></span></h3>
<p><span style="color: #000000;">Once the SSH services are configured and running, we can begin with our first security measure which is <strong>Port Forwarding. </strong>Upon initiating the scan on the client’s machine <strong>IP address</strong> using nmap, it shows that <strong>SSH</strong> is running on <strong>Port 22</strong>.</span></p>
<p><img decoding="async" src="https://3.bp.blogspot.com/-jabS5Sr8lkA/W6cxx5MCIFI/AAAAAAAAabc/yA3l6UUbg1MAo4ElxeQ7ifIz8lVendRqQCEwYBhgL/s1600/2.1.png"/></p>
<p><span style="color: #000000;">Navigate to <strong>/etc/ssh </strong>and we will find a file named <strong>sshd_config</strong> in the client’s machine.</span></p>
<pre class="lang:default decode:true">cd /etc/ssh</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-q0-WCdnO05Q/W6cxyL6bbYI/AAAAAAAAabU/2ImUJ32zO2Mu3bhKBfK-yKzNf842NeI5wCEwYBhgL/s1600/2.png"/></p>
<p><span style="color: #000000;">Open the file <strong>sshd_config</strong> using <strong>nano command</strong>.</span></p>
<p><img decoding="async" src="https://2.bp.blogspot.com/-G0RJOK6F3Yg/W6cx0O8s8KI/AAAAAAAAabc/F5gXTbK7SOIXuW9UxuQwvyaS3aVzYSfigCEwYBhgL/s1600/3.png"/></p>
<p><span style="color: #000000;">Now change the <strong>port 22</strong> to <strong>port 2222</strong> as shown in the below screenshot and <strong>save </strong>the changes made in the <strong>sshd_config </strong>file. Hence, in this way we have forwarded the port from 22 to 2222.</span></p>
<p><img decoding="async" src="https://2.bp.blogspot.com/-5HGbsN6M0y8/W6c_UvSvToI/AAAAAAAAaeQ/hxDHUMs8QToaA64Dm0laZjFcEkUeYOEqwCEwYBhgL/s1600/4.png"/></p>
<p><span style="color: #000000;">Now to confirm port forwarding, we will again scan the <strong>Client’s IP address</strong> using <strong>nmap </strong></span></p>
<pre class="lang:default decode:true">nmap 192.168.1.104</pre>
<p><span style="color: #000000;">The output of the nmap shows that TCP port 2222 is opened; however, shows EthernetIP-1 in the service description which doesn’t give an exact description of the service running. So we will run the following nmap command with version detection option</span></p>
<pre class="lang:default decode:true">nmap -sV 192.168.1.104</pre>
<p><span style="color: #000000;">With the next output of nmap, it is clearly visible that SSH services are running on TCP Port 2222 along with the description of the OpenSSH version.</span></p>
<p><img decoding="async" src="https://3.bp.blogspot.com/-EfL6vFQjN_k/W6cx1OEJuII/AAAAAAAAabU/SWNZZ6iXAPcbTVo367diUjRh2vvbCjmEQCEwYBhgL/s1600/6.1.png"/></p>
<h3><span style="color: #800000;"><strong>Secure With Public Key</strong></span></h3>
<p><span style="color: #000000;">To begin with this security measure we need to download and install <strong>PuTTY Key Generator. </strong></span></p>
<p><span style="color: #000000;"><strong>Note:</strong> PuTTYgen is a key generator tool for creating SSH keys for PuTTY and stores keys in its own format ( .ppk extension)</span></p>
<p><span style="color: #000000;">Open it and Click on <strong>Generate.</strong></span></p>
<p><img decoding="async" src="https://3.bp.blogspot.com/-FfsQZGz8vhg/W6cx1bgqEOI/AAAAAAAAabY/3bcxd_VcqgIYwO7E7Yz6J3M_agY2jKQXQCEwYBhgL/s1600/6.png"/></p>
<p><span style="color: #000000;">Clicking on Generate will initiate the process of generating a Public and Private Key, as shown in the image.</span></p>
<p><img decoding="async" src="https://2.bp.blogspot.com/-yWQKafKKnSM/W6cx1nuNbBI/AAAAAAAAabQ/ecCdgrnrK48deV4Dro0GWRh6eG2kSd6MQCEwYBhgL/s1600/7.png"/></p>
<p><span style="color: #000000;">Once Public and Private Key are generated, click on <strong>Save Private Key</strong>. This will save the key as a Public Key.</span></p>
<p><img decoding="async" src="https://3.bp.blogspot.com/-YTrhT4lUcuk/W6cx1hGJ1VI/AAAAAAAAabc/sPDpldxtJMUc3gIHcXDnXP2knxM_3ifVgCEwYBhgL/s1600/8.png"/></p>
<p><span style="color: #000000;">Now open the Ubuntu terminal of our server and type <strong>ssh-keygen</strong>.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-NYKcuzYA2tE/W6cx138LUUI/AAAAAAAAabg/CB7fObsbifw95BwMy4nt82g1z6Fi-NaOACEwYBhgL/s1600/9.png"/></p>
<p><span style="color: #000000;">The above command will create a folder named <strong>.ssh </strong>and then create an empty text file with the name <strong>authorized_keys </strong>in the same folder<strong>.</strong> After that copy the “<strong>ssh_login.ppk</strong>” file which was created using <strong>PuTTy Key Generator</strong> previously and paste it into the <strong>.ssh</strong> folder <strong>as shown in the image.</strong></span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-H-BtK5E_p2w/W6cxwPjvzSI/AAAAAAAAabM/-Kv9mAguYWUpv0lHlwdaa5QneD3Ue083wCEwYBhgL/s1600/10.png"/></p>
<p><span style="color: #000000;">In the terminal, move into the .ssh folder and type the following command:</span></p>
<pre class="lang:default decode:true">puttygen -L "ssh_login.ppk"</pre>
<p><span style="color: #000000;">This command will open the key.</span></p>
<p><img decoding="async" src="https://2.bp.blogspot.com/-owavso2EYWg/W6cxwPU7z0I/AAAAAAAAabg/AgFYSGe3PP4qibIgF-7cNldeMqJg7vwjwCEwYBhgL/s1600/11.png"/></p>
<p><span style="color: #000000;">Now copy this key and paste it in the empty file named <strong>authorized_keys</strong> using <strong>nano</strong> command and save it.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-tKH3Q7Tm7F0/W6cxwVaCkuI/AAAAAAAAabc/hvmp5KTEp4cW3yGyeTSIBjvFqQliiDfxgCEwYBhgL/s1600/12.png"/></p>
<p><span style="color: #000000;">Now open the putty configuration tab, then go to <strong>Session tab </strong>and give the IP Address &amp; Port Number of your Clients Machine were ssh server is configured.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-AeV0lzu6vaI/W6cxwySLvHI/AAAAAAAAabU/ZrN1YI09GJItE3x7S8qZRM2x1VNuBx4QACEwYBhgL/s1600/13.png"/></p>
<p><span style="color: #000000;">Now go to <strong>data </strong>and give <strong>Auto-login username.</strong></span></p>
<p><img decoding="async" src="https://2.bp.blogspot.com/-zQH2fBM_k7g/W6cxw8wkrMI/AAAAAAAAabM/IPQpOSCHcYE93kZb4shOwayAlz_3taqFQCEwYBhgL/s1600/14.png"/></p>
<p><span style="color: #000000;">Navigate to <strong>SSH&gt;Auth</strong> and give the path of <strong>the ssh_login.ppk file</strong> (the public key that was generated earlier) and then click<strong> Open.</strong></span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-yPqVpZ1ZdAA/W6cxxLeLtgI/AAAAAAAAabc/x7_8x612SEIC3C3PA6gCOmm8vwU4jewpgCEwYBhgL/s1600/15.png"/></p>
<p><span style="color: #000000;">It will simply use the public key to Login into SSH Server without asking for Password.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-ZIeEZDdFN2Y/W6cxxRVJp7I/AAAAAAAAabM/SQ9aURlK67UBheIvBxLXlNr2jtOgzaw1gCEwYBhgL/s1600/16.png"/></p>
<p><span style="color: #000000;">Open the <strong>sshd_config</strong> file in <strong>/etc/ssh</strong> using <strong>gedit</strong> command. Here we will make changes in line <strong>#PasswordAuthentication </strong>as shown in the image.</span></p>
<p><span style="color: #000000;"><strong>Current configuration</strong></span></p>
<p><span style="color: #000000;"><strong>#PasswordAuthentication yes</strong></span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-rN3oOOYpE4M/W6cxxw8ZamI/AAAAAAAAabI/fEIL9dVp4gAJG0ReI81wU9GDNaRno3YnwCEwYBhgL/s1600/17.png"/></p>
<p><span style="color: #000000;">Now we will edit parameter value <strong>yes to no</strong> and <strong>remove the #</strong> (hash) as shown in the below image. Once done save the changes made. These changes will disable any user to log into SSH Server using the password.</span></p>
<p><span style="color: #000000;"><strong>PasswordAuthentication no</strong></span></p>
<p><img decoding="async" src="https://4.bp.blogspot.com/-A0iC98WVaMI/W6cxxnrJlrI/AAAAAAAAabY/IBEzIsC2HEMBQrN_-XO1PgX4uNVWPztMQCEwYBhgL/s1600/19.png"/></p>
<p><span style="color: #000000;">As you can see these settings have disabled password based login and is indeed asking for a Public Key to log in.</span></p>
<p><img decoding="async" src="https://3.bp.blogspot.com/-e8N7w1cBG3c/W6cxyVo2xxI/AAAAAAAAabU/cJawOa8xv6o8eqpgjbN5Mxrekb3WMG4dQCEwYBhgL/s1600/20.png"/></p>
<h3><span style="color: #800000;"><strong>Disable Root Login and Limit SSH User’s Access</strong></span></h3>
<p><span style="color: #000000;">To begin with, this security measure you need to make some new User’s using <strong>adduser </strong>command <strong>(New User’s We have Created: h1,h2,h3,h4)</strong> then make changes in the <strong>sshd_config</strong> file in /etc/ssh using <strong>gedit</strong> command. Type the Following Lines under <strong>#Authentication:</strong></span></p>
<p><span style="color: #000000;">#No root login allowed (h2 can log in as sudo –s)</span></p>
<p><span style="color: #000000;"><strong>PermitRootLogin no</strong></span></p>
<p><span style="color: #000000;"><strong>## only allow 1 users h2 (sysadmin)</strong></span></p>
<p><span style="color: #000000;"><strong>AllowUsers h2</strong></span></p>
<p><span style="color: #000000;">Remember to save the changes made. This will disable Root Login and will allow the only h2 user to log into ssh server remotely.</span></p>
<p><img decoding="async" src="https://4.bp.blogspot.com/-vW1qjKZh0dc/W6cxyiXswjI/AAAAAAAAabI/bRuhh8gvBZse1Gk8M9UykSrOUY1PB-Z3gCEwYBhgL/s1600/21.1.png"/></p>
<p><span style="color: #000000;">As you can see the only h2 user is able to successfully log into SSH Server, where h1 and h3 users permission to log into SSH Server is denied.</span></p>
<p><img decoding="async" src="https://4.bp.blogspot.com/-_kM8-ucdL5U/W6cxy1UMH5I/AAAAAAAAabU/-C_oKMlIWqU8XvO02sQnjoB2UWYnbzHQwCEwYBhgL/s1600/21.png"/></p>
<h3><span style="color: #800000;"><strong> Google Authenticator</strong></span></h3>
<p><span style="color: #000000;">To begin with the two-factor authentication over SSH Server, you need to download the google authenticator application on your phone and also install the required dependency package for Ubuntu using the following command:</span></p>
<pre class="lang:default decode:true">sudo apt-get install libpam-google-authenticator</pre>
<p><span style="color: #000000;"><strong>NOTE-</strong>The installation of google authenticator will as ask a couple of questions give Yes for every question asked.</span></p>
<p><img decoding="async" src="https://3.bp.blogspot.com/-L75PSBNwZWo/W6cxzMhCvsI/AAAAAAAAabc/RUqbiRoCp5EUO3PjdUGtST3qEdkh3XVigCEwYBhgL/s1600/23.png"/></p>
<p><span style="color: #000000;">After the installation is completed. Open terminal and type command:</span></p>
<pre class="lang:default decode:true">google-authenticator</pre>
<p><span style="color: #000000;">We will see a barcode. Scan it using the google authenticator application on your phone.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-Lafdxr-6g7I/W6cxzb82PgI/AAAAAAAAabc/WS8IRrC5nVYY-8pvpuyrnGOZpb2muM8TwCEwYBhgL/s1600/24.png"/></p>
<p><span style="color: #000000;">Once the application has scanned the barcode, it will start generating One Time Password’s as shown in the image.</span></p>
<p><img decoding="async" src="https://4.bp.blogspot.com/-PSdOaNZzxA0/W6cxzpACgzI/AAAAAAAAabY/vsZxafDXoVQXLJm579zNggC88SAgEHXYACEwYBhgL/s1600/25.jpg"/></p>
<p><span style="color: #000000;">Now open <strong>sshd</strong> file in <strong>/etc/pam.d</strong> using <strong>gedit</strong> command and make the following changes:</span></p>
<ol>
<li><span style="color: #000000;"><strong> Add # to @include common-auth</strong></span></li>
<li><span style="color: #000000;"><strong> Add Line (auth required pam_google_authenticator.so) under @include common-password</strong></span></li>
</ol>
<p>As shown in the image.</p>
<p><img decoding="async" src="https://3.bp.blogspot.com/-nL65xzPsbN4/W6c_S8L9rWI/AAAAAAAAaeM/Vdp7gUQ9ZOkcD4fHM9hzWYHBUGuLhRKLgCEwYBhgL/s1600/26.png"/></p>
<p>Now open the <strong>sshd_config</strong> file in <strong>/etc/ssh</strong> using <strong>gedit </strong>command and make the following changes.</p>
<p><strong>ChallengeResponseAuthentication yes</strong></p>
<p><img decoding="async" src="https://4.bp.blogspot.com/-2WV-ip1Vuus/W6c_TNhqV2I/AAAAAAAAaeM/cdQVqlFqhEYO7jL65-FTkPQd6PD3cBhIQCEwYBhgL/s1600/27.png"/></p>
<p>When we log into SSH Server it will prompt for a verification code, Here we have to enter the One Time Password generated on our google authenticator application. As you can see we have successfully logged into SSH Server using One Time Password.</p>
<p><img decoding="async" src="https://2.bp.blogspot.com/-xvMnjukazuU/W6c_Tg2y5NI/AAAAAAAAadg/3BWeCLDuziETSY0Gcq6aHRGaUI3GNk9XQCEwYBhgL/s1600/30.png"/></p>
<h3><span style="color: #800000;"><strong>Time Scheduling</strong></span></h3>
<p>In this security measure, we are going to <strong>set the time limit on SSH</strong> service on the server.</p>
<p><strong>Cron</strong> is a built-in service of Linux to schedule task, which enables a job (command or script) on the server to run automatically over specified time and date.</p>
<p>Here we are going to schedule SSH services using <strong>crontab</strong></p>
<p>We had open crontab in <strong>/etc</strong> using nano command. Now lets schedule ssh service in a way that it will start for every 2nd minute and will get stop after every 4<sup>th</sup> minute. The command used to schedule the SSH Service are given below:</p>
<pre class="lang:default decode:true ">*/2 * * * * root service ssh start
*/4 * * * * root service ssh stop</pre>
<p>Save the changes made in the file.</p>
<p><img decoding="async" src="https://3.bp.blogspot.com/-uqc3m6bJfWA/W6dAGNRELVI/AAAAAAAAaeo/rDzcQHdCxVE4qflr1VBBt8nYiBhu4YdwACLcBGAs/s1600/31.png"/></p>
<p>Wait for service to reboot. Using nmap we have scan port 22.</p>
<pre class="lang:default decode:true">nmap -p 22 192.168.1.104</pre>
<p>After running the scan, we will observe that ssh service on port 22 is CLOSED because it is the 4<sup>th</sup> minute which has started.</p>
<p>Now if our command is working properly it should start itself on every 2nd minute, to confirm it we will again initiate a scan using nmap.</p>
<pre class="lang:default decode:true">nmap –p 22 192.168.1.104</pre>
<p>As we can see that the port is in the OPEN state now.</p>
<p><img decoding="async" src="https://2.bp.blogspot.com/-WWsxwKjtI3E/W6c_T5VKICI/AAAAAAAAado/8Hmdgl6mlZgwb2UF62X53DVhwefSutdzQCEwYBhgL/s1600/32.png"/></p>
<h3><span style="color: #800000;"><strong>Disable Empty Password</strong></span></h3>
<p>In this security measure, as a best practice; one should always disable empty password login to the SSH Server. To enable this setting we need to open <strong>the sshd_config</strong> file using <strong>gedit </strong>command and make the following changes:</p>
<p><strong>PermitEmptyPasswords No</strong></p>
<p>These changes will simply disable empty password login’s into SSH Server.</p>
<p><img decoding="async" src="https://2.bp.blogspot.com/-CXLLv1jmJY0/W6c_UiIhNCI/AAAAAAAAad0/hjs7a7nJgdUJsaux2-k2T4NPvknpsetxACEwYBhgL/s1600/33.png"/></p>
<p><strong>Author</strong>: Ashray Gupta is a Security Researcher and Technical Writer at Hacking Articles. See’s things from a different angle and an out of the box thinker. Contact <a href="https://www.linkedin.com/in/ashray-gupta-b77221b6/"><strong>Here</strong></a></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
