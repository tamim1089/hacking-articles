<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/red-teaming/command-and-control/" rel="category tag">Command and Control</a>, <a href="https://www.hackingarticles.in/category/red-teaming/" rel="category tag">Red Teaming</a></span>            </div>
            <h1 class="post-title entry-title">Command &amp; Control: PoshC2</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/command-control-poshc2/" rel="bookmark"><time class="entry-date published" datetime="2020-03-29T10:34:41+00:00">March 29, 2020</time><time class="updated" datetime="2025-05-12T17:10:28+00:00">May 12, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">PoshC2 is an open-source remote administration and post-exploitation framework that is publicly available on GitHub. The server-side components of the tool are primarily written in Python, while the implants are written in PowerShell. Although PoshC2 primarily focuses on Windows implantation, it does contain a basic Python dropper for Linux/macOS.</span></p>
<h3><span style="color: #800000;">Table of Content</span></h3>
<ul>
<li><strong><span style="color: #000000;">Introduction</span></strong></li>
<li><strong><span style="color: #000000;">Features</span></strong></li>
<li><strong><span style="color: #000000;">Installation</span></strong></li>
<li><strong><span style="color: #000000;">Enumerate User Information</span></strong></li>
<li><strong><span style="color: #000000;">Enumerate Computer Information</span></strong></li>
<li><strong><span style="color: #000000;">Find All Vulnerabilities</span></strong></li>
<li><strong><span style="color: #000000;">Invoke ARP Scan</span></strong></li>
<li><strong><span style="color: #000000;">Get Key Strokes</span></strong></li>
<li><strong><span style="color: #000000;">Get Screenshot</span></strong></li>
</ul>
<h3><span style="color: #800000;">Features of PoshC2</span></h3>
<ul>
<li><span style="color: #000000;">Highly configurable payloads, including default beacon times, jitter, kill dates, user agents and more.</span></li>
<li><span style="color: #000000;">A large number of payloads generated out-of-the-box which are frequently updated and are maintained to bypass common Anti-Virus products.</span></li>
<li><span style="color: #000000;">Auto-generated Apache Rewrite rules for use in C2 proxy, protecting your C2 infrastructure and maintaining good operational security.</span></li>
<li><span style="color: #000000;">A modular format allowing users to create or edit C#, PowerShell or Python3 modules which are run in-memory by the Implants.</span></li>
<li><span style="color: #000000;">Notifications on receiving a successful Implant, such as via text message or Pushover.</span></li>
<li><span style="color: #000000;">A comprehensive and maintained contextual help and an intelligent prompt with contextual auto-completion, history, and suggestions.</span></li>
<li><span style="color: #000000;">Fully encrypted communications, protecting the confidentiality and integrity of the C2 traffic even when communicating over HTTP.</span></li>
<li><span style="color: #000000;">Client/Server format allowing multiple team members to utilize a single C2 server.</span></li>
<li><span style="color: #000000;">The system implements extensive logging to track every action and response. The application timestamps each entry and stores it in a database, capturing all relevant information such as user, host, implant number, and more. Additionally, the system directly logs the C2 server output to a separate file for better organization and analysis.</span></li>
<li><span style="color: #000000;">Support for Docker, allowing reliable and cross-platform execution</span></li>
</ul>
<h3><span style="color: #800000;">Installation of PoshC2</span></h3>
<p><span style="color: #000000;">We can install PoshC2 automatically for Python3 using the curl command. We need an elevated shell to execute this command successfully.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">curl -sSL https://raw.githubusercontent.com/nettitude/PoshC2/master/Install.sh | bash</pre>
<p><span style="color: #000000;">Now that we have installed the PoshC2 from the Github, we need to configure the listener to our IP Address. This can be done by editing the config file using the following command.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">posh-config</pre>
<p><span style="color: #000000;">After the required configurations are done, we need to open 2 instances of the terminals. Running the server and the handler. We need to run the Implant Handler, used to issue commands to the server and implants.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">posh</pre>
<p><span style="color: #000000;">Further, we will run the server which will communicate with the Implants and receive task output.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">posh-server</pre>
<p><img fetchpriority="high" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-4rA83zBDMlM/XoBr189tovI/AAAAAAAAjRQ/BHNRVXqtQfgSVzAyHBnRjTsNHPbbzXmbwCLcBGAsYHQ/s1600/1.png" alt="Command &amp; Control: PoshC2" width="785" height="951"/></p>
<p><span style="color: #000000;">You can use any one of the methods to gain a session from the ones that are depicted in the image above. Know that, as soon as we run the payload on the target machine. It activates an implant in the Implant handler as shown in the image given below.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-ST1aBc8lfWs/XoBr4Y5SvFI/AAAAAAAAjRs/1jsc0ieE_Lg69pEA8o8L3xAxrWGV3W28wCLcBGAsYHQ/s1600/2.png"/></p>
<h3><span style="color: #800000;">Enumerate User Information</span></h3>
<p><span style="color: #000000;">Now that we have an active implant in our Posh, It’s time to run some inbuilt modules to get some information about the Target System. We are going to start with the User Information, Group Information. This module dumps all the local users, local groups and their membership on the Target Machine. It gathers all the information using the WMI. To initiate this module, we will be using the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">get-userinfo</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-yZtmI9Om1cI/XoBr43mIWKI/AAAAAAAAjRw/nIiZdLscR4s8veBKAHM4uoG41F8TStF3wCLcBGAsYHQ/s1600/3.png"/></p>
<p><span style="color: #000000;">After working a while on the implant, we see that it has successfully enumerated all the user-related information from the target machine. We have information about the local users, local groups, number of local groups.</span></p>
<p><img decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-S5frBqwBZPY/XoBr5b_TdCI/AAAAAAAAjR0/f87BDEUwYHs1E4hxGTHdetYOkvaEQ0zXwCLcBGAsYHQ/s1600/4.png" alt="Command &amp; Control: PoshC2" width="294" height="821"/></p>
<h3><span style="color: #800000;">Enumerate Computer Information</span></h3>
<p><span style="color: #000000;">As we already enumerated the user’s information, now its time to get the information about the system. For this, we will use this implant. It is an external implant that is integrated with Posh C2. This is a Windows Powershell Script that runs in the background by the same name. It uses the PSInfo from the Sysinternals to gain the information regarding the Computer Name, Domain, Operating System, OS Architecture and much more.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">get-computerinfo</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-TPzv6NT4kms/XoBr5cyAGTI/AAAAAAAAjR4/sztenXbVJcAODHek-PQRM4a7DexHVnj4ACLcBGAsYHQ/s1600/5.png"/></p>
<p><span style="color: #000000;">After working for a while on the implant, we see that it has successfully enumerated a lot of System related information from the target machine.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-WWAex74AkkY/XoBr5srZgFI/AAAAAAAAjR8/7jYYrLKNe30jgWjE_VA1SYIdxEqLy22wgCLcBGAsYHQ/s1600/6.png"/></p>
<h3><span style="color: #800000;">Find All Vulnerabilities</span></h3>
<p><span style="color: #000000;">Now, comes the automated implant. This implant enumerates the target machine for a huge range of Local Privilege Escalation methods. It works quite similar to Windows Exploit Suggester. This is another Powershell script just like the previous implant that has been integrated into PoshC2. We can invoke this implant using the command given below:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">find-allvulns</pre>
<p><img decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-EyWCoahlmnk/XoBr6Os5_hI/AAAAAAAAjSA/pOYZw-tkNuQ_m2AB0bnCIEYOpYr75-AQQCLcBGAsYHQ/s1600/7.png" alt="Command &amp; Control: PoshC2" width="442" height="53"/></p>
<p><span style="color: #000000;">After working for a while on the implant, we can see that it successfully enumerated all the possible exploits that can elevate privileges on this machine.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-uRhsI2C23Ws/XoBr6TpCoiI/AAAAAAAAjSE/wDsyR38Rny466vJ13-tk0g4IZlZrrQywwCLcBGAsYHQ/s1600/8.png"/></p>
<h3><span style="color: #800000;">Invoke ARP Scan</span></h3>
<p><span style="color: #000000;">We can perform an arp-scan on the implant. This is based on the Powershell ArpScanner and uses C# AssemblyLoad. This scan deploys [DllImport(“iphlpapi.dll”, ExactSpelling=true)] to Export ‘SendARP’; by default, it will loop through all interfaces and perform an arp-scan of the local network based on the IP Address and Subnet mask provided by the network adapter. It can be invoked as shown in the image given below:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">invoke-arpscan</pre>
<p><img loading="lazy" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-3FLkJ80-pqg/XoBr6lJY72I/AAAAAAAAjSI/hDebX5uDCGEcvBs20LCewGWbhjnMhz6tQCLcBGAsYHQ/s1600/9.png" alt="Command &amp; Control: PoshC2" width="444" height="63"/></p>
<p><span style="color: #000000;">Then, we can see that the arp-scan module has worked successfully giving us a list of IP Addresses that are in the same network as the target implant.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-8bLhTtkRKZI/XoBr1WeCZHI/AAAAAAAAjRI/zIpp3X-hh4I6jJEnrT8i0T2C1r7aGHjwgCLcBGAsYHQ/s320/10.png"/></p>
<h3><span style="color: #800000;">Get Key Strokes</span></h3>
<p><span style="color: #000000;">Now, we will attempt to capture keystrokes from our target implant. You can accomplish this using the get-keystrokes module. The process divides into two parts. First, we initiate the keystroke capturing, and then we read the captured data. Although developers originally created this module as an external script in PowerShellMafia, they modified it to operate entirely in memory, avoiding any disk interactions. We start capturing the keystrokes using the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">get-keystrokes</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-ly0lMpLHGyc/XoBr1bOdYNI/AAAAAAAAjRM/1UD-f3ZXqPAnU8zxCOHo5H0eH_SKIFZPQCLcBGAsYHQ/s1600/11.png"/></p>
<p><span style="color: #000000;">By default, the keylogger will run for 60 minutes. It has started the sniffing out the keystrokes as shown in the image given below:</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-tC0t8HD5Ot0/XoBr2B8HaAI/AAAAAAAAjRU/-35hoIg2jloRSOvS6g_0BRP4pA4pcaPagCLcBGAsYHQ/s1600/12.png"/></p>
<p><span style="color: #000000;">Then, to read those keystrokes, we need to run the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">Get-KeystrokeData</pre>
<p><img loading="lazy" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-UixTB3UEqNg/XoBr2mi4krI/AAAAAAAAjRY/XW5jRdx4V6ojSIVTp6lhtezbYJ3wIK-RwCLcBGAsYHQ/s1600/13.png" alt="Command &amp; Control: PoshC2" width="444" height="63"/></p>
<p><span style="color: #000000;">This will show us all the keystrokes that have been performed by the target implant. This is better than other methods to sniff keystrokes because it also shows the function keys like Ctrl and Shifts key entries which can be quite helpful in some scenarios.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-1dtsITtSUAw/XoBr2o7UmyI/AAAAAAAAjRc/Vh3XpfVzMDIGe2HrpsPk7rDi1tJHPqIZwCLcBGAsYHQ/s1600/14.png"/></p>
<h3><span style="color: #800000;">Get Screenshot</span></h3>
<p><span style="color: #000000;">Now, it’s time to take a closer look at the target’s system. This can be accomplished using the <strong data-start="96" data-end="114">get-screenshot</strong> module. This method is straightforward. We will initiate an implant that captures screenshots of the target’s active screen. This module is particularly useful for gathering evidence or directly observing the target’s activities in real-time. You can start this module by using the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">get-screenshot</pre>
<p><img decoding="async" src="https://1.bp.blogspot.com/-WXIR2wNXw10/XoBr25Q0n1I/AAAAAAAAjRg/KmQfi_qX5uE59WqR7PFig1jJwpIeAl-UQCLcBGAsYHQ/s1600/15.png"/></p>
<p><span style="color: #000000;">As shown in the following image, the command executed successfully, and we have captured the live screen of the target.</span></p>
<p><img decoding="async" src="https://1.bp.blogspot.com/-lNi-G_Qm2IM/XoBr3awneKI/AAAAAAAAjRk/KFtUecINYQgn67ylaNpmH32ngNB7BidvACLcBGAsYHQ/s1600/16.png"/></p>
<p><span style="color: #000000;">As mentioned in the image above, you can navigate to the specified location to access the target’s screen. The screenshot captured in this process is displayed below:</span></p>
<p><img loading="lazy" decoding="async" class="alignnone" src="https://1.bp.blogspot.com/-HwtoWx8wcO0/XoBr3y_6mVI/AAAAAAAAjRo/1NKAY59URsMRiSufQtoQ6oFWF9XIL6btQCLcBGAsYHQ/s1600/17.png" alt="Command &amp; Control: PoshC2" width="771" height="603"/></p>
<p><span style="color: #000000;">To learn more about <strong>Command and Control</strong>. Follow this <strong><a href="https://www.hackingarticles.in/category/red-teaming/command-and-control/">Link.</a></strong></span></p>
<p><span style="color: #000000;"><strong>Author</strong>: Kavish Tyagi is a Cybersecurity enthusiast and Researcher in the field of WebApp Penetration testing. Contact</span> <a href="https://www.linkedin.com/in/kavish-tyagi-844239125/"><strong>here</strong></a></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
