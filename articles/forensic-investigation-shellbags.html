<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/cyber-forensics-tricks/" rel="category tag">Cyber Forensics</a></span>            </div>
            <h1 class="post-title entry-title">Forensic Investigation: Shellbags</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/forensic-investigation-shellbags/" rel="bookmark"><time class="entry-date published" datetime="2020-10-26T16:20:39+00:00">October 26, 2020</time><time class="updated" datetime="2025-05-17T19:12:39+00:00">May 17, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">In this article, we will be focusing on shellbags and its forensic analysis using shellbag explorer. Shellbags are created to enhance the users’ experience by remembering user preferences while exploring folders, the information stored in shellbags is useful for forensic investigation.To learn more about Cyber Forensics. Follow this <strong><a href="https://www.hackingarticles.in/category/cyber-forensics-tricks/">Link</a></strong></span></p>
<h3><span style="color: #800000;"><strong>Table of Contents</strong></span></h3>
<ul>
<li><span style="color: #000000;">Introduction</span></li>
<li><span style="color: #000000;">Location of shellbags</span></li>
<li><span style="color: #000000;">Forensic analysis using Shellbags Explorer</span></li>
<li><span style="color: #000000;">Active Registry Analysis</span></li>
<li><span style="color: #000000;">Offline Registry Analysis</span></li>
</ul>
<h3><span style="color: #800000;"><strong>Introduction</strong></span></h3>
<p><span style="color: #000000;">Microsoft introduced Windows Shell Bags into the Windows 7 operating system, and they remain present on all later Windows platforms. Shellbags are registry keys that improve user experience and recall user preferences whenever needed. The user’s exercises create shellbags.</span></p>
<p><span style="color: #000000;">As a digital forensic investigator, you can use shellbags to prove whether a particular user accessed a specific folder. You can even check whether someone created the specific folder or whether it was available. You can also find out whether someone accessed external directories on external devices.</span></p>
<p><span style="color: #000000;">For the most part, Shell Bags hold data about the user’s activities while exploring Windows. This implies that if the user changes icon sizes from large icons to the grid, the system updates the settings in Shell Bag instantly. When you open, close, or change the review option of any folder on your system, either from Windows Explorer or from the Desktop, even by right-clicking or renaming the organizer, the system creates or updates a Shellbag record.</span></p>
<h3><span style="color: #800000;"><strong>Location of shellbags</strong></span></h3>
<p><span style="color: #000000;"><strong>Windows XP</strong></span></p>
<p><span style="color: #000000;">The shellbags for Windows XP are stored in NTUSER.DAT</span></p>
<ul>
<li><span style="color: #000000;">Network folders references:\Software\Microsoft\Windows\Shell</span></li>
<li><span style="color: #000000;">Local folder references: \Software\Microsoft\Windows\ShellNoRoam</span></li>
<li><span style="color: #000000;">Removable device folders: \Software\Microsoft\Windows\StreamMRU</span></li>
</ul>
<p><span style="color: #000000;"><strong>Windows 7 to Windows 10</strong></span></p>
<p><span style="color: #000000;">Shellbags are a set of subkeys in the UsrClass.dat registry hive of Windows 10 systems. The shell bags are stored in both NTUSER.DAT and USRCLASS.DAT.</span></p>
<ul>
<li><span style="color: #000000;">NTUSER.DAT: HKCU\Software\Microsoft\Windows\Shell</span></li>
<li><span style="color: #000000;">USRCLASS.DAT: HKCU\Software\Classes\Local Settings\Software\Microsoft\Windows\Shell</span></li>
</ul>
<p><span style="color: #000000;">The majority of the data is found in the USRCLASS.DAT hive-like local, removable, and network folders’ data. You can manually check shellbags entry in the registry editor like so. In the following screenshot, a shellbag entry for a folder named jeenali is shown.</span></p>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-CgK5ZKCxjLY/X5bxAZD5umI/AAAAAAAApyw/A9CtdKF_K6MzwNd-3-w40efdq6_8gS_NQCLcBGAsYHQ/s16000/7.png"/></strong></span></p>
<p><span style="color: #000000;">The Shellbag data contains two main registry keys, BagMRU and Bags</span></p>
<ul>
<li><span style="color: #000000;"><strong>BagMRU</strong>: This stores folder names and folder path similar to the tree structure. The root directory is represented by the first bagMRU key i.e. 0. BagMRU contains numbered values that compare to say sub key’s nested subkeys. All of these subkeys contain numbered values aside from the last child in each branch.</span></li>
<li><span style="color: #000000;"><strong>Bag</strong>: These stores view preference such as the size of the window, location, and view mode.</span></li>
</ul>
<p><span style="color: #000000;">We will be analyzing the shellbags using the shellbag explorer.</span></p>
<ol>
<li><span style="color: #000000;">ShellBags explorer(SBECmd)</span></li>
<li><span style="color: #000000;">Shellbags explorer (GUI version)</span></li>
</ol>
<p><span style="color: #000000;">Shellbags explorer is a tool by Eric Zimmerman to analyze shellbags. The shellbags explorer is available in both versions cmd and GUI. You can download the tool from <a style="color: #000000;" href="https://ericzimmerman.github.io/#!index.md">here</a>.</span></p>
<h3><span style="color: #800000;"><strong><span style="color: #000000;">Forensic Analysis of Shellbag</span> </strong></span></h3>
<h3><span style="color: #800000;"><strong>Analysis using SBECmd</strong></span></h3>
<p><span style="color: #000000;">Here we are using the SBECmd.exe (Cmd version of the shellbag explorer tool) by Eric Zimmerman. This cmd tool is great for command prompt lovers who prefer using commands over GUI.</span></p>
<p><span style="color: #000000;">To get a clear idea about how shell bags work and store data and how you can analyze it I have created a new folder named “raaj” which consists of a text document. Further, we will be renaming it to geet and then to jeenali. Let’s analyze the shellbags entries for this.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-ke9bqpOEces/X5bxfIvatJI/AAAAAAAApy4/tbMwlkVW9jwZu2Qe_s8KoM2bRBpq0oClwCLcBGAsYHQ/s16000/1.png"/></span></p>
<p><span style="color: #000000;">Run the executable file and browse to the directory where the executable is present. To extract the shellbags data into a .csv file use the following command:</span></p>
<pre class="lang:default decode:true">SBECmd.exe –l --csv ./</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-WtUd7P2Vdco/X5bxmK8-scI/AAAAAAAApy8/l154TawqYXo36H2UXWwWhp6H6X_eSXXlQCLcBGAsYHQ/s16000/2.png"/></span></p>
<p><span style="color: #000000;">As a result of the above command, a .csv file will be created in the directory.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-UQjQtLg41tU/X5bxtGNsSXI/AAAAAAAApzA/bnwfic3gntEOp9_KZ9uheHWWglTzTxuEACLcBGAsYHQ/s16000/3.png"/></span></p>
<p><span style="color: #000000;">Lets’ open the .csv file and analyze it.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-Q8Mq6BVQxbc/X5bxyLG94wI/AAAAAAAApzI/rEPF7-_OEZQWrCUDgcLf2EKYj3qni-KUACLcBGAsYHQ/s16000/6.png"/></span></p>
<p><span style="color: #000000;">As I mentioned earlier, we renamed the folder named “raaj” to “geet” and then to “jeenali.” As highlighted in the screenshot, the MFT entry number is the same for all three folders, which shows that we renamed the folder.</span></p>
<ul>
<li><span style="color: #000000;"><strong>Shellbags explorer (GUI version)</strong></span></li>
</ul>
<h3><span style="color: #800000;"><strong>Active Registry Analysis</strong></span></h3>
<p><span style="color: #000000;">Using the shellbags explorer we can also analyze the active registry. Select load an active registry which will load the registry in use by the active user.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-fpeEcXWNCbk/X5bx8ryaqfI/AAAAAAAApzQ/vJtsKuuKJVQMsyDT267g8X2XVb3AdUZ_ACLcBGAsYHQ/s16000/8.png"/></span></p>
<p><span style="color: #000000;">They successfully parse the shellbags from the active registry.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-LIz5yzHWUB0/X5byA5zE-CI/AAAAAAAApzY/9G6C1oFVvRI9I1rLUDIBKiEW0L2wAZ9pwCLcBGAsYHQ/s16000/9.png"/></span></p>
<p><span style="color: #000000;">The shellbags parse contains the shellbags entries created based on users’ activities. As depicted earlier the folder renamed will have a similar MFT entry number. Here, I have created a folder named “raaj” and we will be further renaming it to “geet”.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-FHD5p0Xv3KA/X5byHaQogAI/AAAAAAAApzg/vhA7JCJNtCYNfcoL_CfLQx69kggplgbawCLcBGAsYHQ/s16000/10.png"/></span></p>
<p><span style="color: #000000;">Whenever a folder is renamed an entry is stored in shellbag, the MFT entry number of both the folder will be the same.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-T-vpGpnrQbI/X5byMkf4EcI/AAAAAAAApzk/bKJGcrPdXCklMkqMyTzT0oFHH544cgQBgCLcBGAsYHQ/s16000/11.png"/></span></p>
<p><span style="color: #000000;">Now, once again rename the folder to jeenali. The MFT entry will be similar to the previous one.</span></p>
<p><span style="color: #000000;"><strong> <img decoding="async" src="https://1.bp.blogspot.com/-vvc3YzHIhfU/X5bySuj4X2I/AAAAAAAApzs/jmhEWHQR2CAdY-HljK-QwpwH1Z8UNtPzQCLcBGAsYHQ/s16000/12.png"/></strong></span></p>
<h3><span style="color: #800000;"><strong>Offline registry analysis</strong></span></h3>
<p><span style="color: #000000;">For offline analysis, we first have to extract the shellbags file which is USRCLASS.DAT. Let’s extract the shellbag file using FTK imager. Download FTK imager from <strong><span style="color: #0000ff;"><a style="color: #0000ff;" href="https://www.exterro.com/digital-forensics-software/ftk-imager">here</a></span></strong>.</span></p>
<p><span style="color: #000000;">Lets’ add in the evidence, go to the add evidence item.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-VVcOf95koR0/X5byZMyf41I/AAAAAAAApzw/X0VF3QEZ918oySRaFVSKMYVWxMTIvmePgCLcBGAsYHQ/s16000/13.png"/></span></p>
<p><span style="color: #000000;">Select the source for adding evidence as here I have selected the logical drive as usrclass.dat is present in the C drive.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-_RxB2yXUb4g/X5byeQ624VI/AAAAAAAApz4/pTP_2dRGMkEzuIRNbmVLPoL9BT5tcsV9wCLcBGAsYHQ/s16000/14.png"/></span></p>
<p><span style="color: #000000;">Next, select the desired user drive. Click <strong>Finish</strong>.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-1JuE_z6FFJk/X5byjXM13oI/AAAAAAAAp0A/FobnXBABV6sRO0MLXoQ89w9NQksuWAFRgCLcBGAsYHQ/s16000/15.png"/></span></p>
<p><span style="color: #000000;">Expand the window to the location of the usrclass.dat. Select the user you want to investigate go to the following path to extract the UsrClass.dat.</span></p>
<p><span style="color: #000000;"><strong>root &gt; users &gt; administrator &gt;Appdata&gt;Local&gt;Microsoft&gt;windows</strong></span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-H6bC44Rj1Ck/X5byoYXn2pI/AAAAAAAAp0E/dAQtJ8EWo40Dco-GD25un6B60pW5spDCwCLcBGAsYHQ/s16000/16.png"/></span></p>
<p><span style="color: #000000;">We will be analyzing the usrclass.dat extracted from the above step using shell bag explorer by Eric Zimmerman.</span></p>
<p><span style="color: #000000;">As we have exported the registry hives we will choose “<strong>load offline hive</strong>”</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-HgUx0RaWwhM/X5bythI5mmI/AAAAAAAAp0M/Y3yCoo2asqIQLHws78EcHJ9NDHI5GnsrgCLcBGAsYHQ/s16000/17.png"/></span></p>
<p><span style="color: #000000;">After successful parsing of the extracted shellbags file, you will be able to see the entries for folders browsed, created, deleted, etc. Here is the entry of the folders renamed earlier, the MFT entry number is the same for the three folders.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-cOXiIBC_cPQ/X5byybN18AI/AAAAAAAAp0U/ycTPh4hkSK4Pt3SB9MnXLMdkIgGXi2uEwCLcBGAsYHQ/s16000/18.png"/></span></p>
<p><span style="color: #000000;">Now here, I have deleted the folder named “jeenali”. Now lets’ check the shellbags data whether the deleted folder still exists or not.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-tu8TXmXUchc/X5by4bsbxyI/AAAAAAAAp0c/hkq5gvcaVyMJl-4Cmd-5ZYwx7aH2Phm2ACLcBGAsYHQ/s16000/19.png"/></span></p>
<p><span style="color: #000000;">Yes, the shellbags store the entry even though someone deleted the folder later.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-oSaRlwq9mRU/X5by-NpoNQI/AAAAAAAAp0k/7-eISSfYrmIK9mtg1wuj1a2DoAAbrYGSQCLcBGAsYHQ/s16000/20.png"/></span></p>
<p><span style="color: #000000;">Shellbags stores the entries of the directories accessed by the user, user preferences such as window size, icon size. Shellbags explorer parses the shellbags entries shows the absolute path of the directory accessed, creation time, file system, child bags. The tool classifies the folders accessed according to the location of the folder. Users create Shellbags for compressed files (ZIP files), command prompt, search window, renaming, moving, and deleting a folder.</span></p>
<p>To learn more about Cyber Forensics. Follow this <strong><a href="https://www.hackingarticles.in/category/cyber-forensics-tricks/">Link</a></strong></p>
<p><span style="color: #000000;"><strong>Author: </strong>Vishva Vaghela is a Digital Forensics enthusiast and enjoys technical content writing. You can reach her on</span><strong><a href="https://www.linkedin.com/in/vishva-vaghela-979446191/"> Here</a></strong></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-related-none yarpp-template-thumbnails">
